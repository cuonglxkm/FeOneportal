<one-portal-header
  title="Security Group"
  [path]="['Home', 'Dịch vụ', 'Security Group']"
  [regionId]="region"
  (onProjectChanged)="projectChanged($event)"
  (onRegionChanged)="regionChanged($event)"
/>
<one-portal-create-security-group
  nz-tooltip
  nzTooltipTitle="Tạo mới Security Group"
  nzTooltipPlacement="bottom"
  [conditionSearch]="conditionSearch"
  (onOk)="handleOkCreate()"
/>
<nz-content>
  <nz-card>
    <div style="display: flex; justify-content: space-between">
      <div class="title"><h3>Danh sách Security Group</h3></div>
      <div class="label" style="display: flex; gap: 10px;">
        <span>Chọn Security group</span>
      </div>
    </div>

        <nz-space [nzSize]="24">
            <nz-select
            *nzSpaceItem
            nzShowSearch
            nzAllowClear
            nz-tooltip
            nzTooltipTitle="Chọn Security Group"
            nzTooltipPlacement="bottom"
            nzPlaceHolder="Select a security"
            [(ngModel)]="selectedValue"
            [nzLoading]="isLoading"
            (ngModelChange)="onSecurityGroupChange()"
          >
            <nz-option
              *ngFor="let item of options"
              [nzValue]="item"
              nzLabel="{{ item.name }}"
            ></nz-option>
          </nz-select>
          <div *nzSpaceItem>
            <one-portal-delete-security-group
              nz-tooltip
              nzTooltipTitle="Xóa Security Group"
              nzTooltipPlacement="bottom"
              *ngIf="!!selectedValue"
              [condition]="conditionSearch"
              [id]="selectedValue.id"
              (onOk)="handleOk()"
            />
          </div>
          
        </nz-space>
    <nz-row style="margin-bottom: 16px">
      <nz-col nzSpan="4">
        <div class="label">Mô tả</div>
      </nz-col>
      <nz-col>
        <div class="label">{{ selectedValue?.description || '' }}</div>
      </nz-col>
    </nz-row>
    <one-portal-inbound-list
      [securityGroupId]="selectedValue?.id"
      [regionId]="region"
      [projectId]="project"
    />
    <one-portal-list-outbound
      [securityGroupId]="selectedValue?.id"
      [regionId]="region"
      [projectId]="project"
    />
    <nz-row>
      <section class="code-box-meta markdown">
        <div class="code-box-title">Quản lý Gán/Gỡ Security Group</div>
        <div class="code-box-description">
          <nz-table
            #basicTable
            [nzData]="collection?.records || []"
            nzShowSizeChanger
            [nzScroll]="{ x: '1000px', y: '240px' }"
            [nzFrontPagination]="false"
            [nzTotal]="collection?.totalCount || 0"
            [nzPageSize]="collection?.pageSize || 0"
            (nzPageSizeChange)="onPageSizeChange($event)"
            (nzPageIndexChange)="onPageIndexChange($event)"
            [nzLoading]="isLoading"
          >
            <thead>
              <tr>
                <th nzAlign="center" class="text-th" nzLeft>Tên máy ảo</th>
                <th nzAlign="center" class="text-th" nzBreakWord>Trạng thái</th>
                <th nzAlign="center" class="text-th" nzBreakWord>
                  Trạng thái tác vụ
                </th>
                <th nzAlign="center" class="text-th" nzBreakWord>IP LAN</th>
                <th nzAlign="center" class="text-th" nzBreakWord>IP Public</th>
                <th
                  nzAlign="center"
                  class="text-th"
                  style="width: 216px"
                  nzBreakWord
                >
                  Thao tác
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of basicTable.data">
                <td nzAlign="center" nzLeft>{{ data.name }}</td>
                <td nzAlign="center" nzBreakWord>{{ data.status }}</td>
                <td nzAlign="center" nzBreakWord>{{ data.taskState }}</td>
                <td nzAlign="center" nzBreakWord>{{ data.ipPrivate }}</td>
                <td nzAlign="center" nzBreakWord>{{ data.ipPublic }}</td>
                <td nzAlign="center" nzBreakWord>
                  <ng-container
                    *ngIf="
                      data.securityGroups.includes(selectedValue?.id);
                      else elseBlock
                    "
                  >
                    <button
                      nz-button
                      nzType="primary"
                      nzDanger
                      class="button-delete"
                      (click)="showModalDetach(data.id)"
                    >
                      Gỡ
                    </button>
                    <one-portal-attach-or-detach
                      [isVisible]="isVisibleDetach"
                      [title]="'Xác nhận gỡ security group khỏi máy ảo'"
                      [content]="
                        'Bạn có chắc chắn muốn gỡ security group khỏi máy ảo'
                      "
                      (onCancel)="handleCancelDetach()"
                      (onOk)="handleOkDetach()"
                    />
                  </ng-container>
                  <ng-template #elseBlock>
                    <button
                      nz-button
                      nzType="primary"
                      class="button-attach"
                      (click)="showModalAttach(data.id)"
                    >
                      Gán
                    </button>
                    <one-portal-attach-or-detach
                      [isVisible]="isVisibleAttach"
                      [title]="'Xác nhận gán security group vào máy ảo'"
                      [content]="
                        'Bạn có chắc chắn muốn gán security group vào máy ảo'
                      "
                      (onCancel)="handleCancelAttach()"
                      (onOk)="handleOkAttach()"
                    />
                  </ng-template>
                </td>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </section>
    </nz-row>
  </nz-card>
</nz-content>
