<one-portal-header
  title="Security Group"
  [path]="['Home', 'Dịch vụ', 'Security Group']"
  [regionId]="region"
  (onProjectChanged)="projectChanged($event)"
  (onRegionChanged)="regionChanged($event)"
/>
<one-portal-create-security-group
  nz-tooltip
  nzTooltipTitle="Tạo mới Security Group"
  nzTooltipPlacement="bottom"
  [conditionSearch]="conditionSearch"
  (onOk)="handleOkCreate()"
/>
<nz-content>
  <ng-container [ngSwitch]="isBegin">
    <ng-container *ngSwitchCase="false">
  <nz-card>
    <div style="display: flex; justify-content: space-between">
      <div class="title">
        <h3 style="font-size: 20px; font-weight: 600">
          Danh sách Security Group
        </h3>
      </div>
      <div class="label">
        <span style="font-size: 16px">Security group: </span>
        <nz-space [nzSize]="24">
          <nz-select
            *nzSpaceItem
            nzShowSearch
            nzAllowClear
            nz-tooltip
            nzTooltipTitle="Chọn Security Group"
            nzTooltipPlacement="bottom"
            nzPlaceHolder="Select a security"
            [(ngModel)]="selectedValue"
            [nzLoading]="isLoading"
            (ngModelChange)="onSecurityGroupChange()"
          >
            <nz-option
              *ngFor="let item of options"
              [nzValue]="item"
              nzLabel="{{ item.name }}"
            ></nz-option>
          </nz-select>
          <div *nzSpaceItem>
            <one-portal-delete-security-group
              *ngIf="!!selectedValue"
              [condition]="conditionSearch"
              [id]="selectedValue.id"
              (onOk)="handleOk()"
            />
          </div>
        </nz-space>
      </div>
    </div>

    <div style="margin-bottom: 16px; display: flex; gap: 40px">
      <div class="description-title">Mô tả:</div>
      <div class="description-detail">
        Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quaerat
        eligendi ratione doloremque deserunt pariatur soluta dicta aperiam
        deleniti esse. Eveniet corporis excepturi voluptatum nihil aliquid vero
        placeat voluptatibus repellat eligendi.
      </div>
    </div>
    <one-portal-inbound-list
      [securityGroupId]="selectedValue?.id"
      [regionId]="region"
      [projectId]="project"
    />
    <one-portal-list-outbound
      [securityGroupId]="selectedValue?.id"
      [regionId]="region"
      [projectId]="project"
    />
    <nz-row>
      <section
        class="code-box-meta markdown"
        style="border: 1px solid #e1edf8; border-radius: 8px"
      >
        <div
          style="
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #e1edf8;
          "
        >
          <div class="code-box-title">Quản lý Gán/Gỡ Security Group</div>
        </div>
        <div class="code-box-description">
          <nz-table
            #basicTable
            [nzData]="collection?.records || []"
            nzShowSizeChanger
            [nzScroll]="{ x: '1000px', y: '240px' }"
            [nzFrontPagination]="false"
            [nzTotal]="collection?.totalCount || 0"
            [nzPageSize]="collection?.pageSize || 0"
            (nzPageSizeChange)="onPageSizeChange($event)"
            (nzPageIndexChange)="onPageIndexChange($event)"
            [nzLoading]="isLoading"
          >
            <thead>
              <tr>
                <th nzAlign="center" class="text-th" nzLeft>Tên máy ảo</th>
                <th nzAlign="center" class="text-th" nzBreakWord>Trạng thái</th>
                <th nzAlign="center" class="text-th" nzBreakWord>
                  Trạng thái tác vụ
                </th>
                <th nzAlign="center" class="text-th" nzBreakWord>IP LAN</th>
                <th nzAlign="center" class="text-th" nzBreakWord>IP Public</th>
                <th
                  nzAlign="center"
                  class="text-th"
                  style="width: 216px"
                  nzBreakWord
                >
                  Thao tác
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of basicTable.data">
                <td nzAlign="center" nzLeft>{{ data.name }}</td>
                <td nzAlign="center" nzBreakWord>{{ data.status }}</td>
                <td nzAlign="center" nzBreakWord>{{ data.taskState }}</td>
                <td nzAlign="center" nzBreakWord>{{ data.ipPrivate }}</td>
                <td nzAlign="center" nzBreakWord>{{ data.ipPublic }}</td>
                <td nzAlign="center" nzBreakWord>
                  <ng-container
                    *ngIf="
                      data.securityGroups.includes(selectedValue?.id);
                      else elseBlock
                    "
                  >
                    <button
                      style="
                        border: none;
                        background-color: transparent;
                        margin-left: -30px;
                        cursor: pointer;
                      "
                      class="button-delete"
                      (click)="showModalDetach(data.id)"
                    >
                      <img
                        src="assets/imgs/bin.svg"
                        alt=""
                        class="icon-image"
                        style="cursor: pointer"
                      />
                    </button>
                    <one-portal-attach-or-detach
                      [isVisible]="isVisibleDetach"
                      [title]="'Xác nhận gỡ security group khỏi máy ảo'"
                      [content]="
                        'Bạn có chắc chắn muốn gỡ security group khỏi máy ảo'
                      "
                      (onCancel)="handleCancelDetach()"
                      (onOk)="handleOkDetach()"
                    />
                  </ng-container>
                  <ng-template #elseBlock>
                    <button
                      nz-button
                      nzType="primary"
                      class="button-attach"
                      (click)="showModalAttach(data.id)"
                    >
                      Gán
                    </button>
                    <one-portal-attach-or-detach
                      [isVisible]="isVisibleAttach"
                      [title]="'Xác nhận gán security group vào máy ảo'"
                      [content]="
                        'Bạn có chắc chắn muốn gán security group vào máy ảo'
                      "
                      (onCancel)="handleCancelAttach()"
                      (onOk)="handleOkAttach()"
                    />
                  </ng-template>
                </td>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </section>
    </nz-row>
  </nz-card>
  </ng-container>
  <ng-container *ngSwitchDefault>
    <nz-card>
      <nz-row nzJustify="center">
        <img src="/assets/imgs/backup-vm-blank.png" width="450" height="450" alt="blank-security-group">
      </nz-row>
      <nz-row nzJustify="center" style="margin-top:15px;">
        <div class="text-title">
          <h1>Backup VM - Sao lưu, bảo mật</h1>
        </div>
      </nz-row>
      <nz-row nzJustify="center">
        <div class="text-subtitle" style="text-align: center;">Giải pháp sao lưu VM nâng cao, phần mềm giúp giảm chi phí chụp nhanh và tiết kiệm thời gian của bạn bằng
          cách tạo các bản sao VM giống hệt nhau trực tiếp từ các bản sao lưu VM hiện có.</div>
      </nz-row>
      <nz-row nzJustify="center">
        <button style="text-align: center; margin-top: 10px" nz-button nzType="primary" [routerLink]="'/app-smart-cloud/schedule/backup/create'">Khởi tạo ngay</button>
      </nz-row>
    </nz-card>
  </ng-container>
</ng-container>
</nz-content>
