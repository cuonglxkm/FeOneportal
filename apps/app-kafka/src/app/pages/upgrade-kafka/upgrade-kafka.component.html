<ng-container *ngIf="itemDetail">
    <page-header [breadcrumb]="breadcrumb" [title]="'Nâng cấp dịch vụ Kafka'" [action]="action">
        <ng-template #breadcrumb>
            <nz-breadcrumb>
                <nz-breadcrumb-item>
                    <a [routerLink]="['/']">Trang chủ</a>
                </nz-breadcrumb-item>
                <nz-breadcrumb-item>
                    <a [routerLink]="['/app-kafka']">Kafka</a>
                </nz-breadcrumb-item>
                <nz-breadcrumb-item>
                    Nâng cấp dịch vụ Kafka
                </nz-breadcrumb-item>
            </nz-breadcrumb>
        </ng-template>

        <!-- action -->
        <ng-template #action>
            <div class="alain-custom-action text-right">
                <region-select-dropdown [isDetail]="true"></region-select-dropdown>
                <project-select-dropdown [regionId]="regionId" [isDetail]="true"></project-select-dropdown>
            </div>
        </ng-template>
    </page-header>

    <div nz-row [nzGutter]="16">
        <div nz-col [nzSpan]="16" class="form-new">
            <nz-card class="border-card" id="general">
                <h3><b>Thông tin dịch vụ</b></h3>
                <div nz-row>
                    <div nz-col [nzSpan]="5">Tên Kafka Cluster:</div>
                    <div><b>{{this.itemDetail.serviceName}}</b></div>
                </div>
                <div nz-row>
                    <div nz-col [nzSpan]="5">Ngày khởi tạo:</div>
                    <div>22/05/2024</div>
                </div>
                <div nz-row>
                    <div nz-col [nzSpan]="5">Ngày hết hạn:</div>
                    <div style="color: #ea3829">22/06/2024</div>
                </div>
                <div nz-row>
                    <div nz-col [nzSpan]="5">Cấu hình gói dịch vụ:</div>
                    <div><b>{{this.itemDetail.offerName}}</b></div>
                </div>
                <div nz-row>
                    <div nz-col [nzSpan]="4">
                        Số Broker: 3
                    </div>
                    <div nz-col [nzSpan]="6"></div>
                    <div>
                        CPU: {{itemDetail.cpu}} VCPU
                    </div>
                </div>
                <div nz-row>
                    <div nz-col [nzSpan]="4">
                        RAM: {{itemDetail.ram}} GB
                    </div>
                    <div nz-col [nzSpan]="6"></div>
                    <div>
                        Storage: {{itemDetail.storage}} GB
                    </div>
                </div>
            </nz-card>

            <form nz-form [formGroup]="myform" nzLayout="horizontal" nzLabelAlign="left">
                <nz-card class="border-card">
                    <h3><b>Cấu hình nâng cấp</b></h3>
                    <nz-alert nzType="warning" nzShowIcon
                        nzDescription="Khách hàng chỉ có thể nâng cấp cấu hình lên cao hơn mức hiện tại đang sử dụng."
                    ></nz-alert>
                    <nz-tabset nzCentered style="margin-top: 15px;">
                        <nz-tab nzTitle="Gói cấu hình sẵn" (nzClick)="clicktab()">
                            <ng-template nz-tab>
                                <ngu-carousel #myCarousel [inputs]="carouselConfig" [dataSource]="listOfServicePack"
                                    class="carousel-div">
                                    <div *nguCarouselDef="let item;" class="item">
                                        <div class="pack-item" [ngClass]="{ 'choose': item===chooseitem, 'pack-item-disable': item.storage < storage }"
                                            (click)="handleChoosePack(item)">
                                            <div class="item-header" [ngClass]="{'item-header-disable': item.storage < storage }">
                                                <div class="item-name"  [ngClass]="{'item-name-disable': item.storage < storage }">
                                                    <span>{{item.servicePackName}}</span>
                                                    <div class="item-price">
                                                        <div class="price">
                                                            <span>{{ item.price | number: '1.0-0' }}</span><br>
                                                            <span class="unit-price">đ/tháng</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="item-body">
                                                {{item.broker}} Broker - {{item.cpu}} VCPU / <br>
                                                {{item.ram}}GB RAM / <br>
                                                {{item.storage}}GB SDD
                                            </div>
                                        </div>
                                    </div>
                                    <ul class="myPoint" NguCarouselPoint>
                                        <li *ngFor="let j of myCarousel.pointNumbers"
                                            [class.active]="j === myCarousel.activePoint"
                                            (click)="myCarousel.moveTo(j)">
                                        </li>
                                    </ul>
                                </ngu-carousel>
                            </ng-template>
                        </nz-tab>

                        <nz-tab nzTitle="Cấu hình tùy chọn">
                            <div nz-row class="customize-config">
                                <div nz-col [nzSpan]="5">
                                    <nz-form-item>
                                        <nz-form-label [nzSm]="24" [nzXs]="24" nzNoColon>Số Broker (<span class="text-red">*</span>)</nz-form-label>
                                        <nz-form-control [nzSm]="24" [nzXs]="24"
                                            nzErrorTip="Vui lòng nhập số lượng Broker">
                                            <input nz-input type="number" formControlName="broker" id="broker" autofocus
                                                nzSize="large" />
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>

                                <div nz-col [nzSpan]="5">
                                    <nz-form-item>
                                        <nz-form-label [nzSm]="24" [nzXs]="24" nzNoColon>vCPU (<span class="text-red">*</span>)</nz-form-label>
                                        <nz-form-control [nzSm]="24" [nzXs]="24"
                                            nzErrorTip="Vui lòng nhập giá trị vCpu">
                                            <input nz-input type="number" formControlName="vCpu" id="vCpu" autofocus
                                                nzSize="large" />
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>

                                <div nz-col [nzSpan]="5" class="config-suffix">
                                    <nz-form-item>
                                        <nz-form-label [nzSm]="24" [nzXs]="24" nzNoColon>RAM (<span class="text-red">*</span>)</nz-form-label>
                                        <nz-form-control [nzSm]="24" [nzXs]="24" nzErrorTip="Vui lòng nhập giá trị Ram">
                                            <nz-input-group nzSuffix="(GB)" nzSize="large">
                                                <input nz-input type="number" formControlName="ram" id="ram"
                                                    autofocus />
                                            </nz-input-group>
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>

                                <div nz-col [nzSpan]="5" class="config-suffix">
                                    <nz-form-item>
                                        <nz-form-label [nzSm]="24" [nzXs]="24" nzNoColon>Storage (<span class="text-red">*</span>)</nz-form-label>
                                        <nz-form-control [nzSm]="24" [nzXs]="24" [nzErrorTip]="storageErrorTpl">
                                            <nz-input-group nzSuffix="(GB)" nzSize="large">
                                                <input nz-input type="number" formControlName="storage" id="storage"
                                                    autofocus />
                                            </nz-input-group>
                                            <ng-template #storageErrorTpl let-control>
                                                <ng-container *ngIf="control.hasError('required')">
                                                    Vui lòng nhập giá trị Storage
                                                </ng-container>
                                                <ng-container *ngIf="control.hasError('min')">
                                                    Vui lòng nhập giá trị Storage lớn hơn hoặc bằng {{storage}}
                                                </ng-container>
                                            </ng-template>
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>
                            </div>

                        </nz-tab>
                    </nz-tabset>
                </nz-card>

            </form>
        </div>

        <!-- payment -->
        <div nz-col [nzSpan]="8">
            <nz-card class="price-card">
                <h3><b>Thành tiền</b></h3>
                <div nz-row [nzGutter]="8">
                    <div nz-col [nzSpan]="12">
                        <div class="label-price">Chi phí nâng cấp</div>
                    </div>
                    <div nz-col [nzSpan]="12">
                        <div class="value-price">{{ pricePerCpu * cpu | number: '1.0-0'}} VNĐ</div>
                    </div>
                </div>
                <nz-divider class="divider-style"></nz-divider>
                <div nz-row [nzGutter]="8">
                    <div nz-col [nzSpan]="12">
                        <div class="label-price" style="margin-bottom: 10px;">Trừ đi mức còn lại của chu kỳ trước</div>
                    </div>
                    <div nz-col [nzSpan]="12">
                        <div class="value-price" >{{ pricePerCpu * cpu | number: '1.0-0'}} VNĐ</div>
                    </div>
                </div>
                <nz-divider class="divider-style"></nz-divider>

                <div nz-row [nzGutter]="8" class="mt-5 price-panel">
                    <div nz-col [nzSpan]="12">
                        <div class="label-price">Tổng cần thanh toán</div>
                        <div class="label-quantity"><i>(Đã bao gồm 10% VAT)</i></div>
                    </div>
                    <div nz-col [nzSpan]="12">
                        <div class="value-price total-price">{{ (pricePerCpu * cpu + pricePerRam * ram + pricePerStorage * storage) * usageTime * 1.1 | number: '1.0-0'}} VNĐ</div>
                    </div>
                </div>

                <div nz-row class="mt-5" [nzGutter]="16" nzJustify="center">
                    <div nz-col [nzSpan]="12">
                        <button nz-button nzType="default" nzBlock (click)="backToList()">
                            <img style="padding-right: 10px; margin-top: -4px" src="assets/imgs/cancel.svg" alt="" />
                            <b>Hủy</b>
                        </button>
                    </div>

                    <div nz-col [nzSpan]="12">
                        <button nz-button nzType="primary" nzBlock [disabled]="myform.invalid"
                            (click)="onSubmitPayment()">
                            <img style="padding-right: 10px; margin-top: -4px; height: 20px;"
                                src="assets/imgs/upgrade-white.svg" alt="" />
                            <b>Nâng cấp</b>
                        </button>
                    </div>
                </div>
            </nz-card>
        </div>
    </div>
</ng-container>