<page-header
  [breadcrumb]="breadcrumb"
  [action]="action"
  [title]="'Thông tin Router'"
>
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item
        ><a [routerLink]="['/']">Trang chủ</a></nz-breadcrumb-item
      >
      <nz-breadcrumb-item> Quản lý Router </nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <region-select-dropdown
        (valueChanged)="onRegionChange($event)"
      ></region-select-dropdown>
      <project-select-dropdown
        [regionId]="region"
        (valueChanged)="onProjectChange($event)"
        (userChanged)="onProjectChange($event)"
      ></project-select-dropdown>
    </div>
  </ng-template>
</page-header>

<nz-card style="border-radius: 4px" *ngIf="!activeCreate">
  <div style="margin-bottom: 20px" nz-row [nzGutter]="24">
    <div
      nz-col
      [nzLg]="12"
      [nzMd]="12"
      [nzSm]="24"
      [nzXl]="12"
      [nzXs]="24"
      [nzXXl]="12"
    >
      <nz-select
        style="width: 20%"
        [ngModelOptions]="{ standalone: true }"
        [nzPlaceHolder]="'Trạng thái'"
        [nzShowSearch]="false"
        (ngModelChange)="doSearch()"
        nzSize="large"
      >
        <nz-option
          *ngFor="let i of filterStatus"
          [nzLabel]="i.text"
          [nzValue]="i.value"
        />
      </nz-select>
      <nz-input-group
        style="margin-left: 10px; width: 50%; border-radius: 8px"
        [nzPrefix]="prefixIconSearch"
        nzSize="large"
      >
        <input
          name="name"
          nz-input
          placeholder="Tìm kiếm"
          (keyup.enter)="doSearch()"
        />
      </nz-input-group>
      <ng-template #prefixIconSearch>
        <img
          src="assets/imgs/search.svg"
          alt=""
          style="cursor: pointer"
          nz-tooltip="Tìm kiếm"
          (click)="doSearch()"
        />
      </ng-template>
    </div>
    <div
      class="text-right p-0 m-b-0"
      nz-col
      [nzLg]="12"
      [nzMd]="12"
      [nzSm]="24"
      [nzXl]="12"
      [nzXs]="24"
      [nzXXl]="12"
    >
      <button nz-button nzType="primary" (click)="modalCreate()" nzSize="large">
        <img
          style="padding-right: 10px; margin-top: -4px"
          src="assets/imgs/add-circle.svg"
          alt=""
        />
        Tạo mới Router
      </button>
    </div>
  </div>
  <nz-table
    #ajaxTable3
    nzShowSizeChanger
    [nzFrontPagination]="false"
    [nzData]="dataList"
    [nzLoading]="loading"
    [nzTotal]="total"
    [(nzPageIndex)]="currentPage"
    [(nzPageSize)]="pageSize"
    (nzPageIndexChange)="getDataList()"
    (nzPageSizeChange)="getDataList()"
    [nzVirtualItemSize]="54"
    [nzScroll]="{ x: '100%', y: '55vh' }"
  >
    <thead>
      <tr>
        <th nzLeft>Tên Router</th>
        <th>Dải mạng</th>
        <th>Trạng thái</th>
        <th nzRight>Thao tác</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of ajaxTable3.data">
        <td nzLeft>
          <a
            nz-tooltip
            nzTooltipTitle="Xem chi tiết"
            nzTooltipPlacement="bottom"
            [routerLink]="'/app-smart-cloud/network/router/detail/' + data.id"
            >{{ data.routerName }}</a
          >
        </td>
        <td nzLeft>
          {{ data.networkAddress }}
        </td>
        <td nzBreakWord>
          <div style="color: #0066b3">
            {{ getStatus(data.status) }}
          </div>
        </td>
        <td>
          <img
            src="assets/imgs/edit-2.svg"
            alt=""
            (click)="modalEdit(data)"
            style="cursor: pointer; margin-right: 16px"
            nz-tooltip="Chỉnh sửa"
          />
          <img
            src="assets/imgs/trash.svg"
            alt=""
            (click)="modalDelete(data.cloudId, data.routerName)"
            style="cursor: pointer; margin-right: 16px"
            nz-tooltip="Xóa"
          />
        </td>
      </tr>
    </tbody>
  </nz-table>
</nz-card>

<div *ngIf="!loading && activeCreate">
  <nz-card style="border-radius: 4px">
    <result>
      <nz-row>
        <nz-col class="text-center" style="width: 100%">
          <img src="assets/imgs/blank_router.svg" alt="" />
        </nz-col>
      </nz-row>
      <nz-row style="margin-top: 20px">
        <nz-col class="text-center" style="width: 100%"
          ><span class="text-intro-title" style="color: #0066b3">
            Router</span
          ></nz-col
        >
      </nz-row>
      <nz-row style="margin-top: 20px">
        <nz-col class="text-center" style="width: 100%"
          ><span class="text-intro-desc">
            Router kết nối thiết bị trong một mạng bằng cách chuyển gói dữ liệu
            giữa chúng bằng cách gán địa chỉ IP cục bộ cho mỗi thiết bị trên
            mạng.<br />
            Điều này đảm bảo gói dữ liệu đến đúng nơi, không bị thất lạc trong
            mạng.</span
          ></nz-col
        >
      </nz-row>
      <button
        style="margin-top: 20px"
        nz-button
        [nzType]="'primary'"
        (click)="modalCreate()"
        nzSize="large"
      >
        <img
          style="padding-right: 10px; margin-top: -4px"
          src="assets/imgs/cloud-plus-bold.svg"
          alt=""
        />
        Khởi tạo Router
      </button>
    </result>
  </nz-card>
</div>

<nz-modal
  [(nzVisible)]="isVisibleCreate"
  nzTitle="Tạo mới Router"
  (nzOnCancel)="handleCancelCreate()"
>
  <ng-container *nzModalContent>
    <div class="text-label">
      Tên Router (<span class="text-red">*</span>)
      <img
        style="padding-right: 10px; margin-top: -4px"
        nz-tooltip="message-question"
        src="assets/imgs/message-question.svg"
        alt=""
      />
    </div>
    <input
      style="margin-bottom: 16px; margin-top: 5px"
      class="input-custom"
      nz-input
      placeholder=""
      [(ngModel)]="routerCreate.routerName"
      [ngModelOptions]="{ standalone: true }"
    />
    <span class="text-label"
      >Chọn Network
      <img
        style="padding-right: 10px; margin-top: -4px"
        nz-tooltip="message-question"
        src="assets/imgs/message-question.svg"
        alt=""
    /></span>
    <nz-form-control style="margin-top: 5px">
      <nz-input-group>
        <nz-select
          [nzPlaceHolder]="'-- Chọn Network --'"
          [nzShowSearch]="true"
          [(ngModel)]="routerCreate.networkId"
          nzSize="large"
        >
          <nz-option
            *ngFor="let p of listNetwork"
            [nzValue]="p.cloudId"
            [nzLabel]="p.name"
          />
        </nz-select>
      </nz-input-group>
    </nz-form-control>
    <label
      class="text-label"
      style="margin-top: 16px"
      nz-checkbox
      [(ngModel)]="isTrigger"
      [ngModelOptions]="{ standalone: true }"
      >Kích hoạt</label
    >
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelCreate()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />Hủy
    </button>
    <button nz-button nzType="primary" (click)="handleOkCreate()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />Xác nhận
    </button>
  </div>
</nz-modal>

<nz-modal
  [(nzVisible)]="isVisibleEdit"
  nzTitle="Chỉnh sửa Router"
  (nzOnCancel)="handleCancelEdit()"
>
  <ng-container *nzModalContent>
    <div class="text-label">
      Tên Router(<span class="text-red">*</span>)
      <img
        style="padding-right: 10px; margin-top: -4px"
        nz-tooltip="message-question"
        src="assets/imgs/message-question.svg"
        alt=""
      />
    </div>
    <input
      style="margin-bottom: 16px; margin-top: 5px"
      class="input-custom"
      nz-input
      placeholder=""
      [(ngModel)]="routerUpdate.routerName"
      [ngModelOptions]="{ standalone: true }"
    />
    <span class="text-label"
      >Chọn Network
      <img
        style="padding-right: 10px; margin-top: -4px"
        nz-tooltip="message-question"
        src="assets/imgs/message-question.svg"
        alt=""
    /></span>
    <nz-form-control style="margin-top: 5px">
      <nz-input-group>
        <nz-select
          [nzPlaceHolder]="'-- Chọn Network --'"
          [nzShowSearch]="true"
          [(ngModel)]="routerUpdate.networkId"
          nzSize="large"
        >
          <nz-option
            *ngFor="let p of listNetwork"
            [nzValue]="p.cloudId"
            [nzLabel]="p.name"
          />
        </nz-select>
      </nz-input-group>
    </nz-form-control>
    <label
      class="text-label"
      style="margin-top: 16px"
      nz-checkbox
      [(ngModel)]="isTrigger"
      [ngModelOptions]="{ standalone: true }"
      >Kích hoạt</label
    >
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelEdit()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />Hủy
    </button>
    <button nz-button nzType="primary" (click)="handleOkEdit()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />Xác nhận
    </button>
  </div>
</nz-modal>

<nz-modal
  [(nzVisible)]="isVisibleDelete"
  nzTitle="Xóa Router"
  (nzOnCancel)="handleCancelDelete()"
>
  <ng-container *nzModalContent>
    <nz-alert
      style="margin-bottom: 16px"
      nzType="warning"
      [nzDescription]="customTemplateMessageDelete"
      nzShowIcon
    ></nz-alert>
    <ng-template #customTemplateMessageDelete>
      <div>
        Bạn đang thực hiện xóa Router <b> {{ nameRouterDelete }} </b>
      </div>
      <div>
        Bạn phải xóa Router Interface và Static Router trước khi thực hiện xóa
        Router
      </div>
      <div>Hành động này không thể được hoàn tác</div>
    </ng-template>

    <span class="text-label"
      >Để thực hiện xóa Router, vui lòng nhập tên Router để xác nhận</span
    >
    <nz-form-control>
      <input
        class="input-custom"
        name="name"
        nz-input
        [(ngModel)]="nameVerify"
        (keyup.enter)="andleOkDelete()"
      />
    </nz-form-control>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelDelete()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />Hủy
    </button>
    <button nz-button nzType="primary" (click)="handleOkDelete()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />
      Xác nhận
    </button>
  </div>
</nz-modal>
