<page-header [breadcrumb]="breadcrumb" [title]="'Chi tiết thanh toán'">
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item> <a [routerLink]="['/']">Trang chủ</a> </nz-breadcrumb-item>
      <nz-breadcrumb-item> <a [routerLink]="['/app-smart-cloud/billing/payments']"
        >Billing</a
      > </nz-breadcrumb-item>
      <nz-breadcrumb-item> Thanh toán </nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
</page-header>

<div  nz-row nzGutter="16">
  <div nz-col nzSpan="16">
    <nz-card style="border-radius: 8px">
    <nz-row class="customRow">
      <nz-col style="width: 80%; display: flex; gap: 5px;">
        <span style="font-weight: 600; font-size: 20px;"
          >MÃ THANH TOÁN {{ payment.paymentNumber }}</span
        >
        <span class="paidField" *ngIf="payment.paymentLatestStatus == 'PAID'" 
          >Đã thanh toán</span
        >
        <span class="initField" *ngIf="payment.paymentLatestStatus == 'INIT'"
          >Chờ thanh toán</span
        >
        <span class="failedField" *ngIf="payment.paymentLatestStatus == 'FAILED'"
          >Chưa thanh toán</span
        >
      </nz-col>
    </nz-row>
    <nz-row style="padding-top: 50px">
      <div nz-col nzSpan="12">
        <nz-row style="height: 50px">
          <span class="fw-600" style="width: 40%">Tên khách hàng:</span>
          <span class="fw-600">{{ (userModel$ | async)?.name === '' ? '-' : (userModel$ | async)?.name}}</span>
        </nz-row>
        <nz-row style="height: 50px">
          <span class="fw-600" style="width: 40%">Số điện thoại:</span>
          <span class="fw-600">{{ (userModel$ | async)?.phoneNumber === '' ? '-' : (userModel$ | async)?.phoneNumber}}</span>
        </nz-row>
        <nz-row style="height: 50px">
          <span class="fw-600" style="width: 40%">Email:</span>
          <span class="fw-600"> {{ (userModel$ | async)?.email === '' ? '-' : (userModel$ | async)?.email }}</span>
        </nz-row>
        <nz-row style="height: 50px">
          <span class="fw-600" style="width: 40%">Địa chỉ:</span>
          <span class="fw-600">{{ (userModel$ | async)?.address === '' ? '-' :  (userModel$ | async)?.address}}</span>
        </nz-row>
      </div>
      <div nz-col nzSpan="12">
        <nz-row style="height: 50px">
          <span class="fw-600" style="width: 40%">Ngày tạo:</span>
          <span class="fw-600">{{ payment.createdDate | date : 'dd/MM/yyyy' }} </span>
        </nz-row>
        <nz-row style="height: 50px">
          <span class="fw-600" style="width: 40%">Hình thức thanh toán:</span>
          <span class="fw-600"> {{ payment.paymentLatestStatus }} </span>
        </nz-row>
        <nz-row style="height: 50px">
          <span class="fw-600" style="width: 40%">Mã đơn hàng:</span>
          <span class="fw-600" style="color: #248FCC;">{{ payment.orderNumber }}</span>
        </nz-row>
        <nz-row style="height: 50px">
          <span class="fw-600" style="width: 40%">Mã hóa đơn:</span>
          <span class="fw-600" style="color: #248FCC;">{{ payment.invoiceIssuedId === 0 ? '-' : payment.invoiceIssuedId  }}</span>
        </nz-row>
      </div>
    </nz-row>
    <div class="d-flex justify-content-center" *ngIf="payment.paymentLatestStatus == 'INIT' || payment.paymentLatestStatus == 'FAILED'">
      <button
        nz-button
        [nzType]="'primary'"
        (click)="payNow()"
        style="background-color: #E58200; border: none; outline: none; padding: 0 50px; display: flex; align-items: center; gap: 5px;"
      >
        <img src="assets/imgs/wallet.svg" alt="" />
        <span>Thanh toán ngay</span>
      </button>
    </div>
  </nz-card>
  <nz-card style="border-radius: 8px">
    <nz-row
      style="
        border-bottom: 1px solid #f2f2f2;
        padding-left: 2%;
        padding-bottom: 2%;
      "
    >
      <span style="font-weight: 600; font-size: 20px;">Thông tin dịch vụ</span> <br />
    </nz-row>
    <nz-table [nzData]="data?.orderItems" nzHideOnSinglePage="true">
      <thead>
        <tr>
          <th>Dịch vụ</th>
          <th>Đơn giá (VND)</th>
          <th>Thời hạn (Tháng)</th>
          <th>Số lượng</th>
          <th>Số tiền (VND)</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of data.orderItems">
          <td>{{ item.serviceName }}</td>
          <td class="text-right">{{ item.unitPrice.amount | number : '1.0-0' }}</td>
          <td class="text-right">{{ item.duration }}</td>
          <td class="text-right">{{ item.quantity }}</td>
          <td class="text-right">{{ item.totalAmount.amount | number : '1.0-0' }}</td>
        </tr>
      </tbody>
    </nz-table>
  </nz-card>
  </div>
  <div nz-col nzSpan="8">
    <nz-card style="border-radius: 8px; border-color: #B2DEFF">
      <div style="margin-bottom: 20px">
        <span class="text-card-header">Thông tin thanh toán</span>
      </div>
      <div>
        <nz-table>
          <tr style="margin-bottom: 5px">
            <td>Tổng tiền</td>
            <td style="text-align: right">
              <span class="price">{{payment.amount | number: '1.0-0'}} VND</span>
              <span>VND/tháng</span>
            </td>
          </tr>
          <tr>
            <td style="border-bottom: 1px solid rgba(0, 0, 0, 0.06)"></td>
            <td style="border-bottom: 1px solid rgba(0, 0, 0, 0.06)"></td>
          </tr>
          <tr style="height: 10px">
            <td></td>
            <td></td>
          </tr>
          <tr style="margin-bottom: 5px">
            <td>VAT(10%)</td>
            <td style="text-align: right">
              <span class="price"
                >{{payment.vat | number: '1.0-1'}} VND</span
              >
              <span>VND/tháng</span>
            </td>
          </tr>
          <tr>
            <td style="border-bottom: 1px solid rgba(0, 0, 0, 0.06)"></td>
            <td style="border-bottom: 1px solid rgba(0, 0, 0, 0.06)"></td>
          </tr>
          <tr style="height: 20px">
            <td></td>
            <td></td>
          </tr>
          <tr style="background-color: #CCE9FF">
            <td style="padding: 10px; border-radius: 8px 0 0 8px">
              <span style="display: block; font-size: 16px; font-weight: 600;">Tổng tiền thanh toán</span>
              <span>( Đã bao gồm 10% VAT)</span>
            </td>
            <td style="text-align: right; color: #EA3829; font-weight: 600; padding: 10px; border-radius: 0 8px 8px 0">
              {{payment.totalAmount | number: '1.0-0'}}
              VND
            </td>
          </tr>
        </nz-table>
        <div *ngIf="payment.paymentLatestStatus == 'PAID'" style="margin-top: 20px;">
          <button style="width: 100%; border: none" nz-button (click)="download(payment.invoiceIssuedId)"><span nz-icon nzType="file-pdf" nzTheme="outline"></span> DOWNLOAD PDF</button>
        </div>
        <div *ngIf="payment.paymentLatestStatus == 'FAILED'" style="margin-top: 20px;">
          <button style="width: 100%" nz-button><span nz-icon nzType="shop" nzTheme="outline"></span>Mua lại</button>
        </div>
        </div>
  </nz-card>
  </div>
</div>

