<page-header [breadcrumb]="breadcrumb"
             [title]="'Thông tin Group'">
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">Home</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">IAM</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a routerLink="/app-smart-cloud/iam/user-group">User Groups</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="'/app-smart-cloud/iam/user-group/' + groupName">Group {{groupName}}</a>
      </nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
</page-header>
<nz-content>
  <nz-card nzTitle="Thông tin chính của Group" [nzLoading]="loading">
    <nz-row nzJustify="space-between">
      <nz-col nzSpan="12">
        <nz-descriptions nzLayout="horizontal" [nzColumn]="1">
          <nz-descriptions-item [nzTitle]="name">{{ groupModel?.name }}</nz-descriptions-item>
          <ng-template #name>
            <div>Tên của Group <span style="color: red">*</span></div>
          </ng-template>
          <nz-descriptions-item
            [nzTitle]="createdAt">{{ groupModel?.createdDate | date: 'dd/MM/yyyy - HH:ss:mm'}}</nz-descriptions-item>
          <ng-template #createdAt>
            <div>Thời gian khởi tạo <span style="color: red">*</span></div>
          </ng-template>
          <nz-descriptions-item [nzTitle]="parent">{{ groupModel?.parent }}</nz-descriptions-item>
          <ng-template #parent>
            <div>Parent Group <span style="color: red">*</span></div>
          </ng-template>
        </nz-descriptions>
      </nz-col>
    </nz-row>
  </nz-card>
  <nz-card nzTitle="Thông tin bổ sung">
    <nz-tabset>
      <ng-template #user>
        <div>Users</div>
      </ng-template>
      <!---Thông tin User -->
      <nz-tab [nzTitle]="user">
        <nz-row nzAlign="middle" style="margin: 16px 0" nzJustify="space-between">
          <nz-space [nzSize]="24">
            <div *nzSpaceItem>
              <nz-input-group nzSearch [nzAddOnAfter]="suffixButton">
                <input [(ngModel)]="valueUser" (input)="onInputChangeUser($event.target['value'])" type="text"
                       nz-input
                       placeholder="Tìm kếm tên..."/>
              </nz-input-group>
              <ng-template #suffixButton>
                <button nz-button nzTooltipTitle="Tìm kiếm tên" nzTooltipPlacement="bottom" nz-tooltip nzType="primary" nzSearch (click)="getListBackupVM()">
                  <span nz-icon nzType="search" nzTheme="outline"></span>
                  Search
                </button>
              </ng-template>
            </div>
          </nz-space>
          <nz-row nzAlign="middle">
            <button nz-button nz-tooltip nzTooltipTitle="Làm mới" nzTooltipPlacement="bottom" nzSize="default"
                    style="cursor: pointer;" (click)="getUsersByGroupName()">
              <span nz-icon nzType="reload" nzTheme="outline"></span>
            </button>
            <button nz-button
                    class="button-del"
                    nzSize="default"
                    style="cursor: pointer;"
                    nz-tooltip nzTooltipTitle="Xóa người dùng" nzTooltipPlacement="bottom"
                    (click)="removeUser()">
              <span nz-icon nzType="rest" nzTheme="outline"></span>
              Xóa
            </button>
            <button nz-button class="button-create"
                    nzSize="default"
                    style="cursor: pointer;"
                    nz-tooltip nzTooltipTitle="Thêm User vào Group" nzTooltipPlacement="bottom"
                    [routerLink]="'/app-smart-cloud/iam/user-group/'+groupName+'/add-user'">
              <span nz-icon nzType="plus" nzTheme="outline"></span>
              Thêm User
            </button>
          </nz-row>
        </nz-row>
        <div style="margin-bottom: 8px; margin-top: 8px">Users trong Group
          <span>({{filteredUsers?.length}})</span>
        </div>
        <nz-table
          #rowSelectionTable
          nzShowPagination
          nzShowSizeChanger
          [nzData]="filteredUsers"
          [nzLoading]="loading"
          (nzCurrentPageDataChange)="onCurrentPageDataChangeUser($event)">
          <thead>
          <tr>
            <th
              [nzChecked]="checkedUser"
              [nzIndeterminate]="indeterminateUser"
              nzLabel="Select all"
              (nzCheckedChange)="onAllCheckedUser($event)"
            ></th>
            <th>Name</th>
            <th>Group</th>
            <th>Thời gian tạo</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let data of rowSelectionTable.data">
            <td
              [nzChecked]="setOfCheckedIdUser.has(data.userName)"
              (nzCheckedChange)="onItemCheckedUser(data.userName, $event)"
            ></td>
            <td>
              <a [href]="'/app-smart-cloud/users/detail/' + data.userName">{{ data.userName }}</a>
            </td>
            <td>{{data.userGroups}}</td>
            <td>{{ data.createdDate | date: 'dd/MM/yyyy - HH:ss:mm' }}</td>
          </tr>
          </tbody>
        </nz-table>
      </nz-tab>
      <!---Thông tin Policies -->
      <nz-tab nzTitle="Policies">
        <nz-row nzAlign="middle" style="margin: 16px 0" nzJustify="space-between">
          <nz-space [nzSize]="24">
            <div *nzSpaceItem>
              <nz-select [(ngModel)]="selectedValue"
                         (ngModelChange)="onChange($event)"
                         nzPlaceHolder="Tất cả các loại"
                         nzTooltipTitle="Tìm kiếm theo loại"
                         nzTooltipPlacement="bottom"
                         nz-tooltip>
                <nz-option *ngFor="let item of status" [nzValue]="item.value" [nzLabel]="item.label"></nz-option>
              </nz-select>
            </div>
            <div *nzSpaceItem>
              <nz-input-group nzSearch [nzAddOnAfter]="suffixButton">
                <input [(ngModel)]="value" (input)="onInputChangePolicy($event.target['value'])" type="text"
                       nz-input
                       placeholder="Tìm kếm tên..."/>
              </nz-input-group>
              <ng-template #suffixButton>
                <button nz-button nzTooltipTitle="Tìm kiếm tên" nzTooltipPlacement="bottom" nz-tooltip nzType="primary" nzSearch (click)="getPoliciesByGroupName()">
                  <span nz-icon nzType="search" nzTheme="outline"></span>
                  Search
                </button>
              </ng-template>
            </div>
          </nz-space>
          <nz-row nzAlign="middle">
            <button nz-button nz-tooltip nzTooltipTitle="Làm mới" nzTooltipPlacement="bottom" nzSize="default"
                    style="cursor: pointer;" (click)="getPoliciesByGroupName()">
              <span nz-icon nzType="reload" nzTheme="outline"></span>
            </button>
            <button nz-button
                    class="button-del"
                    nzSize="default"
                    style="cursor: pointer;"
                    nz-tooltip nzTooltipTitle="Xóa Policy" nzTooltipPlacement="bottom"
                    (click)="removePolicy()">
              <span nz-icon nzType="rest" nzTheme="outline"></span>
              Xóa
            </button>
            <button nz-button
                    class="button-create"
                    nzSize="default" style="cursor: pointer;"
                    nz-tooltip nzTooltipTitle="Gán thêm Policy cho Group" nzTooltipPlacement="bottom"
                    (click)="navigateToAttachPolicy()">
              <span nz-icon nzType="plus" nzTheme="outline"></span>
              Thêm policies
            </button>
          </nz-row>
        </nz-row>
        <div style="margin-bottom: 8px; margin-top: 8px">Policies
          <span>({{responsePolicies?.totalCount}})</span>
          <br/>
          <span style="color: #00000040;">Có thể đính kèm tối đa 10 policies</span>
        </div>

        <nz-table
          #rowSelectionTable2
          nzShowPagination
          nzShowSizeChanger
          [nzData]="filteredPolicies"
          [nzLoading]="isLoadingPolicy"
          [nzTotal]="responsePolicies?.totalCount"
          [nzPageSize]="responsePolicies?.pageSize"
          [nzFrontPagination]="false"
          (nzQueryParams)="onQueryParamsPolicyChange($event)"
        >
          <thead>
          <tr>
            <th
              [nzChecked]="checkedPolicy"
              [nzIndeterminate]="indeterminatePolicy"
              nzLabel="Select all"
              (nzCheckedChange)="onAllCheckedPolicy($event)"
            ></th>
            <th>Name</th>
            <th>Type</th>
          </tr>
          </thead>
          <tbody *ngFor="let data of rowSelectionTable2.data">
          <tr>
            <td
              [nzChecked]="setOfCheckedIdPolicy.has(data.name)"
              (nzCheckedChange)="onItemCheckedPolicy(data.name, $event)"
            ></td>
            <td [nzExpand]="expandSet.has(data.name)" (nzExpandChange)="onExpandChange(data.name, $event)">
              {{ data.name }}
            </td>
            <td>{{ data.type }}</td>
          </tr>
          <tr [nzExpand]="expandSet.has(data.name)">
            <div *ngIf="data.type ==='Portal managed'">
              <div class="json-viewer-bg">
                <ngx-json-viewer [json]="data" style="position: relative;"></ngx-json-viewer>
              </div>
            </div>
            <div *ngIf="data.type === 'Customer managed'">
              <div class="json-viewer-bg">
                <button nz-button
                        style="z-index: 1;position: absolute; right: 20px; top: 21px;"
                        [routerLink]="'/app-smart-cloud/policy/update/' +  data.name">Chỉnh sửa
                </button>
                <ngx-json-viewer [json]="data" style="position: relative;"></ngx-json-viewer>
              </div>
            </div>
          </tr>
          </tbody>
        </nz-table>
      </nz-tab>
    </nz-tabset>
    <nz-form-item nzAlign="bottom" nzJustify="end" style="margin-top: 48px">
      <nz-space nzSize="large">
        <button *nzSpaceItem nz-button nzType="default" (click)="goBack()" class="button-cancel">Quay lại
        </button>
      </nz-space>
    </nz-form-item>
  </nz-card>
</nz-content>
