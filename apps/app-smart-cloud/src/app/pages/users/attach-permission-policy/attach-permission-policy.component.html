<nz-card style="border-radius: 8px" [nzBordered]="false">
  <span class="titlecard-custom ">{{ 'app.create-user.selectPermission' | i18n }}</span>
  <nz-radio-group style="width: 100%; display: inline-flex">
    <nz-row [nzGutter]="24" style="margin-top: 10px">
      <nz-col [nzLg]="8" [nzMd]="8" [nzSm]="24" [nzXl]="8" [nzXs]="24">
        <nz-card style="border-radius: 8px" [ngStyle]="{
            border: activeBlockAddUsertoGroup
              ? '1px solid #0066B3'
              : '1px solid #DADADA',
              boxShadow: activeBlockAddUsertoGroup ? '0px 4px 25px 0px #00000026' : 'none',
            height: cardHeight
          }">
          <nz-card-meta [nzAvatar]="nzAvatarselected1" [nzTitle]="nzTitleselected1"
            [nzDescription]="nzDescriptionselected1">
            <ng-template #nzAvatarselected1>
              <input style="cursor: pointer" type="radio" [checked]="activeBlockAddUsertoGroup"
                (click)="initAddUsertoGroup()" />
            </ng-template>
            <ng-template #nzTitleselected1>
              <b>{{ 'app.create-user.addUserToGroup.title' | i18n }}</b>
            </ng-template>
            <ng-template #nzDescriptionselected1>
              <ellipsis class="text-custom">{{ 'app.create-user.addUserToGroup.des' | i18n }}</ellipsis>
            </ng-template>
          </nz-card-meta>
        </nz-card>
      </nz-col>
      <nz-col [nzLg]="8" [nzMd]="8" [nzSm]="24" [nzXl]="8" [nzXs]="24">
        <nz-card style="border-radius: 8px" [ngStyle]="{
            border: activeBlockCopyPolicies
              ? '1px solid #0066B3'
              : '1px solid #DADADA',
              boxShadow: activeBlockCopyPolicies ? '0px 4px 25px 0px #00000026' : 'none',
            height: cardHeight
          }">
          <nz-card-meta [nzAvatar]="nzAvatarselected2" [nzTitle]="nzTitleselected2"
            [nzDescription]="nzDescriptionselected2">
            <ng-template #nzAvatarselected2>
              <input style="cursor: pointer" type="radio" [checked]="activeBlockCopyPolicies"
                (click)="initCopyPolicies()" />
            </ng-template>
            <ng-template #nzTitleselected2>
              <b>{{ 'app.create-user.copyPolicies.title' | i18n }}</b>
            </ng-template>
            <ng-template #nzDescriptionselected2>
              <ellipsis class="text-custom">
                {{ 'app.create-user.copyPolicies.des' | i18n }}</ellipsis>
            </ng-template>
          </nz-card-meta>
        </nz-card>
      </nz-col>
      <nz-col [nzLg]="8" [nzMd]="8" [nzSm]="24" [nzXl]="8" [nzXs]="24">
        <nz-card style="border-radius: 8px" [ngStyle]="{
            border: activeBlockAttachPolicies
              ? '1px solid #0066B3'
              : '1px solid #DADADA',
              boxShadow: activeBlockAttachPolicies ? '0px 4px 25px 0px #00000026' : 'none',
            height: cardHeight,
          }">
          <nz-card-meta [nzAvatar]="nzAvatarselected3" [nzTitle]="nzTitleselected3"
            [nzDescription]="nzDescriptionselected3">
            <ng-template #nzAvatarselected3>
              <input style="cursor: pointer" type="radio" [checked]="activeBlockAttachPolicies"
                (click)="initAttachPolicies()" />
            </ng-template>
            <ng-template #nzTitleselected3>
              <b>{{ 'app.create-user.attachPolicies.title' | i18n }}</b>
            </ng-template>
            <ng-template #nzDescriptionselected3>
              <ellipsis class="text-custom">
                {{ 'app.create-user.attachPolicies.des' | i18n }}</ellipsis>
            </ng-template>
          </nz-card-meta>
        </nz-card>
      </nz-col>
    </nz-row>
  </nz-radio-group>
</nz-card>

<nz-card *ngIf="activeBlockAddUsertoGroup" [nzBordered]="false" style="border-radius: 8px">
  <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 24 }">
    <div style="margin: 20px 0px" nz-col [nzLg]="8" [nzMd]="8" [nzSm]="24" [nzXl]="8" [nzXs]="24" [nzXXl]="8">
      <span class="text-card-header">{{ 'app.create-user.groupInformation' | i18n }}</span>
    </div>
    <div   class="text-right p-0  d-flex" nz-col [nzLg]="24" [nzMd]="24" [nzSm]="24" [nzXl]="24" [nzXs]="24" [nzXXl]="24" style="justify-content: space-between; margin-bottom: 20px;">
      <div>
        <nz-input-group style="margin-right: 8px;  border-radius: 8px" [nzPrefix]="prefixIconSearch"
        nzSize="large">
        <input name="name" nz-input [placeholder]="'app.users.search' | i18n" [(ngModel)]="searchParam" />
      </nz-input-group>
      <ng-template #prefixIconSearch>
        <img src="assets/imgs/search.svg" alt="" style="cursor: pointer" [nz-tooltip]="'app.button.search' | i18n"
          (click)="getGroup()" />
      </ng-template>
      </div>
      <div class="d-flex">
        <button style="border: none; border-radius: 8px" nz-button (click)="reloadGroupTable()">
          <img style="margin-top: -4px" src="assets/imgs/refresh.svg" alt="" />
        </button>
        <button nz-button nzType="primary" (click)="navigateToCreateGroup()" class="btn-add">
          <one-portal-svg-icon [icon]="'icon_add'" class="icon-svg icon-padding-right"></one-portal-svg-icon>
          <span> {{ 'app.users.button.addnew' | i18n }}</span>
        </button>
      </div>
      
    </div>
  </div>
  
  <nz-table #rowSelectionTable nzShowSizeChanger [nzScroll]="{ x: '100%', y: '250px' }" [nzFrontPagination]="false"
    [nzData]="listOfGroups" (nzCurrentPageDataChange)="onCurrentPageDataChangeGroup($event)" [nzLoading]="loading"
    [nzTotal]="totalGroup" [(nzPageIndex)]="pageIndex" [(nzPageSize)]="pageSize" (nzPageIndexChange)="getGroup()"
    (nzPageSizeChange)="getGroup()">
    <thead>
      <tr>
        <th [nzChecked]="checkedGroup" [nzIndeterminate]="indeterminateGroup" nzLabel="Select all group"
          [nzWidth]="'50px'" (nzCheckedChange)="onAllCheckedGroup($event)" nzLeft></th>
        <th>{{ 'app.create-user.nameGroup' | i18n }}</th>
        <th>{{ 'app.create-user.numberOfUser' | i18n }}</th>
        <th>{{ 'app.create-user.attachedPolicies' | i18n }}</th>
        <th>{{ 'app.create-user.createDate' | i18n }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of listOfGroups; let i = index">
        <td [nzChecked]="mapOfCheckedGroup.has(item.name)" (nzCheckedChange)="onItemCheckedGroup(item, $event)" nzLeft>
        </td>
        <td nzLeft>
          <a nz-tooltip [nzTooltipTitle]="'app.view.detail'|i18n" nzTooltipPlacement="bottom"
            [routerLink]="'/app-smart-cloud/iam/user-group/' + item.name">{{ item.name }}</a>
        </td>
        <td class="fieldColor">{{ item.numberOfUser }}</td>
        <td *ngIf="item.policies == null || item.policies.length == 0">None</td>
        <td class="fieldColor" *ngIf="item.policies != null && item.policies.length == 1">
          {{ item.policies[0] }}
        </td>
        <td class="fieldColor" *ngIf="item.policies != null && item.policies.length == 2">
          {{ item.policies[0] }}, {{ item.policies[1] }}
        </td>
        <td class="fieldColor" *ngIf="item.policies != null && item.policies.length > 2">
          {{ item.policies[0] }}, {{ item.policies[1] }}
          <span class="nameField">
            and {{ item.policies.length - 2 }} policies
          </span>
        </td>
        <td>{{ item.createdDate | date : 'HH:mm:ss dd/MM/yyyy' }}</td>
      </tr>
    </tbody>
  </nz-table>
</nz-card>

<nz-card *ngIf="activeBlockCopyPolicies" [nzBordered]="false" style="border-radius: 8px">
  <div style="margin-bottom: 20px" nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 24 }">
    <div nz-col [nzLg]="12" [nzMd]="12" [nzSm]="24" [nzXl]="12" [nzXs]="24" [nzXXl]="12">
      <span class="text-card-header">{{ 'app.create-user.userInformation' | i18n }}</span>
    </div>
  </div>
  <div nz-row  [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 24 }" style="margin:20px 0px;">
    <div class=" p-0 m-b-0" nz-col [nzLg]="18" [nzMd]="18" [nzSm]="18" [nzXl]="18" [nzXs]="18" [nzXXl]="18">   
      <nz-input-group style="margin-right: 8px; border-radius: 8px" [nzPrefix]="prefixIconSearch"
        nzSize="large">
        <input name="name" nz-input [placeholder]="'app.users.search' | i18n " [(ngModel)]="searchParam" />
      </nz-input-group>
      <ng-template #prefixIconSearch>
        <img src="assets/imgs/search.svg" alt="" style="cursor: pointer" [nz-tooltip]="'app.button.search' | i18n"
          (click)="getCopyUserPlicies()" />
      </ng-template>
      
    </div>
    <div nz-col [nzLg]="24" [nzMd]="6" [nzSm]="6" [nzXl]="6" [nzXs]="6" [nzXXl]="6" class="text-right">
      <button style="border: none; border-radius: 8px" nz-button (click)="reloadUserTable()" >
        <img style="margin-top: -4px" src="assets/imgs/refresh.svg" alt="" />
      </button>
    </div>
  </div>
  <nz-table #rowSelectionTable nzShowSizeChanger [nzScroll]="{ x: '100%', y: '250px' }" [nzFrontPagination]="false"
    [nzData]="listOfUsers" (nzCurrentPageDataChange)="onCurrentPageDataChangeUser($event)" [nzLoading]="loading"
    [nzTotal]="totalUser" [(nzPageIndex)]="pageIndex" [(nzPageSize)]="pageSize"
    (nzPageIndexChange)="getCopyUserPlicies()" (nzPageSizeChange)="getCopyUserPlicies()">
    <thead>
      <tr>
        <th [nzChecked]="checkedUser" [nzIndeterminate]="indeterminateUser" nzLabel="Select all user" [nzWidth]="'50px'"
          (nzCheckedChange)="onAllCheckedUser($event)" nzLeft></th>
        <th>{{ 'app.create-user.nameUser' | i18n }}</th>
        <th>Groups</th>
        <th>{{ 'app.create-user.attachedPolicies' | i18n }}</th>
        <th>{{ 'app.create-user.createDate' | i18n }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of listOfUsers; let i = index">
        <td [nzChecked]="mapOfCheckedUser.has(item.userName)" (nzCheckedChange)="onItemCheckedUser(item, $event)"
          nzLeft></td>
        <td nzLeft>
          <a nz-tooltip nzTooltipTitle="Xem chi tiết" nzTooltipPlacement="bottom"
            [routerLink]="'/app-smart-cloud/users/detail/' + item.userName">{{ item.userName }}</a>
        </td>
        <td *ngIf="item.userGroups.length == 0">None</td>
        <td class="fieldColor" *ngIf="item.userGroups.length == 1">
          {{ item.userGroups[0] }}
        </td>
        <td class="fieldColor" *ngIf="item.userGroups.length == 2">
          {{ item.userGroups[0] }}, {{ item.userGroups[1] }}
        </td>
        <td class="fieldColor" *ngIf="item.userGroups.length > 2">
          {{ item.userGroups[0] }}, {{ item.userGroups[1] }}
          <span class="nameField">
            and {{ item.userGroups.length - 2 }} groups
          </span>
        </td>
        <td *ngIf="item.userPolicies.length == 0">None</td>
        <td class="fieldColor" *ngIf="item.userPolicies.length == 1">
          {{ item.userPolicies[0] }}
        </td>
        <td class="fieldColor" *ngIf="item.userPolicies.length == 2">
          {{ item.userPolicies[0] }}, {{ item.userPolicies[1] }}
        </td>
        <td class="fieldColor" *ngIf="item.userPolicies.length > 2">
          {{ item.userPolicies[0] }}, {{ item.userPolicies[1] }}
          <span class="nameField">
            and {{ item.userPolicies.length - 2 }} policies
          </span>
        </td>
        <td>{{ item.createdDate | date : 'HH:mm:ss dd/MM/yyyy' }}</td>
      </tr>
    </tbody>
  </nz-table>
</nz-card>

<nz-card *ngIf="activeBlockAttachPolicies" [nzBordered]="false" style="border-radius: 8px">
  <form nz-form>
    <div  >
      <div >
        <span class="text-card-header">{{ 'app.create-user.permissionPoliciesInformation' | i18n }}</span>
      </div>
      <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 24 }" style="margin: 20px 0px">
        <div class="text-right p-0 m-b-0 d-flex" nz-col [nzLg]="14" [nzMd]="14" [nzSm]="14" [nzXl]="14" [nzXs]="14" [nzXXl]="14" >
          <nz-input-group style="margin-right: 8px; width: 38%; border-radius: 8px" [nzPrefix]="prefixIconSearch"
            nzSize="large">
            <input name="name" nz-input [placeholder]="'app.users.search' | i18n " [(ngModel)]="searchParam" />
          </nz-input-group>
          <ng-template #prefixIconSearch>
            <img src="assets/imgs/search.svg" alt="" style="cursor: pointer" [nz-tooltip]="'app.button.search' | i18n"
              (click)="getPermissionPolicies()" />
          </ng-template>
          
        </div>
        <div nz-col [nzLg]="16" [nzMd]="16" [nzSm]="10" [nzXl]="10" [nzXs]="10" [nzXXl]="10" class="d-flex " style="justify-content: end;">
          <button style="border: none; border-radius: 8px" nz-button (click)="reloadPolicyTable()">
            <img style="margin-top: -4px" src="assets/imgs/refresh.svg" alt="" />
          </button>
          <button nz-button nzType="primary" (click)="navigateToCreatePolicy()" class="btn-add">
            <one-portal-svg-icon [icon]="'icon_add'" class="icon-svg icon-padding-right"></one-portal-svg-icon>
            <span>{{ 'app.users.button.addnew' | i18n }}</span>
          </button>
        </div>
      </div>
      
    </div>
  </form>
  <nz-table #rowSelectionTable nzShowSizeChanger [nzScroll]="{ x: '100%', y: '250px' }" [nzFrontPagination]="false"
    [nzData]="listOfPolicies" (nzCurrentPageDataChange)="onCurrentPageDataChangePolicy($event)" [nzLoading]="loading"
    [nzTotal]="totalPolicy" [(nzPageIndex)]="pageIndex" [(nzPageSize)]="pageSize"
    (nzPageIndexChange)="getPermissionPolicies()" (nzPageSizeChange)="getPermissionPolicies()">
    <thead>
      <tr>
        <th [nzChecked]="checkedPolicy" [nzIndeterminate]="indeterminatePolicy" nzLabel="Select all Policy"
          [nzWidth]="'50px'" (nzCheckedChange)="onAllCheckedPolicy($event)" nzLeft></th>
        <th>{{ 'app.create-user.namePolicy' | i18n }}</th>
        <th>{{ 'app.create-user.type' | i18n }}</th>
        <th>{{ 'app.create-user.attachedEntities' | i18n }}</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let item of listOfPolicies; let i = index">
        <tr>
          <td [nzChecked]="setOfCheckedPolicy.has(item.name)" (nzCheckedChange)="onItemCheckedPolicy(item.name, $event)"
            nzLeft></td>
          <td [nzExpand]="expandSet.has(item.name)" (nzExpandChange)="onExpandChange(item.name, $event)">
            <a nz-tooltip nzTooltipTitle="Xem chi tiết" nzTooltipPlacement="bottom"
              [routerLink]="'/app-smart-cloud/policy/detail/' + item.name">{{ item.name }}</a>
          </td>
          <td>{{ item.type }}</td>
          <td class="fieldColor">{{ item.attachedEntities }}</td>
        </tr>
        <tr [nzExpand]="expandSet.has(item.name)">
          <div class="json-viewer-bg">
            <button (click)="copyText(item)" style="z-index: 1; position: absolute; right: 20px; top: 21px">
              <span nz-icon nzType="copy" nzTheme="outline"></span> Copy JSON
            </button>
            <ngx-json-viewer [json]="item" style="position: relative"></ngx-json-viewer>
          </div>
        </tr>
      </ng-container>
    </tbody>
  </nz-table>
</nz-card>