<page-header
  [autoBreadcrumb]="false"
  [autoTitle]="false"
  style="background: white"
>
  <nz-breadcrumb style="float: left">
    <nz-breadcrumb-item>Home</nz-breadcrumb-item>
    <nz-breadcrumb-item> Users </nz-breadcrumb-item>
  </nz-breadcrumb>
  <div class="text-right non-pointer">
    <region-select-dropdown
      (valueChanged)="onRegionChange($event)"
    ></region-select-dropdown>
    <project-select-dropdown [regionId]="regionId"></project-select-dropdown>
  </div>
  <div><h2>Danh sách Users</h2></div>
  <form nz-form>
    <div style="margin-bottom: -10px;" nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 24 }">
      <div
        nz-col
        [nzLg]="10"
        [nzMd]="10"
        [nzSm]="24"
        [nzXl]="10"
        [nzXs]="24"
        [nzXXl]="10"
      >
        <nz-form-item>
          <nz-row style="width: 100%">
            <nz-col style="width: 60%">
              <nz-form-control>
                <input
                  name="name"
                  nz-input
                  placeholder="Tìm kiếm tên, thời gian tạo ..."
                  [ngModel]="searchParam"
                  (ngModelChange)="changeSearch($event)"
                />
              </nz-form-control>
            </nz-col>
            <nz-form-control>
              <button nz-button [nzType]="'primary'" (click)="getData()">
                <i nz-icon nzType="search"></i>
                Search
              </button>
            </nz-form-control>
          </nz-row>
        </nz-form-item>
      </div>
      <div
        class="text-right p-0 m-b-0"
        nz-col
        [nzLg]="14"
        [nzMd]="14"
        [nzSm]="24"
        [nzXl]="14"
        [nzXs]="24"
        [nzXXl]="14"
      >
        <button
          class="m-r-8"
          nz-button
          nzType="default"
          style="background-color: white"
          (click)="reloadTable()"
        >
          <img style="margin-bottom: 4px" src="assets/imgs/undo.png" alt="" />
        </button>
        <button
          class="m-r-8"
          nz-button
          nzType="default"
          style="background-color: #9c9c9c; color: white"
          (click)="showModal(); renameModal()"
        >
          <i nz-icon nzType="delete"></i>
          Xóa
        </button>
        <button
          class="m-r-8"
          class="bg-success border-success"
          nz-button
          nzType="primary"
          (click)="navigateToCreate()"
        >
          <i nz-icon nzType="plus"></i>
          Tạo mới
        </button>
      </div>
    </div>
  </form>
</page-header>
<nz-card>
  <ng-container>
    <ng-container>
      <nz-table
        #rowSelectionTable
        nzShowSizeChanger
        [nzFrontPagination]="false"
        [nzData]="listOfUser"
        [nzLoading]="loading"
        [nzTotal]="total"
        [(nzPageIndex)]="pageIndex"
        [(nzPageSize)]="pageSize"
        (nzPageIndexChange)="getData()"
        (nzPageSizeChange)="getData()"
      >
        <thead>
          <tr>
            <th style="width: 20px"></th>
            <th>Tên User</th>
            <th>Groups</th>
            <th>Thời gian tạo</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of listOfUser">
            <td>
              <input nz-input type="checkbox"
                (change)="onClickItem(item.userName)"
              >
            </td>
            <td (click)="getUserDetail(item.id)">
              <a>{{ item.userName }}</a>
            </td>
            <td>{{ item.userOfGroups }}</td>
            <td>{{ item.createdDate }}</td>
          </tr>
        </tbody>
      </nz-table>
    </ng-container>
  </ng-container>
</nz-card>

<nz-modal
  [(nzVisible)]="isVisibleDelete"
  [nzTitle]="nameModal"
  (nzOnCancel)="handleCancelDelete()"
  (nzOnOk)="handleOkDelete()"
  nzOkText="Xác nhận"
  nzCancelText="Hủy"
>
  <ng-container *nzModalContent>
    <nz-alert
      nzType="warning"
      [nzMessage]="customTemplateMessageDelete"
      nzShowIcon
    ></nz-alert>
    <ng-template #customTemplateMessageDelete>
      <div>
        Bạn đang thực hiện xóa User <span> {{userDelete}} </span>
      </div>
      <div>
        Việc thực hiện xóa User cũng sẽ xóa tất cả dữ liệu liên quan tới User này
      </div>
      <div>
        Hành động này không thể được hoàn tác
      </div>
    </ng-template>
    <nz-row nzGutter="16">
      <nz-col nzLg="24" nzMd="12" nzSm="24">
        <nz-form-item>
          <nz-form-label nzFor="name"
            >Để thực hiện xóa User, vui lòng nhập tên User để xác
            nhận.</nz-form-label
          >
          <nz-form-control>
            <input
              name="name"
              nz-input
              [ngModel]="codeVerify"
              (ngModelChange)="changecodeVerify($event)"
            />
          </nz-form-control>
        </nz-form-item>
      </nz-col>
    </nz-row>
  </ng-container>
</nz-modal>
