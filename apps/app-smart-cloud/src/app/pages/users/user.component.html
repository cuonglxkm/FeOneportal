<page-header [breadcrumb]="breadcrumb" [title]="'Danh sách Users'">
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item
        ><a [routerLink]="['/']">Trang chủ</a></nz-breadcrumb-item
      >
      <nz-breadcrumb-item> Users </nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
</page-header>

<nz-card style="border-radius: 4px">
  <div style="margin-bottom: 20px" nz-row [nzGutter]="24">
    <div class="text-right p-0 m-b-0" nz-col nzSpan="24">
      <nz-input-group
        style="margin-right: 8px; width: 25%"
        [nzPrefix]="prefixIconSearch"
        nzSize="large"
      >
        <input
          name="name"
          nz-input
          placeholder="Tìm kiếm tên, thời gian tạo ..."
          [ngModel]="searchParam"
          (ngModelChange)="changeSearch($event)"
        />
      </nz-input-group>
      <ng-template #prefixIconSearch>
        <img
          src="assets/imgs/search.svg"
          alt=""
          style="cursor: pointer"
          nz-tooltip="Tìm kiếm"
          (click)="getData()"
        />
      </ng-template>
      <button style="border: none" nz-button (click)="showModal()">
        <img style="margin-top: -4px" src="assets/imgs/trash.svg" />
      </button>
      <button style="border: none" nz-button (click)="reloadTable()">
        <img style="margin-top: -4px" src="assets/imgs/refresh.svg" alt="" />
      </button>
      <button nz-button nzType="primary" (click)="navigateToCreate()">
        <img
          style="padding-right: 10px; margin-top: -4px"
          src="assets/imgs/add-circle.svg"
          alt=""
        />
        <span>Tạo mới</span>
      </button>
    </div>
  </div>
  <nz-table
    #rowSelectionTable
    nzShowSizeChanger
    [nzScroll]="{ x: '100%', y: '55vh' }"
    [nzFrontPagination]="false"
    [nzData]="listOfCurrentPageData"
    (nzCurrentPageDataChange)="onCurrentPageDataChange($event)"
    [nzLoading]="loading"
    [nzTotal]="total"
    [(nzPageIndex)]="pageIndex"
    [(nzPageSize)]="pageSize"
    (nzPageIndexChange)="getData()"
    (nzPageSizeChange)="getData()"
  >
    <thead>
      <tr>
        <th
          [nzChecked]="checked"
          [nzIndeterminate]="indeterminate"
          nzLabel="Select all"
          [nzWidth]="'50px'"
          (nzCheckedChange)="onAllChecked($event)"
          nzLeft
        ></th>
        <th>Tên User</th>
        <th>Groups</th>
        <th>Thời gian tạo</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of listOfCurrentPageData; let i = index">
        <td
          [nzChecked]="setOfCheckedName.has(item.userName)"
          (nzCheckedChange)="onItemChecked(item.userName, $event)"
          nzLeft
        ></td>
        <td nzLeft>
          <a
            nz-tooltip
            nzTooltipTitle="Xem chi tiết"
            nzTooltipPlacement="bottom"
            [routerLink]="'/app-smart-cloud/users/detail/' + item.userName"
            >{{ item.userName }}</a
          >
        </td>
        <td style="color: #248fcc">{{ item.userGroups.length }}</td>
        <td>{{ item.createdDate | date : 'HH:mm:ss dd/MM/yyyy' }}</td>
      </tr>
    </tbody>
  </nz-table>
</nz-card>

<nz-modal
  [(nzVisible)]="isVisibleDelete"
  [nzTitle]="nameModal"
  (nzOnCancel)="handleCancelDelete()"
>
  <ng-container *nzModalContent>
    <nz-alert
      style="margin-bottom: 20px"
      nzType="warning"
      [nzDescription]="customTemplateMessageDelete"
      nzShowIcon
    ></nz-alert>
    <ng-template #customTemplateMessageDelete>
      <div>
        Bạn đang thực hiện xóa User <span> {{ userDelete }} </span>
      </div>
      <div>
        Việc thực hiện xóa User cũng sẽ xóa tất cả dữ liệu liên quan tới User
        này
      </div>
      <div>Hành động này không thể được hoàn tác</div>
    </ng-template>

    <span class="text-label"
      >Để thực hiện xóa User, vui lòng nhập tên User để xác nhận</span
    >
    <nz-form-control>
      <input
        class="input-custom"
        name="name"
        nz-input
        [(ngModel)]="codeVerify"
      />
    </nz-form-control>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelDelete()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />Hủy
    </button>
    <button nz-button nzType="primary" (click)="handleOkDelete()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />
      Xác nhận
    </button>
  </div>
</nz-modal>

<nz-modal
  [(nzVisible)]="isVisibleDeleteUsers"
  [nzTitle]="nameModal"
  (nzOnCancel)="handleCancelDeleteUsers()"
>
  <ng-container *nzModalContent>
    <nz-alert
      style="margin-bottom: 20px"
      nzType="warning"
      [nzDescription]="customTemplateMessageDeleteUsers"
      nzShowIcon
    ></nz-alert>
    <ng-template #customTemplateMessageDeleteUsers>
      <div>
        Bạn đang thực hiện xóa <span>{{ setOfCheckedName.size }}</span> User
      </div>
      <div>
        Việc thực hiện xóa các Users đồng thời cũng sẽ xóa toàn bộ dữ liệu liên
        quan tới những User đó
      </div>
      <div>Hành động này không thể được hoàn tác</div>
    </ng-template>
    <span class="text-label"
      >Để thực hiện xóa các Users, vui lòng nhập "delete" để xác nhận</span
    >
    <nz-form-control>
      <input
        class="input-custom"
        name="name"
        nz-input
        [(ngModel)]="codeVerify"
      />
    </nz-form-control>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelDeleteUsers()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />
      Hủy
    </button>
    <button nz-button nzType="primary" (click)="handleOkDeleteUsers()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />
      Xác nhận
    </button>
  </div>
</nz-modal>
