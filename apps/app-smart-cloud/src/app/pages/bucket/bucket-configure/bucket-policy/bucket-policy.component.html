<span class="titlecard-custom">Thiết lập Bucket Policy</span>
<div style="margin-top: 20px; margin-bottom: 10px" class="text-label">
  <span
    >Bucket Policy là các tùy chọn chính sách truy cập có sẵn giúp cấp quyền
    (Allow / Deny) cho các tài nguyên Simple Storage, sử dung ngôn ngữ chính
    sách truy cập dạng JSON - based.</span
  ><br /><br />
  <span>
    Có thể thêm các điều kiện giới hạn hoặc điều kiện chi tiết thêm cho Bucket
    Policy với thao tác Thêm Condition
  </span>
</div>
<div class="text-right p-0 m-b-0">
  <nz-input-group
    style="margin-right: 8px; width: 25%; border-radius: 8px"
    [nzPrefix]="prefixIconSearch"
    nzSize="large"
  >
    <input
      name="name"
      nz-input
      placeholder="Tìm kiếm tên"
      [(ngModel)]="searchValue"
    />
  </nz-input-group>
  <ng-template #prefixIconSearch>
    <img
      src="assets/imgs/search.svg"
      alt=""
      style="cursor: pointer"
      nz-tooltip="Tìm kiếm"
      (click)="searchBucketPolicy()"
    />
  </ng-template>
  <button nz-button nzType="primary" (click)="modalCreate()">
    <img
      style="padding-right: 10px; margin-top: -4px"
      src="assets/imgs/add-circle.svg"
      alt=""
    />
    <span>Tạo mới Bucket Policy</span>
  </button>
</div>
<nz-table
  style="margin-top: 10px"
  #rowSelectionTable
  nzShowSizeChanger
  [nzScroll]="{ x: '100%', y: '250px' }"
  [nzFrontPagination]="false"
  [nzData]="listBucketPolicy"
  (nzPageIndexChange)="searchBucketPolicy()"
  (nzPageSizeChange)="searchBucketPolicy()"
  [nzLoading]="loading"
>
  <thead>
    <tr>
      <th>Người dùng</th>
      <th>Quyền</th>
      <th>Quyền thao tác</th>
      <th>JSON</th>
      <th>Thao tác</th>
    </tr>
  </thead>
  <tbody>
    <ng-container *ngFor="let item of listBucketPolicy">
      <tr>
        <td>
          {{ item.user }}
        </td>
        <td>{{ item.permission }}</td>
        <td>{{ item.action }}</td>
        <td><a (click)="modalJson(item)">Xem chi tiết JSON</a></td>
        <td nzRight>
          <img
            src="assets/imgs/edit-2.svg"
            alt=""
            (click)="modalUpdate(data)"
            style="cursor: pointer; margin-right: 16px"
            nz-tooltip="Chỉnh sửa"
          />
          <img
            src="assets/imgs/trash.svg"
            alt=""
            (click)="modalDelete(data.id)"
            style="cursor: pointer; margin-right: 16px"
            nz-tooltip="Xóa"
          />
        </td>
      </tr>
    </ng-container>
  </tbody>
</nz-table>

<nz-modal
  [(nzVisible)]="isVisibleCreate"
  nzTitle="Tạo mới Bucket Policy"
  (nzOnCancel)="handleCancelCreate()"
>
  <ng-container *nzModalContent>
    <nz-radio-group
      style="width: 100%; margin-bottom: 16px"
      [(ngModel)]="isUserOther"
    >
      <div style="display: flex">
        <div style="flex: 1">
          <label class="text-value" nz-radio [nzValue]="true">Subuser</label>
        </div>
        <div style="flex: 1">
          <label class="text-value" nz-radio [nzValue]="false"
            >Người dùng VNPT Cloud</label
          >
        </div>
      </div>
    </nz-radio-group>
    <div class="text-label">Người dùng (<span class="text-red">*</span>)</div>
    <nz-select
      style="width: 100%; margin-top: 5px; margin-bottom: 16px"
      [nzPlaceHolder]="'-- Chọn người dùng --'"
      [nzShowSearch]="true"
      [nzLoading]="loadingSubuser"
      [(ngModel)]="emailUser"
      nzSize="large"
    >
      <nz-option
        *ngFor="let p of listSubuser"
        [nzValue]="p.subUserId"
        [nzLabel]="p.subUserId"
      />
    </nz-select>
    <div *ngIf="userVnpt" style="margin-bottom: 16px" class="text-label">
      Các Access key của người dùng này sẽ có quyền truy cập tới Bucket của Quý
      khách
    </div>
    <div class="text-label">Quyền (<span class="text-red">*</span>)</div>
    <nz-select
      style="width: 100%; margin-top: 5px; margin-bottom: 16px"
      [nzPlaceHolder]="'-- Chọn người dùng --'"
      [nzShowSearch]="true"
      [(ngModel)]="permission"
      nzSize="large"
    >
      <nz-option
        *ngFor="let p of listPermission"
        [nzValue]="p.name"
        [nzLabel]="p.name"
      />
    </nz-select>
    <div class="text-label">
      Chọn thao tác quyền (<span class="text-red">*</span>)
    </div>
    <nz-select
      style="width: 100%; margin-top: 5px; margin-bottom: 16px"
      nzMode="multiple"
      nzPlaceHolder="-- Chọn thao tác quyền --"
      [(ngModel)]="selectedSecurityGroup"
      [nzServerSearch]="true"
      nzSize="large"
    >
      <nz-option-group nzLabel="SUGGESTED COMBO">
        <nz-option
          nzValue="CreateBucket, DeleteBucket"
          nzLabel="Create bucket"
        ></nz-option>
        <nz-option
          nzValue="GetObject, ListBucket"
          nzLabel="Read / Download file"
        ></nz-option>
        <nz-option nzValue="PutObjectAcl, PutObject">Upload file</nz-option>
        <nz-option
          nzValue="GetBucketAcl, GetBucketCORS,..."
          nzLabel="Config bucket"
        ></nz-option>
      </nz-option-group>
      <nz-option-group nzLabel="CUSTOM ACTION">
        <nz-option nzLabel="SELECT ALL"></nz-option>
      </nz-option-group>
      <nz-option-group nzLabel="GROUP BUCKET">
        <nz-option nzValue="CreateBucket" nzLabel="CreateBucket"></nz-option>
        <nz-option
          nzValue="DeleteBucketPolicy"
          nzLabel="DeleteBucketPolicy"
        ></nz-option>
      </nz-option-group>
    </nz-select>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelCreate()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />Hủy
    </button>
    <button nz-button nzType="primary" (click)="handleOkCreate()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />Xác nhận
    </button>
  </div>
</nz-modal>

<nz-modal
  [(nzVisible)]="isVisibleUpdate"
  nzTitle="Chỉnh sửa Bucket Policy"
  (nzOnCancel)="handleCancelUpdate()"
>
  <ng-container *nzModalContent>
    <nz-radio-group
      style="width: 100%; margin-bottom: 16px"
      [(ngModel)]="isUserOther"
    >
      <div style="display: flex">
        <div style="flex: 1">
          <label class="text-value" nz-radio [nzValue]="true">Subuser</label>
        </div>
        <div style="flex: 1">
          <label class="text-value" nz-radio [nzValue]="false"
            >Người dùng VNPT Clou</label
          >
        </div>
      </div>
    </nz-radio-group>
    <div class="text-label">Người dùng (<span class="text-red">*</span>)</div>
    <nz-select
      style="width: 100%; margin-top: 5px; margin-bottom: 16px"
      [nzPlaceHolder]="'-- Chọn người dùng --'"
      [nzShowSearch]="true"
      nzSize="large"
    >
      <nz-option
        *ngFor="let p of listUser"
        [nzValue]="p.cloudId"
        [nzLabel]="p.name"
      />
    </nz-select>
    <div *ngIf="userVnpt" style="margin-bottom: 16px" class="text-label">
      Các Access key của người dùng này sẽ có quyền truy cập tới Bucket của Quý
      khách
    </div>
    <div class="text-label">Quyền (<span class="text-red">*</span>)</div>
    <nz-select
      style="width: 100%; margin-top: 5px; margin-bottom: 16px"
      [nzPlaceHolder]="'-- Chọn người dùng --'"
      [nzShowSearch]="true"
      nzSize="large"
    >
      <nz-option
        *ngFor="let p of listPermission"
        [nzValue]="p.name"
        [nzLabel]="p.name"
      />
    </nz-select>
    <div class="text-label">
      Chọn thao tác quyền (<span class="text-red">*</span>)
    </div>
    <nz-select
      style="width: 100%; margin-top: 5px; margin-bottom: 16px"
      nzMode="multiple"
      nzPlaceHolder="-- Chọn thao tác quyền --"
      [ngModelOptions]="{ standalone: true }"
      [(ngModel)]="selectedSecurityGroup"
      [nzServerSearch]="true"
      nzSize="large"
    >
      <nz-option
        *ngFor="let i of listActionPermission"
        [nzLabel]="i.name"
        [nzValue]="i.name"
      />
    </nz-select>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelUpdate()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />Hủy
    </button>
    <button nz-button nzType="primary" (click)="handleOkUpdate()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />Xác nhận
    </button>
  </div>
</nz-modal>

<nz-modal
  [(nzVisible)]="isVisibleDelete"
  nzTitle="Xác nhận xóa Policy"
  (nzOnCancel)="handleCancelDelete()"
>
  <ng-container *nzModalContent>
    <div>Quý khách muốn thực hiện xóa Policy?</div>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelDelete()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />Hủy
    </button>
    <button nz-button nzType="primary" (click)="handleOkDelete()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />
      Xác nhận
    </button>
  </div>
</nz-modal>

<nz-modal [(nzVisible)]="isVisibleJson" (nzOnCancel)="handleClose()">
  <ng-container *nzModalContent
    ><nz-tabset nzSize="large">
      <nz-tab nzTitle="Json Item">
        <div class="json-viewer-bg">
          <ngx-json-viewer
            [json]="bucketPolicy"
            style="position: relative"
          ></ngx-json-viewer>
        </div>
      </nz-tab>
      <nz-tab nzTitle="Json Total">
        <div class="json-viewer-bg">
          <ngx-json-viewer
            [json]="bucketPolicy"
            style="position: relative"
          ></ngx-json-viewer>
        </div>
      </nz-tab> </nz-tabset
  ></ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleClose()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />Đóng
    </button>
  </div>
</nz-modal>
