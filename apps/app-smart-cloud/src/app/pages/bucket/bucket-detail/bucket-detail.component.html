<page-header [breadcrumb]="breadcrumb" [action]="action" [title]="'Quản lý Object'">
  <ng-template #breadcrumb>
    <nz-breadcrumb [nzSeparator]="separatorTemplate">
      <nz-breadcrumb-item
        ><a [routerLink]="['/']">{{
          'app.breadcrumb.home' | i18n
        }}</a></nz-breadcrumb-item
      >
      <nz-breadcrumb-item
        ><a (click)="navigateToBucketList()"
          >Bucket</a
        ></nz-breadcrumb-item
      >
      <nz-breadcrumb-item>{{
        'app.bucket.detail' | i18n
      }}</nz-breadcrumb-item>
    </nz-breadcrumb>
    <ng-template #separatorTemplate
      ><img src="assets/imgs/arrow-square-right.svg" alt="" />
    </ng-template>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <region-select-dropdown
        (valueChanged)="onRegionChange($event)"
        (regionChange)="onRegionChanged($event)"
      ></region-select-dropdown>
    </div>
  </ng-template>
</page-header>

<!--THÔNG TIN BUCKET-->
<nz-card class="text-label" nzTitle="" style="border-radius: 8px">
  <div style="margin-bottom: 20px">
    <span class="text-card-header">{{ 'app.bucket.info' | i18n }}</span>
  </div>
  <nz-row>
    <div style="margin-bottom: 10px; margin-right: 8px">Bucket:</div>
    <div style="font-weight: bold">{{ bucket ? bucket.bucketName : '' }}</div>
  </nz-row>
  <nz-row>
    <div style="margin-bottom: 10px; margin-right: 8px">URL:</div>
    <div style="font-weight: bold">
      {{ bucket ? bucket.linkS3Website : '' }}
    </div>
  </nz-row>
  <nz-row>
    <div style="margin-bottom: 10px; margin-right: 8px">
      {{ 'app.storage.usage' | i18n }}:
    </div>
    <div style="font-weight: bold">
      {{usage}}
    </div>
  </nz-row>
  <nz-row>
    <div style="margin-bottom: 10px; margin-right: 8px">Versioning:</div>
    <div style="font-weight: bold">
      {{ bucket ? (bucket.isVersioning == true ? 'Bật' : 'Tắt') : '' }}
    </div>
  </nz-row>
  <nz-row>
    <div style="margin-right: 8px">{{ 'app.access.rights' | i18n }}:</div>
    <div style="font-weight: bold">{{ bucket ? bucket.aclType : '' }}</div>
  </nz-row>
</nz-card>

<!--DANH SACH OBJECT -->
<nz-card class="text-label">
  <div
    style="margin-bottom: 20px"
    nz-row
    [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 24 }"
  >
    <div
      class="text-right p-0 m-b-0"
      nz-col
      [nzLg]="9"
      [nzMd]="9"
      [nzSm]="18"
      [nzXl]="9"
      [nzXs]="18"
      [nzXXl]="9"
    >
      <div style="display: flex">
        <nz-input-group
          style="margin-right: 8px; width: 60%; border-radius: 8px"
          [nzPrefix]="suffixIconSearch"
          nzSize="large"
        >
          <input
          [(ngModel)]="value"
          #searchBox (keyup.enter)="search(searchBox.value)" (ngModelChange)="searchDelay.next(false)"
            nz-input
            [placeholder]="'app.users.search' | i18n"
          />
        </nz-input-group>
        <ng-template #suffixIconSearch>
          <img
            src="assets/imgs/search.svg"
            alt=""
          />
        </ng-template>
      </div>
    </div>
    <div
      class="text-right p-0 m-b-0"
      nz-col
      [nzLg]="15"
      [nzMd]="15"
      [nzSm]="30"
      [nzXl]="15"
      [nzXs]="30"
      [nzXXl]="15"
    >
      <p style="display: inline-block; margin-right: 20px">
        {{ 'app.bucket.detail.select' | i18n : {countObjectSelected: countObjectSelected} }}
      </p>
      <img
        *ngIf="setOfCheckedId.size > 0"
        src="assets/imgs/delete.svg"
        alt=""
        style="cursor: pointer; margin-right: 16px"
        nz-tooltip="{{ 'app.delete' | i18n }}"
        (click)="showModalDeleteObject()"
      />
      <button
        nz-button
        nzType="primary"
        (click)="downloadZipFile()"
        nzSize="large"
      >
        <img
          style="padding-right: 10px"
          src="assets/imgs/download-vector.png"
          alt=""
        />
        <span class="button-text-primary">{{ 'app.bucket.detail.downloadZip' | i18n }}</span>
      </button>
      <button
        nz-button
        nzType="primary"
        (click)="isVisibleCreateFolder = true"
        nzSize="large"
      >
        <img style="padding-right: 10px" src="assets/imgs/folder.png" alt="" />
        <span class="button-text-primary">{{ 'app.bucket.detail.createFolder' | i18n }}</span>
      </button>
      <button
        nz-button
        nzType="primary"
        (click)="isVisibleUploadFile = true"
        nzSize="large"
        style="background-color: #43b000; border-color: #43b000"
      >
        <img
          style="padding-right: 10px"
          src="assets/imgs/document-upload.png"
          alt=""
        />
        <span class="button-text-primary">{{ 'app.bucket.detail.upload' | i18n }}</span>
      </button>
    </div>
  </div>

  <div
    style="
      border: 1px solid #e2e2e9;
      margin-bottom: 10px;
      height: 40px;
      display: flex;
      align-items: center;
    "
  >
  <div style="font-weight: bold; padding-right: 10px; cursor: pointer; margin-left: 10px;" (click)="toFolder1('', true)">
    <img
      src="assets/imgs/box.svg"    
    />
    {{bucket ? bucket.bucketName : ''}} 
  </div>
    <ng-container *ngFor="let item of listOfFolder">
      <div
        style="font-weight: bold; padding-right: 10px; cursor: pointer;"
        (click)="toFolder1(item, false)"
      >
        > {{ item.name }}
      </div>
    </ng-container>
  </div>
  <!-- Bảng-->
  <nz-table
    #rowSelectionTable
    [nzData]="listOfData"
    [nzTotal]="total"
    [nzFrontPagination]="false"
    [nzPageSize]="pageSize"
    (nzPageSizeChange)="onPageSizeChange($event)"
    (nzPageIndexChange)="onPageIndexChange($event)" 
    nzShowSizeChanger
    [nzPageIndex]="pageIndex"
    [nzLoading]="loading"
  >
    <thead>
      <tr>
        <th
          [(nzChecked)]="checked"
          [nzIndeterminate]="indeterminate"
          (nzCheckedChange)="onAllChecked($event)"
        ></th>
        <th>{{ 'app.name' | i18n }}</th>
        <th>{{ 'app.bucket.detail.size' | i18n }}</th>
        <th>{{ 'app.bucket.detail.type' | i18n }}</th>
        <th>{{ 'app.bucket.detail.updateTime' | i18n }}</th>
        <th>{{ 'app.access.rights' | i18n }}</th>
        <th>{{ 'app.text.operation' | i18n }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of rowSelectionTable.data">
        <td
          [nzChecked]="setOfCheckedId.has(item)"
          (nzCheckedChange)="onItemChecked(item, $event)"
        ></td>
        <td nzBreakWord="true" *ngIf="item.objectType != 'folder'">{{ item.keyName }}</td>
        <td
          *ngIf="item.objectType == 'folder'"
          style="color: #0074cc; cursor: pointer"
          (click)="toFolder2(item.key + '/')"
        >
          <img style="padding-right: 5px" src="assets/imgs/folder.svg" alt="" />
          {{ item.key.split('/').pop() }}
        </td>
        <td>{{ formatFileSize(item.size) }} KB</td>
        <td nzBreakWord="true" style="text-transform: capitalize;">{{ item.objectType }}</td>
        <td>{{ item.lastModified | date : 'dd/MM/yyyy HH:mm:ss' }}</td>
        <td>{{ item.isPublic == true ? 'Public' : 'Private' }}</td>
        <td>
          <div>
            <!--            <img  style="padding-right: 5px;" src="assets/imgs/document-download.svg" alt=""/>-->
            <!--            <span style="color: #0066B3; margin-right: 10px;" *ngIf="item.objectType != 'folder'"-->
            <!--                  nz-tooltip-->
            <!--                  nzTooltipTitle="" nzTooltipPlacement="bottom"-->
            <!--                  nz-icon nzType="download" nzTheme="outline" (click)="doAction('3',item)"></span>-->
            <img
              src="assets/imgs/download.svg"
              style="margin-right: 10px; height: 20px; cursor: pointer;"
              *ngIf="item.objectType != 'folder'"
              nz-tooltip
              [nzTooltipTitle]="'app.payment.download' | i18n "
              nzTooltipPlacement="bottom"
              (click)="doAction('3', item)"
            />
            <a
              *ngIf="item.objectType != 'folder'"
              nz-dropdown
              [nzDropdownMenu]="menu"
            >
              <img
                src="assets/imgs/more.svg"
                style="height: 20px"
                *ngIf="item.objectType != 'folder'"
              />
            </a>
            <nz-dropdown-menu #menu="nzDropdownMenu">
              <ul nz-menu>
                <li nz-menu-item (click)="doAction('7', item)">
                  {{ 'app.bucket.detail.version' | i18n }} ({{ item.versionsCount }})
                </li>
                <li nz-menu-item (click)="doAction('2', item)">{{ 'app.bucket.detail.copy' | i18n }}</li>
                <li nz-menu-item (click)="doAction('6', item)">{{ 'app.bucket.detail.share' | i18n }}</li>
                <li nz-menu-item (click)="doAction('1', item)">
                  {{ 'app.bucket.detail.authorize' | i18n }}
                </li>
                <li nz-menu-item (click)="doAction('4', item)">{{ 'app.bucket.detail.detail' | i18n }}</li>
                <li
                  nz-menu-item
                  (click)="doAction('5', item)"
                  style="color: red"
                >
                {{ 'app.delete' | i18n }}
                </li>
              </ul>
            </nz-dropdown-menu>
            <!--            <span style="color: #0066B3; " -->
            <!--                  nz-tooltip-->
            <!--                  nzTooltipTitle="" nzTooltipPlacement="bottom"-->
            <!--                  nz-icon nzType="" nzTheme="outline" (click)="doAction('4',item)"></span>-->
            <!--            <span style="color: #0066B3" -->
            <!--                  nz-tooltip-->
            <!--                  [nzTooltipTitle]="'app.delete' | i18n" nzTooltipPlacement="bottom"-->
            <!--                  nz-icon nzType="delete" nzTheme="outline" ></span>-->
            <img
              src="assets/imgs/eye.svg"
              style="margin-right: 10px; height: 20px; cursor: pointer;"
              *ngIf="item.objectType == 'folder'"
              nz-tooltip
              [nzTooltipTitle]="'app.view.detail' | i18n"
              nzTooltipPlacement="bottom"
              (click)="doAction('4', item)"
            />
            <img
              src="assets/imgs/delete.svg"
              style="height: 25px; cursor: pointer;"
              *ngIf="item.objectType == 'folder'"
              nz-tooltip
              [nzTooltipTitle]="'app.delete' | i18n"
              nzTooltipPlacement="bottom"
              (click)="doAction('5', item)"
            />
          </div>
        </td>
      </tr>
    </tbody>
  </nz-table>
</nz-card>

<!--Tạo thư mục-->
<nz-modal
  [(nzVisible)]="isVisibleCreateFolder"
  [nzTitle]="'app.bucket.detail.createFolder' | i18n"
  [nzOkText]="'app.button.confirm' | i18n"
  [nzCancelText]="'app.button.cancel' | i18n"
  [nzStyle]="modalStyle" 
  (nzOnCancel)="handleCancelCreateFolder()"
>
  <form nz-form [formGroup]="formCreateFolder">
  <ng-container *nzModalContent>
    <div class="text-label">
      <div>{{ 'app.bucket.detail.url' | i18n }}</div>
      <div
        style="
          border: 1px solid #e2e2e9;
          margin-bottom: 10px;
          height: 40px;
          display: flex;
          align-items: center;
        "
      >
      <div style="font-weight: bold; padding-right: 5px; margin-left: 10px">
        <img
          src="assets/imgs/box.svg"    
        />
        {{bucket ? bucket.bucketName : ''}} 
      </div>
        <ng-container *ngFor="let item of listOfFolder">
          <div>> {{ item.name }}</div>
        </ng-container>
      </div>
      <nz-form-item>
        <nz-form-control [nzErrorTip]="folderNameErrorTpl">
      <div class="text-label">{{ 'app.bucket.detail.createFolder.name' | i18n }} (<span class="red-star">*</span>)
        <img
        style="padding-right: 10px; margin-top: -4px"
        [nz-tooltip]="foldertooltip"
        src="assets/imgs/pajamas_question.svg"
        alt=""
      />
      <ng-template #foldertooltip>
        <div [innerHTML]="'app.bucket.detail.createFolder.name.tooltip' | i18n"></div>
      </ng-template>
      </div>
      <input
        nzSize="large"
        nz-input
        [placeholder]="'app.input.name' | i18n"
        style="width: 100%"
        [(ngModel)]="nameFolder"
        maxlength="64"
        [ngModelOptions]="{ standalone: true }"
        formControlName="folderName"
      />
      <ng-template #folderNameErrorTpl let-control>
        <ng-container *ngIf="control.hasError('required')">{{
          'app.bucket.detail.createFolder.require' | i18n
        }}</ng-container>
        <ng-container *ngIf="control.hasError('pattern')">{{
          'app.bucket.detail.createFolder.pattern' | i18n
        }}</ng-container>
      </ng-template>
      </nz-form-control>
      </nz-form-item>
    </div>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelCreateFolder()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button
      nz-button
      nzType="primary"
      (click)="createFolder()"
      [nzLoading]="isLoadingCreateFolder" [disabled]="formCreateFolder.invalid"
    >
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
        *ngIf="isLoadingCreateFolder === false"
      />{{ 'app.button.confirm' | i18n }}
    </button>
  </div>
</form>
</nz-modal>
<!--Tải file lên-->
<nz-modal
  [(nzVisible)]="isVisibleUploadFile"
  [nzTitle]="'app.bucket.detail.uploadFile' | i18n"
  [nzStyle]="modalStyle" 
  (nzOnCancel)="handleCancelUploadFile()"
>
  <ng-container *nzModalContent>
    <!--      2 case trống file-->
    <div *ngIf="emptyFileUpload">
      <nz-upload
        [nzFileList]="lstFileUpdate"
        nzType="drag"
        [nzMultiple]="true"
        (nzChange)="handleChange($event)"
      >
        <img
          style="padding-right: 10px"
          src="assets/imgs/document.svg"
          alt=""
        />
        <img
          style="padding-right: 10px"
          src="assets/imgs/document1.svg"
          alt=""
        />
        <img
          style="padding-right: 10px"
          src="assets/imgs/task-square.svg"
          alt=""
        />
        <p style="margin-top: 12px">
          {{ 'app.bucket.detail.uploadFile.drag' | i18n }}: <strong> {{ 'app.bucket.detail.uploadFile.chooseFile' | i18n }}</strong>
        </p>
      </nz-upload>
    </div>
    <div *ngIf="!emptyFileUpload">
      <p class="text-label">{{ 'app.bucket.detail.uploadFile.chooseRight' | i18n }}</p>
      <nz-radio-group [(ngModel)]="radioValue">
        <label nz-radio nzValue="public-read" class="text-label">Public</label>
        <label nz-radio nzValue="private" class="text-label">Private</label>
      </nz-radio-group>
      <nz-divider class="mb-3" />
      <span class="mt-2 d-block text-label float-right mb-4" *ngIf="lstFileUpdate.length > 0">{{countSuccessUpload}} của {{lstFileUpdate.length}}</span>
      <nz-table
        [nzData]="lstFileUpdate"
        style="margin-top: 10px" nzHideOnSinglePage nzShowPagination="false"
      >
        <thead>
          <tr>
            <th>{{ 'app.name' | i18n }}</th>
            <th>{{ 'app.bucket.detail.uploadFile.type' | i18n }}</th>
            <th>{{ 'app.bucket.detail.size' | i18n }}</th>
            <th>{{ 'app.text.operation' | i18n }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of lstFileUpdate; i as index">
            <td nzBreakWord="true">{{ item.name }}</td>
            <td nzBreakWord="true" style="width: 400px">{{ item.type }}</td>
            <td style="width: 400px">
              <div>{{ formatFileSize(item.size) }}</div>
              <div>
                <nz-progress
                  *ngIf="item.isUpload === true"
                  nzType="line"
                  [nzPercent]="item.percentage"
                  [nzStatus]="
                    uploadFailed === true
                      ? 'exception'
                      : item.percentage === 100
                      ? 'success'
                      : 'active'
                  "
                ></nz-progress>
              </div>
            </td>
            <td>
              <img
                style="margin-right: 10px; cursor: pointer"
                nz-tooltip
                [nzTooltipTitle]="'app.bucket.detail.uploadFile.upload' | i18n "
                src="assets/imgs/download.svg"
                (click)="uploadSingleFile(item, i)"
              />
              <img
                *ngIf="!item.isUpload"
                style="cursor: pointer"
                nz-tooltip
                [nzTooltipTitle]="'app.delete' | i18n"
                src="assets/imgs/delete.svg"
                (click)="removeFile(item)"
              />
              <img
                *ngIf="item.isUpload === true"
                style="cursor: pointer"
                nz-tooltip
                [nzTooltipTitle]="'app.button.confirm' | i18n"
                src="assets/imgs/delete.svg"
                (click)="removeFile(item)"
              />
            </td>
          </tr></tbody
      ></nz-table>

      <h3 style="font-weight: bold; margin-top: 10px">METADATA
        <img
        style="padding-right: 10px; margin-top: -4px"
        [nz-tooltip]="'app.bucket.detail.uploadFile.metaData' | i18n "
        src="assets/imgs/pajamas_question.svg"
        alt=""
      />
      </h3>
      <nz-row *ngFor="let item of listOfMetadata" style="margin-top: 10px">
        <input
          style="width: 40%; margin-right: 5%"
          nzSize="large"
          nz-input
          [placeholder]="'app.bucket.detail.uploadFile.key' | i18n "
          [(ngModel)]="item.metaKey"
        />
        <input
          style="width: 40%; margin-right: 5%"
          nzSize="large"
          nz-input
          [placeholder]="'app.bucket.detail.uploadFile.value' | i18n "
          [(ngModel)]="item.metaValue"
        />
        <button
          style="border: none"
          nz-button
          (click)="removeMetadata(item.metaKey)"
          nzSize="large"
        >
          <img style="margin-top: -4px" src="assets/imgs/delete.svg" />
        </button>
      </nz-row>
      <nz-row style="margin-top: 15px">
        <button
          nz-button
          nzType="primary"
          (click)="addMoreMetadata()"
          nzSize="large"
          style="margin-right: 10px"
        >
          <img
            style="padding-right: 10px"
            src="assets/imgs/add-circle.svg"
            alt=""
          />
          <span class="button-text-primary">{{ 'app.bucket.detail.uploadFile.metaData.create' | i18n }}</span>
        </button>
        <nz-upload
          (nzChange)="handleChange($event)"
          [nzShowUploadList]="false"
          [nzFileList]="lstFileUpdate"
        >
          <button nz-button nzType="primary" nzSize="large">
            <img
              style="padding-right: 10px"
              src="assets/imgs/folder.png"
              alt=""
            />
            <span class="button-text-primary">{{ 'app.bucket.detail.uploadFile.metaData.addFile' | i18n }}</span>
          </button>
        </nz-upload>
      </nz-row>
    </div>
  </ng-container>
  <div *nzModalFooter class="d-flex justify-content-end">
    <button nz-button (click)="handleCancelUploadFile()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button
      nz-button
      nzType="primary"
      (click)="uploadAllFile()" 
      [disabled]="lstFileUpdate.length === 0"
    >
      <div class="d-flex align-items-center">
        <img
        style="padding-right: 5px"
        src="assets/imgs/document-upload.png"
        alt=""
      />
      <span>{{ 'app.bucket.detail.uploadFile.all' | i18n }}</span>
      </div>
    </button>
  </div>
</nz-modal>

<!--Chi tiết-->
<nz-modal
  [(nzVisible)]="isVisibleDetail"
  [nzTitle]="'app.bucket.detail.uploadFile.metaData.objectDetail' | i18n: dataAction != undefined ? dataAction.key : '' "
  (nzOnCancel)="handleCancel()"
  (nzOnOk)="handleCancel()"
  [nzOkText]="null"
  [nzCancelText]="null"
  [nzStyle]="modalStyle"
>
  <ng-container *nzModalContent>
    <nz-row style="justify-content: space-between">
      <input
        nz-input
        [ngModel]="dataAction.url"
        [disabled]="true"
        nzSize="large"
        style="width: 91%"
      />
      <button
        nz-button
        nzType="primary"
        (click)="copyUrl()"
        nzSize="large"
        style="width: 15%"
        style="text-align: right"
      >
        <span class="button-text-primary">{{ 'app.copy' | i18n }}</span>
      </button>
    </nz-row>
    <nz-divider *ngIf="dataAction.objectType != 'folder'"></nz-divider>
    <div class="text-label mb-2" *ngIf="dataAction.objectType != 'folder'">
      Phân quyền:
      <span style="font-weight: 700;">{{
        dataAction != undefined
          ? dataAction.isPublic
            ? 'Public'
            : 'Private'
          : ''
      }}</span>
    </div>
    <div class="text-label" *ngIf="dataAction.objectType != 'folder'">
      Loại: 
      <span style="font-weight: 700;">
      {{ dataAction != undefined ? dataAction.objectType : '' }}
    </span>
    </div>
  </ng-container>
</nz-modal>

<!--Xóa-->
<nz-modal
  *ngIf="dataAction != undefined"
  [(nzVisible)]="isVisibleDelete"
  nzTitle="Xác nhận xóa {{
    dataAction.objectType != 'folder' ? 'File' : 'Object'
  }}?"
  (nzOnCancel)="handleCancel()"
  [nzStyle]="modalStyle"
>
  <ng-container *nzModalContent>
    <nz-alert
      *ngIf="dataAction.objectType != 'folder'"
      nzType="warning"
      [nzMessage]="'app.delete.file' | i18n: dataAction.keyName"
      nzShowIcon
    ></nz-alert>
    <nz-alert
      *ngIf="dataAction.objectType == 'folder'"
      nzType="warning"
      nzMessage="Bạn đang thực hiện xóa Folder {{
        dataAction.keyName
      }}. Mọi object bên trong folder này sẽ bị xóa và không thể khôi phục lại"
      nzShowIcon
    ></nz-alert>
    <div *ngIf="dataAction.objectType != 'folder'" class="text-label" style="margin-top: 15px">
      {{ 'app.delete.file.confirm' | i18n }} <b>{{ dataAction.keyName }}</b
      >?
    </div>
    <div *ngIf="dataAction.objectType == 'folder'" class="text-label" style="margin-top: 15px">
      {{ 'app.delete.folder.confirm' | i18n }}
      <b>{{ dataAction.keyName }}</b
      >?
    </div>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancel()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button
      nz-button
      nzType="primary"
      (click)="deleteFolder()"
      [nzLoading]="isLoadingDeleteObject"
    >
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
        *ngIf="isLoadingDeleteObject === false"
      />{{ 'app.button.confirm' | i18n }}
    </button>
  </div>
</nz-modal>

<!--Sao chép-->
<nz-modal
*ngIf="dataAction != undefined"
  [(nzVisible)]="isVisibleCopy"
  [nzTitle]="'Sao chép Object : ' + dataAction.key"
  (nzOnCancel)="handleCancel()"
  [nzStyle]="modalStyle"
>
  <ng-container *nzModalContent>
    <div class="text-label">
      <div>{{ 'app.bucket.detail.copy.chooseFolder' | i18n }}</div>
      <div class="tree">
        <div *ngIf="treeFolder != undefined && treeFolder.length > 0">
          <div *ngFor="let item of treeFolder">
            <div>
              <div class="tree-item">
                <nz-row
                  (click)="toFolder(item)"
                  class="tree-row"
                  [ngStyle]="{
                    'background-color': isActive(item) ? '#E2E2E9' : ''
                  }"
                >
                  <img
                    *ngIf="item.bucketName != undefined"
                    style="
                      margin-left: 10px;
                      margin-right: 10px;
                      cursor: pointer;
                    "
                    src="assets/imgs/box.svg"
                    alt=""
                  />
                  <div
                    *ngIf="item.bucketName != undefined"
                    style="font-weight: bold; cursor: pointer"
                  >
                    {{ item.bucketName }}
                  </div>
                </nz-row>
                <ng-container *ngIf="item.bucketTreeData.length > 0">
                  <nz-row
                    *ngFor="let childItem of item.bucketTreeData"
                    (click)="toFolder(childItem)"
                    style="margin-top: 5px; margin-left: 30px"
                    class="tree-row"
                    [ngStyle]="{
                      'background-color': isActive(childItem) ? '#E2E2E9' : ''
                    }"
                  >
                    <img
                      style="
                        margin-left: 10px;
                        margin-right: 10px;
                        cursor: pointer;
                      "
                      src="assets/imgs/folder-new.svg"
                      alt=""
                    />
                    <div style="cursor: pointer">
                      {{ childItem.folderName }}
                    </div>
                  </nz-row>
                </ng-container>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="mt-2">Đường dẫn</div>
      <div
    style="
      border: 1px solid #e2e2e9;
      margin-bottom: 10px;
      height: 40px; 
      display: flex;
      align-items: center;
    "
  >
    <img
      style="padding-right: 10px; padding-left: 10px; cursor: pointer"
      src="assets/imgs/box.svg"
    />
    <ng-container *ngFor="let item of listOfFolderCopy; let i = index">
      <div
        style="font-weight: bold; padding-right: 10px; cursor: pointer;"
      >
      <span *ngIf="i > 0"> > </span> {{ item.name }}
      </div>
    </ng-container>
  </div>
    </div>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancel()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button
      nz-button
      nzType="primary"
      (click)="copyFolder()"
      [disabled]="isClickCopy === false"
      [nzLoading]="isLoadingCopy"
    >
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
        *ngIf="isLoadingCopy === false"
      />{{ 'app.button.confirm' | i18n }}
    </button>
  </div>
</nz-modal>

<!--Chia sẻ-->
<nz-modal
  [(nzVisible)]="isVisibleShare"
  (nzOnCancel)="handleCancelShareFile()"
  [nzTitle]="'app.bucket.detail.copy.shareFile' | i18n "
  [nzStyle]="modalStyle"
>
  <ng-container *nzModalContent>
    <div class="text-label">{{ 'app.bucket.detail.copy.shareFile.expire' | i18n }}</div>
    <nz-date-picker
      class="input-date-picker"
      nzFormat="yyyy-MM-dd HH:mm:ss"
      [nzDisabledDate]="disabledDate"
      [nzDisabledTime]="disabledDateTime"
      [ngModel]="nextDay"
      (ngModelChange)="getLinkShare($event)"
      [nzShowTime]="{ nzDefaultOpenValue: timeDefaultValue }"
      style="width: 100%; border-radius: 4px"
    ></nz-date-picker>
    <div class="text-label" style="margin-top: 15px">{{ 'app.bucket.detail.copy.shareFile.sharelink' | i18n }}</div>
    <input
      class="input-custom"
      nz-input
      [disabled]="true"
      nzSize="large"
      [ngModel]="linkShare"
      *ngIf="isLoadingGetLink === false"
    />
    <div class="input-share">
      <nz-skeleton
        [nzLoading]="isLoadingGetLink"
        [nzActive]="true"
        [nzTitle]="false"
        [nzParagraph]="{ rows: 1, width: '100%' }"
      ></nz-skeleton>
    </div>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelShareFile()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button
      nz-button
      nzType="primary"
      (click)="handleShare()"
    >
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/icon-copy3.svg"
        alt=""
      />{{ 'app.bucket.detail.copy.shareFile.link' | i18n }}
    </button>
  </div>
</nz-modal>

<!--Phân quyền-->
<nz-modal
  [(nzVisible)]="isVisiblePermission"
  [nzTitle]="'app.bucket.detail.copy.authorize' | i18n "
  (nzOnCancel)="this.isVisiblePermission = false"
  [nzStyle]="modalStyle"
>
  <ng-container *nzModalContent>
    <nz-radio-group
      [(ngModel)]="radioValue1"
      style="width: 100%; display: inline-flex"
    >
      <nz-row
        [nzGutter]="{ xs: 24, sm: 24, md: 24, lg: 24 }"
        style="margin-top: 10px"
      >
        <nz-col [nzLg]="12" [nzMd]="12" [nzSm]="24" [nzXl]="12" [nzXs]="24">
          <nz-card
            style="border-radius: 4px"
            [nzAlign]="'middle'"
            [ngStyle]="{border: activePrivate? '1px solid #0066B3': '1px solid #DADADA',height: '150px',}"
          >
            <nz-row nzGutter="16">
              <nz-col nzSpan="20">
                <nz-card-meta
                  [nzAvatar]="nzAvatarselectedHDDorSSD1"
                  [nzTitle]="nzTitleselectedHDDorSSD1"
                  [nzDescription]="nzDescriptionselectedHDDorSSD1"
                >
                  <ng-template #nzAvatarselectedHDDorSSD1>
                    <label
                      nz-radio
                      [nzValue]="'Private'"
                      (click)="selectPermisstion(1)"
                    ></label>
                  </ng-template>
                  <ng-template #nzTitleselectedHDDorSSD1>
                    <b>Private</b>
                  </ng-template>
                  <ng-template #nzDescriptionselectedHDDorSSD1>
                    <ellipsis class="text-custom">
                      {{ 'app.bucket.detail.copy.authorize.des' | i18n }}
                    </ellipsis>
                  </ng-template>
                </nz-card-meta>
              </nz-col>
            </nz-row>
          </nz-card>
        </nz-col>
        <nz-col [nzLg]="12" [nzMd]="12" [nzSm]="24" [nzXl]="12" [nzXs]="24">
          <nz-card
            style="border-radius: 4px"
            [nzAlign]="'middle'"
            [ngStyle]="{
                  border: !activePrivate
                  ? '1px solid #0066B3'
                  : '1px solid #DADADA',
                  height: '150px',
                }"
          >
            <nz-row nzGutter="16">
              <nz-col nzSpan="20">
                <nz-card-meta
                  [nzAvatar]="nzAvatarselectedHDDorSSD2"
                  [nzTitle]="nzTitleselectedHDDorSSD2"
                  [nzDescription]="nzDescriptionselectedHDDorSSD2"
                >
                  <ng-template #nzAvatarselectedHDDorSSD2>
                    <label
                      nz-radio
                      [nzValue]="'Public'"
                      (click)="selectPermisstion(2)"
                    ></label>
                  </ng-template>
                  <ng-template #nzTitleselectedHDDorSSD2>
                    <b>Public</b>
                  </ng-template>
                  <ng-template #nzDescriptionselectedHDDorSSD2>
                    <ellipsis class="text-custom"
                      >{{ 'app.bucket.detail.copy.authorize.des1' | i18n }}
                    </ellipsis>
                  </ng-template>
                </nz-card-meta>
              </nz-col>
            </nz-row>
          </nz-card>
        </nz-col>
      </nz-row>
    </nz-radio-group>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="this.isVisiblePermission = false">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button
      nz-button
      nzType="primary"
      (click)="editPermission()"
      [nzLoading]="isLoadingAuthorize"
    >
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
        *ngIf="isLoadingAuthorize === false"
      />{{ 'app.button.confirm' | i18n }}
    </button>
  </div>
</nz-modal>

<!--Phiên bản-->
<nz-modal
  *ngIf="dataAction != undefined"
  [(nzVisible)]="isVisibleVersioning"
  [nzTitle]="'app.bucket.detail.version.list' | i18n: {objectName: dataAction.key}"
  (nzOnCancel)="handleCancel()"
  (nzOnOk)="editPermission()"
  [nzOkText]="null"
  nzCancelText="{{'app.order-detail.back' | i18n}}"
  [nzStyle]="modalStyle"
>
  <ng-container *nzModalContent>
    <nz-table
      #rowSelectionTable
      [nzData]="listOfDataVersioning"
      [nzLoading]="loadingVersion"
      [nzHideOnSinglePage]="true"
    >
      <thead>
        <tr>
          <th>{{ 'app.bucket.detail.version.version' | i18n }}</th>
          <th>{{ 'app.bucket.detail.updateTime' | i18n }}</th>
          <th>{{ 'app.bucket.detail.size' | i18n }}</th>
          <th>{{ 'app.bucket.detail.version.versionId' | i18n }}</th>
          <th>{{ 'app.text.operation' | i18n }}</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let item of listOfDataVersioning">
          <tr>
            <td>
              {{ item.key }}
              <div *ngIf="item.isLatest == true">({{ 'app.present' | i18n }})</div>
            </td>
            <td>{{ item.lastModified | date : 'dd/MM/yyyy HH:mm:ss' }}</td>
            <td>{{ (item.size / 1024).toFixed(2) }} KB</td>
            <td>{{ item.versionId === "null" ? '' : item.versionId }}</td>
            <td>
              <div>
                <img
                  src="assets/imgs/download.svg"
                  style="padding-right: 10px; height: 20px; cursor: pointer;"
                  nz-tooltip
                  [nzTooltipTitle]="'app.payment.download' | i18n"
                  nzTooltipPlacement="bottom"
                  (click)="doActionVersion('1', item)"
                />
                <img
                  *ngIf="item.isLatest != true"
                  src="assets/imgs/refresh.svg"
                  style="padding-right: 10px; height: 25px; cursor: pointer;"
                  nz-tooltip
                  [nzTooltipTitle]="'app.restore' | i18n"
                  nzTooltipPlacement="bottom"
                  (click)="doActionVersion('2', item)"
                />
                <img
                  src="assets/imgs/delete.svg"
                  style="height: 25px; cursor: pointer;"
                  nz-tooltip
                  [nzTooltipTitle]="'app.delete' | i18n"
                  nzTooltipPlacement="bottom"
                  (click)="doActionVersion('3', item)"
                />
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </nz-table>
  </ng-container>
</nz-modal>

<!--Xóa Phiên bản-->
<nz-modal
  [(nzVisible)]="isVisibleDeleteVersion"
  [nzTitle]="'app.bucket.detail.version.delete' | i18n "
  (nzOnCancel)="isVisibleDeleteVersion = false"
  [nzStyle]="modalStyle"
>
  <ng-container *nzModalContent>
    <nz-alert
      nzType="warning"
      [nzMessage]="'app.bucket.detail.version.delete.alert' | i18n "
      nzShowIcon
    ></nz-alert>
    <div class="text-label" style="margin-top: 15px">
      {{ 'app.bucket.detail.version.delete.confirm' | i18n }}
    </div>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="isVisibleDeleteVersion = false">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button
      nz-button
      nzType="primary"
      (click)="deleteFolderVersion()"
      [nzLoading]="isLoadingDeleteVersion"
    >
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
        *ngIf="isLoadingDeleteVersion === false"
      />{{ 'app.button.confirm' | i18n }}
    </button>
  </div>
</nz-modal>

<!--Khôi phục Phiên bản-->
<nz-modal
  [(nzVisible)]="isVisibleRestoreVersion"
  [nzTitle]="'app.bucket.detail.version.restore' | i18n"
  (nzOnCancel)="isVisibleRestoreVersion = false"
  (nzOnOk)="restoreObjectVersion()"
  [nzStyle]="modalStyle"
>
  <ng-container *nzModalContent>
    <nz-alert
      nzType="warning"
      [nzMessage]="'app.bucket.detail.version.restore.alert' | i18n"
      nzShowIcon
    ></nz-alert>
    <div style="margin-top: 15px">
      {{ 'app.bucket.detail.version.restore.confirm' | i18n }}
    </div>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="isVisibleRestoreVersion = false">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button
      nz-button
      nzType="primary"
      (click)="restoreObjectVersion()"
      [nzLoading]="isLoadingRestoreVersion"
    >
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
        *ngIf="isLoadingRestoreVersion === false"
      />{{ 'app.button.confirm' | i18n }}
    </button>
  </div>
</nz-modal>

<!--Xóa-->
<nz-modal
  [(nzVisible)]="isVisibleDeleteObject"
  [nzTitle]="'app.bucket.detail.delete.objects' | i18n"
  (nzOnCancel)="handleCancelDeleteObject()"
  [nzStyle]="modalStyle"
>
  <ng-container *nzModalContent>
    <nz-alert
      nzType="warning"
      [nzMessage]="'app.bucket.detail.delete.objects.alert' | i18n"
      nzShowIcon
    ></nz-alert>
    <div style="margin-top: 15px; font-size: 16px;">
      {{ 'app.bucket.detail.delete.objects.confirm' | i18n }}
    </div>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelDeleteObject()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{'app.button.cancel' | i18n}}
    </button>
    <button nz-button nzType="primary" (click)="handledeleteObjects()" [nzLoading]="isLoadingDeleteObjects">
      <img
        *ngIf="isLoadingDeleteObjects === false"
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""

      />{{'app.button.confirm' | i18n}}
    </button>
  </div>
</nz-modal>
