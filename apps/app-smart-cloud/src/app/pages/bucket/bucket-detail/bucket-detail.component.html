<page-header [breadcrumb]="breadcrumb" [title]="'Quản lý Object'">
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item><a [routerLink]="['/']">Trang chủ</a></nz-breadcrumb-item>
      <nz-breadcrumb-item><a [routerLink]="['/app-smart-cloud/object-storage/bucket']">Bucket</a></nz-breadcrumb-item>
      <nz-breadcrumb-item><a>Chi tiết Bucket</a></nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
</page-header>

<!--THÔNG TIN BUCKET-->
<nz-card class="text-label" nzTitle="" style="border-radius: 8px;">
  <div style="margin-bottom: 20px">
    <span class="text-card-header">Thông tin Bucket</span>
  </div>
  <nz-row>
    <div style="margin-bottom: 10px;margin-right: 8px">Bucket:</div>
    <div style="font-weight: bold;">{{bucket.bucketName}}</div>
  </nz-row>
  <nz-row>
    <div style="margin-bottom: 10px;margin-right: 8px">URL:</div>
    <div style="font-weight: bold;">{{bucket.linkS3Website}}</div>
  </nz-row>
  <nz-row>
    <div style="margin-bottom: 10px;margin-right: 8px">Dung lượng đã sử dụng:</div>
    <div style="font-weight: bold;">{{bucket.bucketSize}} Bytes / {{bucket.bucketItemCount}} objects</div>
  </nz-row>
  <nz-row>
    <div style="margin-bottom: 10px;margin-right: 8px">Versioning:</div>
    <div style="font-weight: bold;">{{bucket.isVersioning == true ? 'Bật' : 'Tắt'}}</div>
  </nz-row>
  <nz-row>
    <div style="margin-right: 8px">Quyền truy cập:</div>
    <div style="font-weight: bold;">{{bucket.aclType}}</div>
  </nz-row>
</nz-card>

<!--DANH SACH OBJECT -->
<nz-card class="text-label">
  <div style="margin-bottom: 20px;" nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 24 }">
    <div class="text-right p-0 m-b-0" nz-col [nzLg]="9" [nzMd]="9" [nzSm]="18" [nzXl]="9" [nzXs]="18" [nzXXl]="9">
      <div style="display:flex;">
        <nz-input-group style="margin-right: 8px; width: 60%;border-radius: 8px" [nzPrefix]="suffixIconSearch"
                        nzSize="large">
          <input #searchBox (keyup.enter)="search(searchBox.value)" name="name" nz-input placeholder="Tìm kiếm"/>
        </nz-input-group>
        <ng-template #suffixIconSearch>
          <img src="assets/imgs/search.svg" alt="" style="cursor: pointer" nz-tooltip="Tìm kiếm theo tên"
               (click)="search(searchBox.value)"/>
        </ng-template>
        <button nz-button nzType="default" (click)="openFilter()" nzSize="large">
          <span class="button-text-primary">Lọc</span>
        </button>
      </div>

    </div>
    <div class="text-right p-0 m-b-0" nz-col [nzLg]="15" [nzMd]="15" [nzSm]="30" [nzXl]="15" [nzXs]="30" [nzXXl]="15">
      <p style="display: inline-block; margin-right: 20px;">Đã chọn {{countObjectSelected}} Objects.</p>
      <button nz-button nzType="primary" (click)="uploadFile()" nzSize="large">
        <img style="padding-right: 10px;" src="assets/imgs/download-vector.png" alt=""/>
        <span class="button-text-primary">Tải zip</span>
      </button>
      <button nz-button nzType="primary" (click)="isVisibleCreateFolder = true" nzSize="large">
        <img style="padding-right: 10px;" src="assets/imgs/folder.png" alt=""/>
        <span class="button-text-primary">Tạo thư mục</span>
      </button>
      <button nz-button nzType="primary" (click)="isVisibleUploadFile = true" nzSize="large"
              style="background-color: #43B000;border-color: #43B000">
        <img style="padding-right: 10px;" src="assets/imgs/document-upload.png" alt=""/>
        <span class="button-text-primary">Tải file lên</span>
      </button>
    </div>
  </div>


  <div style="border: 1px solid #E2E2E9;margin-bottom: 10px; height: 40px ; display: flex; align-items: center;">
    <img style="padding-right: 10px;padding-left: 10px;" src="assets/imgs/box.svg" alt=""/>
    <ng-container *ngFor="let item of listOfFolder">
      <div style="font-weight: bold;padding-right: 10px;" (click)="toFolder(item)">> {{item.name}} </div>
    </ng-container>
  </div>
  <!-- Bảng-->
  <nz-table #rowSelectionTable nzShowPagination nzShowSizeChanger [nzData]="listOfData"
            [nzTotal]="total" [nzPageSize]="size" (nzPageSizeChange)="onPageSizeChange($event)"
            (nzPageIndexChange)="onPageIndexChange($event)" [nzLoading]="loading">
    <thead>
    <tr>
      <th
        [(nzChecked)]="checked"
        [nzIndeterminate]="indeterminate"
        (nzCheckedChange)="onAllChecked($event)"
      ></th>
      <th>Tên</th>
      <th>Kích thước</th>
      <th>Loại</th>
      <th>Thời gian chỉnh sửa</th>
      <th>Quyền truy cập</th>
      <th>Thao tác</th>
    </tr>
    </thead>
    <tbody>
    <ng-container *ngFor="let item of listOfData">
      <tr>
        <td [nzChecked]="setOfCheckedId.has(item.key)"
            (nzCheckedChange)="onItemChecked(item.key , $event)"></td>
        <td *ngIf="item.objectType != 'folder'">{{item.key}}</td>
        <td *ngIf="item.objectType == 'folder'" style="color: #0074CC" (click)="loadData(item.key)">
          <img style="padding-right: 5px;" src="assets/imgs/folder.svg" alt=""/>
          {{item.key}}
        </td>
        <td>{{(item.size / 1024).toFixed(2)}} KB</td>
        <td>{{item.objectType}}</td>
        <td>{{item.lastModified | date:'dd/MM/yyyy HH:mm:ss'}}</td>
        <td>{{item.isPublic == true ? 'Public' : 'Private'}}</td>
        <td>
          <div>
            <!--            <img  style="padding-right: 5px;" src="assets/imgs/document-download.svg" alt=""/>-->
            <span style="color: #0066B3; margin-right: 10px;" *ngIf="item.objectType != 'folder'"
                  nz-tooltip
                  nzTooltipTitle="Tải xuống" nzTooltipPlacement="bottom"
                  nz-icon nzType="download" nzTheme="outline"></span>
            <a *ngIf="item.objectType != 'folder'" nz-dropdown [nzDropdownMenu]="menu">
              <span nz-icon nzType="more"></span>
            </a>
            <nz-dropdown-menu #menu="nzDropdownMenu">
              <ul nz-menu>
                <li nz-menu-item>Phiên bản ({{version}})</li>
                <li nz-menu-item (click)="doAction('2',item)">Sao chép</li>
                <li nz-menu-item>Chia sẻ</li>
                <li nz-menu-item>Quản lý phân quyền</li>
                <li nz-menu-item>Chi tiết</li>
                <li nz-menu-item style="color: red">Xóa</li>
              </ul>
            </nz-dropdown-menu>
            <span style="color: #0066B3; margin-right: 10px;" *ngIf="item.objectType == 'folder'"
                  nz-tooltip
                  nzTooltipTitle="Xem chi tiết" nzTooltipPlacement="bottom"
                  nz-icon nzType="eye" nzTheme="outline"></span>
            <span style="color: #0066B3" *ngIf="item.objectType == 'folder'"
                  nz-tooltip
                  nzTooltipTitle="Xóa" nzTooltipPlacement="bottom"
                  nz-icon nzType="delete" nzTheme="outline"></span>
          </div>
        </td>
      </tr>
    </ng-container>
    </tbody>
  </nz-table>
</nz-card>

<!--Filter-->
<nz-modal [(nzVisible)]="isVisibleFilter" nzTitle="Lọc danh sách Object" (nzOnCancel)="handleCancel()"
          (nzOnOk)="openFilter()" nzOkText="Xác nhận" nzCancelText="Hủy" [nzStyle]="modalStyle">
  <ng-container *nzModalContent>
    <nz-table [nzData]="dataFilter" nzHideOnSinglePage="true">
      <thead>
      <tr>
        <th>Cột</th>
        <th>Điều kiện</th>
        <th>Giá trị</th>
        <th>Thao tác</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let item of dataFilter">
        <td style="width: 28%">
          <nz-select [(ngModel)]="item.name" (ngModelChange)="selectCol(item, $event)" nzSize="large"
                     style="width: 100%;">
            <nz-option *ngFor="let p of colReal" [nzValue]="p" [nzLabel]="p"></nz-option>
          </nz-select>
        </td>
        <td style="width: 20%">
          <nz-select *ngIf="item.name == 'Tên'" [(ngModel)]="item.condition"
                     (ngModelChange)="selectCondition(item.orderNum, 1,$event)" nzSize="large" style="width: 100%;">
            <nz-option *ngFor="let p of conditionNameReal" [nzValue]="p" [nzLabel]="p"></nz-option>
          </nz-select>
          <nz-select *ngIf="item.name == 'Thời gian chỉnh sửa'" [(ngModel)]="item.condition"
                     (ngModelChange)="selectCondition(item.orderNum, 2,$event)" nzSize="large" style="width: 100%;">
            <nz-option *ngFor="let p of conditionTimeReal" [nzValue]="p" [nzLabel]="p"></nz-option>
          </nz-select>
          <nz-select *ngIf="item.name == 'Dung lượng'" [(ngModel)]="item.condition"
                     (ngModelChange)="selectCondition(item.orderNum, 3,$event)" nzSize="large" style="width: 100%;">
            <nz-option *ngFor="let p of conditionCapacityReal" [nzValue]="p" [nzLabel]="p"></nz-option>
          </nz-select>
        </td>
        <td style="width: 47%">
          <input nzSize="large" *ngIf="item.name == 'Tên'" nz-input placeholder="Basic usage" [(ngModel)]="item.value"
                 type="text" style="width: 100%;"/>
          <nz-date-picker *ngIf="item.name == 'Thời gian chỉnh sửa'" [(ngModel)]="item.value" nzSize="large"
                          style="width: 100%;"></nz-date-picker>
          <nz-input-number *ngIf="item.name == 'Dung lượng'" [(ngModel)]="item.value"
                           [nzMin]="0" [nzMax]="62" [nzStep]="1" nzSize="large" style="width: 60%;"></nz-input-number>
          <nz-select *ngIf="item.name == 'Dung lượng' && item.condition == 'Lớn hơn'" [(ngModel)]="item.type"
                     (ngModelChange)="selectType(item.condition, $event)" nzSize="large"
                     style="width: 30%;margin-left: 5%;">
            <nz-option *ngFor="let p of capMoreTypeReal" [nzValue]="p" [nzLabel]="p"></nz-option>
          </nz-select>
          <nz-select *ngIf="item.name == 'Dung lượng' && item.condition == 'Nhỏ hơn'" [(ngModel)]="item.type"
                     (ngModelChange)="selectType(item.condition, $event)" nzSize="large"
                     style="width: 30%;margin-left: 5%;">
            <nz-option *ngFor="let p of capLessTypeReal" [nzValue]="p" [nzLabel]="p"></nz-option>
          </nz-select>
        </td>
        <td style="width: 5%">
          <button style="border: none;" nz-button (click)="deleteFilter(item.orderNum)" nzSize="large"><img
            style="margin-top: -4px" src="assets/imgs/trash.svg"/></button>
        </td>
      </tr>
      </tbody>
    </nz-table>
    <button nz-button *ngIf="isVisibleAddFilte" nzType="primary" (click)="addFilter()" nzSize="large"
            style="margin-top: 8px;">
      <img style="padding-right: 10px;" src="assets/imgs/add-circle.svg" alt=""/>
      <span class="button-text-primary">Thêm một dòng</span>
    </button>
  </ng-container>
</nz-modal>
<!--Tạo thư mục-->
<nz-modal [(nzVisible)]="isVisibleCreateFolder" nzTitle="Tạo thư mục" (nzOnCancel)="isVisibleCreateFolder = false"
          (nzOnOk)="createFolder()" nzOkText="Xác nhận"
          nzCancelText="Hủy" [nzStyle]="modalStyle">
  <ng-container *nzModalContent>
    <div class="text-label">
      <div>Đường dẫn</div>
      <div
        style="border: 1px solid #E2E2E9;margin-bottom: 10px; height: 40px ; display: flex; align-items: center;">
        <img style="padding-right: 10px;padding-left: 10px;" src="assets/imgs/box.svg" alt=""/>
        <ng-container *ngFor="let item of listOfFolder">
          <div style="font-weight: bold;">>{{item.name}}</div>
        </ng-container>
      </div>
      <div>Tên thư mục (<span class="red-star">*</span>)</div>
      <input nzSize="large" nz-input placeholder="Nhập tên thư mục" style="width: 100%"
             [(ngModel)]="nameFolder">
    </div>
  </ng-container>
</nz-modal>
<!--Tải file lên-->
<nz-modal [(nzVisible)]="isVisibleUploadFile" nzTitle="Tải File lên" (nzOnCancel)="isVisibleUploadFile = false"
          (nzOnOk)="uploadFile()" nzOkText="Tải lên tất cả"
          nzCancelText="Hủy" [nzStyle]="modalStyle">
  <ng-container *nzModalContent>
    <!--      2 case trống file-->
    <div *ngIf="emptyFileUpload">
      <nz-upload nzType="drag" [nzMultiple]="true" nzAction="https://www.mocky.io/v2/5cc8019d300000980a055e76"
                 (nzChange)="handleChange($event)">
        <img style="padding-right: 10px;" src="assets/imgs/document.svg" alt=""/>
        <img style="padding-right: 10px;" src="assets/imgs/document1.svg" alt=""/>
        <img style="padding-right: 10px;" src="assets/imgs/task-square.svg" alt=""/>
        <p style="margin-top: 12px;">Kéo thả vào đây hoặc: <strong> Chọn tải file lên</strong></p>
      </nz-upload>
    </div>
    <div *ngIf="!emptyFileUpload">
      <p>Lựa chọn phân quyền đọc</p>
      <nz-radio-group [(ngModel)]="radioValue">
        <label nz-radio nzValue="Public">Public</label>
        <label nz-radio nzValue="Private">Private</label>
      </nz-radio-group>
      <nz-table [nzData]="lstFileUpdate" style="margin-top: 10px;" [nzHideOnSinglePage]="true">
        <thead>
        <tr>
          <th>Tên</th>
          <th>Kiểu File</th>
          <th>Kích thước</th>
          <th>Thao tác</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let item of lstFileUpdate">
          <th>{{item.name}}</th>
          <th>{{item.type}}</th>
          <th>{{(item.size / 1024).toFixed(2)}} KB</th>
          <th>
              <span style="color: #0066B3; margin-right: 10px;"
                    nz-tooltip
                    nzTooltipTitle="tải lên" nzTooltipPlacement="bottom"
                    nz-icon nzType="upload" nzTheme="outline"></span>
            <span style="color: #0066B3"
                  nz-tooltip
                  nzTooltipTitle="Xóa" nzTooltipPlacement="bottom"
                  nz-icon nzType="delete" nzTheme="outline" (click)="removeFile(item)"></span>
          </th>
        </tr>
      </nz-table>
      <h3 style="font-weight: bold">METADATA</h3>
      <nz-row *ngFor="let item of listOfMetadata" style="margin-top:10px">
        <input style="width: 40%; margin-right: 5%;" nzSize="large" nz-input placeholder="Nhập Key"
               [(ngModel)]="item.key">
        <input style="width: 40%; margin-right: 5%" nzSize="large" nz-input placeholder="Nhập Value"
               [(ngModel)]="item.value">
        <button style="border: none;" nz-button (click)="removeMetadata(item.order)" nzSize="large">
          <img style="margin-top: -4px" src="assets/imgs/trash.svg"/>
        </button>
      </nz-row>
      <nz-row style="margin-top: 25px">
        <button nz-button nzType="primary" (click)="addMoreMetadata()" nzSize="large" style="margin-right: 10px">
          <img style="padding-right: 10px;" src="assets/imgs/add-circle.svg" alt=""/>
          <span class="button-text-primary">Tạo metadata</span>
        </button>
        <nz-upload (nzChange)="handleChange($event)" [nzShowUploadList]="false">
          <button nz-button nzType="primary" nzSize="large">
            <img style="padding-right: 10px;" src="assets/imgs/folder.png" alt=""/>
            <span class="button-text-primary">Thêm File</span>
          </button>
        </nz-upload>
      </nz-row>
    </div>
  </ng-container>
</nz-modal>

<!--Xóa-->
<nz-modal [(nzVisible)]="isVisibleDelete" nzTitle="Xóa Ip Public" (nzOnCancel)="handleCancel()"
          (nzOnOk)="deleteFolder()" nzOkText="Đồng ý"
          nzCancelText="Hủy" [nzStyle]="modalStyle">
  <ng-container *nzModalContent>
    <b style="display: flex; justify-content: center;">Quý khách chắc chắn muốn thực hiện xóa Ip Public?</b>
    <br>
    <i style="display: flex; justify-content: center;">Vui lòng cân nhắc kỹ trước khi click nút Đồng ý</i>
  </ng-container>
</nz-modal>

<!--Sao chép-->
<nz-modal [(nzVisible)]="isVisibleCopy" nzTitle="Sao chép" (nzOnCancel)="handleCancel()"
          (nzOnOk)="deleteFolder()" nzOkText="Đồng ý"
          nzCancelText="Hủy" [nzStyle]="modalStyle">
  <ng-container *nzModalContent>
    <one-portal-tree-folder [data]="treeFolder"></one-portal-tree-folder>
  </ng-container>
</nz-modal>


