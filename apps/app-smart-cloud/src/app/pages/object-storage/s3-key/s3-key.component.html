<page-header
  *ngIf="hasOS"
  [breadcrumb]="breadcrumb"
  [title]="'app.s3.key.list' | i18n"
>
  <ng-template #breadcrumb>
    <nz-breadcrumb [nzSeparator]="separatorTemplate">
      <nz-breadcrumb-item
        ><a [routerLink]="['/']">{{
          'app.breadcrumb.home' | i18n
        }}</a></nz-breadcrumb-item
      >
      <nz-breadcrumb-item
        ><a [routerLink]="['/app-smart-cloud/s3-key']"
          >S3 Key</a
        ></nz-breadcrumb-item
      >
    </nz-breadcrumb>
    <ng-template #separatorTemplate
      ><img src="assets/imgs/arrow-square-right.svg" alt="" />
    </ng-template>
  </ng-template>
</page-header>

<nz-card *ngIf="hasOS" class="text-label">

    <div
      class="d-flex justify-content-between"
    >
      <nz-input-group
        style="margin-right: 8px; border-radius: 8px"
        [nzPrefix]="suffixIconSearch"
        nzSize="large"
      >
        <input
        [(ngModel)]="value"
        #searchBox (keyup.enter)="search(searchBox.value)" (ngModelChange)="searchDelay.next(false)"
          name="name"
          nz-input
          [placeholder]="'app.s3.key.search' | i18n"
        />
      </nz-input-group>
      <ng-template #suffixIconSearch>
        <img
          src="assets/imgs/search.svg"
          alt=""
          style="cursor: pointer"
          [nz-tooltip]="'app.button.search' | i18n"
        />
      </ng-template>
      <button nz-button nzType="primary" (click)="createS3Key()" nzSize="large">
        <img
          style="padding-right: 10px"
          src="assets/imgs/add-circle.svg"
          alt=""
        />
        <span class="button-text-primary">{{
          'app.s3.key.create' | i18n
        }}</span>
      </button>
  </div>
  <!-- Bảng-->
  <nz-table
    #rowSelectionTable
    style="margin-top: 24px"
    nzShowPagination
    [nzData]="listOfS3Key"
    [nzPageSize]="response?.pageSize"
    (nzPageSizeChange)="onPageSizeChange($event)"
    [nzPageIndex]="response?.currentPage"
    (nzPageIndexChange)="onPageIndexChange($event)"
    [nzTotal]="response?.totalCount"
    [nzFrontPagination]="false"
    [nzLoading]="isLoading"
  >
    <thead>
      <tr>
        <th>STT</th>
        <th>AccessKey</th>
        <th>SecretKey</th>
        <th>User</th>
        <th>{{ 'app.text.operation' | i18n }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of rowSelectionTable.data; index as i">
        <td>{{ i + 1 }}</td>
        <td>
          {{ item.accessKey }}
          <img
            src="assets/imgs/icon_copy1.svg"
            alt=""
            style="cursor: pointer"
            nz-tooltip="Copy"
            (click)="copyText(item.accessKey)"
          />
        </td>
        <td>
          {{ item.secretKey }}
          <img
            src="assets/imgs/icon_copy1.svg"
            alt=""
            style="cursor: pointer"
            nz-tooltip="Copy"
            (click)="copyText(item.secretKey)"
          />
        </td>
        <td>{{ item.subUser }}</td>
        <td>
          <div>
            <!---Gỡ------>
            <span
              style="color: #0066b3; margin-right: 10px; cursor: pointer"
              [nz-tooltip]="'app.recreate' | i18n"
              nz-icon
              nzType="reload"
              nzTheme="outline"
              (click)="openModelRecreate(item)"
            ></span>
            <!----Xóa---->
            <img
              src="assets/imgs/delete.svg"
              alt=""
              (click)="openModelDelete(item.accessKey)"
              style="cursor: pointer; margin-right: 16px"
              nz-tooltip="{{ 'app.delete' | i18n }}"
            />
          </div>
        </td>
      </tr>
    </tbody>
  </nz-table>
</nz-card>

<div *ngIf="hasOS == undefined || hasOS == null"></div>
<one-portal-object-storage *ngIf="hasOS == false"></one-portal-object-storage>

<!--Tạo mới-->
<nz-modal
  (nzOnCancel)="isVisibleCreate = false"
  [(nzVisible)]="isVisibleCreate"
  [nzTitle]="'app.s3.key.create' | i18n"
>
  <ng-container *nzModalContent>
    <div class="text-label mb-2">
      {{ 'app.s3.key.choose' | i18n }} (<span class="text-red">*</span>)
    </div>
    <nz-select
      nzSize="large"
      [nzLoading]="loadingDropdown"
      [nzDisabled]="disableDropdown"
      style="width: 100%; border-radius: 8px"
      [nzPlaceHolder]="'-- ' + ('app.s3.key.choose' | i18n) + ' --'"
      [(ngModel)]="userCreate.subUserId"
    >
      <nz-option
        *ngFor="let i of listUser"
        [nzLabel]="i.subUserId"
        [nzValue]="i.subUserId"
      />
    </nz-select>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelCreate()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button
      nz-button
      nzType="primary"
      (click)="createSecretKey()"
      [nzLoading]="isLoadingCreateS3key"
    >
      <img
        *ngIf="isLoadingCreateS3key === false"
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />{{ 'app.button.confirm' | i18n }}
    </button>
  </div>
</nz-modal>

<!--Xóa-->
<nz-modal
  [(nzVisible)]="isVisibleDelete"
  nzTitle="Xác nhận xóa S3 Key"
  (nzOnCancel)="isVisibleDelete = false"
>
  <ng-container *nzModalContent>
    <nz-alert
      nzType="warning"
      nzDescription="Bạn đang thực hiện xóa S3 Key."
      nzShowIcon
      style="margin-bottom: 10px"
    ></nz-alert>
    <b>Quý khách có chắc chắn thực hiện xóa S3 Key không?</b>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelDelete()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button
      nz-button
      nzType="primary"
      (click)="deleteSecretKey()"
      [nzLoading]="isLoadingDelete"
    >
      <img
        *ngIf="isLoadingDelete === false"
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />{{ 'app.button.confirm' | i18n }}
    </button>
  </div>
</nz-modal>

<!--Nhân tạo-->
<nz-modal
  [(nzVisible)]="isVisibleReCreate"
  nzTitle="Xác nhận tạo lại SecretKey ?"
  (nzOnCancel)="isVisibleReCreate = false"
>
  <ng-container *nzModalContent>
    <nz-alert
      nzType="warning"
      nzDescription="Bạn đang thực hiện tạo lại SecretKey."
      nzShowIcon
      style="margin-bottom: 10px"
    ></nz-alert>
    <b>Quý khách chắc chắn muốn thực hiện tại lại SecretKey?</b>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelReCreate()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button
      nz-button
      nzType="primary"
      (click)="generateS3Key()"
      [nzLoading]="isLoadingCreateS3key"
    >
      <img
        *ngIf="isLoadingCreateS3key === false"
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />{{ 'app.button.confirm' | i18n }}
    </button>
  </div>
</nz-modal>
