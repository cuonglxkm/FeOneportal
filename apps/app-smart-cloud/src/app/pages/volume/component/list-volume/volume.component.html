<page-header [breadcrumb]="breadcrumb"
             [action]="action"
             [title]="'volume.title' | i18n" xmlns="http://www.w3.org/1999/html">
  <ng-template #breadcrumb>
    <nz-breadcrumb [nzSeparator]="iconTemplate">
      <nz-breadcrumb-item [routerLink]="'/'">{{ 'app.breadcrumb.home' | i18n }}</nz-breadcrumb-item>
      <nz-breadcrumb-item>
        {{ 'app.breadcrumb.infrastructure.service' | i18n }}
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        {{ 'app.breadcrumb.block.storage' | i18n }}
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a routerLink="/app-smart-cloud/volumes">{{ 'volume.title' | i18n }}</a>
      </nz-breadcrumb-item>
    </nz-breadcrumb>
    <ng-template #iconTemplate>
      <one-portal-svg-icon [icon]="'icon_breadcrumb'"></one-portal-svg-icon>
    </ng-template>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <share-users-combobox></share-users-combobox>
      <region-select-dropdown (valueChanged)="regionChanged($event)"></region-select-dropdown>
      <project-select-dropdown (valueChanged)="projectChanged($event)"
                               (userChanged)="projectChanged($event)"
                               [regionId]="region"></project-select-dropdown>
    </div>
  </ng-template>
</page-header>
<nz-content *ngIf="typeVPC == 0">
  <nz-card>
    <ng-container [ngSwitch]="isBegin">
      <ng-container *ngSwitchCase="false">
        <nz-row nzJustify="space-between">
          <nz-col nzSpan="16">
            <nz-select [(ngModel)]="selectedValue"
                       nzSize="large"
                       style="margin-right: 10px; width: 200px;"
                       (ngModelChange)="onChange($event)"
                       nzPlaceHolder="{{ 'volume.placeholder.filter.status' | i18n }}"
                       nzTooltipTitle="{{ 'volume.tooltip.title.filter.status' | i18n }}"
                       nzTooltipPlacement="bottom"
                       nz-tooltip>
              <nz-option *ngFor="let item of options" [nzValue]="item.value" [nzLabel]="item.label"></nz-option>
            </nz-select>
            <nz-input-group
              style="width: 300px;"
              [nzPrefix]="prefixIconSearch"
              nzSize="large">
              <input name="name"
                     nz-input
                     placeholder="{{ 'volume.placeholder.filter.name' | i18n }}"
                     [(ngModel)]="value"
                     (input)="changeInputChange($event)"
                     (keydown.enter)="onEnter($event)" />
            </nz-input-group>
            <ng-template #prefixIconSearch>
              <img src="assets/imgs/search.svg" alt="" />
            </ng-template>
          </nz-col>
          <nz-col nzSpan="8" style="flex:none;">
            <button
              nz-button
              nzType="primary"
              nzSize="large"
              (click)="navigateToCreateVolume()">
              <img
                style="padding-right: 10px; margin-top: -4px"
                src="assets/imgs/add-circle.svg"
                alt="" />
              <span class="button-text-primary">{{ 'volume.button.create' | i18n }}</span>
            </button>
          </nz-col>
        </nz-row>
        <nz-table #fixedTable
                  style="margin-top: 20px;"
                  nzShowSizeChanger
                  [nzData]="response?.records || []"
                  [nzPageSize]="response?.pageSize"
                  (nzPageSizeChange)="onPageSizeChange($event)"
                  [nzPageIndex]="response?.currentPage"
                  (nzPageIndexChange)="onPageIndexChange($event)"
                  [nzTotal]="response?.totalCount"
                  [nzFrontPagination]="false"
                  [nzLoading]="isLoading">
          <thead>
          <tr>
            <th nzLeft>{{ 'volume.table.title.name.volume' | i18n }}</th>
            <th nzBreakWord>{{ 'volume.table.title.type.volume' | i18n }}</th>
            <th nzBreakWord>{{ 'volume.table.title.storage' | i18n }} (GB)</th>
            <th nzBreakWord>{{ 'volume.table.title.iops' | i18n }}</th>
            <th nzBreakWord>{{ 'volume.table.title.status.volume' | i18n }}</th>
            <th nzBreakWord>{{ 'volume.table.title.task.status' | i18n }}</th>
            <th nzBreakWord>{{ 'volume.table.title.Ã­nstance' | i18n }}</th>
            <th nzBreakWord>{{ 'volume.table.title.action' | i18n }}</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let data of fixedTable.data">
            <td nzLeft><a [routerLink]="'/app-smart-cloud/volume/detail/' + data.id">{{ data.name }}</a></td>
            <td nzBreakWord>
              <span *ngIf="data.volumeType == 'hdd'">HDD</span>
              <span *ngIf="data.volumeType == 'ssd'">SSD</span>
            </td>
            <td nzBreakWord nzAlign="right">{{ data.sizeInGB }}</td>
            <td nzBreakWord nzAlign="right">
              <div *ngIf="data.iops == null">200</div>
              <div *ngIf="data.iops != null">{{ data.iops }}</div>
            </td>
            <ng-container *ngIf="data.status | ServiceStatusPipe as statusModel">
              <td nzBreakWord nzAlign="left" [ngStyle]="{color: statusModel.color}">{{ statusModel.status }}</td>
            </ng-container>
            <td nzBreakWord nzAlign="left">{{ data.serviceStatus }}</td>
            <td nzBreakWord nzAlign="left">
              <div *ngIf="data.attachedInstances == null || data.attachedInstances.length <= 0">-</div>
              <div *ngIf="data.attachedInstances != null || data.attachedInstances.length > 0">
                <div *ngFor="let index of data.attachedInstances; let last = last">{{ index.instanceName }}<br
                  *ngIf="!last"></div>
              </div>
            </td>
            <td nzBreakWord>
              <div
                *ngIf="!(data.serviceStatus == 'CREATING' || data.serviceStatus == 'ERROR' || data.serviceStatus == 'ATTACHING' || data.serviceStatus == 'DELETING' || data.serviceStatus == 'ERROR_DELETING' || data.serviceStatus == 'RESIZING')">
                <one-portal-attach-volume [region]="region"
                                          [project]="project"
                                          [volumeId]="data.id"
                                          [multiple]="data.isMultiAttach"
                                          [instanceInVolume]="data.attachedInstances"
                                          (onOk)="handleOkAttachVm()" />
                <one-portal-detach-volume [region]="region"
                                          [project]="project"
                                          [volumeId]="data.id"
                                          [isMultiple]="data.isMultiAttach"
                                          [instanceInVolume]="data.attachedInstances"
                                          (onOk)="handleOkDetachVm()" />
                <img style="padding-right: 10px; margin-left: 10px; cursor: pointer;"
                     src="assets/imgs/calendar-tick.svg" alt=""
                     nz-popover
                     [nzPopoverContent]="'volume.tooltip.content.create.backup' | i18n"
                     nzPopoverPlacement="bottom"
                     (click)="navigateToCreateBackup(data.id)" />
                <one-portal-delete-volume [region]="region"
                                          [project]="project"
                                          [volumeId]="data.id"
                                          [volumeName]="data.name"
                                          (onOk)="handleOkDelete()" />
                <img nz-dropdown
                     [nzDropdownMenu]="opMenu"
                     src="assets/imgs/more1.svg" alt="" style="cursor: pointer; margin-left: 5px;" />
                <nz-dropdown-menu #opMenu="nzDropdownMenu">
                  <ul nz-menu>
                    <li nz-menu-item
                        (click)="navigateToCreateScheduleBackup(data.id)">{{ 'volume.menu.create.schedule.backup' | i18n }}
                    </li>
                    <li nz-menu-item
                        (click)="navigateToCreateScheduleSnapshot()">{{ 'volume.menu.create.schedule.snapshot' | i18n }}
                    </li>
                    <one-portal-update-volume [region]="region" [project]="project" [volume]="data"
                                              (onOk)="handleOkUpdate()" />
                  </ul>
                </nz-dropdown-menu>
              </div>
              <div *ngIf="data.serviceStatus == 'ERROR'">
                <one-portal-delete-volume [region]="region"
                                          [project]="project"
                                          [volumeId]="data.id"
                                          [volumeName]="data.name"
                                          (onOk)="handleOkDelete()" />
              </div>
            </td>
          </tr>
          </tbody>
        </nz-table>
      </ng-container>
      <ng-container *ngSwitchDefault>
        <result>
          <nz-row>
            <nz-col class="text-center" style="width: 100%">
              <img src="/assets/imgs/volume.png" alt="" />
            </nz-col>
          </nz-row>
          <nz-row style="margin-top: 20px">
            <nz-col class="text-center" style="width: 100%">
              <span class="text-intro-title" style="color: #0066b3">{{ 'volume.intro.title' | i18n }}
                <br>{{ 'volume.intro.title2' | i18n }}</span>
            </nz-col>
          </nz-row>
          <nz-row style="margin-top: 20px">
            <nz-col class="text-center" style="width: 100%">
              <span class="text-intro-desc">{{ 'volume.intro.subtitle' | i18n }}</span>
            </nz-col>
          </nz-row>
          <button style="margin-top: 20px" nz-button [nzType]="'primary'" (click)="navigateToCreate()" nzSize="large">
            <img style="padding-right: 10px; margin-top: -4px" src="assets/imgs/cloud-plus-bold.svg" alt="" />
            {{ 'volume.button.create' | i18n }}
          </button>
        </result>
      </ng-container>
    </ng-container>
  </nz-card>
</nz-content>
<nz-content *ngIf="typeVPC == 1">
  <nz-card>
    <ng-container [ngSwitch]="isBegin">
      <ng-container *ngSwitchCase="false">
        <nz-row nzJustify="space-between">
          <nz-col nzSpan="16">
            <nz-select [(ngModel)]="selectedValue"
                       nzSize="large"
                       style="margin-right: 15px; width: 200px;"
                       (ngModelChange)="onChange($event)"
                       nzPlaceHolder="{{'volume.placeholder.filter.status' | i18n}}"
                       nzTooltipTitle="{{'volume.tooltip.title.filter.status' | i18n}}"
                       nzTooltipPlacement="bottom"
                       nz-tooltip>
              <nz-option *ngFor="let item of options" [nzValue]="item.value" [nzLabel]="item.label"></nz-option>
            </nz-select>
            <nz-input-group
              style="width: 300px;"
              [nzPrefix]="prefixIconSearch"
              nzSize="large">
              <input
                name="name"
                nz-input
                placeholder="{{'volume.placeholder.filter.name' | i18n}}"
                [(ngModel)]="value"
                (input)="changeInputChange($event)"
                (keydown.enter)="onEnter($event)" />
            </nz-input-group>
            <ng-template #prefixIconSearch>
              <img
                src="assets/imgs/search.svg"
                alt=""
                style="cursor: pointer"
                nz-tooltip="{{'volume.tooltip.title.filter.img' | i18n}}" />
            </ng-template>
          </nz-col>
          <nz-col nzSpan="8" style="flex:none;">
            <button
              nz-button
              nzType="primary"
              nzSize="large"
              (click)="navigateToCreateVolumeVPC()">
              <img
                style="padding-right: 10px; margin-top: -4px"
                src="assets/imgs/add-circle.svg"
                alt="" />
              <span class="button-text-primary">{{ 'volume.button.create' | i18n }}</span>
            </button>
          </nz-col>
        </nz-row>
        <nz-table #fixedTable2
                  style="margin-top: 20px;"
                  nzShowSizeChanger
                  [nzData]="response?.records"
                  [nzPageSize]="response?.pageSize"
                  (nzPageSizeChange)="onPageSizeChange($event)"
                  [nzPageIndex]="response?.currentPage"
                  (nzPageIndexChange)="onPageIndexChange($event)"
                  [nzTotal]="response?.totalCount"
                  [nzFrontPagination]="false"
                  [nzLoading]="isLoading">
          <thead>
          <tr>
            <th nzLeft>{{ 'volume.table.title.name.volume' | i18n }}</th>
            <th nzBreakWord>{{ 'volume.table.title.type.volume' | i18n }}</th>
            <th nzBreakWord>{{ 'volume.table.title.storage' | i18n }} (GB)</th>
            <th nzBreakWord>{{ 'volume.table.title.iops' | i18n }}</th>
            <th nzBreakWord>{{ 'volume.table.title.status.volume' | i18n }}</th>
            <th nzBreakWord>{{ 'volume.table.title.task.status' | i18n }}</th>
            <th nzBreakWord>{{ 'volume.table.title.instance' | i18n }}</th>
            <th nzBreakWord>{{ 'volume.table.title.action' | i18n }}</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let i of fixedTable2.data">
            <td nzLeft><a [routerLink]="'/app-smart-cloud/volume/detail/' + i.id">{{ i.name }}</a></td>
            <td nzBreakWord>
              <span *ngIf="i.volumeType == 'hdd'">HDD</span>
              <span *ngIf="i.volumeType == 'ssd'">SSD</span>
            </td>
            <td nzBreakWord nzAlign="right">{{ i.sizeInGB }}</td>
            <td nzBreakWord nzAlign="right">
              <div *ngIf="i.iops == null">300</div>
              <div *ngIf="i.iops != null">{{ i.iops }}</div>
            </td>
            <td nzBreakWord>
              <div class="status" [ngSwitch]="i.status">
                                <span class="available" *ngSwitchCase="'KHOITAO'">
                                            {{ 'app.status.running' | i18n }}
                                          </span>
                <span class="available" *ngSwitchCase="'CREATING'">
                                            {{ 'app.status.init' | i18n }}
                                          </span>
                <span class="suspended" *ngSwitchCase="'SUSPENDED'">
                                            {{ 'app.status.suspend' | i18n }}
                                          </span>
                <span class="error" *ngSwitchCase="'ERROR'">
                                            {{ 'app.status.error' | i18n }}
                                          </span>
                <span class="error" *ngSwitchCase="'ERROR_DELETING'">
                                            {{ 'app.status.error' | i18n }}
                                          </span>
                <span class="suspended" *ngSwitchCase="'DELETING'">
                                            {{ 'app.status.deleting' | i18n }}
                                          </span>
              </div>
            </td>
            <td nzBreakWord>{{ i.serviceStatus }}</td>
            <td nzBreakWord>
              <div *ngIf="i.attachedInstances.length <= 0">-</div>
              <div *ngIf="i.attachedInstances.length > 0">
                <div *ngFor="let index of i.attachedInstances; let last = last">{{ index.instanceName }}<br *ngIf="!last"></div>
              </div>
            </td>
            <td>
              <div
                *ngIf="!(i.serviceStatus == 'CREATING' || i.serviceStatus == 'ERROR' || i.serviceStatus == 'ATTACHING' || i.serviceStatus == 'DELETING' || i.serviceStatus == 'ERROR_DELETING' || data.serviceStatus == 'RESIZING')">
                <one-portal-attach-volume [region]="region"
                                          [project]="project"
                                          [volumeId]="i.id"
                                          [multiple]="i.isMultiAttach"
                                          [instanceInVolume]="i.attachedInstances"
                                          (onOk)="handleOkAttachVm()" />
                <one-portal-detach-volume [region]="region"
                                          [project]="project"
                                          [volumeId]="i.id"
                                          [isMultiple]="i.isMultiAttach"
                                          [instanceInVolume]="i.attachedInstances"
                                          (onOk)="handleOkDetachVm()" />
                <img style="padding-right: 10px; margin-left: 3px; cursor: pointer;"
                     src="assets/imgs/calendar-tick.svg" alt=""
                     nz-popover
                     [nzPopoverContent]="'volume.tooltip.content.create.backup' | i18n"
                     nzPopoverPlacement="bottom"
                     (click)="navigateToCreateBackup(i.id)" />
                <one-portal-delete-volume [region]="region"
                                          [project]="project"
                                          [volumeId]="i.id"
                                          [volumeName]="i.name"
                                          (onOk)="handleOkDelete()" />
                <img nz-dropdown
                     [nzDropdownMenu]="opMenu"
                     src="assets/imgs/more1.svg" alt="" style="cursor: pointer; margin-left: 5px;" />
                <nz-dropdown-menu #opMenu="nzDropdownMenu">
                  <ul nz-menu>
                    <li nz-menu-item
                        (click)="navigateToCreateScheduleBackup(i.id)">{{ 'volume.menu.create.schedule.backup' | i18n }}
                    </li>
                    <li nz-menu-item
                        (click)="navigateToCreateScheduleSnapshot()">{{ 'volume.menu.create.schedule.snapshot' | i18n }}
                    </li>
                    <one-portal-update-volume [region]="region" [project]="project" [volume]="i"
                                              (onOk)="handleOkUpdate()" />
                  </ul>
                </nz-dropdown-menu>
              </div>
              <div *ngIf="i.serviceStatus == 'ERROR'">
                <one-portal-delete-volume [region]="region"
                                          [project]="project"
                                          [volumeId]="i.id"
                                          [volumeName]="i.name"
                                          (onOk)="handleOkDelete()" />
              </div>
            </td>
          </tr>
          </tbody>
        </nz-table>
      </ng-container>
      <ng-container *ngSwitchDefault>
        <result>
          <nz-row>
            <nz-col class="text-center" style="width: 100%">
              <img src="/assets/imgs/volume.png" alt="" />
            </nz-col>
          </nz-row>
          <nz-row style="margin-top: 20px">
            <nz-col class="text-center" style="width: 100%">
                <span class="text-intro-title" style="color: #0066b3">{{ 'volume.intro.title' | i18n }}
                  <br>{{ 'volume.intro.title2' | i18n }}</span>
            </nz-col>
          </nz-row>
          <nz-row style="margin-top: 20px">
            <nz-col class="text-center" style="width: 100%">
              <span class="text-intro-desc">{{ 'volume.intro.subtitle' | i18n }}</span>
            </nz-col>
          </nz-row>
          <button style="margin-top: 20px" nz-button [nzType]="'primary'" (click)="navigateToCreateVolumeVPC()"
                  nzSize="large">
            <img style="padding-right: 10px; margin-top: -4px" src="assets/imgs/cloud-plus-bold.svg" alt="" />
            {{ 'volume.button.create' | i18n }}
          </button>
        </result>
      </ng-container>
    </ng-container>
  </nz-card>
</nz-content>

