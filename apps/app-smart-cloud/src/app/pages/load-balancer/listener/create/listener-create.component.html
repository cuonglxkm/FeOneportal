<page-header [breadcrumb]="breadcrumb" [title]="'Tạo mới Listener'" [action]="action">
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">Trang chủ</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/app-smart-cloud/load-balancer/list']">Load Balancer</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="[]">Tạo mới Listener</a>
      </nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <region-select-dropdown (valueChanged)="onRegionChange($event)" isDetail="true"></region-select-dropdown>
      <project-select-dropdown [regionId]="regionId" (userChanged)="projectChange($event)" isDetail="true"></project-select-dropdown>
    </div>
  </ng-template>
</page-header>
<nz-card>
  <nz-steps [nzCurrent]="step" style="width: 60%; margin: 0 auto;">
    <nz-step nzTitle="Listener" [nzIcon]="step1"></nz-step>
    <nz-step nzTitle="Pool" [nzIcon]="step2"></nz-step>
    <nz-step nzTitle="Pool Member" [nzIcon]="step3"></nz-step>
    <nz-step nzTitle="Kết thúc" [nzIcon]="step4"></nz-step>
  </nz-steps>
  <ng-template #step1>
    <img src="assets/imgs/listener-done.svg" />
  </ng-template>
  <ng-template #step2>
    <img *ngIf="step >= 1" src="assets/imgs/pool-done.svg" />
    <img *ngIf="step < 1" src="assets/imgs/pool.svg" />
  </ng-template>
  <ng-template #step3>
    <img *ngIf="step >= 2" src="assets/imgs/pool member-done.svg" />
    <img *ngIf="step < 2" src="assets/imgs/pool member.svg" />
  </ng-template>
  <ng-template #step4>
    <img *ngIf="step >= 3" src="assets/imgs/final-done.svg" />
    <img *ngIf="step < 3" src="assets/imgs/final.svg" />
  </ng-template>
</nz-card>
<nz-content>
  <form nz-form [formGroup]="validateForm" nzLayout="vertical">
    <!--CARD LISTENER-->
    <nz-card *ngIf="step == 0">
      <div class="text-card-header" style="margin-bottom: 15px;">Thông tin Listener</div>
      <nz-form-item>
        <nz-form-label>
          <span>Tên Load Balancer (<span style="color: red;">*</span>) </span>
        </nz-form-label>
        <nz-form-control nzDisableAutoTips [nzErrorTip]="nameErrorTpl">
          <input nz-input
                 class="input-custom"
                 formControlName="listenerName"
                 [placeholder]="'Nhập tên Load Balancer'" [maxLength]="50" />
          <ng-template #nameErrorTpl let-control>
            <ng-container *ngIf="control.hasError('required')">Vui lòng nhập tên Load Balancer</ng-container>
            <ng-container *ngIf="control.hasError('pattern')">không được chứa dấu cách, dấu tiếng việt và ký tự đặc
              biệt (trừ _)
            </ng-container>
            <ng-container *ngIf="control.hasError('maxLength')">Tối đa 50 ký tự</ng-container>
            <ng-container *ngIf="control.hasError('duplicateName')">Tên Volume đã tồn tại, vui lòng nhập tên Load
              Balancer khác
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>

      <nz-row>
        <nz-col nzSpan="16">
          <nz-form-item>
            <nz-form-label>
              <span>Giao thức (<span style="color: red;">*</span>) </span>
            </nz-form-label>
            <nz-form-control nzDisableAutoTips>
              <nz-radio-group [(ngModel)]="protocolListener" [ngModelOptions]="{standalone: true}" nzSize="large">
                <label nz-radio nzValue="HTTP">HTTP</label>
                <label nz-radio nzValue="TCP">TCP</label>
                <label nz-radio nzValue="TERMINATED_HTTPS">TERMINATED_HTTPS</label>
              </nz-radio-group>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
        <nz-col nzSpan="8">
          <nz-form-item>
            <nz-form-label>
              <span>Port (<span style="color: red;">*</span>) </span>
            </nz-form-label>
            <nz-form-control nzDisableAutoTips>
              <nz-input-number formControlName="port" [nzMin]="0" [nzStep]="1" nzSize="large"
                               style="margin-left: -2px;"></nz-input-number>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
      </nz-row>

      <nz-row>
        <nz-col nzSpan="6">
          <nz-form-item>
            <nz-form-label>
              <span>Client timeout (ms)</span>
            </nz-form-label>
            <nz-form-control nzDisableAutoTips>
              <nz-input-number style="margin-left: -2px;width: 90%" formControlName="timeout" [nzMin]="0" nzSize="large"
                               [nzStep]="1"></nz-input-number>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
        <nz-col nzSpan="6">
          <nz-form-item>
            <nz-form-label>
              <span>Member</span>
            </nz-form-label>
            <nz-form-control nzDisableAutoTips>
              <nz-input-number style="margin-left: -2px;width: 90%" formControlName="member" [nzMin]="0" nzSize="large"
                               [nzStep]="1"></nz-input-number>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
        <nz-col nzSpan="6">
          <nz-form-item>
            <nz-form-label>
              <span>Connection</span>
            </nz-form-label>
            <nz-form-control nzDisableAutoTips>
              <nz-input-number style="margin-left: -2px;width: 90%" formControlName="connection" [nzMin]="0" nzSize="large"
                               [nzStep]="1"></nz-input-number>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
        <nz-col nzSpan="6">
          <nz-form-item>
            <nz-form-label>
              <span>Allowed CIDRs (<span style="color: red;">*</span>) </span>
            </nz-form-label>
            <nz-form-control nzDisableAutoTips>
              <input nz-input
                     class="input-custom"
                     formControlName="allowCIRR"
                     [placeholder]="" [maxLength]="50" />
              <!--              <nz-input-number style="margin-left: -2px;width: 90%" formControlName="" [nzMin]="0"-->
              <!--                               [nzStep]="1"></nz-input-number>-->
            </nz-form-control>
          </nz-form-item>
        </nz-col>
      </nz-row>


      <nz-form-item>
        <nz-form-label>
          <span>Mô tả</span>
        </nz-form-label>
        <nz-form-control nzDisableAutoTips>
          <textarea maxlength="255" nz-input [nzAutosize]="{ minRows: 3 }" placeholder="Nhập mô tả" style="width: 100%"
                    formControlName="description"></textarea>
        </nz-form-control>
      </nz-form-item>

      <div class="text-right"
           style="display: flex;align-items: center;justify-content: flex-end;height: 100%;margin-top: 80px;">
        <button (click)="priviousStep()" nzSize="large" nz-button nzType="primary"
                style="border-color: #0066B3;background-color: white;"><span style="color:#0066B3">Quay lại</span>
        </button>
        <button [disabled]="checkDisable() == true" nzSize="large" (click)="nextStep()" nz-button nzType="primary"
                style="border: none;margin-left: 30px;">Tiếp tục
        </button>
      </div>
    </nz-card>

    <!--CARD POOL-->
    <div *ngIf="step == 1">
      <nz-card>
        <div class="text-card-header" style="margin-bottom: 15px;">Thông tin Pool</div>
        <nz-form-item>
          <nz-form-label>
            <span>Tên pool (<span style="color: red;">*</span>) </span>
          </nz-form-label>
          <nz-form-control nzDisableAutoTips>
            <input nz-input
                   class="input-custom"
                   formControlName="poolName"
                   [placeholder]="'Nhập tên pool chỉ gồm ký tự chữ cái và số, không bao gồm dấu cách'"
                   [maxLength]="50" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label>
            <span>Thuật toán (<span style="color: red;">*</span>) </span>
          </nz-form-label>
          <nz-form-control nzDisableAutoTips>
            <nz-select [(ngModel)]="selectedAlgorithm" nzSize="large" style="width: 100%"
                       [ngModelOptions]="{standalone: true}">
              <nz-option *ngFor="let p of listAlgorithm" [nzValue]="p.value" [nzLabel]="p.name"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        <nz-row>
          <nz-col nzSpan="10">
            <span class="text-label">Sticky Session (<span style="color: red;">*</span>) </span>
            <label nz-checkbox [(ngModel)]="checkedSession" [ngModelOptions]="{standalone: true}"></label>
          </nz-col>
          <nz-col nzSpan="14">
            <span class="text-label">Phương pháp đánh dấu session</span>
            <input nz-input style="width: 30%" disabled="true"
                   [ngModel]="sessionFix" [ngModelOptions]="{standalone: true}" />
          </nz-col>
        </nz-row>

      </nz-card>
      <nz-card>
        <div class="text-card-header" style="margin-bottom: 15px;">Thông tin Health Monitor</div>
        <nz-form-item>
          <nz-form-label>
            <span>Tên Health Monitor (<span style="color: red;">*</span>) </span>
          </nz-form-label>
          <nz-form-control nzDisableAutoTips>
            <input nz-input
                   class="input-custom"
                   formControlName="healthName"
                   [placeholder]="'Nhập tên Health Monitor chỉ gồm ký tự chữ cái và số, không bao gồm dấu cách'"
                   [maxLength]="50" />
          </nz-form-control>
        </nz-form-item>

        <nz-row>
          <nz-col nzSpan="12">
            <nz-form-item>
              <nz-form-label>
                <span>Phương pháp kiểm tra (<span style="color: red;">*</span>) </span>
              </nz-form-label>
              <nz-form-control nzDisableAutoTips>
                <nz-select [(ngModel)]="selectedCheckMethod" nzSize="large" style="width: 90%"
                           [ngModelOptions]="{standalone: true}">
                  <nz-option *ngFor="let p of listCheckMethod" [nzValue]="p.value" [nzLabel]="p.name"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
          <nz-col nzSpan="12">
            <nz-form-item>
              <nz-form-label>
                <span>HTTP Method (<span style="color: red;">*</span>) </span>
              </nz-form-label>
              <nz-form-control nzDisableAutoTips>
                <nz-select [(ngModel)]="selectedHttpMethod" nzSize="large" style="width: 90%"
                           [ngModelOptions]="{standalone: true}">
                  <nz-option *ngFor="let p of listHttpMethod" [nzValue]="p.value" [nzLabel]="p.name"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <nz-row>
          <nz-col nzSpan="12">
            <nz-form-item>
              <nz-form-label>
                <span>Max Retries</span>
              </nz-form-label>
              <nz-form-control nzDisableAutoTips>
                <nz-input-number style="margin-left: -2px;width: 90%" formControlName="maxRetries" [nzMin]="0" nzSize="large"
                                 [nzStep]="1"></nz-input-number>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
          <nz-col nzSpan="12">
            <nz-form-item>
              <nz-form-label>
                <span>Max Retries Down</span>
              </nz-form-label>
              <nz-form-control nzDisableAutoTips>
                <nz-input-number style="margin-left: -2px;width: 90%" formControlName="maxRetriesDown" [nzMin]="0" nzSize="large"
                                 [nzStep]="1"></nz-input-number>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <nz-row>
          <nz-col nzSpan="12">
            <nz-form-item>
              <nz-form-label>
                <span>Delay</span>
              </nz-form-label>
              <nz-form-control nzDisableAutoTips>
                <nz-input-number style="margin-left: -2px;width: 90%" formControlName="delay" [nzMin]="0" nzSize="large"
                                 [nzStep]="1"></nz-input-number>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
          <nz-col nzSpan="12">
            <nz-form-item>
              <nz-form-label>
                <span>Timeout</span>
              </nz-form-label>
              <nz-form-control nzDisableAutoTips>
                <nz-input-number style="margin-left: -2px;width: 90%" formControlName="timeoutHealth" [nzMin]="0" nzSize="large"
                                 [nzStep]="1"></nz-input-number>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <nz-form-item>
          <nz-form-label>
            <span>Path (<span style="color: red;">*</span>) </span>
          </nz-form-label>
          <nz-form-control nzDisableAutoTips>
            <input nz-input
                   class="input-custom"
                   formControlName="path"
                   [placeholder]="'Nhập path'" [maxLength]="50" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label>
            <span>Success code (<span style="color: red;">*</span>) </span>
          </nz-form-label>
          <nz-form-control nzDisableAutoTips>
            <input nz-input
                   class="input-custom"
                   formControlName="sucessCode"
                   [placeholder]="'Nhập sucessCode'" [maxLength]="50" />
          </nz-form-control>
        </nz-form-item>
        <div class="text-right"
             style="display: flex;align-items: center;justify-content: flex-end;height: 100%;margin-top: 80px;">
          <button (click)="priviousStep()" nzSize="large" nz-button nzType="primary"
                  style="border-color: #0066B3;background-color: white;"><span style="color:#0066B3">Quay lại</span>
          </button>
          <button [disabled]="checkDisable() == true" nzSize="large" (click)="nextStep()" nz-button nzType="primary"
                  style="border: none;margin-left: 30px;">Tiếp tục
          </button>
        </div>
      </nz-card>
    </div>

    <!--CARD POOL NUMBER-->
    <nz-card *ngIf="step == 2">
      <div class="text-label" style="font-weight: bold;margin-bottom: 10px;">Máy ảo được chọn làm Member</div>
      <nz-table [nzData]="lstInstanceUse" [nzShowPagination]="false">
        <thead>
        <tr>
          <th>Tên VM</th>
          <th>IP Adress</th>
          <th>Port</th>
          <th>Weight</th>
          <th>Backup</th>
          <th>Hoạt động</th>
          <th  width="10%">Thao tác</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let item of lstInstanceUse">
          <td>{{ item.name }}</td>
          <td>{{ item.ipPrivate }}</td>
          <td>
            <nz-input-number [ngModel]="item.port" [nzMin]="0" [nzStep]="1" nzSize="large"
                             style="margin-left: -2px;" [ngModelOptions]="{standalone: true}"></nz-input-number>
          </td>
          <td>
            <nz-input-number [ngModel]="item.weight" [nzMin]="0" [nzStep]="1" nzSize="large"
                             style="margin-left: -2px;" [ngModelOptions]="{standalone: true}"></nz-input-number>
          </td>
          <td>
            <label nz-checkbox [(ngModel)]="item.backup" [ngModelOptions]="{standalone: true}"></label>
          </td>
          <td>{{ item.status == 'KHOITAO' && item.taskState == 'ACTIVE' ? 'Online' : 'Offline'}}</td>
          <td>
            <span style="color: #0066B3"
                  nz-tooltip
                  nzTooltipTitle="Xóa" nzTooltipPlacement="bottom"
                  nz-icon nzType="delete" nzTheme="outline"
                  (click)="removeInstance(item.id,0)"></span>
          </td>
        </tr>
        </tbody>
      </nz-table>
      <div class="text-label" style="margin-top: 30px;font-weight: bold;margin-bottom: 10px;">Máy ảo để lựa chọn</div>
      <nz-table [nzData]="lstInstance" [nzShowPagination]="false">
        <thead>
        <tr>
          <th>Tên VM</th>
          <th>IP Adress</th>
          <th width="10%">Thao tác</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let item of lstInstance">
          <td>{{ item.name }}</td>
          <td>{{ item.ipPrivate }}</td>
          <td>
            <span style="color: #0066B3"
                  nz-tooltip
                  nzTooltipTitle="Thêm" nzTooltipPlacement="bottom"
                  nz-icon nzType="plus" nzTheme="outline"
                  (click)="removeInstance(item.id,1)"></span>
          </td>
        </tr>
        </tbody>
      </nz-table>
      <div class="text-right"
           style="display: flex;align-items: center;justify-content: flex-end;height: 100%;margin-top: 80px;">
        <button (click)="priviousStep()" nzSize="large" nz-button nzType="primary"
                style="border-color: #0066B3;background-color: white;"><span style="color:#0066B3">Quay lại</span>
        </button>
        <button [disabled]="checkDisable() == true" nzSize="large" (click)="nextStep()" nz-button nzType="primary"
                style="border: none;margin-left: 30px;">Tiếp tục
        </button>
      </div>
    </nz-card>

    <!--CARD COMPLETE-->
    <div *ngIf="step == 3">
      <nz-row nzGutter="24" class="card-container">
        <nz-col nzSpan="8">
          <nz-card style="height: 200px;">
            <div class="text-card-header" style="margin-bottom: 15px;">Thông tin Listener</div>
            <nz-row>
              <nz-col nzSpan="9" class="text-label">aaa</nz-col>
              <nz-col nzSpan="15" class="text-label">aaa</nz-col>
            </nz-row>
            <nz-row>
              <nz-col nzSpan="9" class="text-label">aaa</nz-col>
              <nz-col nzSpan="15" class="text-label">aaa</nz-col>
            </nz-row>
          </nz-card>
        </nz-col>
        <nz-col nzSpan="8">
          <nz-card style="height: 200px;">
            <div class="text-card-header" style="margin-bottom: 15px;">Thông tin Health Monitor</div>
            <nz-row>
              <nz-col nzSpan="9" class="text-label">aaa</nz-col>
              <nz-col nzSpan="15" class="text-label">aaa</nz-col>
            </nz-row>
            <nz-row>
              <nz-col nzSpan="9" class="text-label">aaa</nz-col>
              <nz-col nzSpan="15" class="text-label">aaa</nz-col>
            </nz-row>
            <nz-row>
              <nz-col nzSpan="9" class="text-label">aaa</nz-col>
              <nz-col nzSpan="15" class="text-label">aaa</nz-col>
            </nz-row>
            <nz-row>
              <nz-col nzSpan="9" class="text-label">aaa</nz-col>
              <nz-col nzSpan="15" class="text-label">aaa</nz-col>
            </nz-row>
          </nz-card>
        </nz-col>
        <nz-col nzSpan="8">
          <nz-card style="height: 200px;">
            <div class="text-card-header" style="margin-bottom: 15px;">Thông tin Pool</div>
            <nz-row>
              <nz-col nzSpan="9" class="text-label">aaa</nz-col>
              <nz-col nzSpan="15" class="text-label">aaa</nz-col>
            </nz-row>
            <nz-row>
              <nz-col nzSpan="9" class="text-label">aaa</nz-col>
              <nz-col nzSpan="15" class="text-label">aaa</nz-col>
            </nz-row>
          </nz-card>
        </nz-col>
      </nz-row>
      <nz-card>
        <div class="text-card-header" style="margin-bottom: 15px;">Thông tin Pool Member</div>
        <div class="text-right"
             style="display: flex;align-items: center;justify-content: flex-end;height: 100%;margin-top: 80px;">
          <button (click)="priviousStep()" nzSize="large" nz-button nzType="primary"
                  style="border-color: #0066B3;background-color: white;"><span style="color:#0066B3">Quay lại</span>
          </button>
          <button [disabled]="checkDisable() == true" nzSize="large" (click)="createListener()" nz-button
                  nzType="primary" style="border: none;margin-left: 30px;">Hoàn tất
          </button>
        </div>
      </nz-card>
    </div>
  </form>
</nz-content>

