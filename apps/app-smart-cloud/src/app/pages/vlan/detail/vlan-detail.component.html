<page-header [breadcrumb]="breadcrumb"
             [action]="action"
             [title]="'Xem chi tiết Network'" xmlns="http://www.w3.org/1999/html">
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item>Trang chủ</nz-breadcrumb-item>
      <nz-breadcrumb-item>
        VLAN
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a routerLink="/app-smart-cloud/vlan/network/list">Danh sách Network</a>
      </nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <region-select-dropdown (valueChanged)="regionChanged($event)"></region-select-dropdown>
      <project-select-dropdown (valueChanged)="projectChanged($event)"
                               (userChanged)="userChanged($event)"
                               [regionId]="region"></project-select-dropdown>
    </div>
  </ng-template>
</page-header>
<nz-content>
  <nz-card>
    <nz-tabset>
      <nz-tab nzTitle="Subnet">
        <nz-row nzJustify="space-between" style="margin-bottom: 15px;" *ngIf="!networkName?.includes('pri_network')">
          <nz-col nzSpan="16">
            <nz-input-group [nzPrefix]="prefixIconSearch"
                            nzSize="large"
                            style="width: 300px;">
              <input name="name"
                     nz-input placeholder="Tìm kiếm"
                     [(ngModel)]="valueSubnet"
                     (input)="onInputChangeSubnet($event.target['value'])" />
            </nz-input-group>
            <ng-template #prefixIconSearch>
              <img src="assets/imgs/search.svg" alt="" style="cursor: pointer" nz-tooltip="Tìm kiếm" />
            </ng-template>
          </nz-col>
          <nz-col nzSpan="8" style="flex:none;">
            <button nz-button nzType="primary" nzSize="large" (click)="navigateToCreateSubnet()">
              <img style="padding-right: 10px; margin-top: -4px" src="assets/imgs/add-circle.svg" alt="" />
              <span class="button-text-primary">Tạo mới Subnet</span>
            </button>
          </nz-col>
        </nz-row>
        <nz-table #fixTableSubnet
                  nzShowPagination
                  [nzData]="responseSubnet?.records"
                  [nzTotal]="responseSubnet?.totalCount"
                  (nzPageSizeChange)="onPageSizeChangeSubnet($event)"
                  [nzPageIndex]="responseSubnet?.currentPage"
                  (nzPageIndexChange)="onPageIndexChangeSubnet($event)"
                  [nzFrontPagination]="false"
                  [nzLoading]="isLoadingSubnet">
          <thead>
          <tr>
            <th>Tên Subnet</th>
            <th>Subnet</th>
            <th>Gateway</th>
            <th *ngIf="!networkName?.includes('pri_network')">Thao tác</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let data of fixTableSubnet.data">
            <td>{{ data.name }}</td>
            <td>{{ data.subnetAddressRequired }}</td>
            <td>{{ data.gatewayIP }}</td>
            <td *ngIf="!networkName?.includes('pri_network')">
              <span style="color: #0066B3; margin-right: 10px; cursor: pointer;" nz-icon nzType="edit"
                    nzTheme="outline"
                    (click)="navigateToEditSubnet(data.id)"
                    nz-popover
                    [nzPopoverContent]="'Chỉnh sửa'"
                    nzPopoverPlacement="bottom"></span>
              <span style="color: #0066B3; margin-right: 20px; cursor: pointer;"
                    (click)="showModalDeleteConfirm(data.id)"
                    nz-popover
                    [nzPopoverContent]="'Xóa'"
                    nzPopoverPlacement="bottom"
                    nz-icon nzType="delete" nzTheme="outline"></span>
              <nz-modal [(nzVisible)]="isVisibleDelete" nzTitle="Xóa Subnet"
                        (nzOnCancel)="handleCancelDelete()" nzCentered>
                <div *nzModalTitle>
                  <span class="text-modal-title">Xóa</span>
                </div>
                <div *nzModalContent>

                  <span>Đế thực hiện xoá Subnet + tên subnet, vui lòng nhập tên Subnet
để xác nhận.</span>
                  <input nz-input [(ngModel)]="value" (ngModelChange)="onInputChange($event)" type="text"/>
                </div>
                <div *nzModalFooter>
                  <button nz-button nzType="default" (click)="handleCancelDelete()" class="button-cancel">Hủy
                  </button>
                  <button nz-button nzType="primary" (click)="handleOkDelete()"
                          [nzLoading]="isLoadingDelete"
                          class="button-ok">Đồng ý
                  </button>
                </div>
              </nz-modal>
            </td>
          </tr>
          </tbody>
        </nz-table>
      </nz-tab>
      <nz-tab nzTitle="Port">
        <nz-row nzJustify="space-between" style="margin-bottom: 15px;">
          <nz-col nzSpan="16">
            <nz-input-group [nzPrefix]="prefixIconSearch"
                            nzSize="large"
                            style="width: 300px;">
              <input name="name"
                     nz-input placeholder="Tìm kiếm"
                     [(ngModel)]="valuePort"
                     (input)="onInputChangePort($event.target['value'])" />
            </nz-input-group>
            <ng-template #prefixIconSearch>
              <img src="assets/imgs/search.svg" alt="" style="cursor: pointer" nz-tooltip="Tìm kiếm" />
            </ng-template>
          </nz-col>
          <nz-col nzSpan="8" style="flex:none;">
<!--            <button nz-button nzType="primary" nzSize="large" (click)="navigateToCreatePort()">-->
<!--              <img style="padding-right: 10px; margin-top: -4px" src="assets/imgs/add-circle.svg" alt="" />-->
<!--              <span class="button-text-primary">Tạo mới Port</span>-->
<!--            </button>-->
            <one-portal-vlan-create-port [region]="region"
                                         [project]="project"
                                         [networkId]="idNetwork"
                                         (onOk)="handleOk()" />
          </nz-col>
        </nz-row>
        <nz-table #fixTablePort
                  nzShowPagination
                  [nzData]="responsePort?.records"
                  [nzTotal]="responsePort?.totalCount"
                  (nzPageSizeChange)="onPageSizeChangePort($event)"
                  [nzPageIndex]="responseSubnet?.currentPage"
                  (nzPageIndexChange)="onPageIndexChangePort($event)"
                  [nzFrontPagination]="false"
                  [nzLoading]="isLoadingPort">
          <thead>
          <tr>
            <th>Tên Port</th>
            <th>Fixed IPs</th>
            <th>MAC Address</th>
            <th>Attached Device</th>
            <th>Trạng thái</th>
            <th>Gắn vào máy ảo</th>
            <th>Thao tác</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let index of fixTablePort.data">
            <td>{{ index.name }}</td>
            <td>{{ index.fixedIPs }}</td>
            <td>{{ index.macAddress }}</td>
            <td>{{ index.attachedDevice }}</td>
            <td>{{ index.status }}</td>
            <td>
              <div *ngIf="(index.instanceName)">
                {{ index.instanceName }}
              </div>
              <div *ngIf="!(index.instanceName)">
                -
              </div>
            </td>
            <td *ngIf="!index.attachedDevice.includes('network:dhcp')">
              <div *ngIf="!(index.instanceName)">
                <span style="color: #0066B3; margin-right: 10px; cursor: pointer;" nz-icon nzType="plus"
                      nzTheme="outline"
                      nz-popover
                      [nzPopoverContent]="'Gắn máy ảo'"
                      nzPopoverPlacement="bottom" (click)="showModalAttach(index.id)"></span>
                <nz-modal [(nzVisible)]="isVisibleAttach" nzTitle="Gán Port"
                          (nzOnCancel)="handleCancelAttach()" nzMask="false">
                  <div *nzModalTitle>
                    <span class="text-modal-title">Gán Port</span>
                  </div>
                  <div *nzModalContent>
                    <nz-form-label>Chọn máy ảo</nz-form-label>
                    <nz-select nzSize="default"
                               [nzLoading]="isLoadingAttach"
                               [nzPlaceHolder]="'-Chọn máy ảo-'"
                               [(ngModel)]="instanceSelected"
                               (ngModelChange)="instanceChange($event)"
                               nzShowSearch
                               style="width: 300px;">
                      <nz-option *ngFor="let item of listVm" [nzLabel]="item.name"
                                 [nzValue]="item.cloudId"></nz-option>
                    </nz-select>
                  </div>
                  <div *nzModalFooter style="padding-left: 8px; padding-right: 8px;">
                    <button nz-button nzType="default" (click)="handleCancelAttach()" class="button-cancel">
                      <span nz-icon nzType="close" nzTheme="outline"></span>Hủy
                    </button>
                    <button nz-button nzType="primary"
                            (click)="handleOkAttach()"
                            [nzLoading]="isLoadingAttach"
                            class="button-ok">
                      <span nz-icon nzType="check" nzTheme="outline"></span>Xác nhận
                    </button>
                  </div>
                </nz-modal>
                <span style="color: #0066B3; margin-right: 20px; cursor: pointer;"
                      nz-popover
                      [nzPopoverContent]="'Xoá'"
                      nzPopoverPlacement="bottom"
                      nz-icon nzType="delete" nzTheme="outline" (click)="showModalDeletePort(index.id)"></span>
                <nz-modal [(nzVisible)]="isVisbileDeletePort" nzTitle="Xoá Port"
                          (nzOnCancel)="handleCancelDeletePort()">
                  <div *nzModalTitle>
                    <span class="text-modal-title">Xoá Port</span>
                  </div>
                  <div *nzModalContent>
                    <span>Bạn có chắc chắn muốn xóa Port không?</span>
                  </div>
                  <div *nzModalFooter style="padding-left: 8px; padding-right: 8px;">
                    <button nz-button nzType="default" (click)="handleCancelDeletePort()" class="button-cancel">
                      <span nz-icon nzType="close" nzTheme="outline"></span>Hủy
                    </button>
                    <button nz-button nzType="primary"
                            (click)="handleOkDeletePort()"
                            [nzLoading]="isLoadingDeletePort"
                            class="button-ok">
                      <span nz-icon nzType="check" nzTheme="outline"></span>Xác nhận
                    </button>
                  </div>
                </nz-modal>
              </div>
              <div *ngIf="(index.instanceName)">
                <span style="color: #0066B3; margin-right: 10px; cursor: pointer;" nz-icon nzType="close"
                      nzTheme="outline" nz-popover
                      [nzPopoverContent]="'Gỡ máy ảo'"
                      nzPopoverPlacement="bottom" (click)="showModalDetach(index.id)"></span>
                <nz-modal [(nzVisible)]="isVisibleDetach" nzTitle="Gỡ Port"
                          (nzOnCancel)="handleCancelDetach()" nzMask="false">
                  <div *nzModalTitle>
                    <span class="text-modal-title">Gỡ Port</span>
                  </div>
                  <div *nzModalContent>
                    <span>Quý khách có chắc chắn muốn gỡ Port khỏi máy ảo?</span>
                  </div>
                  <div *nzModalFooter style="padding-left: 8px; padding-right: 8px;">
                    <button nz-button nzType="default" (click)="handleCancelDetach()" class="button-cancel">
                      <span nz-icon nzType="close" nzTheme="outline"></span>Hủy
                    </button>
                    <button nz-button nzType="primary"
                            (click)="handleOkDetach()"
                            [nzLoading]="isLoadingDetach"
                            class="button-ok">
                      <span nz-icon nzType="check" nzTheme="outline"></span>Xác nhận
                    </button>
                  </div>
                </nz-modal>
                <span style="color: #0066B3; margin-right: 20px; cursor: pointer;"
                      nz-popover
                      [nzPopoverContent]="'Xoá'"
                      nzPopoverPlacement="bottom"
                      nz-icon nzType="delete" nzTheme="outline" (click)="showModalDeletePort(index.id)"></span>
                <nz-modal [(nzVisible)]="isVisbileDeletePort" nzTitle="Xoá Port"
                          (nzOnCancel)="handleCancelDeletePort()" nzMask="false">
                  <div *nzModalTitle>
                    <span class="text-modal-title">Xoá Port</span>
                  </div>
                  <div *nzModalContent>
                    <span>Bạn có chắc chắn muốn xóa Port không?</span>
                  </div>
                  <div *nzModalFooter style="padding-left: 8px; padding-right: 8px;">
                    <button nz-button nzType="default" (click)="handleCancelDeletePort()" class="button-cancel">
                      <span nz-icon nzType="close" nzTheme="outline"></span>Hủy
                    </button>
                    <button nz-button nzType="primary"
                            (click)="handleOkDeletePort()"
                            [nzLoading]="isLoadingDeletePort"
                            class="button-ok">
                      <span nz-icon nzType="check" nzTheme="outline"></span>Xác nhận
                    </button>
                  </div>
                </nz-modal>
              </div>
            </td>
            <td *ngIf="index.attachedDevice.includes('network:dhcp')">
              <div *ngIf="!(index.instanceName)" >
                <span style="margin-right: 10px; color: #E6E6E6; cursor: not-allowed;" nz-icon nzType="plus"
                    nzTheme="outline"></span>
                <span style="margin-right: 20px; color: #E6E6E6; cursor: not-allowed;"
                      nz-icon nzType="delete" nzTheme="outline"></span>
              </div>
              <div *ngIf="(index.instanceName)">
                <span style="margin-right: 10px; color: #E6E6E6; cursor: not-allowed;" nz-icon nzType="close"
                      nzTheme="outline"></span>
                <span style="margin-right: 20px; color: #E6E6E6; cursor: not-allowed;"
                      nz-icon nzType="delete" nzTheme="outline"></span>
              </div>
            </td>
          </tr>
          </tbody>
        </nz-table>
      </nz-tab>
    </nz-tabset>
  </nz-card>
</nz-content>
