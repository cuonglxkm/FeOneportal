<page-header
  [breadcrumb]="breadcrumb"
  [action]="action"
  [title]="'app.instances.create' | i18n"
>
  <ng-template #breadcrumb>
    <nz-breadcrumb [nzSeparator]="separatorTemplate">
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">{{ 'app.breadcrumb.home' | i18n }}</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        {{ 'app.breadcrumb.infrastructure.service' | i18n }}
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/app-smart-cloud/instances']">{{
          'app.instances' | i18n
        }}</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item
        ><a
          [routerLink]="['/app-smart-cloud/instances/instances-create-vpc']"
          >{{ 'app.instances.create' | i18n }}</a
        ></nz-breadcrumb-item
      >
    </nz-breadcrumb>
    <ng-template #separatorTemplate
      ><img src="assets/imgs/arrow-square-right.svg" alt="" />
    </ng-template>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <share-users-combobox></share-users-combobox>
      <region-select-dropdown
        (valueChanged)="onRegionChange($event)"
        (regionChange)="onRegionChanged($event)"
      ></region-select-dropdown>
      <project-select-dropdown
        [regionId]="region"
        (userChanged)="onProjectChange($event)"
      ></project-select-dropdown>
    </div>
  </ng-template>
</page-header>

<div nz-row [nzGutter]="24">
  <div nz-col [nzSpan]="16" style="display: flex">
    <form nz-form [formGroup]="form" [nzLayout]="'vertical'">
      <nz-card [nzBordered]="false">
        <div style="margin-bottom: 20px">
          <span class="text-card-header">{{
            'app.instances.info' | i18n
          }}</span>
        </div>
        <nz-row nzGutter="16">
          <nz-col nzSpan="24">
            <nz-form-item>
              <nz-form-label nzFor="name"
                >{{ 'app.instances.name' | i18n }} (<span class="text-red"
                  >*</span
                >)<img
                  style="margin-left: 10px"
                  [nz-tooltip]="'app.tooltip.instance.name' | i18n"
                  src="assets/imgs/pajamas_question.svg"
                  alt=""
              /></nz-form-label>

              <nz-form-control nzDisableAutoTips [nzErrorTip]="nameErrorTpl">
                <nz-row>
                  <nz-col nzSpan="12">
                    <input
                      #nameInput
                      class="input-custom"
                      nz-input
                      formControlName="name"
                      [(ngModel)]="instanceCreate.serviceName"
                      (ngModelChange)="changeName($event)"
                      [placeholder]="'app.input.name' | i18n"
                      [maxlength]="50"
                    />
                  </nz-col>
                  <nz-col
                    style="display: flex; align-items: center"
                    nzSpan="12"
                  >
                    <nz-switch
                      style="margin-left: 20px"
                      nzSize="small"
                      [(ngModel)]="isSnapshot"
                      [ngModelOptions]="{ standalone: true }"
                      (ngModelChange)="initSnapshot()"
                    ></nz-switch>
                    <label
                      class="text-label"
                      nzFor="name"
                      style="text-align: right; padding-left: 1%"
                      >{{ 'app.instances.from.snapshot' | i18n }}
                      <img
                        style="margin-left: 10px"
                        [nz-tooltip]="
                          'app.tooltip.instances.from.snapshot' | i18n
                        "
                        src="assets/imgs/pajamas_question.svg"
                        alt=""
                    /></label>
                  </nz-col>
                </nz-row>
                <div *ngIf="isExistName" style="color: #ff4d4f">
                  {{ 'validation.exist.instance.name' | i18n }}
                </div>
                <ng-template #nameErrorTpl let-control>
                  <ng-container *ngIf="control.hasError('required')">{{
                    'validation.info.required' | i18n
                  }}</ng-container>
                  <ng-container *ngIf="control.hasError('pattern')">{{
                    'validation.name.pattern' | i18n
                  }}</ng-container>
                </ng-template>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <div *ngIf="isSnapshot">
          <nz-form-item>
            <nz-form-label nzFor="name"
              >{{ 'app.choose.snapshot' | i18n }} (<span class="text-red"
                >*</span
              >)</nz-form-label
            >
            <nz-form-control nzErrorTip="Vui lòng Chọn Snapshot">
              <nz-select
                [nzPlaceHolder]="'-- ' + ('app.choose.snapshot' | i18n) + ' --'"
                [nzShowSearch]="true"
                [(ngModel)]="selectedSnapshot"
                (ngModelChange)="changeSelectedSnapshot()"
                [ngModelOptions]="{ standalone: true }"
                nzSize="large"
              >
                <nz-option
                  *ngFor="let i of listSnapshot"
                  [nzLabel]="i.name"
                  [nzValue]="i.id"
                />
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div style="margin-left: -10px" *ngIf="!isSnapshot">
          <nz-form-label style="padding-left: 12px"
            >{{ 'app.instances.OS' | i18n }} (<span class="text-red">*</span
            >)<img
              style="margin-left: 10px"
              [nz-tooltip]="'app.tooltip.instance.OS' | i18n"
              src="assets/imgs/pajamas_question.svg"
              alt=""
          /></nz-form-label>
          <ngu-carousel
            #myCarouselImage
            [inputs]="carouselTileConfig"
            [dataSource]="listImageTypes"
          >
            <ngu-tile
              *nguCarouselDef="let data; index as i; let ani = animate"
              [@slider]="ani"
            >
              <div
                class="images-body"
                [id]="'images_' + data.id"
                [ngClass]="{
                  'images-body-active': data.id === selectedImageTypeId,
                  bgGray: !data.id === selectedImageTypeId
                }"
              >
                <nz-row>
                  <nz-col class="text-center" style="width: 100%">
                    <img
                      *ngIf="data.name == 'Linux'"
                      src="assets/imgs/ubuntu.png"
                      alt=""
                    />
                    <img
                      *ngIf="data.name == 'Windows'"
                      src="assets/imgs/window.png"
                      alt=""
                    />
                  </nz-col>
                </nz-row>
                <nz-row>
                  <nz-col class="text-center" style="width: 100%">
                    <div style="margin-top: 15px; margin-bottom: 15px">
                      <nz-select
                        nzShowSearch
                        [id]="'hdh_' + data.id"
                        [(ngModel)]="listSelectedImage[i]"
                        (ngModelChange)="
                          onInputHDH($event, i, data.id, data.uniqueKey)
                        "
                        [nzPlaceHolder]="'app.button.choose.version' | i18n"
                        [ngModelOptions]="{ standalone: true }"
                        style="text-align: center; width: 155px"
                      >
                        <nz-option
                          *ngFor="let p of listOfImageByImageType.get(data.id)"
                          [nzValue]="p.id"
                          [nzLabel]="p.name"
                        ></nz-option>
                      </nz-select>
                    </div>
                  </nz-col>
                </nz-row>
              </div>
            </ngu-tile>

            <ul class="myPoint" NguCarouselPoint>
              <li
                *ngFor="let i of myCarouselImage.pointNumbers"
                [class.active]="i === myCarouselImage.activePoint"
                (click)="myCarouselImage.moveTo(i)"
              ></li>
            </ul>
          </ngu-carousel>
        </div>

        <br />
        <nz-row nzGutter="16">
          <nz-form-label
            >{{ 'app.choose.volume.type' | i18n }} (<span class="text-red"
              >*</span
            >)<img
              style="margin-left: 10px"
              [nz-tooltip]="'app.tooltip.volume.type' | i18n"
              src="assets/imgs/pajamas_question.svg"
              alt=""
          /></nz-form-label>
        </nz-row>
        <nz-radio-group
          style="width: 100%; display: inline-flex"
          name="selectedHDDorSSD"
        >
          <nz-row
            [nzGutter]="{ xs: 24, sm: 24, md: 24, lg: 24 }"
            style="margin-top: 10px"
            ><nz-col
              [nzLg]="12"
              [nzMd]="12"
              [nzSm]="24"
              [nzXl]="12"
              [nzXs]="24"
            >
              <nz-card
                style="border-radius: 4px"
                [nzAlign]="'middle'"
                [ngStyle]="{
                    border: activeBlockHDD
                  ? '1px solid #0066B3'
                  : '1px solid #DADADA',
                  height: cardHeight,
                }"
              >
                <nz-row nzGutter="16">
                  <nz-col nzSpan="20">
                    <nz-card-meta
                      [nzAvatar]="nzAvatarselectedHDDorSSD1"
                      [nzTitle]="nzTitleselectedHDDorSSD1"
                      [nzDescription]="nzDescriptionselectedHDDorSSD1"
                    >
                      <ng-template #nzAvatarselectedHDDorSSD1>
                        <label
                          [tabIndex]="0"
                          nz-radio
                          [ngModel]="activeBlockHDD"
                          [ngModelOptions]="{ standalone: true }"
                          (click)="initHDD()"
                          (keyup.enter)="initHDD()"
                          [disabled]="disableHDD"
                        ></label>
                      </ng-template>
                      <ng-template #nzTitleselectedHDDorSSD1>
                        <b>HDD</b>
                      </ng-template>
                      <ng-template #nzDescriptionselectedHDDorSSD1>
                        <ellipsis class="text-custom">
                          {{ 'app.hdd.intro.text' | i18n }}
                        </ellipsis>
                      </ng-template>
                    </nz-card-meta></nz-col
                  >
                  <nz-col
                    style="
                      display: flex;
                      align-items: center;
                      margin-top: -24px;
                    "
                    [ngStyle]="{
                      height: cardHeight,
                    }"
                    nzSpan="4"
                  >
                    <img
                      [src]="
                        activeBlockHDD
                          ? 'assets/imgs/hdd-svgrepo-com-active.svg'
                          : 'assets/imgs/hdd-svgrepo-com.svg'
                      "
                      alt=""
                    />
                  </nz-col>
                </nz-row>
              </nz-card>
            </nz-col>
            <nz-col [nzLg]="12" [nzMd]="12" [nzSm]="24" [nzXl]="12" [nzXs]="24">
              <nz-card
                style="border-radius: 4px"
                [nzAlign]="'middle'"
                [ngStyle]="{
                  border: activeBlockSSD
                  ? '1px solid #0066B3'
                  : '1px solid #DADADA',
                  height: cardHeight,
                }"
              >
                <nz-row nzGutter="16">
                  <nz-col nzSpan="20"
                    ><nz-card-meta
                      [nzAvatar]="nzAvatarselectedHDDorSSD2"
                      [nzTitle]="nzTitleselectedHDDorSSD2"
                      [nzDescription]="nzDescriptionselectedHDDorSSD2"
                    >
                      <ng-template #nzAvatarselectedHDDorSSD2>
                        <label
                          [tabIndex]="0"
                          nz-radio
                          [ngModel]="activeBlockSSD"
                          [ngModelOptions]="{ standalone: true }"
                          (click)="initSSD()"
                          (keyup.enter)="initSSD()"
                        ></label>
                      </ng-template>
                      <ng-template #nzTitleselectedHDDorSSD2>
                        <b>SSD</b>
                      </ng-template>
                      <ng-template #nzDescriptionselectedHDDorSSD2>
                        <ellipsis class="text-custom">
                          {{ 'app.ssd.intro.text' | i18n }}
                        </ellipsis>
                      </ng-template>
                    </nz-card-meta>
                  </nz-col>
                  <nz-col
                    style="
                      display: flex;
                      align-items: center;
                      margin-top: -24px;
                    "
                    [ngStyle]="{
                        height: cardHeight,
                      }"
                    nzSpan="4"
                  >
                    <img
                      [src]="
                        activeBlockSSD
                          ? 'assets/imgs/ssd-svgrepo-com-active.svg'
                          : 'assets/imgs/ssd-svgrepo-com.svg'
                      "
                      alt=""
                    />
                  </nz-col>
                </nz-row>
              </nz-card> </nz-col
          ></nz-row>
        </nz-radio-group>
        <nz-tabset
          nzCentered
          nzSize="large"
          (keydown)="handleKeyboardEvent($event)"
        >
          <nz-tab
            [nzTitle]="'app.custom.configuration' | i18n"
            (nzClick)="onClickCustomConfig()"
          >
            <div class="ant-table">
              <table>
                <thead class="ant-table-thead">
                  <tr>
                    <th style="width: 80%">{{ 'app.resource' | i18n }}</th>
                    <th>{{ 'app.amount' | i18n }}</th>
                  </tr>
                </thead>
                <tbody class="ant-table-tbody">
                  <tr>
                    <td style="width: 50%">
                      <nz-form-label style="margin-left: -12px"
                        >{{ 'app.capacity' | i18n }} (<span class="text-red"
                          >*</span
                        >) - GB</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="minCapacity"
                        [nzMax]="remainingVolume"
                        [nzStep]="stepCapacity"
                        [(ngModel)]="instanceCreate.volumeSize"
                        (ngModelChange)="changeCapacity($event)"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                      <div
                        *ngIf="remainingVolume == 0"
                        style="font-size: 14px; color: #ff4d4f"
                      >
                        {{ 'app.alert.quota.vpc' | i18n }}
                        <a
                          [routerLink]="[
                            '/app-smart-cloud/project/update',
                            projectId
                          ]"
                          >{{ 'app.this' | i18n }}</a
                        >
                        {{ 'app.alert.quota.vpc.next' | i18n }}
                      </div>
                    </td>
                    <td>
                      <nz-input-number
                        [nzMin]="minCapacity"
                        [nzMax]="maxCapacity"
                        [nzStep]="stepCapacity"
                        [(ngModel)]="instanceCreate.volumeSize"
                        (ngModelChange)="changeCapacity($event)"
                        (keydown)="onKeyDown($event)"
                        [ngModelOptions]="{ standalone: true }"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <nz-form-label style="margin-left: -12px"
                        >RAM (<span class="text-red">*</span>) -
                        GB</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="0"
                        [nzMax]="remainingRAM"
                        [(ngModel)]="instanceCreate.ram"
                        (ngModelChange)="checkValidConfig()"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                      <div
                        *ngIf="remainingRAM == 0"
                        style="font-size: 14px; color: #ff4d4f"
                      >
                        {{ 'app.alert.quota.vpc' | i18n }}
                        <a
                          [routerLink]="[
                            '/app-smart-cloud/project/update',
                            projectId
                          ]"
                          >{{ 'app.this' | i18n }}</a
                        >
                        {{ 'app.alert.quota.vpc.next' | i18n }}
                      </div>
                    </td>
                    <td>
                      <nz-input-number
                        [nzMin]="0"
                        [nzMax]="remainingRAM"
                        [(ngModel)]="instanceCreate.ram"
                        (ngModelChange)="checkValidConfig()"
                        (keydown)="onKeyDown($event)"
                        [ngModelOptions]="{ standalone: true }"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <nz-form-label style="margin-left: -12px"
                        >CPU (<span class="text-red">*</span>) -
                        vCPU</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="0"
                        [nzMax]="remainingVCPU"
                        [(ngModel)]="instanceCreate.cpu"
                        (ngModelChange)="checkValidConfig()"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                      <div
                        *ngIf="remainingVCPU == 0"
                        style="font-size: 14px; color: #ff4d4f"
                      >
                        {{ 'app.alert.quota.vpc' | i18n }}
                        <a
                          [routerLink]="[
                            '/app-smart-cloud/project/update',
                            projectId
                          ]"
                          >{{ 'app.this' | i18n }}</a
                        >
                        {{ 'app.alert.quota.vpc.next' | i18n }}
                      </div>
                    </td>
                    <td>
                      <nz-input-number
                        [nzMin]="0"
                        [nzMax]="remainingVCPU"
                        [(ngModel)]="instanceCreate.cpu"
                        (ngModelChange)="checkValidConfig()"
                        (keydown)="onKeyDown($event)"
                        [ngModelOptions]="{ standalone: true }"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </nz-tab>
          <nz-tab
            [nzTitle]="'app.gpu.configuration' | i18n"
            (nzClick)="onClickGpuConfig()"
          >
            <div class="ant-table">
              <table>
                <thead class="ant-table-thead">
                  <tr>
                    <th style="width: 80%">{{ 'app.resource' | i18n }}</th>
                    <th>{{ 'app.amount' | i18n }}</th>
                  </tr>
                </thead>
                <tbody class="ant-table-tbody">
                  <tr>
                    <td style="width: 50%">
                      <nz-form-label style="margin-left: -12px"
                        >{{ 'app.ssd.capacity' | i18n }} (<span class="text-red"
                          >*</span
                        >) - GB</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="minCapacity"
                        [nzMax]="remainingVolume"
                        [nzStep]="stepCapacity"
                        [(ngModel)]="instanceCreate.volumeSize"
                        (ngModelChange)="changeCapacity($event)"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                      <div
                        *ngIf="remainingVolume == 0"
                        style="font-size: 14px; color: #ff4d4f"
                      >
                        {{ 'app.alert.quota.vpc' | i18n }}
                        <a
                          [routerLink]="[
                            '/app-smart-cloud/project/update',
                            projectId
                          ]"
                          >{{ 'app.this' | i18n }}</a
                        >
                        {{ 'app.alert.quota.vpc.next' | i18n }}
                      </div>
                    </td>
                    <td>
                      <nz-input-number
                        [nzMin]="minCapacity"
                        [nzMax]="remainingVolume"
                        [nzStep]="stepCapacity"
                        [(ngModel)]="instanceCreate.volumeSize"
                        (ngModelChange)="changeCapacity($event)"
                        (keydown)="onKeyDown($event)"
                        [ngModelOptions]="{ standalone: true }"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <nz-form-label style="margin-left: -12px"
                        >RAM (<span class="text-red">*</span>) -
                        GB</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="0"
                        [nzMax]="remainingRAM"
                        [(ngModel)]="instanceCreate.ram"
                        (ngModelChange)="checkValidConfig()"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                      <div
                        *ngIf="remainingRAM == 0"
                        style="font-size: 14px; color: #ff4d4f"
                      >
                        {{ 'app.alert.quota.vpc' | i18n }}
                        <a
                          [routerLink]="[
                            '/app-smart-cloud/project/update',
                            projectId
                          ]"
                          >{{ 'app.this' | i18n }}</a
                        >
                        {{ 'app.alert.quota.vpc.next' | i18n }}
                      </div>
                    </td>
                    <td>
                      <nz-input-number
                        [nzMin]="0"
                        [nzMax]="remainingRAM"
                        [(ngModel)]="instanceCreate.ram"
                        (ngModelChange)="checkValidConfig()"
                        (keydown)="onKeyDown($event)"
                        [ngModelOptions]="{ standalone: true }"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <nz-form-label style="margin-left: -12px"
                        >CPU (<span class="text-red">*</span>) -
                        vCPU</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="0"
                        [nzMax]="remainingVCPU"
                        [(ngModel)]="instanceCreate.cpu"
                        (ngModelChange)="checkValidConfig()"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                      <div
                        *ngIf="remainingVCPU == 0"
                        style="font-size: 14px; color: #ff4d4f"
                      >
                        {{ 'app.alert.quota.vpc' | i18n }}
                        <a
                          [routerLink]="[
                            '/app-smart-cloud/project/update',
                            projectId
                          ]"
                          >{{ 'app.this' | i18n }}</a
                        >
                        {{ 'app.alert.quota.vpc.next' | i18n }}
                      </div>
                    </td>
                    <td>
                      <nz-input-number
                        [nzMin]="0"
                        [nzMax]="remainingVCPU"
                        [(ngModel)]="instanceCreate.cpu"
                        (ngModelChange)="checkValidConfig()"
                        (keydown)="onKeyDown($event)"
                        [ngModelOptions]="{ standalone: true }"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                  </tr>
                  <tr>
                    <td style="width: 50%">
                      <nz-form-label style="margin-left: -12px"
                        >{{ 'app.choose.gpu.type' | i18n }} (<span
                          class="text-red"
                          >*</span
                        >)</nz-form-label
                      >
                      <style>
                        ::ng-deep nz-form-control {
                          padding-left: 0px !important;
                          padding-right: 0px !important;
                        }
                      </style>
                      <nz-form-control>
                        <nz-select
                          [nzPlaceHolder]="
                            '-- ' + ('app.choose.gpu.type' | i18n) + ' --'
                          "
                          [nzShowSearch]="true"
                          [(ngModel)]="instanceCreate.gpuOfferId"
                          (ngModelChange)="changeGpuType($event)"
                          [ngModelOptions]="{ standalone: true }"
                          nzSize="large"
                        >
                          <nz-option
                            *ngFor="let i of purchasedListGPUType"
                            [nzLabel]="i.offerName"
                            [nzValue]="i.id"
                          />
                        </nz-select>
                      </nz-form-control>
                      <div
                        *ngIf="remainingGpu == 0"
                        style="font-size: 14px; color: #ff4d4f"
                      >
                        {{ 'app.alert.quota.vpc' | i18n }}
                        <a
                          [routerLink]="[
                            '/app-smart-cloud/project/update',
                            projectId
                          ]"
                          >{{ 'app.this' | i18n }}</a
                        >
                        {{ 'app.alert.quota.vpc.next' | i18n }}
                      </div>
                    </td>
                    <td>
                      <nz-form-label></nz-form-label>
                      <nz-form-control
                        ><nz-select
                          style="margin-left: 8px; width: 90px"
                          [nzShowSearch]="true"
                          [(ngModel)]="instanceCreate.gpuCount"
                          (ngModelChange)="checkValidConfig()"
                          [ngModelOptions]="{ standalone: true }"
                          nzSize="large"
                        >
                          <nz-option
                            *ngFor="let i of listOptionGpuValue"
                            [nzLabel]="i"
                            [nzValue]="i"
                          /> </nz-select
                      ></nz-form-control>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </nz-tab>
        </nz-tabset>
        <div style="margin-top: 20px" class="text-label" *ngIf="activeBlockHDD">
          IOPS
          <img
            nz-popover
            [nzPopoverContent]="contentTemplateEncryptVolume"
            src="assets/imgs/pajamas_question.svg"
            alt=""
            [nzPopoverOverlayStyle]="{ width: '320px' }"
          />
          300
        </div>
        <div
          style="margin-top: 20px"
          class="text-label"
          *ngIf="activeBlockSSD && volumeRootCapacity <= 40"
        >
          IOPS
          <img
            nz-popover
            [nzPopoverContent]="contentTemplateEncryptVolume"
            src="assets/imgs/pajamas_question.svg"
            alt=""
            [nzPopoverOverlayStyle]="{ width: '320px' }"
          />
          400
        </div>
        <div
          style="margin-top: 20px"
          class="text-label"
          *ngIf="activeBlockSSD && volumeRootCapacity > 40"
        >
          IOPS
          <img
            nz-popover
            [nzPopoverContent]="contentTemplateEncryptVolume"
            src="assets/imgs/pajamas_question.svg"
            alt=""
            [nzPopoverOverlayStyle]="{ width: '320px' }"
          />
          {{ volumeRootCapacity * 10 }}
        </div>
        <ng-template #contentTemplateEncryptVolume>
          <span
            [innerHTML]="'app.tooltip.instance.volume.encypt' | i18n"
          ></span>
        </ng-template>
        <label
          *ngIf="isSupportEncryption"
          style="margin-top: 20px"
          nz-checkbox
          [(ngModel)]="instanceCreate.encryption"
          [ngModelOptions]="{ standalone: true }"
          [disabled]="isSnapshot"
          >{{ 'volume.info.type.encrypt' | i18n }}
          <img
            [nz-tooltip]="'volume.tooltip.type.encrypt' | i18n"
            src="assets/imgs/pajamas_question.svg"
            alt=""
            [nzPopoverOverlayStyle]="{ width: '320px' }"
          />
        </label>
        <nz-row style="margin-top: 20px" nzGutter="16">
          <nz-col nzLg="12" nzMd="12" nzSm="24">
            <nz-form-item
              ><nz-form-label
                >{{ 'app.choose.ip.public' | i18n }} (<span class="text-red"
                  >*</span
                >)<img
                  style="margin-left: 10px"
                  nz-popover
                  [nzPopoverContent]="contentTemplateIPPublic"
                  src="assets/imgs/pajamas_question.svg"
                  alt=""
                /><ng-template #contentTemplateIPPublic>
                  <span
                    [innerHTML]="'app.tooltip.instance.ip.public' | i18n"
                  ></span>
                  <a
                    [routerLink]="[
                      '/app-smart-cloud/networks/ip-floating/list'
                    ]"
                    >{{ 'app.ip.floating' | i18n }}</a
                  >
                </ng-template></nz-form-label
              >
              <nz-form-control>
                <nz-select
                  [nzShowSearch]="true"
                  [(ngModel)]="ipPublicValue"
                  [ngModelOptions]="{ standalone: true }"
                  nzSize="large"
                >
                  <nz-option
                    [nzLabel]="'app.do.not.use' | i18n"
                    [nzValue]="0"
                  />
                  <nz-option
                    *ngFor="let i of listIPPublic"
                    [nzLabel]="i.ipAddress || i.networkId"
                    [nzValue]="i.id"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
          <nz-col nzLg="12" nzMd="12" nzSm="24">
            <nz-form-item>
              <nz-form-label>{{
                'app.choose.security.group' | i18n
              }}</nz-form-label>
              <nz-form-control>
                <nz-select
                  nzMode="multiple"
                  [ngModelOptions]="{ standalone: true }"
                  [(ngModel)]="selectedSecurityGroup"
                  [nzShowSearch]="true"
                  nzSize="large"
                >
                  <nz-option
                    *ngFor="let i of listSecurityGroup"
                    [nzLabel]="i.name"
                    [nzValue]="i.name"
                    [nzDisabled]="i.name.toUpperCase() === 'DEFAULT'"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <nz-row>
          <nz-form-item style="width: 100%">
            <div>
              <nz-alert
                nzType="warning"
                [nzDescription]="nzDescriptionWarning3"
                nzShowIcon
              ></nz-alert>
              <ng-template #nzDescriptionWarning3>
                <div>
                  {{ 'app.alert.security.group' | i18n }}
                  <u
                    style="cursor: pointer"
                    [routerLink]="['/app-smart-cloud/security-group/list']"
                    (keyup.enter)="navigateToSecurity()"
                    >{{ 'app.alert.access.security' | i18n }}</u
                  >
                </div>
              </ng-template>
            </div>
          </nz-form-item>
        </nz-row>
        <nz-row nzGutter="16">
          <nz-col nzLg="12" nzMd="12" nzSm="24">
            <nz-form-item>
              <nz-form-label
                >{{ 'app.choose.vlan.instance' | i18n }} (<span class="text-red"
                  >*</span
                >)</nz-form-label
              >
              <nz-form-control>
                <nz-select
                  [nzShowSearch]="true"
                  [(ngModel)]="vlanNetwork"
                  (ngModelChange)="getListPort()"
                  [ngModelOptions]="{ standalone: true }"
                  nzSize="large"
                >
                  <nz-option
                    *ngFor="let i of listVlanNetwork"
                    [nzLabel]="i.name"
                    [nzValue]="i.cloudId"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
          <nz-col nzLg="12" nzMd="12" nzSm="24">
            <nz-form-item>
              <nz-form-label
                >{{ 'app.choose.port' | i18n }} (<span class="text-red">*</span
                >)</nz-form-label
              >
              <nz-form-control>
                <nz-select
                  [nzShowSearch]="true"
                  [(ngModel)]="port"
                  [ngModelOptions]="{ standalone: true }"
                  nzSize="large"
                >
                  <nz-option
                    *ngFor="let i of listPort"
                    [nzLabel]="i.fixedIPs[0]"
                    [nzValue]="i.id"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <nz-row>
          <nz-form-label nzFor="name"
            >{{ 'app.access.method.instance' | i18n }} (<span class="text-red"
              >*</span
            >)<img
              style="margin-left: 10px"
              [nz-tooltip]="'app.tooltip.access.method.instance' | i18n"
              src="assets/imgs/pajamas_question.svg"
              alt=""
          /></nz-form-label>
        </nz-row>
        <nz-row nzGutter="16">
          <nz-radio-group
            style="width: 100%; display: inline-flex"
            name="selectedPasswordOrSSHkey"
          >
            <nz-col nzXs="24" nzMd="12" nzLg="12">
              <nz-card
                style="border-radius: 4px"
                [ngStyle]="{
                  border: activeBlockPassword
                    ? '1px solid #0066B3'
                    : '1px solid #DADADA'
                }"
              >
                <nz-card-meta
                  [nzAvatar]="nzAvatarselectedPasswordOrSSHkey1"
                  [nzTitle]="nzTitleselectedPasswordOrSSHkey1"
                  [nzDescription]="nzDescriptionselectedPasswordOrSSHkey1"
                >
                  <ng-template #nzAvatarselectedPasswordOrSSHkey1>
                    <label
                      [tabIndex]="0"
                      nz-radio
                      [ngModel]="activeBlockPassword"
                      [ngModelOptions]="{ standalone: true }"
                      (click)="initPassword()"
                      (keyup.enter)="initPassword()"
                    ></label>
                  </ng-template>
                  <ng-template #nzTitleselectedPasswordOrSSHkey1>
                    <b>{{ 'app.password' | i18n }} </b>
                  </ng-template>
                  <ng-template #nzDescriptionselectedPasswordOrSSHkey1>
                    <ellipsis class="text-custom">
                      {{ 'app.password.intro.text' | i18n }}</ellipsis
                    >
                  </ng-template>
                </nz-card-meta>
              </nz-card>
            </nz-col>
            <nz-col nzXs="24" nzMd="12" nzLg="12">
              <nz-card
                style="border-radius: 4px"
                [ngStyle]="{
                  border: activeBlockSSHKey
                    ? '1px solid #0066B3'
                    : '1px solid #DADADA'
                }"
              >
                <nz-card-meta
                  [nzAvatar]="nzAvatarselectedPasswordOrSSHkey2"
                  [nzTitle]="nzTitleselectedPasswordOrSSHkey2"
                  [nzDescription]="nzDescriptionselectedPasswordOrSSHkey2"
                >
                  <ng-template #nzAvatarselectedPasswordOrSSHkey2>
                    <label
                      [tabIndex]="0"
                      nz-radio
                      [ngModel]="activeBlockSSHKey"
                      [ngModelOptions]="{ standalone: true }"
                      (click)="initSSHkey()"
                      (keyup.enter)="initSSHkey()"
                      [disabled]="disableKeypair"
                    ></label>
                  </ng-template>
                  <ng-template #nzTitleselectedPasswordOrSSHkey2>
                    <b>Keypair</b>
                  </ng-template>
                  <ng-template #nzDescriptionselectedPasswordOrSSHkey2>
                    <ellipsis class="text-custom">
                      {{ 'app.keypair.intro.text' | i18n }}</ellipsis
                    >
                  </ng-template>
                </nz-card-meta>
              </nz-card>
            </nz-col>
          </nz-radio-group>
          <div *ngIf="activeBlockPassword" style="width: 100%">
            <nz-col nzSpan="24">
              <nz-form-item>
                <nz-form-label nzFor="name"
                  >{{ 'app.label.instance.password' | i18n }} (<span
                    class="text-red"
                    >*</span
                  >)</nz-form-label
                >
                <nz-form-control [nzErrorTip]="passwordErrorTpl">
                  <nz-input-group
                    [nzSuffix]="suffixTemplate"
                    style="width: 100%"
                  >
                    <input
                      class="input-custom"
                      [type]="passwordVisible ? 'text' : 'password'"
                      nz-input
                      [placeholder]="'app.input.password' | i18n"
                      formControlName="passOrKeyFormControl"
                      [(ngModel)]="password"
                    />
                  </nz-input-group>
                  <ng-template #suffixTemplate>
                    <img
                      style="margin-top: -4px"
                      [src]="
                        passwordVisible
                          ? 'assets/imgs/eye-close.svg'
                          : 'assets/imgs/eye1.svg'
                      "
                      alt=""
                      (click)="passwordVisible = !passwordVisible"
                    />
                  </ng-template>
                </nz-form-control>
                <ng-template #passwordErrorTpl let-control>
                  <ng-container *ngIf="control.hasError('required')">{{
                    'validation.instance.password.required' | i18n
                  }}</ng-container>
                  <ng-container *ngIf="control.hasError('pattern')">{{
                    'validation.password.pattern' | i18n
                  }}</ng-container>
                </ng-template>
              </nz-form-item>
            </nz-col>

            <nz-col nzSpan="24">
              <nz-alert
                nzType="warning"
                [nzDescription]="nzDescriptionWarning06"
                nzShowIcon
              ></nz-alert>
              <ng-template #nzDescriptionWarning06>
                <div>
                  {{ 'app.alert.password' | i18n }}
                </div>
              </ng-template>
            </nz-col>
          </div>
          <div *ngIf="activeBlockSSHKey" style="width: 100%">
            <nz-col nzSpan="24">
              <nz-form-item>
                <nz-form-label
                  >{{ 'app.choose.keypair' | i18n }} (<span class="text-red"
                    >*</span
                  >)</nz-form-label
                >
                <nz-form-control [nzErrorTip]="keypairErrorTpl">
                  <nz-select
                    *ngIf="activeBlockSSHKey"
                    [nzPlaceHolder]="
                      '-- ' + ('app.choose.keypair' | i18n) + ' --'
                    "
                    [nzShowSearch]="true"
                    formControlName="passOrKeyFormControl"
                    [(ngModel)]="selectedSSHKeyName"
                    nzSize="large"
                  >
                    <nz-option
                      *ngFor="let i of listSSHKey"
                      [nzLabel]="i.displayName"
                      [nzValue]="i.displayName"
                    />
                  </nz-select>
                </nz-form-control>
                <ng-template #keypairErrorTpl let-control>
                  <ng-container *ngIf="control.hasError('required')">{{
                    'validation.choose.required' | i18n : { name: 'keypair' }
                  }}</ng-container>
                </ng-template>
              </nz-form-item>
            </nz-col>
            <nz-form-label style="margin-bottom: 20px">
              {{ 'app.instances.keypair.label' | i18n }}&nbsp;
              <a [routerLink]="['/app-smart-cloud/keypair']">{{
                'app.label.create' | i18n
              }}</a>
            </nz-form-label>
            <nz-col nzSpan="24">
              <nz-alert
                nzType="warning"
                [nzDescription]="nzDescriptionWarning07"
                nzShowIcon
              ></nz-alert>
              <ng-template #nzDescriptionWarning07>
                <div>
                  {{ 'app.alert.keypair' | i18n }}
                  <a
                    href="https://docs.smartcloud.vn/index.php/knowledge-base/su-dung-keypair/"
                    target="_blank"
                    >{{ 'app.here' | i18n }}
                  </a>
                  <br />
                  {{ 'app.alert.keypair.next' | i18n }}
                </div>
              </ng-template>
            </nz-col>
          </div>
        </nz-row>
      </nz-card>
    </form>
  </div>
  <div nz-col [nzSpan]="8" style="display: flex">
    <div style="width: 100%">
      <nz-affix [nzOffsetTop]="72">
        <nz-card class="card-border" style="border-radius: 8px; width: 100%">
          <div style="margin-bottom: 20px">
            <span class="text-card-header">{{
              'app.config.parameters' | i18n
            }}</span>
          </div>
          <div class="text-value">{{ 'app.instances.name' | i18n }}</div>
          <div style="margin-top: 10px" class="text-label">
            {{ instanceCreate.serviceName }}
          </div>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <div *ngIf="!isSnapshot" class="text-value">
            {{ 'app.instances.OS' | i18n }}
          </div>
          <div *ngIf="!isSnapshot" style="margin-top: 10px" class="text-label">
            {{ nameImage }}
          </div>
          <div *ngIf="isSnapshot" class="text-value">Snapshot</div>
          <div *ngIf="isSnapshot" style="margin-top: 10px" class="text-label">
            {{ nameSnapshot }}
          </div>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <div class="text-value">{{ 'app.text.package' | i18n }}</div>
          <div style="margin-top: 10px" class="text-label">
            {{ instanceCreate.cpu }} vCPU
          </div>
          <div style="margin-top: 10px" class="text-label">
            {{ instanceCreate.ram }} GB RAM
          </div>
          <div style="margin-top: 10px" class="text-label">
            {{ instanceCreate.volumeSize }} GB Root Disk (<span>{{
              activeBlockHDD ? 'HDD' : 'SSD'
            }}</span
            >)
          </div>
          <div *ngIf="isGpuConfig" style="margin-top: 10px" class="text-label">
            {{ instanceCreate.gpuCount }} GPU ({{ gpuTypeName }})
          </div>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <nz-row>
            <nz-col style="width: 100%">
              <button
                style="width: 100%"
                nz-button
                nzSize="large"
                nzType="primary"
                [nzLoading]="isLoading"
                (click)="showModalCreate()"
                [disabled]="form.invalid || isExistName || !isValid"
              >
                <span nz-icon nzType="wallet" nzTheme="outline"></span>
                <span
                  [style.color]="
                    form.invalid || isExistName || !isValid ? 'gray' : 'white'
                  "
                  >{{ 'app.button.create' | i18n }}</span
                >
              </button>
            </nz-col>
          </nz-row>
        </nz-card>
      </nz-affix>
    </div>
  </div>
</div>

<nz-modal
  [(nzVisible)]="isVisibleCreate"
  [nzTitle]="'app.instances.create.confirm' | i18n"
  (nzOnCancel)="handleCancelCreate()"
>
  <div *nzModalContent>
    {{ 'app.alert.create.vpc.instance' | i18n }}<br />•
    {{ 'app.instances.name' | i18n }}: {{ instanceCreate.serviceName }}<br />•
    {{ 'app.instances.OS' | i18n }}: {{ nameImage }}<br />•
    {{ 'app.configuration.package' | i18n }}: {{ instanceCreate.cpu }} vCPU /
    {{ instanceCreate.ram }}GB RAM / {{ instanceCreate.volumeSize }}GB
    {{ activeBlockHDD ? 'HDD' : 'SSD'
    }}<span *ngIf="isGpuConfig">
      / {{ instanceCreate.gpuCount }} GPU ({{ gpuTypeName }})
    </span>
  </div>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelCreate()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button nz-button nzType="primary" (click)="handleOkCreate()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />{{ 'app.button.confirm' | i18n }}
    </button>
  </div>
</nz-modal>
<one-portal-popup-list-error
  [isVisible]="isVisiblePopupError"
  [errorList]="errorList"
  (onCancel)="closePopupError()"
></one-portal-popup-list-error>
