<page-header [breadcrumb]="breadcrumb" [action]="action" [title]="'Tạo máy ảo'">
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">Home</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/app-smart-cloud/instances']">Quản lý máy ảo</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item> Tạo máy ảo</nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <region-select-dropdown
        (valueChanged)="onRegionChange($event)"
      ></region-select-dropdown>
      <project-select-dropdown
        [regionId]="region"
        (valueChanged)="onProjectChange($event)"
      ></project-select-dropdown>
    </div>
  </ng-template>
</page-header>

<form nz-form [formGroup]="form" [nzLayout]="'vertical'">
  <nz-card [nzBordered]="false">
    <div style="margin-bottom: 20px">
      <span class="table-title">Thông tin máy ảo</span>
    </div>
    <nz-row nzGutter="16">
      <nz-col nzLg="24" nzMd="12" nzSm="24">
        <nz-form-item>
          <nz-form-label nzFor="name"
            >Tên máy ảo (<span class="text-red">*</span>)</nz-form-label
          >
          <nz-form-control nzDisableAutoTips [nzErrorTip]="nameErrorTpl">
            <input
              nz-input
              formControlName="name"
              [(ngModel)]="instanceCreate.serviceName"
              id="name"
              placeholder="Nhập tên máy ảo"
              maxlength="50"
              minlength="1"
              (change)="
                instanceCreate.serviceName = instanceCreate.serviceName.trim()
              "
            />
            <ng-template #nameErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')"
                >Vui lòng nhập thông tin</ng-container
              >
              <ng-container *ngIf="control.hasError('pattern')"
                >Tên gồm 50 ký tự viết liền không dấu cách và không chứa ký tự
                đặc biệt</ng-container
              >
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </nz-col>
      <nz-col nzLg="24" nzMd="12" nzSm="24">
        <nz-form-item>
          <nz-form-control>
            <nz-switch
              nzSize="small"
              [(ngModel)]="isSnapshot"
              [ngModelOptions]="{ standalone: true }"
              (ngModelChange)="initSnapshot()"
            ></nz-switch>
            <label nzFor="name" style="text-align: right; padding-left: 1%"
              >Tạo từ Snapshot</label
            >
          </nz-form-control>
        </nz-form-item>
      </nz-col>
    </nz-row>
    <div *ngIf="isSnapshot">
      <nz-col nzLg="24" nzMd="12" nzSm="24">
        <nz-form-item>
          <nz-form-label nzFor="name">Chọn Snapshot</nz-form-label>
          <nz-form-control nzErrorTip="Vui lòng Chọn Snapshot">
            <nz-select
              [nzPlaceHolder]="'--Chọn Snapshot--'"
              [nzShowSearch]="true"
              [(ngModel)]="selectedSnapshot"
              [ngModelOptions]="{ standalone: true }"
              (ngModelChange)="onChangeSnapshot($event)"
            >
              <nz-option
                *ngFor="let i of listSnapshot"
                [nzLabel]="i.name"
                [nzValue]="i.id"
              />
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </nz-col>
    </div>
    <div *ngIf="!isSnapshot">
      <nz-form-label
        >Hệ điều hành (<span class="text-red">*</span>)</nz-form-label
      >
      <ngu-carousel
        #myCarouselImage
        [inputs]="carouselTileConfig"
        [dataSource]="listImageTypes"
      >
        <ngu-tile
          *nguCarouselDef="let data; index as i; let ani = animate"
          [@slider]="ani"
        >
          <table class="text-center" style="width: 100%">
            <tbody
              class="images-body"
              [id]="'images_' + data.id"
              [ngClass]="{
                'images-body-active': data.id === selectedImageTypeId,
                bgGray: !data.id === selectedImageTypeId
              }"
            >
              <tr>
                <img
                  *ngIf="data.name == 'Linux'"
                  src="assets/imgs/ubuntu.png"
                  alt=""
                />
                <img
                  *ngIf="data.name == 'Windows'"
                  src="assets/imgs/window.png"
                  alt=""
                />
              </tr>
              <tr>
                <div style="margin-top: 15px; margin-bottom: 15px">
                  <nz-select
                    nzShowSearch
                    [id]="'hdh_' + data.id"
                    [(ngModel)]="listSelectedImage[i]"
                    (ngModelChange)="onInputHDH($event, i, data.id)"
                    nzPlaceHolder="Chọn phiên bản"
                    [ngModelOptions]="{ standalone: true }"
                    style="text-align: center; width: 150px"
                  >
                    <nz-option
                      *ngFor="let p of listOfImageByImageType.get(data.id)"
                      [nzValue]="p.id"
                      [nzLabel]="p.name"
                    ></nz-option>
                  </nz-select>
                </div>
              </tr>
            </tbody>
          </table>
        </ngu-tile>

        <ul class="myPoint" NguCarouselPoint>
          <li
            *ngFor="let i of myCarouselImage.pointNumbers"
            [class.active]="i === myCarouselImage.activePoint"
            (click)="myCarouselImage.moveTo(i)"
          ></li>
        </ul>
      </ngu-carousel>
    </div>

    <br />
    <nz-row nzGutter="16">
      <nz-form-label
        >Chọn loại Volume (<span class="text-red">*</span>)</nz-form-label
      >
    </nz-row>
    <nz-row nzGutter="16">
      <nz-radio-group
        style="width: 100%; display: inline-flex"
        name="selectedHDDorSSD"
      >
        <nz-col nzXs="24" nzMd="12">
          <nz-card
            style="border-radius: 4px"
            [nzAlign]="'middle'"
            [ngStyle]="{
                border: activeBlockHDD
              ? '1px solid #035DED'
              : '1px solid #DADADA',
            }"
          >
            <nz-card-meta
              [nzAvatar]="nzAvatarselectedHDDorSSD1"
              [nzTitle]="nzTitleselectedHDDorSSD1"
              [nzDescription]="nzDescriptionselectedHDDorSSD1"
            >
              <ng-template #nzAvatarselectedHDDorSSD1>
                <input
                  style="cursor: pointer"
                  type="radio"
                  [checked]="activeBlockHDD"
                  (click)="initHDD()"
                />
              </ng-template>
              <ng-template #nzTitleselectedHDDorSSD1>
                <b>HDD</b>
              </ng-template>
              <ng-template #nzDescriptionselectedHDDorSSD1>
                <ellipsis class="text-custom">
                  Lựa chọn tốt hơn nếu bạn đang đối phó với các bản sao lưu dữ
                  liệu,<br />
                  lưu trữ dữ liệu hoặc khối lượng công việc chuyên sâu thông
                  lượng
                </ellipsis>
              </ng-template>
            </nz-card-meta>
          </nz-card>
        </nz-col>
        <nz-col nzXs="24" nzMd="12">
          <nz-card
            style="border-radius: 4px"
            [nzAlign]="'middle'"
            [ngStyle]="{
              border: activeBlockSSD
              ? '1px solid #035DED'
              : '1px solid #DADADA',
            }"
          >
            <nz-card-meta
              [nzAvatar]="nzAvatarselectedHDDorSSD2"
              [nzTitle]="nzTitleselectedHDDorSSD2"
              [nzDescription]="nzDescriptionselectedHDDorSSD2"
            >
              <ng-template #nzAvatarselectedHDDorSSD2>
                <input
                  type="radio"
                  style="cursor: pointer"
                  [checked]="activeBlockSSD"
                  (click)="initSSD()"
                />
              </ng-template>
              <ng-template #nzTitleselectedHDDorSSD2>
                <b>SSD</b>
              </ng-template>
              <ng-template #nzDescriptionselectedHDDorSSD2>
                <ellipsis class="text-custom"
                  >Lựa chọn tốt hơn cho khối lượng công việc phân tích dữ liệu
                  hoặc <br />
                  chơi game
                </ellipsis>
              </ng-template>
            </nz-card-meta>
          </nz-card>
        </nz-col>
      </nz-radio-group>
    </nz-row>
    <nz-row nzGutter="24">
      <nz-col nzLg="8" nzMd="8" nzSm="24">
        <nz-form-label style="margin-left: -12px"
          >Dung lượng (<span class="text-red">*</span>) - GB</nz-form-label
        >
        <nz-row>
          <nz-col nzSpan="18">
            <nz-slider [nzMin]="1" [nzMax]="500"></nz-slider>
          </nz-col>
          <div nzSpan="6">
            <nz-input-number [nzMin]="1" [nzMax]="20"></nz-input-number>
          </div>
        </nz-row>
      </nz-col>
      <nz-col nzLg="8" nzMd="8" nzSm="24">
        <nz-form-label style="margin-left: -12px"
          >RAM (<span class="text-red">*</span>) - GB</nz-form-label
        >
        <nz-row>
          <nz-col nzSpan="18">
            <nz-slider [nzMin]="1" [nzMax]="20"></nz-slider>
          </nz-col>
          <div nzSpan="6">
            <nz-input-number [nzMin]="1" [nzMax]="20"></nz-input-number>
          </div>
        </nz-row>
      </nz-col>
      <nz-col nzLg="8" nzMd="8" nzSm="24">
        <nz-form-label style="margin-left: -12px"
          >CPU (<span class="text-red">*</span>) - vCPU</nz-form-label
        >
        <nz-row>
          <nz-col nzSpan="18">
            <nz-slider [nzMin]="1" [nzMax]="20"></nz-slider>
          </nz-col>
          <div nzSpan="6">
            <nz-input-number [nzMin]="1" [nzMax]="20"></nz-input-number>
          </div>
        </nz-row>
      </nz-col>
    </nz-row>
    <nz-row style="margin-top: 20px; margin-bottom: 20px"
      ><div style="margin-right: 20px">IOPS: 200</div>
      <div>
        <label
          nz-checkbox
          [(ngModel)]="isEncryptVolume"
          [ngModelOptions]="{ standalone: true }"
          >Mã hóa Volume</label
        >
      </div></nz-row
    >
    <nz-row nzGutter="16">
      <nz-col nzLg="12" nzMd="12" nzSm="24">
        <nz-form-item>
          <nz-form-label
            >Chọn IP Public (<span class="text-red">*</span>)</nz-form-label
          >
          <nz-form-control nzErrorTip="Chọn IP Public *">
            <nz-select
              [nzPlaceHolder]="'Mặc định'"
              [nzShowSearch]="true"
              [(ngModel)]="ipPublicValue"
              [ngModelOptions]="{ standalone: true }"
            >
              <nz-option nzLabel="Mặc định" nzValue="" />
              <nz-option
                *ngFor="let i of listIPPublic"
                [nzLabel]="i.ipAddress || i.networkId"
                [nzValue]="i.id"
              />
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        <div>
          <label
            nz-checkbox
            [(ngModel)]="isUseLAN"
            [ngModelOptions]="{ standalone: true }"
            >Sử dụng mạng LAN</label
          >
        </div>
      </nz-col>
      <nz-col nzLg="12" nzMd="12" nzSm="24">
        <nz-form-item>
          <nz-form-label>Chọn Security Group</nz-form-label>
          <nz-form-control>
            <nz-select
              nzMode="multiple"
              nzPlaceHolder="Chọn Security Group"
              [ngModelOptions]="{ standalone: true }"
              [(ngModel)]="selectedSecurityGroup"
              [nzServerSearch]="true"
            >
              <nz-option
                *ngFor="let i of listSecurityGroup"
                [nzLabel]="i.name"
                [nzValue]="i.name"
              />
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        <div>
          <nz-alert
            nzType="warning"
            [nzMessage]="nzDescriptionWarning3"
            nzShowIcon
          ></nz-alert>
          <ng-template #nzDescriptionWarning3>
            <div>
              Để thiết lập các cơ chế truy cập vào máy ảo, Quý khách cần cấu
              hình Security Group <br />
              trong mục <u><a>Truy cập và Bảo mật</a></u>
            </div>
          </ng-template>
        </div>
      </nz-col>
    </nz-row>
    <nz-col nzLg="24" nzMd="12" nzSm="24">
      <nz-form-label nzFor="name"
        >Chọn phương thức truy cập máy ảo (<span class="text-red">*</span
        >)</nz-form-label
      >
    </nz-col>
    <nz-row nzGutter="16">
      <nz-radio-group
        style="width: 100%; display: inline-flex"
        name="selectedPasswordOrSSHkey"
      >
        <nz-col nzXs="24" nzMd="12">
          <nz-card
            [ngStyle]="{
              'background-color': activeBlockPassword ? '#e6f7ff' : '#fcfcfc'
            }"
          >
            <nz-card-meta
              [nzAvatar]="nzAvatarselectedPasswordOrSSHkey1"
              [nzTitle]="nzTitleselectedPasswordOrSSHkey1"
              [nzDescription]="nzDescriptionselectedPasswordOrSSHkey1"
            >
              <ng-template #nzAvatarselectedPasswordOrSSHkey1>
                <input
                  type="radio"
                  [checked]="activeBlockPassword"
                  (click)="initPassword()"
                />
              </ng-template>
              <ng-template #nzTitleselectedPasswordOrSSHkey1>
                <b>Mật khẩu</b>
              </ng-template>
              <ng-template #nzDescriptionselectedPasswordOrSSHkey1>
                <ellipsis> Thuận tiện cho người dùng</ellipsis>
              </ng-template>
            </nz-card-meta>
          </nz-card>
        </nz-col>
        <nz-col nzXs="24" nzMd="12">
          <nz-card
            [ngStyle]="{
              'background-color': activeBlockSSHKey ? '#e6f7ff' : '#fcfcfc'
            }"
          >
            <nz-card-meta
              [nzAvatar]="nzAvatarselectedPasswordOrSSHkey2"
              [nzTitle]="nzTitleselectedPasswordOrSSHkey2"
              [nzDescription]="nzDescriptionselectedPasswordOrSSHkey2"
            >
              <ng-template #nzAvatarselectedPasswordOrSSHkey2>
                <input
                  type="radio"
                  [checked]="activeBlockSSHKey"
                  (click)="initSSHkey()"
                />
              </ng-template>
              <ng-template #nzTitleselectedPasswordOrSSHkey2>
                <b>SSH key</b>
              </ng-template>
              <ng-template #nzDescriptionselectedPasswordOrSSHkey2>
                <ellipsis> Tăng tính bảo mật khi đăng nhập</ellipsis>
              </ng-template>
            </nz-card-meta>
          </nz-card>
        </nz-col>
      </nz-radio-group>
      <div *ngIf="activeBlockPassword" style="width: 100%">
        <nz-col nzLg="24" nzMd="12" nzSm="24">
          <nz-form-item>
            <nz-form-label nzFor="name"
              >Mật khẩu truy cập máy ảo (<span class="text-red">*</span
              >)</nz-form-label
            >
            <nz-form-control
              nzErrorTip="Vui lòng nhập mật khẩu truy cập máy ảo"
            >
              <nz-input-group [nzSuffix]="suffixTemplate" style="width: 100%">
                <input
                  [type]="passwordVisible ? 'text' : 'password'"
                  nz-input
                  placeholder="input password"
                  [(ngModel)]="password"
                  [ngModelOptions]="{ standalone: true }"
                />
              </nz-input-group>
              <ng-template #suffixTemplate>
                <i
                  nz-icon
                  [nzType]="'eye'"
                  (click)="passwordVisible = !passwordVisible"
                ></i>
              </ng-template>
            </nz-form-control>
          </nz-form-item>
        </nz-col>

        <nz-col nzLg="24" nzMd="12" nzSm="24">
          <nz-alert
            nzType="warning"
            [nzMessage]="nzDescriptionWarning06"
            nzShowIcon
          ></nz-alert>
          <ng-template #nzDescriptionWarning06>
            <div>
              Quy tắc đặt mật khẩu: Độ dài của một mật khẩu được sử dụng trực
              tuyến cần phải chứa tối thiểu là 12 ký tự, sử dụng hỗn hợp bao gồm
              các chữ số, chữ hoa, chữ thường và ký hiệu đặc biệt.
            </div>
          </ng-template>
        </nz-col>
      </div>
      <div *ngIf="activeBlockSSHKey" style="width: 100%">
        <nz-col nzLg="24" nzMd="12" nzSm="24">
          <nz-form-item>
            <nz-form-label
              >Chọn SSH key (<span class="text-red">*</span>)</nz-form-label
            >
            <nz-form-control nzErrorTip="Chọn  *">
              <nz-select
                [nzPlaceHolder]="'--Chọn SSH key--'"
                [nzShowSearch]="true"
                [ngModelOptions]="{ standalone: true }"
                [(ngModel)]="selectedSSHKeyName"
                (ngModelChange)="onSSHKeyChange($event)"
              >
                <nz-option
                  *ngFor="let i of listSSHKey"
                  [nzLabel]="i.displayName"
                  [nzValue]="i.displayName"
                />
              </nz-select>
            </nz-form-control>
            <div>Lựa chọn keypair có sẵn hoặc <a>Tạo mới</a></div>
          </nz-form-item>
        </nz-col>

        <nz-col nzLg="24" nzMd="12" nzSm="24">
          <nz-alert
            nzType="warning"
            [nzMessage]="nzDescriptionWarning07"
            nzShowIcon
          ></nz-alert>
          <ng-template #nzDescriptionWarning07>
            <div>
              Chúng tôi khuyến cáo sử dụng SSH Key để đảm an toàn bảo mật cho
              máy chủ của quý khách. Thông tin hướng dẫn sử dụng về SSH key cho
              máy chủ có thể xem tại đây.
              <br />
              Mật khẩu đăng nhập vào máy chủ sẽ được tạo tự động và gửi vào
              email của quý khách khi máy chủ được tạo thành công
            </div>
          </ng-template>
        </nz-col>
      </div>
    </nz-row>
  </nz-card>

  <div style="float: right; padding-top: 1%">
    <button nz-button nzType="default" (click)="cancel()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />Hủy
    </button>
    <button
      nz-button
      nzType="primary"
      [disabled]="form.invalid"
      (click)="save()"
    >
      Tạo máy ảo
    </button>
  </div>
</form>
