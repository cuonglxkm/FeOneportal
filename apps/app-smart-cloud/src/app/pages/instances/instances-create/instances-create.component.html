<page-header
  [breadcrumb]="breadcrumb"
  [action]="action"
  [title]="'app.instances.create' | i18n"
>
  <ng-template #breadcrumb>
    <nz-breadcrumb [nzSeparator]="separatorTemplate">
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">{{ 'app.breadcrumb.home' | i18n }}</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/app-smart-cloud/instances']">{{
          'app.instances' | i18n
        }}</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>{{
        'app.instances.create' | i18n
      }}</nz-breadcrumb-item>
    </nz-breadcrumb>
    <ng-template #separatorTemplate
      ><img src="assets/imgs/arrow-square-right.svg" alt="" />
    </ng-template>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <share-users-combobox></share-users-combobox>
      <region-select-dropdown
        (valueChanged)="onRegionChange($event)"
      ></region-select-dropdown>
      <project-select-dropdown
        [regionId]="region"
        (userChanged)="userChangeProject()"
      ></project-select-dropdown>
    </div>
  </ng-template>
</page-header>
<div nz-row [nzGutter]="24">
  <div nz-col [nzSpan]="16" style="display: flex">
    <form nz-form [formGroup]="form" [nzLayout]="'vertical'">
      <nz-card style="border-radius: 8px" [nzBordered]="false">
        <div style="margin-bottom: 20px">
          <span class="text-card-header">{{
            'app.instances.info' | i18n
          }}</span>
        </div>
        <nz-row nzGutter="16">
          <nz-col nzSpan="24">
            <nz-form-item>
              <nz-form-label nzFor="name"
                >{{ 'app.instances.name' | i18n }} (<span class="text-red"
                  >*</span
                >)<img
                  style="margin-left: 10px"
                  [nz-tooltip]="'app.tooltip.instance.name' | i18n"
                  src="assets/imgs/pajamas_question.svg"
                  alt=""
              /></nz-form-label>

              <nz-form-control nzDisableAutoTips [nzErrorTip]="nameErrorTpl">
                <nz-row>
                  <nz-col nzSpan="12">
                    <input
                      #nameInput
                      class="input-custom"
                      nz-input
                      formControlName="name"
                      [(ngModel)]="instanceCreate.serviceName"
                      (ngModelChange)="changeName($event)"
                      [placeholder]="'app.input.name' | i18n"
                      [maxlength]="50"
                    />
                  </nz-col>
                  <nz-col
                    style="display: flex; align-items: center"
                    nzSpan="12"
                  >
                    <nz-switch
                      style="margin-left: 20px"
                      nzSize="small"
                      [(ngModel)]="isSnapshot"
                      [ngModelOptions]="{ standalone: true }"
                      (ngModelChange)="initSnapshot()"
                    ></nz-switch>
                    <label
                      class="text-label"
                      nzFor="name"
                      style="text-align: right; padding-left: 1%"
                      >{{ 'app.instances.from.snapshot' | i18n }}
                      <img
                        style="margin-left: 10px"
                        [nz-tooltip]="
                          'app.tooltip.instances.from.snapshot' | i18n
                        "
                        src="assets/imgs/pajamas_question.svg"
                        alt=""
                    /></label>
                  </nz-col>
                </nz-row>
                <div *ngIf="isExistName" style="color: #ff4d4f">
                  {{ 'validation.exist.instance.name' | i18n }}
                </div>
                <ng-template #nameErrorTpl let-control>
                  <ng-container *ngIf="control.hasError('required')">{{
                    'validation.info.required' | i18n
                  }}</ng-container>
                  <ng-container *ngIf="control.hasError('pattern')">{{
                    'validation.name.pattern' | i18n
                  }}</ng-container>
                </ng-template>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <div *ngIf="isSnapshot">
          <nz-form-item>
            <nz-form-label nzFor="name"
              >{{ 'app.choose.snapshot' | i18n }} (<span class="text-red"
                >*</span
              >)</nz-form-label
            >
            <nz-form-control nzErrorTip="Vui lòng Chọn Snapshot">
              <nz-select
                [nzPlaceHolder]="'-- ' + ('app.choose.snapshot' | i18n) + ' --'"
                [nzShowSearch]="true"
                [(ngModel)]="selectedSnapshot"
                [ngModelOptions]="{ standalone: true }"
                nzSize="large"
              >
                <nz-option
                  *ngFor="let i of listSnapshot"
                  [nzLabel]="i.name"
                  [nzValue]="i.id"
                />
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div style="margin-left: -10px" *ngIf="!isSnapshot">
          <nz-form-label
            >{{ 'app.instances.OS' | i18n }} (<span class="text-red">*</span
            >)<img
              style="margin-left: 10px"
              [nz-tooltip]="'app.tooltip.instance.OS' | i18n"
              src="assets/imgs/pajamas_question.svg"
              alt=""
          /></nz-form-label>
          <ngu-carousel
            #myCarouselImage
            [inputs]="carouselTileConfig"
            [dataSource]="listImageTypes"
          >
            <ngu-tile
              *nguCarouselDef="let data; index as i; let ani = animate"
              [@slider]="ani"
            >
              <div
                class="images-body"
                [id]="'images_' + data.id"
                [ngClass]="{
                  'images-body-active': data.id === selectedImageTypeId,
                  bgGray: !data.id === selectedImageTypeId
                }"
              >
                <nz-row>
                  <nz-col class="text-center" style="width: 100%">
                    <img
                      *ngIf="data.name == 'Linux'"
                      src="assets/imgs/ubuntu.png"
                      alt=""
                    />
                    <img
                      *ngIf="data.name == 'Windows'"
                      src="assets/imgs/window.png"
                      alt=""
                    />
                  </nz-col>
                </nz-row>
                <nz-row>
                  <nz-col class="text-center" style="width: 100%">
                    <div style="margin-top: 15px; margin-bottom: 15px">
                      <nz-select
                        nzShowSearch
                        [id]="'hdh_' + data.id"
                        [(ngModel)]="listSelectedImage[i]"
                        (ngModelChange)="
                          onInputHDH($event, i, data.id, data.uniqueKey)
                        "
                        [nzPlaceHolder]="'app.button.choose.version' | i18n"
                        [ngModelOptions]="{ standalone: true }"
                        style="text-align: center; width: 155px"
                      >
                        <nz-option
                          *ngFor="let p of listOfImageByImageType.get(data.id)"
                          [nzValue]="p.id"
                          [nzLabel]="p.name"
                        ></nz-option>
                      </nz-select>
                    </div>
                  </nz-col>
                </nz-row>
              </div>
            </ngu-tile>

            <ul class="myPoint" NguCarouselPoint>
              <li
                *ngFor="let i of myCarouselImage.pointNumbers"
                [class.active]="i === myCarouselImage.activePoint"
                (click)="myCarouselImage.moveTo(i)"
              ></li>
            </ul>
          </ngu-carousel>
        </div>

        <br />
        <nz-row nzGutter="16">
          <nz-form-label
            >{{ 'app.choose.volume.type' | i18n }} (<span class="text-red"
              >*</span
            >)<img
              style="margin-left: 10px"
              [nz-tooltip]="'app.tooltip.volume.type' | i18n"
              src="assets/imgs/pajamas_question.svg"
              alt=""
          /></nz-form-label>
        </nz-row>
        <nz-radio-group
          style="width: 100%; display: inline-flex"
          name="selectedHDDorSSD"
        >
          <nz-row
            [nzGutter]="{ xs: 24, sm: 24, md: 24, lg: 24 }"
            style="margin-top: 10px"
            ><nz-col
              [nzLg]="12"
              [nzMd]="12"
              [nzSm]="24"
              [nzXl]="12"
              [nzXs]="24"
            >
              <nz-card
                style="border-radius: 4px"
                [nzAlign]="'middle'"
                [ngStyle]="{
                      border: activeBlockHDD
                    ? '1px solid #0066B3'
                    : '1px solid #DADADA',
                    height: cardHeight,
                  }"
              >
                <nz-row nzGutter="16">
                  <nz-col nzSpan="20">
                    <nz-card-meta
                      [nzAvatar]="nzAvatarselectedHDDorSSD1"
                      [nzTitle]="nzTitleselectedHDDorSSD1"
                      [nzDescription]="nzDescriptionselectedHDDorSSD1"
                    >
                      <ng-template #nzAvatarselectedHDDorSSD1>
                        <label
                          [tabIndex]="0"
                          nz-radio
                          [ngModel]="activeBlockHDD"
                          [ngModelOptions]="{ standalone: true }"
                          (click)="initHDD()"
                          (keyup.enter)="initHDD()"
                          [disabled]="disableHDD"
                        ></label>
                      </ng-template>
                      <ng-template #nzTitleselectedHDDorSSD1>
                        <b>HDD</b>
                      </ng-template>
                      <ng-template #nzDescriptionselectedHDDorSSD1>
                        <ellipsis class="text-custom">
                          {{ 'app.hdd.intro.text' | i18n }}
                        </ellipsis>
                      </ng-template>
                    </nz-card-meta></nz-col
                  >
                  <nz-col
                    style="
                      display: flex;
                      align-items: center;
                      margin-top: -24px;
                    "
                    [ngStyle]="{
                        height: cardHeight,
                      }"
                    nzSpan="4"
                  >
                    <img
                      [src]="
                        activeBlockHDD
                          ? 'assets/imgs/hdd-svgrepo-com-active.svg'
                          : 'assets/imgs/hdd-svgrepo-com.svg'
                      "
                      alt=""
                    />
                  </nz-col>
                </nz-row>
              </nz-card>
            </nz-col>
            <nz-col [nzLg]="12" [nzMd]="12" [nzSm]="24" [nzXl]="12" [nzXs]="24">
              <nz-card
                style="border-radius: 4px"
                [nzAlign]="'middle'"
                [ngStyle]="{
                    border: activeBlockSSD
                    ? '1px solid #0066B3'
                    : '1px solid #DADADA',
                    height: cardHeight,
                  }"
              >
                <nz-row nzGutter="16">
                  <nz-col nzSpan="20"
                    ><nz-card-meta
                      [nzAvatar]="nzAvatarselectedHDDorSSD2"
                      [nzTitle]="nzTitleselectedHDDorSSD2"
                      [nzDescription]="nzDescriptionselectedHDDorSSD2"
                    >
                      <ng-template #nzAvatarselectedHDDorSSD2>
                        <label
                          [tabIndex]="0"
                          nz-radio
                          [ngModel]="activeBlockSSD"
                          [ngModelOptions]="{ standalone: true }"
                          (click)="initSSD()"
                          (keyup.enter)="initSSD()"
                        ></label>
                      </ng-template>
                      <ng-template #nzTitleselectedHDDorSSD2>
                        <b>SSD</b>
                      </ng-template>
                      <ng-template #nzDescriptionselectedHDDorSSD2>
                        <ellipsis class="text-custom">
                          {{ 'app.ssd.intro.text' | i18n }}
                        </ellipsis>
                      </ng-template>
                    </nz-card-meta>
                  </nz-col>
                  <nz-col
                    style="
                      display: flex;
                      align-items: center;
                      margin-top: -24px;
                    "
                    [ngStyle]="{
                          height: cardHeight,
                        }"
                    nzSpan="4"
                  >
                    <img
                      [src]="
                        activeBlockSSD
                          ? 'assets/imgs/ssd-svgrepo-com-active.svg'
                          : 'assets/imgs/ssd-svgrepo-com.svg'
                      "
                      alt=""
                    />
                  </nz-col>
                </nz-row>
              </nz-card> </nz-col
          ></nz-row>
        </nz-radio-group>

        <nz-tabset
          nzCentered
          nzSize="large"
          (keydown)="handleKeyboardEvent($event)"
        >
          <nz-tab
            [nzTitle]="'app.Preconfigured.Package' | i18n"
            (nzClick)="onClickConfigPackage()"
          >
            <ngu-carousel
              *ngIf="activeBlockHDD"
              #myCarouselFlavor
              [inputs]="carouselTileConfig"
              [dataSource]="listOfferFlavors"
            >
              <ngu-tile
                *nguCarouselDef="let item; let ani = animate"
                [@slider]="ani"
              >
                <div
                  [tabIndex]="0"
                  style="cursor: pointer"
                  (click)="
                    onInputFlavors(item.id);
                    selectElementInputFlavors('flavor_' + item.id)
                  "
                  (keyup.enter)="
                    onInputFlavors(item.id);
                    selectElementInputFlavors('flavor_' + item.id)
                  "
                  [id]="'flavor_' + item.id"
                >
                  <nz-row>
                    <nz-col
                      style="padding-bottom: 5px"
                      class="newClassFlavor text-center"
                      [class.initialClassFlavor]="
                        selectedElementFlavor === 'flavor_' + item.id
                      "
                    >
                      <div>
                        <span
                          class="nameFlavor"
                          [class.initialNameFlavor]="
                            selectedElementFlavor === 'flavor_' + item.id
                          "
                          >{{ item.offerName | slice : 3 : -4 }}</span
                        >
                        <div style="margin-top: -16px">
                          <img
                            style="width: 100px"
                            [src]="
                              selectedElementFlavor === 'flavor_' + item.id
                                ? 'assets/imgs/line2.svg'
                                : 'assets/imgs/line.svg'
                            "
                            alt=""
                          />
                        </div>
                        <span class="priceFlavor">{{
                          item.price.fixedPrice.amount | number
                        }}</span
                        ><span> VND/{{ 'app.Month' | i18n }}</span>
                      </div>
                    </nz-col>
                  </nz-row>
                  <nz-row>
                    <nz-col
                      style="width: 100%; padding-top: 5px"
                      [class.flavor-footer-active]="
                        selectedElementFlavor === 'flavor_' + item.id
                      "
                      [class.flavor-footer]="
                        selectedElementFlavor != 'flavor_' + item.id
                      "
                    >
                      <div>
                        <p>{{ item.description }}</p>
                      </div>
                    </nz-col>
                  </nz-row>
                </div>
              </ngu-tile>

              <ul class="myPoint" NguCarouselPoint>
                <li
                  *ngFor="let i of myCarouselFlavor.pointNumbers"
                  [class.active]="i === myCarouselFlavor.activePoint"
                  (click)="myCarouselFlavor.moveTo(i)"
                ></li>
              </ul>
            </ngu-carousel>
            <ngu-carousel
              *ngIf="activeBlockSSD"
              #myCarouselFlavor
              [inputs]="carouselTileConfig"
              [dataSource]="listOfferFlavors"
            >
              <ngu-tile
                *nguCarouselDef="let item; let ani = animate"
                [@slider]="ani"
              >
                <div
                  [tabIndex]="0"
                  style="cursor: pointer"
                  (click)="
                    onInputFlavors(item.id);
                    selectElementInputFlavors('flavor_' + item.id)
                  "
                  (keyup.enter)="
                    onInputFlavors(item.id);
                    selectElementInputFlavors('flavor_' + item.id)
                  "
                  [id]="'flavor_' + item.id"
                >
                  <nz-row>
                    <nz-col
                      style="padding-bottom: 5px"
                      class="newClassFlavor text-center"
                      [class.initialClassFlavor]="
                        selectedElementFlavor === 'flavor_' + item.id
                      "
                    >
                      <div>
                        <span
                          class="nameFlavor"
                          [class.initialNameFlavor]="
                            selectedElementFlavor === 'flavor_' + item.id
                          "
                          >{{ item.offerName | slice : 3 : -4 }}</span
                        >
                        <div style="margin-top: -16px">
                          <img
                            style="width: 100px"
                            [src]="
                              selectedElementFlavor === 'flavor_' + item.id
                                ? 'assets/imgs/line2.svg'
                                : 'assets/imgs/line.svg'
                            "
                            alt=""
                          />
                        </div>
                        <span class="priceFlavor">{{
                          item.price.fixedPrice.amount | number
                        }}</span
                        ><span> VND/{{ 'app.Month' | i18n }}</span>
                      </div>
                    </nz-col>
                  </nz-row>
                  <nz-row>
                    <nz-col
                      style="width: 100%; padding-top: 5px"
                      [class.flavor-footer-active]="
                        selectedElementFlavor === 'flavor_' + item.id
                      "
                      [class.flavor-footer]="
                        selectedElementFlavor != 'flavor_' + item.id
                      "
                    >
                      <div>
                        <p>{{ item.description }}</p>
                      </div>
                    </nz-col>
                  </nz-row>
                </div>
              </ngu-tile>

              <ul class="myPoint" NguCarouselPoint>
                <li
                  *ngFor="let i of myCarouselFlavor.pointNumbers"
                  [class.active]="i === myCarouselFlavor.activePoint"
                  (click)="myCarouselFlavor.moveTo(i)"
                ></li>
              </ul>
            </ngu-carousel>
          </nz-tab>
          <nz-tab
            [nzTitle]="'app.custom.configuration' | i18n"
            (nzClick)="onClickCustomConfig()"
          >
            <div class="ant-table">
              <table>
                <thead class="ant-table-thead">
                  <tr>
                    <th>{{ 'app.resource' | i18n }}</th>
                    <th>{{ 'app.amount' | i18n }}</th>
                    <th>{{ 'app.money.price' | i18n }} (VND)</th>
                  </tr>
                </thead>
                <tbody class="ant-table-tbody">
                  <tr>
                    <td style="width: 50%">
                      <nz-form-label style="margin-left: -12px"
                        >{{ 'app.capacity' | i18n }} (<span class="text-red"
                          >*</span
                        >) - GB</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="minCapacity"
                        [nzMax]="maxCapacity"
                        [nzStep]="stepCapacity"
                        [(ngModel)]="configCustom.capacity"
                        (ngModelChange)="changeCapacity($event)"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="configCustom.capacity"
                        (keydown)="onKeyDown($event)"
                        (ngModelChange)="changeCapacity($event)"
                        [ngModelOptions]="{ standalone: true }"
                        [nzMin]="minCapacity"
                        [nzMax]="maxCapacity"
                        [nzStep]="stepCapacity"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td nzAlign="right">
                      <label class="text-custom-price">
                        {{ volumeIntoMoney | number }} </label
                      ><br />
                      <label class="text-custom-unit-price">
                        {{ volumeUnitPrice | number }}
                      </label>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <nz-form-label style="margin-left: -12px"
                        >RAM (<span class="text-red">*</span>) -
                        GB</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="0"
                        [nzMax]="62"
                        [(ngModel)]="configCustom.ram"
                        (ngModelChange)="changeRam($event)"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="configCustom.ram"
                        (keydown)="onKeyDown($event)"
                        (ngModelChange)="changeRam($event)"
                        [ngModelOptions]="{ standalone: true }"
                        [nzMin]="0"
                        [nzMax]="62"
                        [nzStep]="1"
                        nzSize="large"
                      ></nz-input-number>
                    </td>

                    <td nzAlign="right">
                      <label class="text-custom-price">
                        {{ ramIntoMoney | number }} </label
                      ><br />
                      <label class="text-custom-unit-price">
                        {{ ramUnitPrice | number }}
                      </label>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <nz-form-label style="margin-left: -12px"
                        >CPU (<span class="text-red">*</span>) -
                        vCPU</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="0"
                        [nzMax]="62"
                        [(ngModel)]="configCustom.vCPU"
                        (ngModelChange)="changeVCPU($event)"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="configCustom.vCPU"
                        (keydown)="onKeyDown($event)"
                        (ngModelChange)="changeVCPU($event)"
                        [ngModelOptions]="{ standalone: true }"
                        [nzMin]="0"
                        [nzMax]="62"
                        [nzStep]="1"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td nzAlign="right">
                      <label class="text-custom-price">
                        {{ cpuIntoMoney | number }} </label
                      ><br />
                      <label class="text-custom-unit-price">
                        {{ cpuUnitPrice | number }}
                      </label>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </nz-tab>
          <nz-tab
            [nzTitle]="'app.gpu.configuration' | i18n"
            (nzClick)="onClickGpuConfig()"
          >
            <div class="ant-table">
              <table>
                <thead class="ant-table-thead">
                  <tr>
                    <th>{{ 'app.resource' | i18n }}</th>
                    <th>{{ 'app.amount' | i18n }}</th>
                    <th>{{ 'app.money.price' | i18n }} (VND)</th>
                  </tr>
                </thead>
                <tbody class="ant-table-tbody">
                  <tr>
                    <td>
                      <nz-form-label style="margin-left: -12px"
                        >CPUs (<span class="text-red">*</span>)</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="0"
                        [nzMax]="62"
                        [(ngModel)]="configGPU.CPU"
                        (ngModelChange)="changeCpuOfGpu($event)"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="configGPU.CPU"
                        (keydown)="onKeyDown($event)"
                        (ngModelChange)="changeCpuOfGpu($event)"
                        [ngModelOptions]="{ standalone: true }"
                        [nzMin]="0"
                        [nzMax]="62"
                        [nzStep]="1"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td nzAlign="right">
                      <label class="text-custom-price">
                        {{ cpuIntoMoney | number }} </label
                      ><br />
                      <label class="text-custom-unit-price">
                        {{ cpuUnitPrice | number }}
                      </label>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <nz-form-label style="margin-left: -12px"
                        >RAM (<span class="text-red">*</span>) -
                        GB</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="0"
                        [nzMax]="62"
                        [(ngModel)]="configGPU.ram"
                        (ngModelChange)="changeRamOfGpu($event)"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="configGPU.ram"
                        (keydown)="onKeyDown($event)"
                        (ngModelChange)="changeRamOfGpu($event)"
                        [ngModelOptions]="{ standalone: true }"
                        [nzMin]="0"
                        [nzMax]="62"
                        [nzStep]="1"
                        nzSize="large"
                      ></nz-input-number>
                    </td>

                    <td nzAlign="right">
                      <label class="text-custom-price">
                        {{ ramIntoMoney | number }} </label
                      ><br />
                      <label class="text-custom-unit-price">
                        {{ ramUnitPrice | number }}
                      </label>
                    </td>
                  </tr>
                  <tr>
                    <td style="width: 50%">
                      <nz-form-label style="margin-left: -12px"
                        >{{ 'app.ssd.capacity' | i18n }} (<span class="text-red"
                          >*</span
                        >) - GB</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="minCapacity"
                        [nzMax]="maxCapacity"
                        [nzStep]="stepCapacity"
                        [(ngModel)]="configGPU.storage"
                        (ngModelChange)="changeStorageOfGpu($event)"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="configGPU.storage"
                        (keydown)="onKeyDown($event)"
                        (ngModelChange)="changeStorageOfGpu($event)"
                        [ngModelOptions]="{ standalone: true }"
                        [nzMin]="minCapacity"
                        [nzMax]="maxCapacity"
                        [nzStep]="stepCapacity"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td nzAlign="right">
                      <label class="text-custom-price">
                        {{ volumeIntoMoney | number }} </label
                      ><br />
                      <label class="text-custom-unit-price">
                        {{ volumeUnitPrice | number }}
                      </label>
                    </td>
                  </tr>
                  <tr>
                    <td style="width: 50%">
                      <nz-form-label style="margin-left: -12px"
                        >{{ 'app.gpu.number' | i18n }} (<span class="text-red"
                          >*</span
                        >)</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="0"
                        [nzMax]="8"
                        [(ngModel)]="configGPU.GPU"
                        (ngModelChange)="changeGpu($event)"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="configGPU.GPU"
                        (keydown)="onKeyDown($event)"
                        (ngModelChange)="changeGpu($event)"
                        [ngModelOptions]="{ standalone: true }"
                        [nzMin]="0"
                        [nzMax]="8"
                        [nzStep]="1"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td nzAlign="right">
                      <label class="text-custom-price">
                        {{ gpuIntoMoney | number }} </label
                      ><br />
                      <label class="text-custom-unit-price">
                        {{ gpuUnitPrice | number }}
                      </label>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <nz-form-item style="margin-top: 20px; margin-bottom: 0px">
              <nz-form-label
                >{{ 'app.choose.gpu.type' | i18n }} (<span class="text-red"
                  >*</span
                >)</nz-form-label
              >
              <nz-form-control>
                <nz-select
                  [nzPlaceHolder]="
                    '-- ' + ('app.choose.gpu.type' | i18n) + ' --'
                  "
                  [nzShowSearch]="true"
                  [(ngModel)]="configGPU.gpuOfferId"
                  (ngModelChange)="changeGpuType()"
                  [ngModelOptions]="{ standalone: true }"
                  nzSize="large"
                >
                  <nz-option
                    *ngFor="let i of listGPUType"
                    [nzLabel]="i.offerName"
                    [nzValue]="i.id"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-tab>
        </nz-tabset>
        <br />
        <nz-row nzGutter="16">
          <nz-col nzLg="12" nzMd="12" nzSm="24">
            <nz-form-item
              ><nz-form-label
                >{{ 'app.choose.ip.public' | i18n }} (<span class="text-red"
                  >*</span
                >)<img
                  style="margin-left: 10px"
                  nz-popover
                  [nzPopoverContent]="contentTemplateIPPublic"
                  src="assets/imgs/pajamas_question.svg"
                  alt=""
                /><ng-template #contentTemplateIPPublic>
                  <span
                    [innerHTML]="'app.tooltip.instance.ip.public' | i18n"
                  ></span>
                  <a
                    [routerLink]="[
                      '/app-smart-cloud/networks/ip-floating/list'
                    ]"
                    >{{ 'app.ip.floating' | i18n }}</a
                  >
                </ng-template></nz-form-label
              >
              <nz-form-control>
                <nz-select
                  [nzPlaceHolder]="'menu.dashboard.v1' | i18n"
                  [nzShowSearch]="true"
                  [(ngModel)]="ipPublicValue"
                  [ngModelOptions]="{ standalone: true }"
                  nzSize="large"
                >
                  <nz-option
                    [nzLabel]="'menu.dashboard.v1' | i18n"
                    [nzValue]="0"
                  />
                  <nz-option
                    *ngFor="let i of listIPPublic"
                    [nzLabel]="i.ipAddress || i.networkId"
                    [nzValue]="i.id"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
          <nz-col nzLg="12" nzMd="12" nzSm="24">
            <nz-form-item>
              <nz-form-label>{{
                'app.choose.security.group' | i18n
              }}</nz-form-label>
              <nz-form-control>
                <nz-select
                  nzMode="multiple"
                  [ngModelOptions]="{ standalone: true }"
                  [(ngModel)]="selectedSecurityGroup"
                  [nzShowSearch]="true"
                  nzSize="large"
                >
                  <nz-option
                    *ngFor="let i of listSecurityGroup"
                    [nzLabel]="i.name"
                    [nzValue]="i.name"
                    [nzDisabled]="i.name.toUpperCase() === 'DEFAULT'"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <nz-row>
          <nz-form-item style="width: 100%">
            <div>
              <nz-alert
                nzType="warning"
                [nzDescription]="nzDescriptionWarning3"
                nzShowIcon
              ></nz-alert>
              <ng-template #nzDescriptionWarning3>
                <div>
                  {{ 'app.alert.security.group' | i18n }}
                  <u
                    style="cursor: pointer"
                    [routerLink]="['/app-smart-cloud/security-group/list']"
                    (keyup.enter)="navigateToSecurity()"
                    >{{ 'app.alert.access.security' | i18n }}</u
                  >
                </div>
              </ng-template>
            </div>
          </nz-form-item>
        </nz-row>
        <nz-row nzGutter="16">
          <nz-col nzLg="12" nzMd="12" nzSm="24">
            <nz-form-item>
              <nz-form-label
                >{{ 'app.choose.vlan.instance' | i18n }} (<span class="text-red"
                  >*</span
                >)</nz-form-label
              >
              <nz-form-control>
                <nz-select
                  [nzShowSearch]="true"
                  [(ngModel)]="vlanNetwork"
                  (ngModelChange)="getListPort()"
                  [ngModelOptions]="{ standalone: true }"
                  nzSize="large"
                >
                  <nz-option
                    [nzLabel]="'app.do.not.use' | i18n"
                    [nzValue]="''"
                  />
                  <nz-option
                    *ngFor="let i of listVlanNetwork"
                    [nzLabel]="i.name"
                    [nzValue]="i.cloudId"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
          <nz-col nzLg="12" nzMd="12" nzSm="24">
            <nz-form-item *ngIf="!hidePort">
              <nz-form-label
                >{{ 'app.choose.port' | i18n }} (<span class="text-red">*</span
                >)</nz-form-label
              >
              <nz-form-control>
                <nz-select
                  [nzShowSearch]="true"
                  [(ngModel)]="port"
                  [ngModelOptions]="{ standalone: true }"
                  nzSize="large"
                >
                  <nz-option
                    *ngFor="let i of listPort"
                    [nzLabel]="i.fixedIPs[0]"
                    [nzValue]="i.id"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <nz-row nzGutter="16">
          <nz-col nzLg="12" nzMd="12" nzSm="24">
            <div>
              <label
                *ngIf="hasOfferIpv6"
                nz-checkbox
                [(ngModel)]="isUseIPv6"
                [ngModelOptions]="{ standalone: true }"
                >Sử dụng IPv6<img
                  style="margin-left: 10px"
                  nz-popover
                  [nzPopoverContent]="contentTemplateIPv6"
                  src="assets/imgs/pajamas_question.svg"
                  alt=""
                /><ng-template #contentTemplateIPv6>
                  <div>
                    Máy ảo sẽ được cấp thêm một địa chỉ IPv6<br />
                    chạy song song với địa chỉ IPv4 theo cơ<br />
                    chế Dual Stack. Dual-stack là cơ chế có<br />
                    khả năng thực thi đồng thời cả hai giao<br />
                    thức IPV4 và IPV6. Thiết bị này cho phép<br />
                    cả hai giao thức cùng hoạt động trên một<br />
                    máy chủ. Theo đó dual-stack sẽ cho phép <br />
                    hệ điều hành tự lựa chọn giao thức liên <br />
                    lạc phù hợp nhất. Xem thêm về IPv6
                    <a
                      href="https://docs.smartcloud.vn/index.php/knowledge-base/ipv6-la-gi-va-co-che-dual-stacks-trong-chuyen-doi-ipv4-sang-ipv6/"
                      target="_blank"
                      >tại đây</a
                    >
                  </div>
                </ng-template></label
              >
            </div>
          </nz-col>
          <nz-col nzLg="12" nzMd="12" nzSm="24"> </nz-col>
        </nz-row>
        <nz-row>
          <nz-form-label nzFor="name"
            >{{ 'app.access.method.instance' | i18n }} (<span class="text-red"
              >*</span
            >)<img
              style="margin-left: 10px"
              [nz-tooltip]="'app.tooltip.access.method.instance' | i18n"
              src="assets/imgs/pajamas_question.svg"
              alt=""
          /></nz-form-label>
        </nz-row>
        <nz-row nzGutter="16">
          <nz-radio-group
            style="width: 100%; display: inline-flex"
            name="selectedPasswordOrSSHkey"
          >
            <nz-col nzXs="24" nzMd="12" nzLg="12">
              <nz-card
                style="border-radius: 4px"
                [ngStyle]="{
                  border: activeBlockPassword
                    ? '1px solid #0066B3'
                    : '1px solid #DADADA'
                }"
              >
                <nz-card-meta
                  [nzAvatar]="nzAvatarselectedPasswordOrSSHkey1"
                  [nzTitle]="nzTitleselectedPasswordOrSSHkey1"
                  [nzDescription]="nzDescriptionselectedPasswordOrSSHkey1"
                >
                  <ng-template #nzAvatarselectedPasswordOrSSHkey1>
                    <label
                      [tabIndex]="0"
                      nz-radio
                      [ngModel]="activeBlockPassword"
                      [ngModelOptions]="{ standalone: true }"
                      (click)="initPassword()"
                      (keyup.enter)="initPassword()"
                    ></label>
                  </ng-template>
                  <ng-template #nzTitleselectedPasswordOrSSHkey1>
                    <b>{{ 'app.password' | i18n }} </b>
                  </ng-template>
                  <ng-template #nzDescriptionselectedPasswordOrSSHkey1>
                    <ellipsis class="text-custom">
                      {{ 'app.password.intro.text' | i18n }}</ellipsis
                    >
                  </ng-template>
                </nz-card-meta>
              </nz-card>
            </nz-col>
            <nz-col nzXs="24" nzMd="12" nzLg="12">
              <nz-card
                style="border-radius: 4px"
                [ngStyle]="{
                  border: activeBlockSSHKey
                    ? '1px solid #0066B3'
                    : '1px solid #DADADA'
                }"
              >
                <nz-card-meta
                  [nzAvatar]="nzAvatarselectedPasswordOrSSHkey2"
                  [nzTitle]="nzTitleselectedPasswordOrSSHkey2"
                  [nzDescription]="nzDescriptionselectedPasswordOrSSHkey2"
                >
                  <ng-template #nzAvatarselectedPasswordOrSSHkey2>
                    <label
                      [tabIndex]="0"
                      nz-radio
                      [ngModel]="activeBlockSSHKey"
                      [ngModelOptions]="{ standalone: true }"
                      (click)="initSSHkey()"
                      (keyup.enter)="initSSHkey()"
                      [disabled]="disableKeypair"
                    ></label>
                  </ng-template>
                  <ng-template #nzTitleselectedPasswordOrSSHkey2>
                    <b>Keypair</b>
                  </ng-template>
                  <ng-template #nzDescriptionselectedPasswordOrSSHkey2>
                    <ellipsis class="text-custom">
                      {{ 'app.keypair.intro.text' | i18n }}</ellipsis
                    >
                  </ng-template>
                </nz-card-meta>
              </nz-card>
            </nz-col>
          </nz-radio-group>
          <div *ngIf="activeBlockPassword" style="width: 100%">
            <nz-col nzSpan="24">
              <nz-form-item>
                <nz-form-label nzFor="name"
                  >{{ 'app.label.instance.password' | i18n }} (<span
                    class="text-red"
                    >*</span
                  >)</nz-form-label
                >
                <nz-form-control [nzErrorTip]="passwordErrorTpl">
                  <nz-input-group
                    [nzSuffix]="suffixTemplate"
                    style="width: 100%"
                  >
                    <input
                      class="input-custom"
                      [type]="passwordVisible ? 'text' : 'password'"
                      nz-input
                      [placeholder]="'app.input.password' | i18n"
                      formControlName="passOrKeyFormControl"
                      [(ngModel)]="password"
                    />
                  </nz-input-group>
                  <ng-template #suffixTemplate>
                    <img
                      style="margin-top: -4px"
                      [src]="
                        passwordVisible
                          ? 'assets/imgs/eye-close.svg'
                          : 'assets/imgs/eye1.svg'
                      "
                      alt=""
                      (click)="passwordVisible = !passwordVisible"
                    />
                  </ng-template>
                </nz-form-control>
                <ng-template #passwordErrorTpl let-control>
                  <ng-container *ngIf="control.hasError('required')">{{
                    'validation.instance.password.required' | i18n
                  }}</ng-container>
                  <ng-container *ngIf="control.hasError('pattern')">{{
                    'validation.password.pattern' | i18n
                  }}</ng-container>
                </ng-template>
              </nz-form-item>
            </nz-col>

            <nz-col nzSpan="24">
              <nz-alert
                nzType="warning"
                [nzDescription]="nzDescriptionWarning06"
                nzShowIcon
              ></nz-alert>
              <ng-template #nzDescriptionWarning06>
                <div>
                  {{ 'app.alert.password' | i18n }}
                </div>
              </ng-template>
            </nz-col>
          </div>
          <div *ngIf="activeBlockSSHKey" style="width: 100%">
            <nz-col nzSpan="24">
              <nz-form-item>
                <nz-form-label
                  >{{ 'app.choose.keypair' | i18n }} (<span class="text-red"
                    >*</span
                  >)</nz-form-label
                >
                <nz-form-control [nzErrorTip]="keypairErrorTpl">
                  <nz-select
                    *ngIf="activeBlockSSHKey"
                    [nzPlaceHolder]="
                      '-- ' + ('app.choose.keypair' | i18n) + ' --'
                    "
                    [nzShowSearch]="true"
                    formControlName="passOrKeyFormControl"
                    [(ngModel)]="selectedSSHKeyName"
                    nzSize="large"
                  >
                    <nz-option
                      *ngFor="let i of listSSHKey"
                      [nzLabel]="i.displayName"
                      [nzValue]="i.displayName"
                    />
                  </nz-select>
                </nz-form-control>
                <ng-template #keypairErrorTpl let-control>
                  <ng-container *ngIf="control.hasError('required')">{{
                    'validation.choose.required' | i18n : { name: 'keypair' }
                  }}</ng-container>
                </ng-template>
              </nz-form-item>
            </nz-col>
            <nz-form-label style="margin-bottom: 20px">
              {{ 'app.instances.keypair.label' | i18n }}&nbsp;
              <a [routerLink]="['/app-smart-cloud/keypair']">{{
                'app.label.create' | i18n
              }}</a>
            </nz-form-label>
            <nz-col nzSpan="24">
              <nz-alert
                nzType="warning"
                [nzDescription]="nzDescriptionWarning07"
                nzShowIcon
              ></nz-alert>
              <ng-template #nzDescriptionWarning07>
                <div>
                  {{ 'app.alert.keypair' | i18n }}
                  <a
                    href="https://docs.smartcloud.vn/index.php/knowledge-base/su-dung-keypair/"
                    target="_blank"
                    >{{ 'app.here' | i18n }}
                  </a>
                  <br />
                  {{ 'app.alert.keypair.next' | i18n }}
                </div>
              </ng-template>
            </nz-col>
          </div>
        </nz-row>
      </nz-card>

      <nz-card style="border-radius: 8px">
        <div style="margin-bottom: 20px">
          <span class="text-card-header">Block Storage</span>
        </div>
        <div *ngIf="!activeBlockStorage">
          <button
            style="height: 32px"
            nz-button
            nzType="default"
            (click)="initBlockStorage()"
          >
            <img
              style="padding-right: 10px; margin-top: -4px"
              src="assets/imgs/add.svg"
              alt=""
            />{{ 'app.button.add.volume' | i18n }}
          </button>
        </div>
        <div *ngIf="activeBlockStorage">
          <nz-card nzHoverable>
            <div class="ant-table">
              <table>
                <thead class="ant-table-thead">
                  <tr>
                    <th>{{ 'app.volume.type' | i18n }}</th>
                    <th>{{ 'app.volume.name' | i18n }}</th>
                    <th>{{ 'app.capacity' | i18n }} (GB)</th>
                    <th>IOPS</th>
                    <th>{{ 'app.encrypt' | i18n }}</th>
                    <th>Multi Attach</th>
                    <th>{{ 'app.monthly.price' | i18n }} (VND)</th>
                  </tr>
                </thead>
                <tbody class="ant-table-tbody">
                  <tr
                    *ngFor="let data of listOfDataBlockStorage; let i = index"
                  >
                    <td>
                      <nz-select
                        [nzPlaceHolder]="'app.choose' | i18n"
                        name="inputBlockStorage"
                        [ngModelOptions]="{ standalone: true }"
                        [(ngModel)]="data.type"
                        [id]="'type_' + data.id"
                        (ngModelChange)="onInputBlockStorage(data.id, $event)"
                        nzSize="large"
                      >
                        <nz-option
                          *ngFor="let p of typeBlockStorage"
                          [nzValue]="p.value"
                          [nzLabel]="p.label"
                        ></nz-option>
                      </nz-select>
                    </td>
                    <td>
                      <input
                        class="input-custom"
                        type="text"
                        [ngModelOptions]="{ standalone: true }"
                        nz-input
                        [(ngModel)]="data.name"
                        [id]="'name_' + data.id"
                      />
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="data.capacity"
                        (keydown)="onKeyDown($event)"
                        (ngModelChange)="
                          changeTotalAmountBlockStorage(data.id, $event);
                          externalVolume()
                        "
                        [ngModelOptions]="{ standalone: true }"
                        [id]="'capacity_' + data.id"
                        [nzMin]="minCapacity"
                        [nzMax]="maxCapacity"
                        [nzStep]="stepCapacity"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td>
                      <span *ngIf="data.type == 'hdd'">300</span>
                      <span *ngIf="data.type == 'ssd' && data.capacity <= 40"
                        >400</span
                      >
                      <span *ngIf="data.type == 'ssd' && data.capacity > 40">{{
                        data.capacity * 10
                      }}</span>
                    </td>
                    <td>
                      <label
                        nz-checkbox
                        [(ngModel)]="data.encrypt"
                        (ngModelChange)="changeEncrypt($event, i)"
                        [ngModelOptions]="{ standalone: true }"
                        [id]="'encrypt_' + data.id"
                      ></label>
                    </td>
                    <td>
                      <label
                        nz-checkbox
                        [(ngModel)]="data.multiattach"
                        (ngModelChange)="changeMultiAttach($event, i)"
                        [ngModelOptions]="{ standalone: true }"
                        [id]="'multiattach_' + data.id"
                      ></label>
                    </td>
                    <td>
                      <label class="text-custom-price">
                        {{ data.price | number }}
                      </label>
                    </td>
                    <td>
                      <button
                        *ngIf="data.type != ''"
                        style="border: none"
                        nz-button
                        (click)="deleteRowBlockStorage(data.id)"
                      >
                        <img
                          style="margin-top: -4px"
                          src="assets/imgs/trash1.svg"
                        />
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </nz-card>
        </div>
        <nz-alert
          style="margin-left: -22px"
          class="ant-alert-warning-custom"
          nzType="warning"
          [nzDescription]="'app.alert.block.storage' | i18n"
          nzShowIcon
        ></nz-alert>
      </nz-card>

      <nz-card style="border-radius: 8px">
        <div style="margin-bottom: 20px">
          <span class="text-card-header">Network</span>
        </div>
        <div *ngIf="!activeIPv4">
          <button
            style="height: 32px"
            nz-button
            nzType="default"
            (click)="initIPv4()"
          >
            <img
              style="padding-right: 10px; margin-top: -4px"
              src="assets/imgs/add.svg"
              alt=""
            />{{ 'app.button.add.ipv4' | i18n }}
          </button>
        </div>
        <div *ngIf="activeIPv4">
          <nz-card nzHoverable>
            <div class="ant-table">
              <table>
                <thead class="ant-table-thead">
                  <tr>
                    <th>{{ 'app.ip.range' | i18n }}</th>
                    <th>{{ 'app.amount' | i18n }}</th>
                    <th>{{ 'app.monthly.price' | i18n }} (VND)</th>
                  </tr>
                </thead>
                <tbody class="ant-table-tbody">
                  <tr *ngFor="let data of listOfDataIPv4">
                    <td>
                      <nz-select
                        style="width: 85%"
                        [nzPlaceHolder]="'app.choose' | i18n"
                        name="inputNetwork"
                        [ngModelOptions]="{ standalone: true }"
                        [(ngModel)]="data.ip"
                        [id]="'ip_' + data.id"
                        (ngModelChange)="onInputIPv4($event, data.id)"
                        nzSize="large"
                      >
                        <nz-option
                          *ngFor="let p of listIPSubnetModel"
                          [nzValue]="p.networkId"
                          [nzLabel]="p.displayName"
                        ></nz-option>
                      </nz-select>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="data.amount"
                        (keydown)="onKeyDown($event)"
                        (ngModelChange)="onInputIPv4($event)"
                        [ngModelOptions]="{ standalone: true }"
                        [id]="'amount_' + data.id"
                        [nzMin]="0"
                        [nzMax]="7"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td>
                      <label class="text-custom-price">
                        {{ data.price | number }}
                      </label>
                    </td>
                    <td>
                      <button
                        style="border: none"
                        nz-button
                        (click)="deleteRowIPv4(data.id)"
                      >
                        <img
                          style="margin-top: -4px"
                          src="assets/imgs/trash1.svg"
                        />
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </nz-card>
        </div>
        <div style="margin-top: 5px" *ngIf="!activeIPv6 && hasOfferIpv6">
          <button
            style="height: 32px; margin-top: 10px"
            nz-button
            nzType="default"
            (click)="initIPv6()"
          >
            <img
              style="padding-right: 10px; margin-top: -4px"
              src="assets/imgs/add.svg"
              alt=""
            />{{ 'app.button.add.ipv6' | i18n }}
          </button>
        </div>
        <div *ngIf="activeIPv6 && hasOfferIpv6">
          <nz-card nzHoverable>
            <div class="ant-table">
              <table>
                <thead class="ant-table-thead">
                  <tr>
                    <th>{{ 'app.ip.range' | i18n }}</th>
                    <th>{{ 'app.amount' | i18n }}/th></th>
                    <th>{{ 'app.monthly.price' | i18n }} (VND)</th>
                  </tr>
                </thead>
                <tbody class="ant-table-tbody">
                  <tr *ngFor="let data of listOfDataIPv6">
                    <td>
                      <nz-select
                        style="width: 85%"
                        nzPlaceHolder="Chọn"
                        name="inputNetwork"
                        [ngModelOptions]="{ standalone: true }"
                        [(ngModel)]="data.ip"
                        [id]="'ip_' + data.id"
                        (ngModelChange)="onInputIPv6($event, data.id)"
                        nzSize="large"
                      >
                        <nz-option
                          *ngFor="let p of listIPSubnetModel"
                          [nzValue]="p.networkId"
                          [nzLabel]="p.displayName"
                        ></nz-option>
                      </nz-select>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="data.amount"
                        (keydown)="onKeyDown($event)"
                        (ngModelChange)="onInputIPv6($event)"
                        [ngModelOptions]="{ standalone: true }"
                        [id]="'amount_' + data.id"
                        [nzMin]="0"
                        [nzMax]="7"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td>
                      <label class="text-custom-price">
                        {{ data.price | number }}
                      </label>
                    </td>
                    <td>
                      <button
                        *ngIf="data.ip != ''"
                        style="border: none"
                        nz-button
                        (click)="deleteRowIPv6(data.id)"
                      >
                        <img
                          style="margin-top: -4px"
                          src="assets/imgs/trash1.svg"
                        />
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </nz-card>
        </div>
        <nz-alert
          style="margin-left: -22px"
          class="ant-alert-warning-custom"
          nzType="warning"
          [nzDescription]="'app.alert.network' | i18n"
          nzShowIcon
        ></nz-alert>
      </nz-card>
      <one-portal-service-usage-period
        [nameService]="'instance'"
        (valueChanged)="onChangeTime($event)"
      ></one-portal-service-usage-period>
    </form>
  </div>
  <div nz-col [nzSpan]="8" style="display: flex">
    <div style="width: 100%">
      <nz-affix [nzOffsetTop]="72">
        <nz-card class="card-border" style="border-radius: 8px; width: 100%">
          <div style="margin-bottom: 20px">
            <span class="text-card-header">{{
              'app.estimated.cost' | i18n
            }}</span>
          </div>
          <div class="text-value">{{ 'app.instances.name' | i18n }}</div>
          <div style="margin-top: 10px" class="text-label">
            {{ instanceCreate.serviceName }}
          </div>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <div class="text-value">{{ 'app.instances.OS' | i18n }}</div>
          <div style="margin-top: 10px" class="text-label">{{ nameHdh }}</div>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <div class="text-value">{{ 'app.text.package' | i18n }}</div>
          <div style="margin-top: 10px" class="text-label">
            {{ instanceCreate.cpu }} CPUs
          </div>
          <div style="margin-top: 10px" class="text-label">
            {{ instanceCreate.ram }} GB RAM
          </div>
          <div style="margin-top: 10px" class="text-label">
            {{ instanceCreate.volumeSize }} GB Root Disk (<span>{{
              activeBlockHDD ? 'HDD' : 'SSD'
            }}</span
            >)
          </div>
          <div *ngIf="isGpuConfig" style="margin-top: 10px" class="text-label">
            {{ instanceCreate.gpuCount }} GPU ({{ gpuTypeName }})
          </div>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <div class="text-value">{{ 'service.bonus' | i18n }}</div>
          <div
            *ngIf="externalVolumeHdd > 0"
            style="margin-top: 10px"
            class="text-label"
          >
            {{ externalVolumeHdd }} GB Data Disk (HDD)
          </div>
          <div
            *ngIf="externalVolumeSsd > 0"
            style="margin-top: 10px"
            class="text-label"
          >
            {{ externalVolumeSsd }} GB Data Disk (SSD)
          </div>
          <div
            *ngIf="numberOfIpv4 > 0"
            style="margin-top: 10px"
            class="text-label"
          >
            {{ numberOfIpv4 }} IPv4
          </div>
          <div
            *ngIf="numberOfIpv6 > 0"
            style="margin-top: 10px"
            class="text-label"
          >
            {{ numberOfIpv6 }} IPv6
          </div>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <nz-row style="margin-bottom: 10px" nzGutter="16">
            <nz-col nzSpan="16">
              <span *ngIf="numberMonth == 1" class="text-value">
                {{ 'app.cost.a.month' | i18n }}
              </span>
              <span *ngIf="numberMonth > 1" class="text-value">
                {{ 'app.cost.n.month' | i18n : { numberMonth: numberMonth } }}
              </span>
            </nz-col>
            <nz-col class="text-right" nzSpan="8">
              <span class="text-value" style="color: #0066b3" nzAlign="right">
                {{
                  totalAmount +
                    totalAmountVolume +
                    totalAmountIPv4 +
                    totalAmountIPv6 | number
                }}
                VND
              </span>
            </nz-col>
          </nz-row>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <nz-row style="margin-bottom: 10px" nzGutter="16">
            <nz-col nzSpan="16">
              <span class="text-value">
                {{ 'app.cost.vat' | i18n }}
              </span>
            </nz-col>
            <nz-col class="text-right" nzSpan="8">
              <span class="text-value" style="color: #0066b3" nzAlign="right">
                {{
                  totalVAT + totalVATVolume + totalVATIPv4 + totalVATIPv6
                    | number
                }}
                VND
              </span>
            </nz-col>
          </nz-row>
          <nz-row
            style="
              margin-bottom: 20px;
              background-color: #cce9ff;
              padding: 16px 0 16px 0;
              border-radius: 8px;
            "
            nzGutter="16"
          >
            <nz-col nzSpan="16">
              <span class="text-label">{{ 'app.total.payment' | i18n }}</span
              ><br />
              <span class="text-note-italicized"
                >({{ 'app.include.vat' | i18n : { vat: '10' } }})</span
              >
            </nz-col>
            <nz-col class="text-right" nzSpan="8">
              <span class="text-value" style="color: #ea3829" nzAlign="right">
                {{
                  totalincludesVAT +
                    totalPaymentVolume +
                    totalPaymentIPv4 +
                    totalPaymentIPv6 | number : '1.0-0'
                }}
                VND
              </span>
            </nz-col>
          </nz-row>
          <nz-row>
            <nz-col style="width: 100%">
              <button
                style="width: 100%"
                nz-button
                nzSize="large"
                nzType="primary"
                (click)="save()"
                [disabled]="
                  form.invalid ||
                  isExistName ||
                  totalincludesVAT +
                    totalPaymentVolume +
                    totalPaymentIPv4 +
                    totalPaymentIPv6 ==
                    0
                "
              >
                <span nz-icon nzType="wallet" nzTheme="outline"></span>
                <span
                  [style.color]="
                    form.invalid ||
                    isExistName ||
                    totalincludesVAT +
                      totalPaymentVolume +
                      totalPaymentIPv4 +
                      totalPaymentIPv6 ==
                      0
                      ? 'gray'
                      : 'white'
                  "
                  >{{ 'app.button.create' | i18n }}</span
                >
              </button>
            </nz-col>
          </nz-row>
        </nz-card>
      </nz-affix>
    </div>
  </div>
</div>
<one-portal-popup-list-error
  [isVisible]="isVisiblePopupError"
  [errorList]="errorList"
  (onCancel)="closePopupError()"
></one-portal-popup-list-error>
