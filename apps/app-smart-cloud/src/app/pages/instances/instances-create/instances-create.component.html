<page-header [breadcrumb]="breadcrumb" [action]="action" [title]="'Tạo máy ảo'">
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">Trang chủ</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/app-smart-cloud/instances']">Quản lý máy ảo</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item> Tạo máy ảo</nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <region-select-dropdown
        (valueChanged)="onRegionChange($event)"
      ></region-select-dropdown>
      <project-select-dropdown
        [regionId]="region"
        (userChanged)="userChangeProject()"
      ></project-select-dropdown>
    </div>
  </ng-template>
</page-header>

<form nz-form [formGroup]="form" [nzLayout]="'vertical'">
  <nz-row nzGutter="24">
    <nz-col nzSpan="16">
      <nz-card style="border-radius: 8px" [nzBordered]="false">
        <div style="margin-bottom: 20px">
          <span class="text-card-header">Thông tin máy ảo</span>
        </div>
        <nz-row nzGutter="16">
          <nz-col nzSpan="24">
            <nz-form-item>
              <nz-form-label nzFor="name"
                >Tên máy ảo (<span class="text-red">*</span>)<img
                  style="margin-left: 10px"
                  nz-tooltip="Tên máy ảo. Không bao gồm ký tự đặc biệt, dấu cách, tiếng Việt."
                  src="assets/imgs/pajamas_question.svg"
                  alt=""
              /></nz-form-label>

              <nz-form-control nzDisableAutoTips [nzErrorTip]="nameErrorTpl">
                <nz-row>
                  <nz-col nzSpan="12">
                    <input
                      class="input-custom"
                      nz-input
                      formControlName="name"
                      [(ngModel)]="instanceCreate.serviceName"
                      id="name"
                      placeholder="Nhập tên máy ảo"
                      maxlength="50"
                      minlength="1"
                      (change)="
                        instanceCreate.serviceName =
                          instanceCreate.serviceName.trim()
                      "
                    />
                  </nz-col>
                  <nz-col
                    style="display: flex; align-items: center"
                    nzSpan="12"
                  >
                    <nz-switch
                      style="margin-left: 20px"
                      nzSize="small"
                      [(ngModel)]="isSnapshot"
                      [ngModelOptions]="{ standalone: true }"
                      (ngModelChange)="initSnapshot()"
                    ></nz-switch>
                    <label
                      nzFor="name"
                      style="text-align: right; padding-left: 1%"
                      >Tạo từ Snapshot
                      <img
                        style="margin-left: 10px"
                        nz-tooltip="Quý khách có thể tạo máy ảo từ một bản snapshot có sẵn để phục hồi máy ảo về trạng thái khi thực hiện tạo bản snapshot đó."
                        src="assets/imgs/pajamas_question.svg"
                        alt=""
                    /></label>
                  </nz-col>
                </nz-row>
                <ng-template #nameErrorTpl let-control>
                  <ng-container *ngIf="control.hasError('required')"
                    >Vui lòng nhập thông tin</ng-container
                  >
                  <ng-container *ngIf="control.hasError('pattern')"
                    >Tên gồm 50 ký tự viết liền không dấu và không chứa ký tự
                    đặc biệt</ng-container
                  >
                </ng-template>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <div *ngIf="isSnapshot">
          <nz-form-item>
            <nz-form-label nzFor="name"
              >Chọn Snapshot (<span class="text-red">*</span>)</nz-form-label
            >
            <nz-form-control nzErrorTip="Vui lòng Chọn Snapshot">
              <nz-select
                [nzPlaceHolder]="'--Chọn Snapshot--'"
                [nzShowSearch]="true"
                [(ngModel)]="selectedSnapshot"
                [ngModelOptions]="{ standalone: true }"
                nzSize="large"
              >
                <nz-option
                  *ngFor="let i of listSnapshot"
                  [nzLabel]="i.name"
                  [nzValue]="i.id"
                />
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div style="margin-left: -10px" *ngIf="!isSnapshot">
          <nz-form-label
            >Hệ điều hành (<span class="text-red">*</span>)<img
              style="margin-left: 10px"
              nz-tooltip="Hệ điều hành sử dụng để khởi tạo máy ảo."
              src="assets/imgs/pajamas_question.svg"
              alt=""
          /></nz-form-label>
          <ngu-carousel
            #myCarouselImage
            [inputs]="carouselTileConfig"
            [dataSource]="listImageTypes"
          >
            <ngu-tile
              *nguCarouselDef="let data; index as i; let ani = animate"
              [@slider]="ani"
            >
              <div
                class="images-body"
                [id]="'images_' + data.id"
                [ngClass]="{
                  'images-body-active': data.id === selectedImageTypeId,
                  bgGray: !data.id === selectedImageTypeId
                }"
              >
                <nz-row>
                  <nz-col class="text-center" style="width: 100%">
                    <img
                      *ngIf="data.name == 'Linux'"
                      src="assets/imgs/ubuntu.png"
                      alt=""
                    />
                    <img
                      *ngIf="data.name == 'Windows'"
                      src="assets/imgs/window.png"
                      alt=""
                    />
                  </nz-col>
                </nz-row>
                <nz-row>
                  <nz-col class="text-center" style="width: 100%">
                    <div style="margin-top: 15px; margin-bottom: 15px">
                      <nz-select
                        nzShowSearch
                        [id]="'hdh_' + data.id"
                        [(ngModel)]="listSelectedImage[i]"
                        (ngModelChange)="onInputHDH($event, i, data.id)"
                        nzPlaceHolder="Chọn phiên bản"
                        [ngModelOptions]="{ standalone: true }"
                        style="text-align: center; width: 150px"
                      >
                        <nz-option
                          *ngFor="let p of listOfImageByImageType.get(data.id)"
                          [nzValue]="p.id"
                          [nzLabel]="p.name"
                        ></nz-option>
                      </nz-select>
                    </div>
                  </nz-col>
                </nz-row>
              </div>
            </ngu-tile>

            <ul class="myPoint" NguCarouselPoint>
              <li
                *ngFor="let i of myCarouselImage.pointNumbers"
                [class.active]="i === myCarouselImage.activePoint"
                (click)="myCarouselImage.moveTo(i)"
              ></li>
            </ul>
          </ngu-carousel>
        </div>

        <br />
        <nz-row nzGutter="16">
          <nz-form-label
            >Chọn loại Volume (<span class="text-red">*</span>)<img
              style="margin-left: 10px"
              nz-tooltip="Quý khách có thể tạo volume mới hoặc tạo từ một bản snapshot."
              src="assets/imgs/pajamas_question.svg"
              alt=""
          /></nz-form-label>
        </nz-row>
        <nz-radio-group
          style="width: 100%; display: inline-flex"
          name="selectedHDDorSSD"
        >
          <nz-row
            [nzGutter]="{ xs: 24, sm: 24, md: 24, lg: 24 }"
            style="margin-top: 10px"
            ><nz-col
              [nzLg]="12"
              [nzMd]="12"
              [nzSm]="24"
              [nzXl]="12"
              [nzXs]="24"
            >
              <nz-card
                style="border-radius: 4px"
                [nzAlign]="'middle'"
                [ngStyle]="{
                    border: activeBlockHDD
                  ? '1px solid #0066B3'
                  : '1px solid #DADADA',
                  height: cardHeight,
                }"
              >
                <nz-row nzGutter="16">
                  <nz-col nzSpan="20">
                    <nz-card-meta
                      [nzAvatar]="nzAvatarselectedHDDorSSD1"
                      [nzTitle]="nzTitleselectedHDDorSSD1"
                      [nzDescription]="nzDescriptionselectedHDDorSSD1"
                    >
                      <ng-template #nzAvatarselectedHDDorSSD1>
                        <label
                          nz-radio
                          [ngModel]="activeBlockHDD"
                          [ngModelOptions]="{ standalone: true }"
                          (click)="initHDD()"
                        ></label>
                      </ng-template>
                      <ng-template #nzTitleselectedHDDorSSD1>
                        <b>HDD</b>
                      </ng-template>
                      <ng-template #nzDescriptionselectedHDDorSSD1>
                        <ellipsis class="text-custom">
                          Lựa chọn tốt hơn nếu bạn đang đối phó với các bản sao
                          lưu dữ liệu, lưu trữ dữ liệu hoặc khối lượng công việc
                          chuyên sâu thông lượng
                        </ellipsis>
                      </ng-template>
                    </nz-card-meta></nz-col
                  >
                  <nz-col
                    style="
                      display: flex;
                      align-items: center;
                      margin-top: -24px;
                    "
                    [ngStyle]="{
                      height: cardHeight,
                    }"
                    nzSpan="4"
                  >
                    <img
                      [src]="
                        activeBlockHDD
                          ? 'assets/imgs/hdd-svgrepo-com-active.svg'
                          : 'assets/imgs/hdd-svgrepo-com.svg'
                      "
                      alt=""
                    />
                  </nz-col>
                </nz-row>
              </nz-card>
            </nz-col>
            <nz-col [nzLg]="12" [nzMd]="12" [nzSm]="24" [nzXl]="12" [nzXs]="24">
              <nz-card
                style="border-radius: 4px"
                [nzAlign]="'middle'"
                [ngStyle]="{
                  border: activeBlockSSD
                  ? '1px solid #0066B3'
                  : '1px solid #DADADA',
                  height: cardHeight,
                }"
              >
                <nz-row nzGutter="16">
                  <nz-col nzSpan="20"
                    ><nz-card-meta
                      [nzAvatar]="nzAvatarselectedHDDorSSD2"
                      [nzTitle]="nzTitleselectedHDDorSSD2"
                      [nzDescription]="nzDescriptionselectedHDDorSSD2"
                    >
                      <ng-template #nzAvatarselectedHDDorSSD2>
                        <label
                          nz-radio
                          [ngModel]="activeBlockSSD"
                          [ngModelOptions]="{ standalone: true }"
                          (click)="initSSD()"
                        ></label>
                      </ng-template>
                      <ng-template #nzTitleselectedHDDorSSD2>
                        <b>SSD</b>
                      </ng-template>
                      <ng-template #nzDescriptionselectedHDDorSSD2>
                        <ellipsis class="text-custom"
                          >Lựa chọn tốt hơn cho khối lượng công việc phân tích
                          dữ liệu hoặc chơi game
                        </ellipsis>
                      </ng-template>
                    </nz-card-meta>
                  </nz-col>
                  <nz-col
                    style="
                      display: flex;
                      align-items: center;
                      margin-top: -24px;
                    "
                    [ngStyle]="{
                        height: cardHeight,
                      }"
                    nzSpan="4"
                  >
                    <img
                      [src]="
                        activeBlockSSD
                          ? 'assets/imgs/ssd-svgrepo-com-active.svg'
                          : 'assets/imgs/ssd-svgrepo-com.svg'
                      "
                      alt=""
                    />
                  </nz-col>
                </nz-row>
              </nz-card> </nz-col
          ></nz-row>
        </nz-radio-group>

        <nz-tabset nzCentered nzSize="large">
          <nz-tab nzTitle="Gói cấu hình" (nzClick)="onClickConfigPackage()">
            <ngu-carousel
              #myCarouselFlavor
              [inputs]="carouselTileConfig"
              [dataSource]="listOfferFlavors"
            >
              <ngu-tile
                *nguCarouselDef="let item; let ani = animate"
                [@slider]="ani"
              >
                <div
                  style="cursor: pointer"
                  (click)="
                    onInputFlavors(item.id);
                    selectElementInputFlavors('flavor_' + item.id)
                  "
                  [id]="'flavor_' + item.id"
                >
                  <nz-row>
                    <nz-col
                      style="padding-bottom: 5px"
                      class="newClassFlavor text-center"
                      [class.initialClassFlavor]="
                        selectedElementFlavor === 'flavor_' + item.id
                      "
                    >
                      <div>
                        <span
                          class="nameFlavor"
                          [class.initialNameFlavor]="
                            selectedElementFlavor === 'flavor_' + item.id
                          "
                          >{{ item.offerName | slice : 3 : -4 }}</span
                        >
                        <div style="margin-top: -16px">
                          <img
                            style="width: 100px"
                            [src]="
                              selectedElementFlavor === 'flavor_' + item.id
                                ? 'assets/imgs/line2.svg'
                                : 'assets/imgs/line.svg'
                            "
                            alt=""
                          />
                        </div>
                        <span class="priceFlavor">{{
                          item.price.fixedPrice.amount | number
                        }}</span
                        ><span> đ/tháng</span>
                      </div>
                    </nz-col>
                  </nz-row>
                  <nz-row>
                    <nz-col
                      style="width: 100%; padding-top: 5px"
                      [class.flavor-footer-active]="
                        selectedElementFlavor === 'flavor_' + item.id
                      "
                      [class.flavor-footer]="
                        selectedElementFlavor != 'flavor_' + item.id
                      "
                    >
                      <div>
                        <p>{{ item.description }}</p>
                      </div>
                    </nz-col>
                  </nz-row>
                </div>
              </ngu-tile>

              <ul class="myPoint" NguCarouselPoint>
                <li
                  *ngFor="let i of myCarouselFlavor.pointNumbers"
                  [class.active]="i === myCarouselFlavor.activePoint"
                  (click)="myCarouselFlavor.moveTo(i)"
                ></li>
              </ul>
            </ngu-carousel>
          </nz-tab>
          <nz-tab
            nzTitle="Cấu hình tuỳ chỉnh"
            (nzClick)="onClickCustomConfig()"
          >
            <div class="ant-table">
              <table>
                <thead class="ant-table-thead">
                  <tr>
                    <th>Tài nguyên</th>
                    <th>Số lượng</th>
                    <th>Thành tiền/Đơn giá</th>
                  </tr>
                </thead>
                <tbody class="ant-table-tbody">
                  <tr>
                    <td style="width: 50%">
                      <nz-form-label style="margin-left: -12px"
                        >Dung lượng (<span class="text-red">*</span>) -
                        GB</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="1"
                        [nzMax]="1000"
                        [(ngModel)]="configCustom.capacity"
                        (ngModelChange)="onChangeCapacity()"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="configCustom.capacity"
                        (ngModelChange)="onChangeCapacity()"
                        [ngModelOptions]="{ standalone: true }"
                        [nzMin]="0"
                        [nzMax]="1000"
                        [nzStep]="1"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td nzAlign="right">
                      <label class="text-custom-price">
                        {{ volumeIntoMoney | number }} VNĐ </label
                      ><br />
                      <label class="text-custom-price">
                        {{ volumeUnitPrice | number }} VNĐ
                      </label>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <nz-form-label style="margin-left: -12px"
                        >RAM (<span class="text-red">*</span>) -
                        GB</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="1"
                        [nzMax]="62"
                        [(ngModel)]="configCustom.ram"
                        (ngModelChange)="onChangeRam()"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="configCustom.ram"
                        (ngModelChange)="onChangeRam()"
                        [ngModelOptions]="{ standalone: true }"
                        [nzMin]="0"
                        [nzMax]="62"
                        [nzStep]="1"
                        nzSize="large"
                      ></nz-input-number>
                    </td>

                    <td nzAlign="right">
                      <label class="text-custom-price">
                        {{ ramIntoMoney | number }} VNĐ </label
                      ><br />
                      <label class="text-custom-price">
                        {{ ramUnitPrice | number }} VNĐ
                      </label>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <nz-form-label style="margin-left: -12px"
                        >CPU (<span class="text-red">*</span>) -
                        vCPU</nz-form-label
                      >
                      <nz-slider
                        [nzMin]="1"
                        [nzMax]="62"
                        [(ngModel)]="configCustom.vCPU"
                        (ngModelChange)="onChangeVCPU()"
                        [ngModelOptions]="{ standalone: true }"
                      ></nz-slider>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="configCustom.vCPU"
                        (ngModelChange)="onChangeVCPU()"
                        [ngModelOptions]="{ standalone: true }"
                        [nzMin]="0"
                        [nzMax]="62"
                        [nzStep]="1"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td nzAlign="right">
                      <label class="text-custom-price">
                        {{ cpuIntoMoney | number }} VNĐ </label
                      ><br />
                      <label class="text-custom-price">
                        {{ cpuUnitPrice | number }} VNĐ
                      </label>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </nz-tab>
        </nz-tabset>
        <br />
        <nz-row nzGutter="16">
          <nz-col nzLg="12" nzMd="12" nzSm="24">
            <nz-form-item>
              <nz-form-label
                >Chọn IP Public (<span class="text-red">*</span>)<img
                  style="margin-left: 10px"
                  nz-popover
                  [nzPopoverContent]="contentTemplateIPPublic"
                  src="assets/imgs/pajamas_question.svg"
                  alt=""
                /><ng-template #contentTemplateIPPublic>
                  <div>
                    Máy ảo tạo ra sẽ có thêm một card mạng<br />
                    tương ứng với địa chỉ IP khách hàng lựa<br />
                    chọn. Trường hợp muốn sử dụng IP Floating,<br />
                    vụi lòng truy cập
                    <a
                      [routerLink]="[
                        '/app-smart-cloud/networks/ip-floating/list'
                      ]"
                      >IP Floating</a
                    >
                  </div>
                </ng-template></nz-form-label
              >
              <nz-form-control nzErrorTip="Chọn IP Public *">
                <nz-select
                  [nzPlaceHolder]="'Mặc định'"
                  [nzShowSearch]="true"
                  [(ngModel)]="ipPublicValue"
                  [ngModelOptions]="{ standalone: true }"
                  nzSize="large"
                >
                  <nz-option nzLabel="Mặc định" nzValue="" />
                  <nz-option
                    *ngFor="let i of listIPPublic"
                    [nzLabel]="i.ipAddress || i.networkId"
                    [nzValue]="i.id"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <div>
              <label
                nz-checkbox
                [(ngModel)]="isUseIPv6"
                [ngModelOptions]="{ standalone: true }"
                >Sử dụng IPv6<img
                  style="margin-left: 10px"
                  nz-popover
                  [nzPopoverContent]="contentTemplateIPv6"
                  src="assets/imgs/pajamas_question.svg"
                  alt=""
                /><ng-template #contentTemplateIPv6>
                  <div>
                    Máy ảo sẽ được cấp thêm một địa chỉ IPv6<br />
                    chạy song song với địa chỉ IPv4 theo cơ<br />
                    chế Dual Stack. Dual-stack là cơ chế có<br />
                    khả năng thực thi đồng thời cả hai giao<br />
                    thức IPV4 và IPV6. Thiết bị này cho phép<br />
                    cả hai giao thức cùng hoạt động trên một<br />
                    máy chủ. Theo đó dual-stack sẽ cho phép <br />
                    hệ điều hành tự lựa chọn giao thức liên <br />
                    lạc phù hợp nhất. Xem thêm về IPv6
                    <a
                      href="https://docs.smartcloud.vn/index.php/knowledge-base/ipv6-la-gi-va-co-che-dual-stacks-trong-chuyen-doi-ipv4-sang-ipv6/"
                      target="_blank"
                      >tại đây</a
                    >
                  </div>
                </ng-template></label
              >
              <br />
              <label
                nz-checkbox
                [(ngModel)]="isUseLAN"
                [ngModelOptions]="{ standalone: true }"
                >Sử dụng mạng LAN<img
                  style="margin-left: 10px"
                  nz-tooltip="Khi sử dụng mạng LAN, máy ảo sẽ được trang bị thêm 01 IP LAN."
                  src="assets/imgs/pajamas_question.svg"
                  alt=""
              /></label>
            </div>
          </nz-col>
          <nz-col nzLg="12" nzMd="12" nzSm="24">
            <nz-form-item>
              <nz-form-label>Chọn Security Group</nz-form-label>
              <nz-form-control>
                <nz-select
                  nzMode="multiple"
                  nzPlaceHolder="Chọn Security Group"
                  [ngModelOptions]="{ standalone: true }"
                  [(ngModel)]="selectedSecurityGroup"
                  [nzServerSearch]="true"
                  nzSize="large"
                >
                  <nz-option
                    *ngFor="let i of listSecurityGroup"
                    [nzLabel]="i.name"
                    [nzValue]="i.name"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <div>
              <nz-alert
                nzType="warning"
                [nzDescription]="nzDescriptionWarning3"
                nzShowIcon
              ></nz-alert>
              <ng-template #nzDescriptionWarning3>
                <div>
                  Để thiết lập các cơ chế truy cập vào máy ảo, Quý khách cần cấu
                  hình Security Group <br />
                  trong mục <u>Truy cập và Bảo mật</u>
                </div>
              </ng-template>
            </div>
          </nz-col>
        </nz-row>
        <nz-row>
          <nz-form-label nzFor="name"
            >Phương thức truy cập máy ảo (<span class="text-red">*</span>)<img
              style="margin-left: 10px"
              nz-tooltip="Có thể sử dụng mật khẩu hoặc keypair để sử truy cập vào máy ảo."
              src="assets/imgs/pajamas_question.svg"
              alt=""
          /></nz-form-label>
        </nz-row>
        <nz-row nzGutter="16">
          <nz-radio-group
            style="width: 100%; display: inline-flex"
            name="selectedPasswordOrSSHkey"
          >
            <nz-col nzXs="24" nzMd="12" nzLg="12">
              <nz-card
                style="border-radius: 4px"
                [ngStyle]="{
                  border: activeBlockPassword
                    ? '1px solid #0066B3'
                    : '1px solid #DADADA'
                }"
              >
                <nz-card-meta
                  [nzAvatar]="nzAvatarselectedPasswordOrSSHkey1"
                  [nzTitle]="nzTitleselectedPasswordOrSSHkey1"
                  [nzDescription]="nzDescriptionselectedPasswordOrSSHkey1"
                >
                  <ng-template #nzAvatarselectedPasswordOrSSHkey1>
                    <label
                      nz-radio
                      [ngModel]="activeBlockPassword"
                      [ngModelOptions]="{ standalone: true }"
                      (click)="initPassword()"
                    ></label>
                  </ng-template>
                  <ng-template #nzTitleselectedPasswordOrSSHkey1>
                    <b>Mật khẩu</b>
                  </ng-template>
                  <ng-template #nzDescriptionselectedPasswordOrSSHkey1>
                    <ellipsis class="text-custom">
                      Thuận tiện cho người dùng</ellipsis
                    >
                  </ng-template>
                </nz-card-meta>
              </nz-card>
            </nz-col>
            <nz-col nzXs="24" nzMd="12" nzLg="12">
              <nz-card
                style="border-radius: 4px"
                [ngStyle]="{
                  border: activeBlockSSHKey
                    ? '1px solid #0066B3'
                    : '1px solid #DADADA'
                }"
              >
                <nz-card-meta
                  [nzAvatar]="nzAvatarselectedPasswordOrSSHkey2"
                  [nzTitle]="nzTitleselectedPasswordOrSSHkey2"
                  [nzDescription]="nzDescriptionselectedPasswordOrSSHkey2"
                >
                  <ng-template #nzAvatarselectedPasswordOrSSHkey2>
                    <label
                      nz-radio
                      [ngModel]="activeBlockSSHKey"
                      [ngModelOptions]="{ standalone: true }"
                      (click)="initSSHkey()"
                    ></label>
                  </ng-template>
                  <ng-template #nzTitleselectedPasswordOrSSHkey2>
                    <b>SSH key</b>
                  </ng-template>
                  <ng-template #nzDescriptionselectedPasswordOrSSHkey2>
                    <ellipsis class="text-custom">
                      Tăng tính bảo mật khi đăng nhập</ellipsis
                    >
                  </ng-template>
                </nz-card-meta>
              </nz-card>
            </nz-col>
          </nz-radio-group>
          <div *ngIf="activeBlockPassword" style="width: 100%">
            <nz-col nzSpan="24">
              <nz-form-item>
                <nz-form-label nzFor="name"
                  >Mật khẩu truy cập máy ảo (<span class="text-red">*</span
                  >)</nz-form-label
                >
                <nz-form-control
                  nzErrorTip="Vui lòng nhập mật khẩu truy cập máy ảo"
                >
                  <nz-input-group
                    [nzSuffix]="suffixTemplate"
                    style="width: 100%"
                  >
                    <input
                      class="input-custom"
                      [type]="passwordVisible ? 'text' : 'password'"
                      nz-input
                      placeholder="input password"
                      [(ngModel)]="password"
                      [ngModelOptions]="{ standalone: true }"
                    />
                  </nz-input-group>
                  <ng-template #suffixTemplate>
                    <i
                      nz-icon
                      [nzType]="'eye'"
                      (click)="passwordVisible = !passwordVisible"
                    ></i>
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </nz-col>

            <nz-col nzSpan="24">
              <nz-alert
                nzType="warning"
                [nzDescription]="nzDescriptionWarning06"
                nzShowIcon
              ></nz-alert>
              <ng-template #nzDescriptionWarning06>
                <div>
                  Quy tắc đặt mật khẩu: Độ dài của một mật khẩu được sử dụng
                  trực tuyến cần phải chứa tối thiểu là 12 ký tự, sử dụng hỗn
                  hợp bao gồm các chữ số, chữ hoa, chữ thường và ký hiệu đặc
                  biệt.
                </div>
              </ng-template>
            </nz-col>
          </div>
          <div *ngIf="activeBlockSSHKey" style="width: 100%">
            <nz-col nzSpan="24">
              <nz-form-item>
                <nz-form-label
                  >Chọn SSH key (<span class="text-red">*</span>)</nz-form-label
                >
                <nz-form-control nzErrorTip="Chọn  *">
                  <nz-select
                    [nzPlaceHolder]="'--Chọn SSH key--'"
                    [nzShowSearch]="true"
                    [ngModelOptions]="{ standalone: true }"
                    [(ngModel)]="selectedSSHKeyName"
                    (ngModelChange)="onSSHKeyChange($event)"
                    nzSize="large"
                  >
                    <nz-option
                      *ngFor="let i of listSSHKey"
                      [nzLabel]="i.displayName"
                      [nzValue]="i.displayName"
                    />
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </nz-col>
            <nz-form-label style="margin-bottom: 20px">
              Lựa chọn keypair có sẵn hoặc&nbsp;
              <a [routerLink]="['/app-smart-cloud/ssh-key']">Tạo mới</a>
            </nz-form-label>
            <nz-col nzSpan="24">
              <nz-alert
                nzType="warning"
                [nzDescription]="nzDescriptionWarning07"
                nzShowIcon
              ></nz-alert>
              <ng-template #nzDescriptionWarning07>
                <div>
                  Chúng tôi khuyến cáo sử dụng SSH Key để đảm an toàn bảo mật
                  cho máy chủ của quý khách. Thông tin hướng dẫn sử dụng về SSH
                  key cho máy chủ có thể xem
                  <a
                    href="https://docs.smartcloud.vn/index.php/knowledge-base/su-dung-keypair/"
                    target="_blank"
                    >tại đây</a
                  >.
                  <br />
                  Mật khẩu đăng nhập vào máy chủ sẽ được tạo tự động và gửi vào
                  email của quý khách khi máy chủ được tạo thành công
                </div>
              </ng-template>
            </nz-col>
          </div>
        </nz-row>

        <nz-row style="margin-top: 20px; margin-bottom: -25px" nzGutter="16">
          <nz-col nzSpan="24">
            <nz-form-item style="margin-bottom: 5px">
              <nz-form-label
                >Thời hạn sử dụng (<span class="text-red">*</span>) - Tháng<img
                  style="margin-left: 10px"
                  nz-tooltip="Thời gian khách hàng mua máy ảo để sử dụng, tính theo tháng."
                  src="assets/imgs/pajamas_question.svg"
                  alt=""
              /></nz-form-label>
              <nz-form-control>
                <nz-row>
                  <nz-input-number
                    style="width: 50%; margin-left: -1px"
                    [nzMin]="1"
                    [nzMax]="100"
                    [nzStep]="1"
                    [(ngModel)]="numberMonth"
                    (ngModelChange)="onChangeTime($event)"
                    [ngModelOptions]="{ standalone: true }"
                    nzSize="large"
                  ></nz-input-number>
                  <div
                    class="text-custom-time"
                    style="
                      display: flex;
                      margin-left: 20px;
                      align-items: center;
                    "
                  >
                    Thời gian bắt đầu sử dụng: {{ today | date : 'dd/MM/yyyy' }}
                  </div>
                </nz-row>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <div style="color: #eb1414; margin-top: 20px" class="text-label">
          Ngày hết hạn: {{ expiredDate | date : 'dd/MM/yyyy' }}
        </div>
      </nz-card>

      <nz-card style="border-radius: 8px">
        <div style="margin-bottom: 20px">
          <span class="text-card-header">Block Storage</span>
        </div>
        <div *ngIf="!activeBlockStorage">
          <button
            style="height: 32px"
            nz-button
            nzType="default"
            (click)="initBlockStorage()"
          >
            <img
              style="padding-right: 10px; margin-top: -4px"
              src="assets/imgs/add.svg"
              alt=""
            />Bổ sung Volume
          </button>
        </div>
        <div *ngIf="activeBlockStorage">
          <nz-card nzHoverable>
            <div class="ant-table">
              <table>
                <thead class="ant-table-thead">
                  <tr>
                    <th>Loại Volume</th>
                    <th>Tên Volume</th>
                    <th>Dung lượng (GB)</th>
                    <th>Mã hóa</th>
                    <th>Multi Attach</th>
                    <th>Giá theo tháng (VNĐ)</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody class="ant-table-tbody">
                  <tr *ngFor="let data of listOfDataBlockStorage">
                    <td>
                      <nz-select
                        nzPlaceHolder="Thêm ổ cứng"
                        name="inputBlockStorage"
                        [ngModelOptions]="{ standalone: true }"
                        [(ngModel)]="data.type"
                        [id]="'type_' + data.id"
                        (ngModelChange)="onInputBlockStorage(data.id, $event)"
                        nzSize="large"
                      >
                        <nz-option
                          *ngFor="let p of typeBlockStorage"
                          [nzValue]="p.value"
                          [nzLabel]="p.label"
                        ></nz-option>
                      </nz-select>
                    </td>
                    <td>
                      <input
                        class="input-custom"
                        type="text"
                        [ngModelOptions]="{ standalone: true }"
                        nz-input
                        [(ngModel)]="data.name"
                        [id]="'name_' + data.id"
                      />
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="data.capacity"
                        (ngModelChange)="
                          changeTotalAmountBlockStorage(data.id, $event);
                          externalVolume()
                        "
                        [ngModelOptions]="{ standalone: true }"
                        [id]="'capacity_' + data.id"
                        [nzMin]="0"
                        [nzMax]="1000"
                        [nzStep]="1"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td>
                      <label
                        nz-checkbox
                        [(ngModel)]="data.encrypt"
                        [ngModelOptions]="{ standalone: true }"
                        [id]="'encrypt_' + data.id"
                      ></label>
                    </td>
                    <td>
                      <label
                        nz-checkbox
                        [(ngModel)]="data.multiattach"
                        [ngModelOptions]="{ standalone: true }"
                        [id]="'multiattach_' + data.id"
                      ></label>
                    </td>
                    <td>
                      <label class="text-custom-price">
                        {{ data.price | number }}
                      </label>
                    </td>
                    <td>
                      <button
                        *ngIf="data.type != ''"
                        style="border: none"
                        nz-button
                        (click)="deleteRowBlockStorage(data.id)"
                      >
                        <img
                          style="margin-top: -4px"
                          src="assets/imgs/trash1.svg"
                        />
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </nz-card>
        </div>
        <nz-alert
          style="margin-left: -22px"
          class="ant-alert-warning-custom"
          (click)="initBlockStorage()"
          nzType="warning"
          nzDescription="Với các ứng dụng cần lưu trữ lớn, quý khách nên sử dụng ổ cứng
          gắn ngoài để đảm bảo về dữ liệu và khả năng mở rộng dễ
          dàng"
          nzShowIcon
        ></nz-alert>
      </nz-card>

      <nz-card style="border-radius: 8px">
        <div style="margin-bottom: 20px">
          <span class="text-card-header">Network</span>
        </div>
        <div *ngIf="!activeIPv4">
          <button
            style="height: 32px"
            nz-button
            nzType="default"
            (click)="initIPv4()"
          >
            <img
              style="padding-right: 10px; margin-top: -4px"
              src="assets/imgs/add.svg"
              alt=""
            />Bổ sung IPv4
          </button>
        </div>
        <div *ngIf="activeIPv4">
          <nz-card nzHoverable>
            <div class="ant-table">
              <table>
                <thead class="ant-table-thead">
                  <tr>
                    <th>Dải IP</th>
                    <th>Số lượng</th>
                    <th>Giá theo tháng (VNĐ)</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody class="ant-table-tbody">
                  <tr *ngFor="let data of listOfDataIPv4">
                    <td>
                      <nz-select
                        style="width: 85%"
                        nzPlaceHolder="Chọn"
                        name="inputNetwork"
                        [ngModelOptions]="{ standalone: true }"
                        [(ngModel)]="data.ip"
                        [id]="'ip_' + data.id"
                        (ngModelChange)="onInputIPv4($event)"
                        nzSize="large"
                      >
                        <nz-option
                          *ngFor="let p of listIPSubnetModel"
                          [nzValue]="p.networkId"
                          [nzLabel]="p.displayName"
                        ></nz-option>
                      </nz-select>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="data.amount"
                        (ngModelChange)="onInputIPv4($event)"
                        [ngModelOptions]="{ standalone: true }"
                        [id]="'amount_' + data.id"
                        [nzMin]="1"
                        [nzMax]="7"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td>
                      <label class="text-custom-price">
                        {{ data.price | number }}
                      </label>
                    </td>
                    <td>
                      <button
                        *ngIf="data.ip != ''"
                        style="border: none"
                        nz-button
                        (click)="deleteRowIPv4(data.id)"
                      >
                        <img
                          style="margin-top: -4px"
                          src="assets/imgs/trash1.svg"
                        />
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </nz-card>
        </div>
        <div style="margin-top: 5px" *ngIf="!activeIPv6">
          <button
            style="height: 32px; margin-top: 10px"
            nz-button
            nzType="default"
            (click)="initIPv6()"
          >
            <img
              style="padding-right: 10px; margin-top: -4px"
              src="assets/imgs/add.svg"
              alt=""
            />Bổ sung IPv6
          </button>
        </div>
        <div *ngIf="activeIPv6">
          <nz-card nzHoverable>
            <div class="ant-table">
              <table>
                <thead class="ant-table-thead">
                  <tr>
                    <th>Dải IP</th>
                    <th>Số lượng</th>
                    <th>Giá theo tháng (VNĐ)</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody class="ant-table-tbody">
                  <tr *ngFor="let data of listOfDataIPv6">
                    <td>
                      <nz-select
                        style="width: 85%"
                        nzPlaceHolder="Chọn"
                        name="inputNetwork"
                        [ngModelOptions]="{ standalone: true }"
                        [(ngModel)]="data.ip"
                        [id]="'ip_' + data.id"
                        (ngModelChange)="onInputIPv6($event)"
                        nzSize="large"
                      >
                        <nz-option
                          *ngFor="let p of listIPSubnetModel"
                          [nzValue]="p.networkId"
                          [nzLabel]="p.displayName"
                        ></nz-option>
                      </nz-select>
                    </td>
                    <td>
                      <nz-input-number
                        [(ngModel)]="data.amount"
                        (ngModelChange)="onInputIPv6($event)"
                        [ngModelOptions]="{ standalone: true }"
                        [id]="'amount_' + data.id"
                        [nzMin]="1"
                        [nzMax]="7"
                        nzSize="large"
                      ></nz-input-number>
                    </td>
                    <td>
                      <label class="text-custom-price">
                        {{ data.price | number }}
                      </label>
                    </td>
                    <td>
                      <button
                        *ngIf="data.ip != ''"
                        style="border: none"
                        nz-button
                        (click)="deleteRowIPv6(data.id)"
                      >
                        <img
                          style="margin-top: -4px"
                          src="assets/imgs/trash1.svg"
                        />
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </nz-card>
        </div>
        <nz-alert
          style="margin-left: -22px"
          class="ant-alert-warning-custom"
          nzType="warning"
          nzDescription="Địa chỉ IP mà nhà cung cấp dịch vụ internet cung cấp cho router
          gia đình hoặc doanh nghiệp để kết nối với internet"
          nzShowIcon
        ></nz-alert>
      </nz-card>
    </nz-col>
    <nz-col nzSpan="8">
      <nz-card style="border-radius: 8px">
        <div style="margin-bottom: 20px">
          <span class="text-card-header">Chi phí ước tính</span>
        </div>
        <div class="text-value">Tên máy ảo</div>
        <div style="margin-top: 10px" class="text-label">
          {{ instanceCreate.serviceName }}
        </div>
        <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
        <div class="text-value">Hệ điều hành</div>
        <div style="margin-top: 10px" class="text-label">{{ nameHdh }}</div>
        <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
        <div class="text-value">Gói dịch vụ</div>
        <div
          *ngIf="instanceCreate.cpu"
          style="margin-top: 10px"
          class="text-label"
        >
          {{ instanceCreate.cpu }} CPUs
        </div>
        <div
          *ngIf="instanceCreate.ram"
          style="margin-top: 10px"
          class="text-label"
        >
          {{ instanceCreate.ram }} GB RAM
        </div>
        <div
          *ngIf="instanceCreate.volumeSize"
          style="margin-top: 10px"
          class="text-label"
        >
          {{ instanceCreate.volumeSize }} GB Root Disk (<span>{{
            instanceCreate.volumeType | uppercase
          }}</span
          >)
        </div>
        <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
        <div class="text-value">Cài đặt</div>
        <div
          *ngIf="externalVolumeHdd > 0"
          style="margin-top: 10px"
          class="text-label"
        >
          {{ externalVolumeHdd }} GB Data Disk (HDD)
        </div>
        <div
          *ngIf="externalVolumeSsd > 0"
          style="margin-top: 10px"
          class="text-label"
        >
          {{ externalVolumeSsd }} GB Data Disk (SSD)
        </div>
        <div
          *ngIf="numberOfIpv4 > 0"
          style="margin-top: 10px"
          class="text-label"
        >
          {{ numberOfIpv4 }} IPv4
        </div>
        <div
          *ngIf="numberOfIpv6 > 0"
          style="margin-top: 10px"
          class="text-label"
        >
          {{ numberOfIpv6 }} IPv6
        </div>
        <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
        <nz-row style="margin-bottom: 10px" nzGutter="16">
          <nz-col nzSpan="16">
            <span class="text-value"> Chi phí 1 tháng </span>
          </nz-col>
          <nz-col class="text-right" nzSpan="8">
            <span class="text-value" style="color: #0066b3" nzAlign="right">
              {{
                (totalAmount +
                  totalAmountVolume +
                  totalAmountIPv4 +
                  totalAmountIPv6) /
                  numberMonth | number
              }}
              VNĐ
            </span>
          </nz-col>
        </nz-row>
        <nz-row style="margin-bottom: 10px">
          <nz-col style="width: 100%" class="text-right">
            <span class="text-label"> VNĐ/tháng </span>
          </nz-col>
        </nz-row>

        <nz-row
          style="
            margin-bottom: 20px;
            background-color: #cce9ff;
            padding: 16px 0 16px 0;
            border-radius: 8px;
          "
          nzGutter="16"
        >
          <nz-col nzSpan="16">
            <span class="text-label">Tổng thanh toán</span><br />
            <span class="text-note-italicized">(Đã bao gồm 10% VAT)</span>
          </nz-col>
          <nz-col class="text-right" nzSpan="8">
            <span class="text-value" style="color: #ea3829" nzAlign="right">
              {{
                totalincludesVAT +
                  totalAmountVolumeVAT +
                  totalAmountIPv4VAT +
                  totalAmountIPv6VAT | number
              }}
              VNĐ
            </span>
          </nz-col>
        </nz-row>
        <nz-row>
          <nz-col style="width: 100%">
            <button
              style="width: 100%"
              nz-button
              nzSize="large"
              nzType="primary"
              (click)="save()"
              [disabled]="form.invalid"
            >
              <span nz-icon nzType="wallet" nzTheme="outline"></span>
              <span [style.color]="form.invalid ? 'gray' : 'white'"
                >Khởi tạo</span
              >
            </button>
          </nz-col>
        </nz-row>
      </nz-card>
    </nz-col>
  </nz-row>
</form>
