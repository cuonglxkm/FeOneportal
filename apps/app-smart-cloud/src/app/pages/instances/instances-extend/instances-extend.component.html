<page-header>
  <nz-breadcrumb style="float: left">
    <nz-breadcrumb-item>
      <a [routerLink]="['/']">Trang chủ</a>
    </nz-breadcrumb-item>
    <nz-breadcrumb-item>
      <a [routerLink]="['/app-smart-cloud/instances']">Quản lý máy ảo</a>
    </nz-breadcrumb-item>
    <nz-breadcrumb-item>
      <a
        [routerLink]="[
          '/app-smart-cloud/instances/instances-detail/' + this.id
        ]"
        >Chi tiết máy ảo</a
      >
    </nz-breadcrumb-item>
    <nz-breadcrumb-item> Gia hạn máy ảo </nz-breadcrumb-item>
  </nz-breadcrumb>
  <div class="text-right">
    <region-select-dropdown
      (valueChanged)="onRegionChange($event)"
    ></region-select-dropdown>
    <project-select-dropdown
      [regionId]="regionId"
      (userChanged)="onProjectChange($event)"
    ></project-select-dropdown>
  </div>
  <div>
    <nz-row style="margin-bottom: -10px">
      <span class="text-page-header">Gia hạn máy ảo</span>
    </nz-row>
  </div>
</page-header>

<div>
  <nz-row nzGutter="24">
    <nz-col nzSpan="16"
      ><nz-card
        style="border-radius: 8px"
        [nzBordered]="false"
        [nzLoading]="loading"
      >
        <div style="margin-bottom: 20px">
          <span class="text-card-header">Thông tin máy ảo</span>
        </div>
        <div class="customRow">
          <nz-row>
            <nz-col nzSpan="12">
              <nz-row style="padding: 12px 0 12px 0">
                <span class="text-label customSpan" style="width: 35%"
                  >Tên máy ảo:</span
                >
                <span class="text-value-detail customSpan">{{
                  instancesModel.name || ''
                }}</span>
              </nz-row>
            </nz-col>
            <nz-col nzSpan="12">
              <nz-row style="padding: 12px 0 12px 0">
                <span class="text-label" style="width: 35%">Hệ điều hành:</span>
                <span class="text-value-detail"
                  >{{ instancesModel.imageName }}
                  <img
                    style="cursor: pointer; margin-left: 10px"
                    nz-tooltip="Thay đổi"
                    src="assets/imgs/refresh.svg"
                    alt=""
                    (click)="navigateToChangeImage()"
                /></span> </nz-row
            ></nz-col>
          </nz-row>
          <nz-row style="background-color: #e2e2e9">
            <nz-col nzSpan="12">
              <nz-row style="padding: 12px 0 12px 0">
                <span class="text-label customSpan" style="width: 35%"
                  >Gói cấu hình:</span
                >
                <span class="text-value-detail customSpan">{{
                  instancesModel.flavorName | slice : 3
                }}</span>
              </nz-row>
            </nz-col>
            <nz-col nzSpan="12">
              <nz-row style="padding: 12px 0 12px 0">
                <span class="text-label" style="width: 35%"
                  >Truy cập và bảo mật:</span
                >
                <span
                  class="text-value-detail"
                  *ngFor="let item of listSecurityGroupModel; let first = first"
                  >{{ !first ? ', ' : '' }}{{ item.name }}
                </span>
              </nz-row></nz-col
            >
          </nz-row>
          <nz-row>
            <nz-col nzSpan="12">
              <nz-row style="padding: 12px 0 12px 0">
                <span class="text-label customSpan" style="width: 35%"
                  >Trạng thái tác vụ:</span
                >
                <span
                  *ngIf="instancesModel.taskState == 'SHUTOFF'"
                  class="text-value-detail customSpan"
                  style="color: #ea3829"
                  >{{ instancesModel.taskState }}</span
                >
                <span
                  *ngIf="instancesModel.taskState == 'powering-off'"
                  class="text-value-detail customSpan"
                  style="color: #ea3829"
                  >{{ instancesModel.taskState }}</span
                >
                <span
                  *ngIf="instancesModel.taskState == 'ACTIVE'"
                  class="text-value-detail customSpan"
                  style="color: #008d47"
                  >{{ instancesModel.taskState }}</span
                >
                <span
                  *ngIf="instancesModel.taskState == 'powering-on'"
                  class="text-value-detail customSpan"
                  style="color: #008d47"
                  >{{ instancesModel.taskState }}</span
                >
              </nz-row>
            </nz-col>
            <nz-col nzSpan="12">
              <nz-row style="padding: 12px 0 12px 0">
                <span class="text-label" style="width: 35%">IP Public:</span>
                <span class="text-value-detail">{{ listIPPublicStr }}</span>
              </nz-row></nz-col
            >
          </nz-row>
          <nz-row style="background-color: #e2e2e9">
            <nz-col nzSpan="12">
              <nz-row style="padding: 12px 0 12px 0">
                <span class="text-label customSpan" style="width: 35%"
                  >Loại ổ cứng:</span
                >
                <span
                  *ngIf="instancesModel.volumeType == 0"
                  class="text-value-detail customSpan"
                  >HDD</span
                >
                <span
                  *ngIf="instancesModel.volumeType == 1"
                  class="text-value-detail customSpan"
                  >SSD</span
                >
              </nz-row>
            </nz-col>
            <nz-col nzSpan="12">
              <nz-row style="padding: 12px 0 12px 0">
                <span class="text-label" style="width: 35%">IP LAN:</span>
                <span class="text-value-detail">{{ listIPLanStr }}</span>
              </nz-row></nz-col
            >
          </nz-row>
          <nz-row>
            <nz-col nzSpan="12">
              <nz-row style="padding: 12px 0 12px 0">
                <span class="text-label customSpan" style="width: 35%"
                  >Băng thông trong nước:</span
                >
                <span class="text-value-detail customSpan"
                  >{{ instancesModel.bttn || '' }}{{ ' Mbps' }}</span
                >
              </nz-row>
            </nz-col>
            <nz-col nzSpan="12">
              <nz-row style="padding: 12px 0 12px 0">
                <span class="text-label" style="width: 35%"
                  >Băng thông quốc tế:</span
                >
                <span class="text-value-detail"
                  >{{ instancesModel.btqt }}{{ ' Mbps' }}</span
                >
              </nz-row></nz-col
            >
          </nz-row>
        </div>
      </nz-card>

      <nz-card
        style="border-radius: 8px"
        [nzBordered]="false"
        [nzLoading]="loading"
        *ngIf="instancesModel"
      >
        <div style="margin-bottom: 20px">
          <span class="text-card-header">Thông tin gia hạn</span>
        </div>
        <nz-row nzGutter="16">
          <nz-col nzSpan="12">
            <span class="text-label">Ngày cấp dịch vụ: </span>
            <span class="text-value-detail">{{
              instancesModel.createdDate | date : 'dd/MM/yyyy'
            }}</span>
          </nz-col>
          <nz-col nzSpan="12">
            <span class="text-label">Ngày hết hạn: </span>
            <span class="text-value-detail">
              {{ instancesModel.expiredDate | date : 'dd/MM/yyyy' }}</span
            >
          </nz-col>
        </nz-row>
        <nz-row style="margin-top: 20px" nzGutter="16">
          <nz-col nzSpan="12">
            <nz-form-item>
              <nz-form-label>Số tháng cần gia hạn thêm</nz-form-label>
              <nz-form-control>
                <nz-input-number
                  [nzMin]="1"
                  [nzMax]="100"
                  [nzStep]="1"
                  [(ngModel)]="numberMonth"
                  (keydown)="onKeyDown($event)"
                  (ngModelChange)="changeTime($event)"
                  [ngModelOptions]="{ standalone: true }"
                  nzSize="large"
                ></nz-input-number>
              </nz-form-control> </nz-form-item
          ></nz-col>
          <nz-col nzSpan="12">
            <div
              class="text-label text-red"
              style="display: flex; align-items: center"
            >
              Ngày hết hạn dự kiến:
              {{ newExpiredDate | date : 'dd/MM/yyyy' }}
            </div>
          </nz-col>
        </nz-row>
      </nz-card></nz-col
    >
    <nz-col nzSpan="8">
      <nz-card style="border-radius: 8px">
        <div style="margin-bottom: 20px">
          <span class="text-card-header">Chi phí ước tính</span>
        </div>
        <div class="text-value">Tên máy ảo</div>
        <div style="margin-top: 10px" class="text-label">
          {{ instancesModel.name }}
        </div>
        <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
        <div class="text-value">Hệ điều hành</div>
        <div style="margin-top: 10px" class="text-label">
          {{ instancesModel.imageName }}
        </div>
        <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
        <div class="text-value">Gói dịch vụ</div>
        <div
          *ngIf="instancesModel.cpu"
          style="margin-top: 10px"
          class="text-label"
        >
          {{ instancesModel.cpu }} CPUs
        </div>
        <div
          *ngIf="instancesModel.ram"
          style="margin-top: 10px"
          class="text-label"
        >
          {{ instancesModel.ram }} GB RAM
        </div>
        <div style="margin-top: 10px" class="text-label">
          {{ instancesModel.storage }} GB Root Disk (<span
            *ngIf="instancesModel.volumeType == 0"
            >HDD</span
          >
          <span *ngIf="instancesModel.volumeType == 1">SSD</span>)
        </div>
        <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
        <nz-row style="margin-bottom: 10px" nzGutter="16">
          <nz-col nzSpan="16">
            <span class="text-value"> Chi phí 1 tháng </span>
          </nz-col>
          <nz-col class="text-right" nzSpan="8">
            <span class="text-value" style="color: #0066b3" nzAlign="right">
              {{ totalAmount / numberMonth | number }} VND
            </span>
          </nz-col>
        </nz-row>
        <nz-row
          style="
            margin-bottom: 20px;
            background-color: #cce9ff;
            padding: 16px 0 16px 0;
            border-radius: 8px;
          "
          nzGutter="16"
        >
          <nz-col nzSpan="16">
            <span class="text-label">Tổng thanh toán</span><br />
            <span class="text-note-italicized">(Đã bao gồm 10% VAT)</span>
          </nz-col>
          <nz-col class="text-right" nzSpan="8">
            <span class="text-value" style="color: #ea3829" nzAlign="right">
              {{ totalincludesVAT | number }}
              VND
            </span>
          </nz-col>
        </nz-row>
        <nz-row>
          <nz-col style="width: 100%">
            <button
              style="width: 100%"
              nz-button
              nzSize="large"
              nzType="primary"
              (click)="handleOkExtend()"
              [disabled]="isDisable"
            >
              <span nz-icon nzType="wallet" nzTheme="outline"></span>
              Gia hạn
            </button>
          </nz-col>
        </nz-row>
      </nz-card>
    </nz-col>
  </nz-row>
</div>
