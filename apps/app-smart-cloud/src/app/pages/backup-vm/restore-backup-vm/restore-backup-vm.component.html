<page-header
  [breadcrumb]="breadcrumb"
  [action]="action"
  [title]="'app.backup.vm.restore' | i18n"
>
  <ng-template #breadcrumb>
    <nz-breadcrumb [nzSeparator]="iconTemplate">
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">{{ 'app.breadcrumb.home' | i18n }}</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>{{
        'app.breadcrumb.infrastructure.service' | i18n
      }}</nz-breadcrumb-item>
      <nz-breadcrumb-item [routerLink]="'/app-smart-cloud/backup-vm'"
        >Backup VM</nz-breadcrumb-item
      >
      <nz-breadcrumb-item>{{
        'app.backup.vm.restore' | i18n
      }}</nz-breadcrumb-item>
    </nz-breadcrumb>
    <ng-template #iconTemplate
      ><one-portal-svg-icon [icon]="'icon_breadcrumb'"></one-portal-svg-icon
    ></ng-template>
  </ng-template>

  <ng-template #action>
    <div class="alain-custom-action text-right">
      <share-users-combobox></share-users-combobox>
      <region-select-dropdown
        (regionChange)="onRegionChanged($event)"
        (valueChanged)="regionChanged($event)"
      ></region-select-dropdown>
      <project-select-dropdown
        #projectCombobox
        (valueChanged)="projectChanged($event)"
        (userChanged)="userChanged($event)"
        [regionId]="region"
      ></project-select-dropdown>
    </div>
  </ng-template>
</page-header>
<div nz-row [nzGutter]="24">
  <div nz-col [nzSpan]="16">
    <form
      style="width: 100%"
      nz-form
      [formGroup]="validateForm"
      nzLayout="vertical"
    >
      <nz-card style="border-radius: 8px">
        <span class="text-card-header">{{
          'app.backup.vm.Ã¬nformation' | i18n
        }}</span>
        <nz-row nzGutter="24" style="margin-top: 20px">
          <nz-col nzSpan="12">
            <nz-form-item>
              <nz-form-label>
                <span>{{ 'app.table.backup.vm.name' | i18n }}</span>
              </nz-form-label>
              <nz-form-control>
                <input
                  nz-input
                  class="input-custom"
                  [value]="backupVmModel?.name"
                  [disabled]="true"
                />
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label>
                <span>{{ 'app.instances.OS' | i18n }}</span>
              </nz-form-label>
              <nz-form-control>
                <input
                  nz-input
                  class="input-custom"
                  [value]="backupVmModel?.systemInfoBackups[0].osName"
                  [disabled]="true"
                />
              </nz-form-control>
            </nz-form-item>
          </nz-col>
          <nz-col nzSpan="12">
            <nz-form-item>
              <nz-form-label>
                <span>{{ 'app.instances' | i18n }}</span>
              </nz-form-label>
              <nz-form-control>
                <input
                  nz-input
                  class="input-custom"
                  [value]="backupVmModel?.instanceName"
                  [disabled]="true"
                />
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label>
                <span>{{ 'app.backup.size' | i18n }}</span>
              </nz-form-label>
              <nz-form-control>
                <input
                  nz-input
                  class="input-custom"
                  [value]="backupSize + ' GB'"
                  [disabled]="true"
                />
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <nz-form-item>
          <nz-form-label>
            <span style="color: #ff0000"
              >{{ 'app.service.expiration-date' | i18n }} :
              {{ backupVmModel?.expirationDate | date : 'dd/MM/yyyy' }}</span
            >
          </nz-form-label>
        </nz-form-item>
      </nz-card>
      <nz-card style="border-radius: 8px">
        <span class="text-card-header">{{
          'app.info.backup.vm.restore.information' | i18n
        }}</span>
        <nz-radio-group
          [(ngModel)]="selectedOption"
          [ngModelOptions]="{ standalone: true }"
          style="margin-top: 20px; display: grid"
        >
          <label nz-radio nzValue="current">
            {{ 'app.backup.vm.restore.current' | i18n }}</label
          >
          <label nz-radio nzValue="new" style="margin-top: 10px">
            {{ 'app.backup.vm.restore.new' | i18n }}</label
          >
        </nz-radio-group>
        <div *ngIf="selectedOption == 'current'" formGroupName="formCurrent">
          <nz-row nzGutter="24" style="margin-top: 20px">
            <nz-col nzSpan="12">
              <nz-form-item>
                <nz-form-label>
                  <span>{{ 'app.backup.vm.restore.storage.os' | i18n }}</span>
                </nz-form-label>
                <nz-form-control>
                  <input
                    nz-input
                    class="input-custom"
                    [value]="backupVmModel?.size + ' GB'"
                    [disabled]="true"
                  />
                </nz-form-control>
              </nz-form-item>
            </nz-col>
            <nz-col nzSpan="12">
              <nz-form-item>
                <nz-form-label>
                  <span>Security Group</span>
                </nz-form-label>
                <nz-form-control>
                  <nz-select
                    nzMode="multiple"
                    [nzPlaceHolder]="'app.choose.security.group' | i18n"
                    [nzShowSearch]="true"
                    [(ngModel)]="selectedSecurityGroup"
                    [ngModelOptions]="{ standalone: true }"
                    nzSize="large"
                  >
                    <nz-option
                      *ngFor="let sg of listSecurityGroupBackups"
                      [nzLabel]="sg.sgName"
                      [nzValue]="sg.sgName"
                      [nzDisabled]="sg.sgName.toUpperCase() === 'DEFAULT'"
                    />
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </nz-col>
          </nz-row>
        </div>
        <div
          style="margin-bottom: 20px"
          *ngIf="selectedOption == 'new'"
          formGroupName="formNew"
        >
          <div>
            <nz-tabset
              [(nzSelectedIndex)]="selectedIndextab"
              nzCentered
              nzSize="large"
              (keydown)="handleKeyboardEvent($event)"
            >
              <nz-tab
                *ngIf="isVmFlavor"
                [nzTitle]="'app.Preconfigured.Package' | i18n"
                (nzClick)="onClickConfigPackage()"
              >
                <ngu-carousel
                  *ngIf="activeBlockHDD"
                  #myCarouselFlavor
                  [inputs]="carouselTileConfig"
                  [dataSource]="listOfferFlavors"
                >
                  <ngu-tile
                    *nguCarouselDef="let item; let ani = animate"
                    [@slider]="ani"
                  >
                    <div
                      [tabIndex]="0"
                      style="cursor: pointer"
                      (click)="
                        selectElementInputFlavors('flavor_' + item.id);
                        onInputFlavors(item.id)
                      "
                      (keyup.enter)="
                        selectElementInputFlavors('flavor_' + item.id);
                        onInputFlavors(item.id)
                      "
                      [id]="'flavor_' + item.id"
                    >
                      <nz-row>
                        <nz-col
                          style="padding-bottom: 5px"
                          class="newClassFlavor text-center"
                          [class.initialClassFlavor]="
                            selectedElementFlavor === 'flavor_' + item.id
                          "
                        >
                          <div>
                            <span
                              class="nameFlavor"
                              [class.initialNameFlavor]="
                                selectedElementFlavor === 'flavor_' + item.id
                              "
                              >{{ item.offerName | slice : 3 : -4 }}</span
                            >
                            <div style="margin-top: -16px">
                              <img
                                style="width: 100px"
                                [src]="
                                  selectedElementFlavor === 'flavor_' + item.id
                                    ? 'assets/imgs/line2.svg'
                                    : 'assets/imgs/line.svg'
                                "
                                alt=""
                              />
                            </div>
                            <span class="priceFlavor">{{
                              item.price.fixedPrice.amount | number
                            }}</span
                            ><span> VND/{{ 'app.Month' | i18n }}</span>
                          </div>
                        </nz-col>
                      </nz-row>
                      <nz-row>
                        <nz-col
                          style="width: 100%; padding-top: 5px"
                          [class.flavor-footer-active]="
                            selectedElementFlavor === 'flavor_' + item.id
                          "
                          [class.flavor-footer]="
                            selectedElementFlavor != 'flavor_' + item.id
                          "
                        >
                          <div>
                            <p>{{ item.description }}</p>
                          </div>
                        </nz-col>
                      </nz-row>
                    </div>
                  </ngu-tile>

                  <ul class="myPoint" NguCarouselPoint>
                    <li
                      *ngFor="let i of myCarouselFlavor.pointNumbers"
                      [class.active]="i === myCarouselFlavor.activePoint"
                      (click)="myCarouselFlavor.moveTo(i)"
                    ></li>
                  </ul>
                </ngu-carousel>
                <ngu-carousel
                  *ngIf="activeBlockSSD"
                  #myCarouselFlavor
                  [inputs]="carouselTileConfig"
                  [dataSource]="listOfferFlavors"
                >
                  <ngu-tile
                    *nguCarouselDef="let item; let ani = animate"
                    [@slider]="ani"
                  >
                    <div
                      [tabIndex]="0"
                      style="cursor: pointer"
                      (click)="
                        selectElementInputFlavors('flavor_' + item.id);
                        onInputFlavors(item.id)
                      "
                      (keyup.enter)="
                        selectElementInputFlavors('flavor_' + item.id);
                        onInputFlavors(item.id)
                      "
                      [id]="'flavor_' + item.id"
                    >
                      <nz-row>
                        <nz-col
                          style="padding-bottom: 5px"
                          class="newClassFlavor text-center"
                          [class.initialClassFlavor]="
                            selectedElementFlavor === 'flavor_' + item.id
                          "
                        >
                          <div>
                            <span
                              class="nameFlavor"
                              [class.initialNameFlavor]="
                                selectedElementFlavor === 'flavor_' + item.id
                              "
                              >{{ item.offerName | slice : 3 : -4 }}</span
                            >
                            <div style="margin-top: -16px">
                              <img
                                style="width: 100px"
                                [src]="
                                  selectedElementFlavor === 'flavor_' + item.id
                                    ? 'assets/imgs/line2.svg'
                                    : 'assets/imgs/line.svg'
                                "
                                alt=""
                              />
                            </div>
                            <span class="priceFlavor">{{
                              item.price.fixedPrice.amount | number
                            }}</span
                            ><span> VND/{{ 'app.Month' | i18n }}</span>
                          </div>
                        </nz-col>
                      </nz-row>
                      <nz-row>
                        <nz-col
                          style="width: 100%; padding-top: 5px"
                          [class.flavor-footer-active]="
                            selectedElementFlavor === 'flavor_' + item.id
                          "
                          [class.flavor-footer]="
                            selectedElementFlavor != 'flavor_' + item.id
                          "
                        >
                          <div>
                            <p>{{ item.description }}</p>
                          </div>
                        </nz-col>
                      </nz-row>
                    </div>
                  </ngu-tile>

                  <ul class="myPoint" NguCarouselPoint>
                    <li
                      *ngFor="let i of myCarouselFlavor.pointNumbers"
                      [class.active]="i === myCarouselFlavor.activePoint"
                      (click)="myCarouselFlavor.moveTo(i)"
                    ></li>
                  </ul>
                </ngu-carousel>
              </nz-tab>
              <nz-tab
                [nzTitle]="'app.custom.configuration' | i18n"
                (nzClick)="onClickCustomConfig()"
              >
                <div class="ant-table">
                  <table>
                    <thead class="ant-table-thead">
                      <tr>
                        <th>{{ 'app.resource' | i18n }}</th>
                        <th>{{ 'app.amount' | i18n }}</th>
                        <th>{{ 'app.money.price' | i18n }} (VND)</th>
                      </tr>
                    </thead>
                    <tbody class="ant-table-tbody">
                      <tr>
                        <td style="width: 50%">
                          <nz-form-label style="margin-left: -12px"
                            >{{ 'app.capacity' | i18n }} (<span class="text-red"
                              >*</span
                            >) - GB</nz-form-label
                          >
                          <nz-slider
                            [nzMin]="minCapacity"
                            [nzMax]="maxCapacity"
                            [nzStep]="stepCapacity"
                            [(ngModel)]="configCustom.capacity"
                            (ngModelChange)="changeCapacity($event)"
                            [ngModelOptions]="{ standalone: true }"
                          ></nz-slider>
                        </td>
                        <td>
                          <nz-input-number
                            [(ngModel)]="configCustom.capacity"
                            (keydown)="onKeyDown($event)"
                            (ngModelChange)="changeCapacity($event)"
                            [ngModelOptions]="{ standalone: true }"
                            [nzMin]="minCapacity"
                            [nzMax]="maxCapacity"
                            [nzStep]="stepCapacity"
                            nzSize="large"
                          ></nz-input-number>
                        </td>
                        <td nzAlign="right">
                          <label class="text-custom-price">
                            {{ volumeIntoMoney | number }} </label
                          ><br />
                          <label class="text-custom-unit-price">
                            {{ volumeUnitPrice | number }}
                          </label>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <nz-form-label style="margin-left: -12px"
                            >RAM (<span class="text-red">*</span>) -
                            GB</nz-form-label
                          >
                          <nz-slider
                            [nzMin]="0"
                            [nzMax]="62"
                            [(ngModel)]="configCustom.ram"
                            (ngModelChange)="changeRam($event)"
                            [ngModelOptions]="{ standalone: true }"
                          ></nz-slider>
                        </td>
                        <td>
                          <nz-input-number
                            [(ngModel)]="configCustom.ram"
                            (keydown)="onKeyDown($event)"
                            (ngModelChange)="changeRam($event)"
                            [ngModelOptions]="{ standalone: true }"
                            [nzMin]="0"
                            [nzMax]="62"
                            [nzStep]="1"
                            nzSize="large"
                          ></nz-input-number>
                        </td>

                        <td nzAlign="right">
                          <label class="text-custom-price">
                            {{ ramIntoMoney | number }} </label
                          ><br />
                          <label class="text-custom-unit-price">
                            {{ ramUnitPrice | number }}
                          </label>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <nz-form-label style="margin-left: -12px"
                            >CPU (<span class="text-red">*</span>) -
                            vCPU</nz-form-label
                          >
                          <nz-slider
                            [nzMin]="0"
                            [nzMax]="62"
                            [(ngModel)]="configCustom.vCPU"
                            (ngModelChange)="changeVCPU($event)"
                            [ngModelOptions]="{ standalone: true }"
                          ></nz-slider>
                        </td>
                        <td>
                          <nz-input-number
                            [(ngModel)]="configCustom.vCPU"
                            (keydown)="onKeyDown($event)"
                            (ngModelChange)="changeVCPU($event)"
                            [ngModelOptions]="{ standalone: true }"
                            [nzMin]="0"
                            [nzMax]="62"
                            [nzStep]="1"
                            nzSize="large"
                          ></nz-input-number>
                        </td>
                        <td nzAlign="right">
                          <label class="text-custom-price">
                            {{ cpuIntoMoney | number }} </label
                          ><br />
                          <label class="text-custom-unit-price">
                            {{ cpuUnitPrice | number }}
                          </label>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </nz-tab>
              <nz-tab
                *ngIf="isVmGpu && activeBlockSSD"
                [nzTitle]="'app.gpu.configuration' | i18n"
                (nzClick)="onClickGpuConfig()"
              >
                <div class="ant-table">
                  <table>
                    <thead class="ant-table-thead">
                      <tr>
                        <th>{{ 'app.resource' | i18n }}</th>
                        <th>{{ 'app.amount' | i18n }}</th>
                        <th>{{ 'app.money.price' | i18n }} (VND)</th>
                      </tr>
                    </thead>
                    <tbody class="ant-table-tbody">
                      <tr>
                        <td style="width: 50%">
                          <nz-form-label style="margin-left: -12px"
                            >{{ 'app.ssd.capacity' | i18n }} (<span
                              class="text-red"
                              >*</span
                            >) - GB</nz-form-label
                          >
                          <nz-slider
                            [nzMin]="minCapacity"
                            [nzMax]="maxCapacity"
                            [nzStep]="stepCapacity"
                            [(ngModel)]="configGPU.storage"
                            (ngModelChange)="changeStorageOfGpu($event)"
                            [ngModelOptions]="{ standalone: true }"
                          ></nz-slider>
                        </td>
                        <td>
                          <nz-input-number
                            [(ngModel)]="configGPU.storage"
                            (keydown)="onKeyDown($event)"
                            (ngModelChange)="changeStorageOfGpu($event)"
                            [ngModelOptions]="{ standalone: true }"
                            [nzMin]="minCapacity"
                            [nzMax]="maxCapacity"
                            [nzStep]="stepCapacity"
                            nzSize="large"
                          ></nz-input-number>
                        </td>
                        <td nzAlign="right">
                          <label class="text-custom-price">
                            {{ volumeIntoMoney | number }} </label
                          ><br />
                          <label class="text-custom-unit-price">
                            {{ volumeUnitPrice | number }}
                          </label>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <nz-form-label style="margin-left: -12px"
                            >RAM (<span class="text-red">*</span>) -
                            GB</nz-form-label
                          >
                          <nz-slider
                            [nzMin]="0"
                            [nzMax]="62"
                            [(ngModel)]="configGPU.ram"
                            (ngModelChange)="changeRamOfGpu($event)"
                            [ngModelOptions]="{ standalone: true }"
                          ></nz-slider>
                        </td>
                        <td>
                          <nz-input-number
                            [(ngModel)]="configGPU.ram"
                            (keydown)="onKeyDown($event)"
                            (ngModelChange)="changeRamOfGpu($event)"
                            [ngModelOptions]="{ standalone: true }"
                            [nzMin]="0"
                            [nzMax]="62"
                            [nzStep]="1"
                            nzSize="large"
                          ></nz-input-number>
                        </td>

                        <td nzAlign="right">
                          <label class="text-custom-price">
                            {{ ramIntoMoney | number }} </label
                          ><br />
                          <label class="text-custom-unit-price">
                            {{ ramUnitPrice | number }}
                          </label>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <nz-form-label style="margin-left: -12px"
                            >CPU (<span class="text-red">*</span>) -
                            vCPU</nz-form-label
                          >
                          <nz-slider
                            [nzMin]="0"
                            [nzMax]="62"
                            [(ngModel)]="configGPU.CPU"
                            (ngModelChange)="changeCpuOfGpu($event)"
                            [ngModelOptions]="{ standalone: true }"
                          ></nz-slider>
                        </td>
                        <td>
                          <nz-input-number
                            [(ngModel)]="configGPU.CPU"
                            (keydown)="onKeyDown($event)"
                            (ngModelChange)="changeCpuOfGpu($event)"
                            [ngModelOptions]="{ standalone: true }"
                            [nzMin]="0"
                            [nzMax]="62"
                            [nzStep]="1"
                            nzSize="large"
                          ></nz-input-number>
                        </td>
                        <td nzAlign="right">
                          <label class="text-custom-price">
                            {{ cpuIntoMoney | number }} </label
                          ><br />
                          <label class="text-custom-unit-price">
                            {{ cpuUnitPrice | number }}
                          </label>
                        </td>
                      </tr>
                      <tr>
                        <td style="width: 50%">
                          <nz-form-label style="margin-left: -12px"
                            >{{ 'app.choose.gpu.type' | i18n }} (<span
                              class="text-red"
                              >*</span
                            >)</nz-form-label
                          >
                          <style>
                            ::ng-deep nz-form-control {
                              padding-left: 0px !important;
                              padding-right: 0px !important;
                            }
                          </style>
                          <nz-form-control>
                            <nz-select
                              [nzPlaceHolder]="
                                '-- ' + ('app.choose.gpu.type' | i18n) + ' --'
                              "
                              [nzShowSearch]="true"
                              [(ngModel)]="configGPU.gpuOfferId"
                              (ngModelChange)="changeGpuType()"
                              [ngModelOptions]="{ standalone: true }"
                              nzSize="large"
                            >
                              <nz-option
                                *ngFor="let i of listGPUType"
                                [nzLabel]="i.offerName"
                                [nzValue]="i.id"
                              />
                            </nz-select>
                          </nz-form-control>
                        </td>
                        <td>
                          <nz-select
                            style="
                              margin-left: 8px;
                              margin-top: 32px;
                              width: 90px;
                            "
                            [nzShowSearch]="true"
                            [(ngModel)]="configGPU.GPU"
                            (ngModelChange)="changeGpu()"
                            [ngModelOptions]="{ standalone: true }"
                            nzSize="large"
                          >
                            <nz-option
                              *ngFor="let i of listOptionGpuValue"
                              [nzLabel]="i"
                              [nzValue]="i"
                            />
                          </nz-select>
                        </td>
                        <td nzAlign="right">
                          <label class="text-custom-price">
                            {{ gpuIntoMoney | number }} </label
                          ><br />
                          <label class="text-custom-unit-price">
                            {{ gpuUnitPrice | number }}
                          </label>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  <nz-alert
                    *ngIf="configRecommend"
                    style="margin-top: 20px"
                    nzType="warning"
                    [nzDescription]="
                      'app.alert.config.gpu.recommend'
                        | i18n
                          : {
                              type: gpuTypeName,
                              gpu: configRecommend.gpuCount,
                              ssd: configRecommend.ssd,
                              ram: configRecommend.ram,
                              cpu: configRecommend.cpu
                            }
                    "
                    nzShowIcon
                  ></nz-alert>
                </div>
              </nz-tab>
            </nz-tabset>
            <label
              *ngIf="isSupportEncryption"
              style="margin-top: 20px"
              nz-checkbox
              [(ngModel)]="restoreInstanceBackup.encryption"
              [ngModelOptions]="{ standalone: true }"
              [disabled]="isSnapshot"
              >{{ 'volume.info.type.encrypt' | i18n }}
              <img
                [nz-tooltip]="'volume.tooltip.type.encrypt' | i18n"
                src="assets/imgs/pajamas_question.svg"
                alt=""
                [nzPopoverOverlayStyle]="{ width: '320px' }"
              />
            </label>
            <nz-row style="margin-top: 20px" nzGutter="16">
              <nz-col nzLg="12" nzMd="12" nzSm="24">
                <nz-form-item>
                  <nz-form-label>
                    <span
                      >{{ 'app.instances.name' | i18n }} (<span
                        style="color: #ff0000"
                        >*</span
                      >)</span
                    >
                    <img
                      style="margin-left: 10px"
                      nz-popover
                      [nzPopoverPlacement]="'bottom'"
                      [nzPopoverContent]="'app.tooltip.instance.name' | i18n"
                      src="assets/imgs/pajamas_question.svg"
                      alt=""
                    />
                  </nz-form-label>
                  <nz-form-control
                    nzDisableAutoTips
                    [nzErrorTip]="nameErrorTpl"
                  >
                    <input
                      #nameInput
                      class="input-custom"
                      nz-input
                      formControlName="name"
                      [(ngModel)]="restoreInstanceBackup.serviceName"
                      (ngModelChange)="changeName($event)"
                      [placeholder]="'app.input.name' | i18n"
                      [maxlength]="50"
                    />
                    <div *ngIf="isExistName" style="color: #ff4d4f">
                      {{ 'validation.exist.instance.name' | i18n }}
                    </div>
                    <ng-template #nameErrorTpl let-control>
                      <ng-container *ngIf="control.hasError('required')"
                        >{{ 'validation.info.required' | i18n }}
                      </ng-container>
                      <ng-container *ngIf="control.hasError('pattern')"
                        >{{ 'validation.name.pattern' | i18n }}
                      </ng-container>
                    </ng-template>
                  </nz-form-control>
                </nz-form-item>
              </nz-col>
              <nz-col nzLg="12" nzMd="12" nzSm="24">
                <nz-form-item>
                  <nz-form-label>{{
                    'app.choose.security.group' | i18n
                  }}</nz-form-label>
                  <nz-form-control>
                    <nz-select
                      nzMode="multiple"
                      [ngModelOptions]="{ standalone: true }"
                      [(ngModel)]="selectedSecurityGroup"
                      [nzShowSearch]="true"
                      nzSize="large"
                    >
                      <nz-option
                        *ngFor="let sg of listSecurityGroupBackups"
                        [nzLabel]="sg.sgName"
                        [nzValue]="sg.sgName"
                        [nzDisabled]="sg.sgName.toUpperCase() === 'DEFAULT'"
                      />
                    </nz-select>
                  </nz-form-control>
                </nz-form-item>
              </nz-col>
            </nz-row>
            <nz-row nzGutter="16">
              <nz-col nzLg="12" nzMd="12" nzSm="24">
                <nz-form-item
                  ><nz-form-label
                    >{{ 'app.choose.ip.public' | i18n }} (<span class="text-red"
                      >*</span
                    >)<img
                      style="margin-left: 10px"
                      nz-popover
                      [nzPopoverContent]="contentTemplateIPPublic"
                      src="assets/imgs/pajamas_question.svg"
                      alt=""
                    /><ng-template #contentTemplateIPPublic>
                      <span
                        [innerHTML]="'app.tooltip.instance.ip.public' | i18n"
                      ></span>
                      <a
                        [routerLink]="[
                          '/app-smart-cloud/networks/ip-floating/list'
                        ]"
                        >{{ 'app.ip.floating' | i18n }}</a
                      >
                    </ng-template></nz-form-label
                  >
                  <nz-form-control>
                    <nz-select
                      [nzPlaceHolder]="'menu.dashboard.v1' | i18n"
                      [nzShowSearch]="true"
                      [(ngModel)]="ipPublicValue"
                      [ngModelOptions]="{ standalone: true }"
                      nzSize="large"
                    >
                      <nz-option
                        [nzLabel]="'menu.dashboard.v1' | i18n"
                        [nzValue]="0"
                      />
                      <nz-option
                        *ngFor="let i of listIPPublic"
                        [nzLabel]="i.ipAddress || i.networkId"
                        [nzValue]="i.id"
                      />
                    </nz-select>
                  </nz-form-control>
                </nz-form-item>
              </nz-col>
              <nz-col nzLg="12" nzMd="12" nzSm="24">
                <nz-form-item>
                  <nz-form-label
                    >{{ 'app.choose.vlan.instance' | i18n }} (<span
                      class="text-red"
                      >*</span
                    >)</nz-form-label
                  >
                  <nz-form-control>
                    <nz-select
                      [nzShowSearch]="true"
                      [(ngModel)]="vlanNetwork"
                      (ngModelChange)="getListPort()"
                      [ngModelOptions]="{ standalone: true }"
                      nzSize="large"
                    >
                      <nz-option
                        [nzLabel]="'app.do.not.use' | i18n"
                        [nzValue]="''"
                      />
                      <nz-option
                        *ngFor="let i of listVlanNetwork"
                        [nzLabel]="i.name"
                        [nzValue]="i.cloudId"
                      />
                    </nz-select>
                  </nz-form-control>
                </nz-form-item>
              </nz-col>
            </nz-row>
            <nz-row *ngIf="!hidePort" nzGutter="24">
              <nz-col nzSpan="12">
                <nz-form-item>
                  <nz-form-label
                    >{{ 'app.choose.port' | i18n }} (<span class="text-red"
                      >*</span
                    >)</nz-form-label
                  >
                  <nz-form-control>
                    <nz-select
                      [nzShowSearch]="true"
                      [(ngModel)]="port"
                      [ngModelOptions]="{ standalone: true }"
                      nzSize="large"
                    >
                      <nz-option
                        *ngFor="let i of listPort"
                        [nzLabel]="i.fixedIPs[0]"
                        [nzValue]="i.id"
                      />
                    </nz-select>
                  </nz-form-control>
                </nz-form-item>
              </nz-col>
            </nz-row>
            <nz-row>
              <nz-form-label nzFor="name"
                >{{ 'app.access.method.instance' | i18n }} (<span
                  class="text-red"
                  >*</span
                >)<img
                  style="margin-left: 10px"
                  [nz-tooltip]="'app.tooltip.access.method.instance' | i18n"
                  src="assets/imgs/pajamas_question.svg"
                  alt=""
              /></nz-form-label>
            </nz-row>
            <nz-row nzGutter="16">
              <nz-radio-group
                style="width: 100%; display: inline-flex"
                name="selectedPasswordOrSSHkey"
              >
                <nz-col nzXs="24" nzMd="12" nzLg="12">
                  <nz-card
                    style="border-radius: 4px"
                    [ngStyle]="{
                      border: activeBlockPassword
                        ? '1px solid #0066B3'
                        : '1px solid #DADADA'
                    }"
                  >
                    <nz-card-meta
                      [nzAvatar]="nzAvatarselectedPasswordOrSSHkey1"
                      [nzTitle]="nzTitleselectedPasswordOrSSHkey1"
                      [nzDescription]="nzDescriptionselectedPasswordOrSSHkey1"
                    >
                      <ng-template #nzAvatarselectedPasswordOrSSHkey1>
                        <label
                          [tabIndex]="0"
                          nz-radio
                          [ngModel]="activeBlockPassword"
                          [ngModelOptions]="{ standalone: true }"
                          (click)="initPassword()"
                          (keyup.enter)="initPassword()"
                        ></label>
                      </ng-template>
                      <ng-template #nzTitleselectedPasswordOrSSHkey1>
                        <b>{{ 'app.password' | i18n }} </b>
                      </ng-template>
                      <ng-template #nzDescriptionselectedPasswordOrSSHkey1>
                        <ellipsis class="text-custom">
                          {{ 'app.password.intro.text' | i18n }}</ellipsis
                        >
                      </ng-template>
                    </nz-card-meta>
                  </nz-card>
                </nz-col>
                <nz-col nzXs="24" nzMd="12" nzLg="12">
                  <nz-card
                    style="border-radius: 4px"
                    [ngStyle]="{
                      border: activeBlockSSHKey
                        ? '1px solid #0066B3'
                        : '1px solid #DADADA'
                    }"
                  >
                    <nz-card-meta
                      [nzAvatar]="nzAvatarselectedPasswordOrSSHkey2"
                      [nzTitle]="nzTitleselectedPasswordOrSSHkey2"
                      [nzDescription]="nzDescriptionselectedPasswordOrSSHkey2"
                    >
                      <ng-template #nzAvatarselectedPasswordOrSSHkey2>
                        <label
                          [tabIndex]="0"
                          nz-radio
                          [ngModel]="activeBlockSSHKey"
                          [ngModelOptions]="{ standalone: true }"
                          (click)="initSSHkey()"
                          (keyup.enter)="initSSHkey()"
                          [disabled]="disableKeypair"
                        ></label>
                      </ng-template>
                      <ng-template #nzTitleselectedPasswordOrSSHkey2>
                        <b>Keypair</b>
                      </ng-template>
                      <ng-template #nzDescriptionselectedPasswordOrSSHkey2>
                        <ellipsis class="text-custom">
                          {{ 'app.keypair.intro.text' | i18n }}</ellipsis
                        >
                      </ng-template>
                    </nz-card-meta>
                  </nz-card>
                </nz-col>
              </nz-radio-group>
              <div *ngIf="activeBlockPassword" style="width: 100%">
                <nz-col nzSpan="24">
                  <nz-form-item>
                    <nz-form-label nzFor="name"
                      >{{ 'app.label.instance.password' | i18n }} (<span
                        class="text-red"
                        >*</span
                      >)</nz-form-label
                    >
                    <nz-form-control [nzErrorTip]="passwordErrorTpl">
                      <nz-input-group
                        [nzSuffix]="suffixTemplate"
                        style="width: 100%"
                      >
                        <input
                          class="input-custom"
                          [type]="passwordVisible ? 'text' : 'password'"
                          nz-input
                          [placeholder]="'app.input.password' | i18n"
                          formControlName="passOrKeyFormControl"
                          [(ngModel)]="password"
                        />
                      </nz-input-group>
                      <ng-template #suffixTemplate>
                        <img
                          style="margin-top: -4px"
                          [src]="
                            passwordVisible
                              ? 'assets/imgs/eye-close.svg'
                              : 'assets/imgs/eye1.svg'
                          "
                          alt=""
                          (click)="passwordVisible = !passwordVisible"
                        />
                      </ng-template>
                    </nz-form-control>
                    <ng-template #passwordErrorTpl let-control>
                      <ng-container *ngIf="control.hasError('required')">{{
                        'validation.instance.password.required' | i18n
                      }}</ng-container>
                      <ng-container *ngIf="control.hasError('pattern')">{{
                        'validation.password.pattern' | i18n
                      }}</ng-container>
                    </ng-template>
                  </nz-form-item>
                </nz-col>

                <nz-col nzSpan="24">
                  <nz-alert
                    nzType="warning"
                    [nzDescription]="nzDescriptionWarning06"
                    nzShowIcon
                  ></nz-alert>
                  <ng-template #nzDescriptionWarning06>
                    <div>
                      {{ 'app.alert.password' | i18n }}
                    </div>
                  </ng-template>
                </nz-col>
              </div>
              <div *ngIf="activeBlockSSHKey" style="width: 100%">
                <nz-col nzSpan="24">
                  <nz-form-item>
                    <nz-form-label
                      >{{ 'app.choose.keypair' | i18n }} (<span class="text-red"
                        >*</span
                      >)</nz-form-label
                    >
                    <nz-form-control [nzErrorTip]="keypairErrorTpl">
                      <nz-select
                        *ngIf="activeBlockSSHKey"
                        [nzPlaceHolder]="
                          '-- ' + ('app.choose.keypair' | i18n) + ' --'
                        "
                        [nzShowSearch]="true"
                        formControlName="passOrKeyFormControl"
                        [(ngModel)]="selectedSSHKeyName"
                        nzSize="large"
                      >
                        <nz-option
                          *ngFor="let i of listSSHKey"
                          [nzLabel]="i.displayName"
                          [nzValue]="i.displayName"
                        />
                      </nz-select>
                    </nz-form-control>
                    <ng-template #keypairErrorTpl let-control>
                      <ng-container *ngIf="control.hasError('required')">{{
                        'validation.choose.required'
                          | i18n : { name: 'keypair' }
                      }}</ng-container>
                    </ng-template>
                  </nz-form-item>
                </nz-col>
                <nz-form-label style="margin-bottom: 20px">
                  {{ 'app.instances.keypair.label' | i18n }}&nbsp;
                  <a [routerLink]="['/app-smart-cloud/keypair']">{{
                    'app.label.create' | i18n
                  }}</a>
                </nz-form-label>
                <nz-col nzSpan="24">
                  <nz-alert
                    nzType="warning"
                    [nzDescription]="nzDescriptionWarning07"
                    nzShowIcon
                  ></nz-alert>
                  <ng-template #nzDescriptionWarning07>
                    <div>
                      {{ 'app.alert.keypair' | i18n }}
                      <a
                        href="https://docs.smartcloud.vn/index.php/knowledge-base/su-dung-keypair/"
                        target="_blank"
                        >{{ 'app.here' | i18n }}
                      </a>
                      <br />
                      {{ 'app.alert.keypair.next' | i18n }}
                    </div>
                  </ng-template>
                </nz-col>
              </div>
            </nz-row>
          </div>
        </div>
        <nz-row nzGutter="24">
          <nz-col nzSpan="24">
            <nz-form-item>
              <nz-form-label>
                <span>{{ 'app.info.backup.vm.external.volume' | i18n }}</span>
              </nz-form-label>
              <nz-form-control>
                <nz-select
                  nzMode="multiple"
                  [nzPlaceHolder]="
                    'app.choose.backup.vm.external.volume' | i18n
                  "
                  [nzShowSearch]="true"
                  [(ngModel)]="listAttachVolume"
                  (ngModelChange)="changeAttachVolume()"
                  [ngModelOptions]="{ standalone: true }"
                  nzSize="large"
                >
                  <nz-option
                    *ngFor="let e of listExternalAttachVolume"
                    [nzLabel]="e.name"
                    [nzValue]="e"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
        <div
          *ngIf="listOfDataBlockStorage.length > 0"
          class="text-center"
          style="margin-bottom: 20px"
        >
          <span class="text-header-attach-volume"
            >{{ 'app.backup.config.vm.attach' | i18n }}
          </span>
        </div>
        <div *ngIf="listOfDataBlockStorage.length > 0">
          <div class="ant-table">
            <table>
              <thead class="ant-table-thead">
                <tr>
                  <th>{{ 'app.backup.volume.root' | i18n }}</th>
                  <th *ngIf="selectedOption == 'new'">
                    {{ 'app.backup.volume.restore' | i18n }}
                  </th>
                  <th>{{ 'app.volume.type' | i18n }}</th>
                  <th>{{ 'app.capacity' | i18n }} (GB)</th>
                  <th *ngIf="isSupportEncryption">
                    {{ 'app.encrypt' | i18n }}
                  </th>
                  <th *ngIf="isSupportMultiAttachment">Multi Attach</th>
                  <th *ngIf="selectedOption == 'new'">
                    {{ 'app.monthly.price' | i18n }} (VND)
                  </th>
                </tr>
              </thead>
              <tbody class="ant-table-tbody">
                <tr *ngFor="let data of listOfDataBlockStorage; let i = index">
                  <td>
                    <input
                      class="input-custom"
                      type="text"
                      [ngModelOptions]="{ standalone: true }"
                      nz-input
                      [(ngModel)]="data.name"
                      [disabled]="true"
                    />
                  </td>
                  <td *ngIf="selectedOption == 'new'">
                    <input
                      class="input-custom"
                      type="text"
                      [placeholder]="'app.input.name' | i18n"
                      [ngModelOptions]="{ standalone: true }"
                      nz-input
                      [maxlength]="50"
                      [(ngModel)]="data.newName"
                    />
                  </td>
                  <td>
                    <input
                      class="input-custom"
                      type="text"
                      [ngModelOptions]="{ standalone: true }"
                      nz-input
                      [(ngModel)]="data.type"
                      [disabled]="true"
                    />
                  </td>
                  <td>
                    <nz-input-number
                      [(ngModel)]="data.capacity"
                      (keydown)="onKeyDown($event)"
                      (ngModelChange)="
                        changeTotalAmountBlockStorage(data.id, $event)
                      "
                      [ngModelOptions]="{ standalone: true }"
                      [id]="'capacity_' + data.id"
                      [nzMin]="data.minCapacity"
                      [nzMax]="maxCapacity"
                      [nzStep]="stepCapacity"
                      [disabled]="selectedOption == 'current'"
                      nzSize="large"
                    ></nz-input-number>
                  </td>
                  <td *ngIf="isSupportEncryption" nzAlign="center">
                    <label
                      nz-checkbox
                      [ngModel]="data.isEncryption"
                      [ngModelOptions]="{ standalone: true }"
                      [disabled]="true"
                    ></label>
                  </td>
                  <td *ngIf="isSupportMultiAttachment" nzAlign="center">
                    <label
                      nz-checkbox
                      [ngModel]="data.isMultiAttach"
                      [ngModelOptions]="{ standalone: true }"
                      [disabled]="true"
                    ></label>
                  </td>
                  <td nzAlign="right" *ngIf="selectedOption == 'new'">
                    <label class="text-custom-price">
                      {{ data.price | number }}
                    </label>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </nz-card>
      <one-portal-service-usage-period
        *ngIf="selectedOption == 'new'"
        [nameService]="'instance'"
        (valueChanged)="onChangeTime($event)"
      ></one-portal-service-usage-period>
    </form>
  </div>
  <div nz-col [nzSpan]="8">
    <div style="width: 100%">
      <nz-affix [nzOffsetTop]="72">
        <nz-card
          *ngIf="selectedOption == 'new'"
          class="card-border"
          style="border-radius: 8px; width: 100%"
        >
          <div style="margin-bottom: 20px">
            <span class="text-card-header">{{
              'app.estimated.cost' | i18n
            }}</span>
          </div>
          <div class="card-money">
            <div class="text-value">{{ 'app.instances.name' | i18n }}</div>
            <div style="margin-top: 10px" class="text-label">
              {{ restoreInstanceBackup.serviceName }}
            </div>
            <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
            <div class="text-value">{{ 'app.instances.OS' | i18n }}</div>
            <div style="margin-top: 10px" class="text-label">
              {{ backupVmModel?.systemInfoBackups[0].osName }}
            </div>
            <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
            <div class="text-value">{{ 'app.text.package' | i18n }}</div>
            <div style="margin-top: 10px" class="text-label">
              {{ restoreInstanceBackup.cpu }} vCPU
            </div>
            <div style="margin-top: 10px" class="text-label">
              {{ restoreInstanceBackup.ram }} GB RAM
            </div>
            <div style="margin-top: 10px" class="text-label">
              {{ restoreInstanceBackup.volumeSize }} GB Root Disk (<span>{{
                activeBlockHDD ? 'HDD' : 'SSD'
              }}</span
              >)
            </div>
            <div
              *ngIf="isGpuConfig"
              style="margin-top: 10px"
              class="text-label"
            >
              {{ restoreInstanceBackup.gpuCount }} GPU ({{ gpuTypeName }})
            </div>
            <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
            <div class="text-value">
              {{ 'app.info.backup.vm.external.volume' | i18n }}
            </div>
            <div *ngFor="let v of listOfDataBlockStorage; let last = last">
              <div style="margin-top: 10px" class="text-label">
                {{ v.capacity }} GB {{ v.name }} ({{ v.type }})
              </div>
            </div>
          </div>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <nz-row style="margin-bottom: 10px" nzGutter="16">
            <nz-col nzSpan="16">
              <span *ngIf="numberMonth == 1" class="text-value">
                {{ 'app.cost.a.month' | i18n }}
              </span>
              <span *ngIf="numberMonth > 1" class="text-value">
                {{ 'app.cost.n.month' | i18n : { numberMonth: numberMonth } }}
              </span>
            </nz-col>
            <nz-col class="text-right" nzSpan="8">
              <span class="text-value" style="color: #0066b3" nzAlign="right">
                {{ totalAmount | number }} VND
              </span>
            </nz-col>
          </nz-row>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <nz-row style="margin-bottom: 10px" nzGutter="16">
            <nz-col nzSpan="16">
              <span class="text-value">
                {{ 'app.cost.vat' | i18n }}
              </span>
            </nz-col>
            <nz-col class="text-right" nzSpan="8">
              <span class="text-value" style="color: #0066b3" nzAlign="right">
                {{ totalVAT | number }} VND
              </span>
            </nz-col>
          </nz-row>
          <nz-row
            style="
              margin-bottom: 20px;
              background-color: #cce9ff;
              padding: 16px 0 16px 0;
              border-radius: 8px;
            "
            nzGutter="16"
          >
            <nz-col nzSpan="16">
              <span class="text-label">{{ 'app.total.payment' | i18n }}</span
              ><br />
              <span class="text-note-italicized"
                >({{ 'app.include.vat' | i18n : { vat: '10' } }})</span
              >
            </nz-col>
            <nz-col class="text-right" nzSpan="8">
              <span class="text-value" style="color: #ea3829" nzAlign="right">
                {{ totalincludesVAT | number : '1.0-0' }} VND
              </span>
            </nz-col>
          </nz-row>
          <nz-row>
            <nz-col style="width: 100%">
              <button
                style="width: 100%"
                nz-button
                nzSize="large"
                nzType="primary"
                [nzLoading]="isLoading"
                (click)="restore()"
                [disabled]="
                  !isValid ||
                  formNew.invalid ||
                  isExistName ||
                  totalincludesVAT == 0
                "
              >
                <img
                  src="assets/imgs/wallet.svg"
                  style="margin-right: 5px; padding-bottom: 5px"
                />
                <span
                  [style.color]="
                    !isValid ||
                    formNew.invalid ||
                    isExistName ||
                    totalincludesVAT == 0
                      ? 'gray'
                      : 'white'
                  "
                  >{{ 'app.restore' | i18n }}</span
                >
              </button>
            </nz-col>
          </nz-row>
        </nz-card>
        <nz-card
          *ngIf="selectedOption == 'current'"
          class="card-border"
          style="border-radius: 8px; width: 100%"
        >
          <div style="margin-bottom: 20px">
            <span class="text-card-header">{{
              'app.config.parameters' | i18n
            }}</span>
          </div>
          <div class="text-value">{{ 'app.instances.name' | i18n }}</div>
          <div style="margin-top: 10px" class="text-label">
            {{ backupVmModel?.instanceName }}
          </div>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <div class="text-value">{{ 'app.instances.OS' | i18n }}</div>
          <div style="margin-top: 10px" class="text-label">
            {{ backupVmModel?.systemInfoBackups[0].osName }}
          </div>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <div class="text-value">Security Group</div>
          <div style="margin-top: 10px" class="text-label">
            {{ selectedSecurityGroup.join(', ') }}
          </div>
          <nz-divider style="margin: 10px 0" nzType="horizontal"></nz-divider>
          <div class="text-value">
            {{ 'app.info.backup.vm.external.volume' | i18n }}
          </div>
          <div *ngFor="let v of listOfDataBlockStorage; let last = last">
            <div style="margin-top: 10px" class="text-label">
              {{ v.capacity }} GB {{ v.name }} ({{ v.type }})
            </div>
          </div>
          <nz-row style="margin-top: 20px">
            <nz-col style="width: 100%">
              <button
                style="width: 100%"
                nz-button
                nzSize="large"
                nzType="primary"
                [nzLoading]="isLoadingCurrent"
                (click)="submitFormCurrent()"
              >
                <img
                  src="assets/imgs/wallet.svg"
                  style="margin-right: 5px; padding-bottom: 5px"
                />
                <span>{{ 'app.restore' | i18n }}</span>
              </button>
            </nz-col>
          </nz-row>
        </nz-card>
      </nz-affix>
    </div>
  </div>
</div>
<one-portal-popup-list-error
  [isVisible]="isVisiblePopupError"
  [errorList]="errorList"
  (onCancel)="closePopupError()"
></one-portal-popup-list-error>
