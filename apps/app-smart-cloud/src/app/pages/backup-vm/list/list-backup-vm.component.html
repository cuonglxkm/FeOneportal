<page-header [breadcrumb]="breadcrumb" [action]="action"
             [title]="'Danh sách Backup VM'">
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">Home</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">Dịch vụ</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="'/app-smart-cloud/backup-vm'">
          Backup VM
        </a></nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>

  <ng-template #action>
    <div class="alain-custom-action text-right">
      <region-select-dropdown (valueChanged)="regionChanged($event)"></region-select-dropdown>
      <project-select-dropdown (valueChanged)="projectChanged($event)"
                               [regionId]="region"></project-select-dropdown>
    </div>
  </ng-template>
</page-header>

<nz-content >
  <ng-container [ngSwitch]="isBegin">
    <ng-container *ngSwitchCase="false">
      <nz-card>
        <nz-row nzJustify="space-between">
          <nz-col nzSpan="16">
            <nz-select [(ngModel)]="selectedValue"
                       nzSize="large"
                       style="margin-right: 15px; width: 170px;"
                       (ngModelChange)="onChange($event)"
                       nzPlaceHolder="Tất cả trạng thái"
                       nzTooltipTitle="Tìm kiếm theo trạng thi"
                       nzTooltipPlacement="bottom"
                       nz-tooltip>
              <nz-option *ngFor="let item of status" [nzValue]="item.value"
                         [nzLabel]="item.label"></nz-option>
            </nz-select>
            <nz-input-group
              style="width: 300px;"
              [nzPrefix]="prefixIconSearch"
              nzSize="large"
              [(ngModel)]="value"
              (input)="onInputChange($event.target['value'])">
              <input
                name="name"
                nz-input
                placeholder="Tìm kiếm tên ..."/>
            </nz-input-group>
            <ng-template #prefixIconSearch>
              <img
                src="assets/imgs/search.svg"
                alt=""
                style="cursor: pointer"
                nz-tooltip="Tìm kiếm"/>
            </ng-template>
          </nz-col>
        </nz-row>
        <nz-table #fixedTable
                  style="margin-top: 20px;"
                  [nzScroll]="{ x: '100%', y: '55vh' }"
                  [nzData]="collection.records"
                  nzShowSizeChanger
                  [nzFrontPagination]="false"
                  [nzTotal]="collection.totalCount"
                  [nzPageSize]="collection.pageSize"
                  [nzPageIndex]="collection.currentPage"
                  [nzLoading]="isLoading"
                  (nzQueryParams)="onQueryParamsChange($event)"
        >
          <thead>
          <tr>
            <th nzAlign="center" nzLeft>Tên</th>
            <th nzAlign="center" nzBreakWord>VM gốc</th>
            <th nzAlign="center" nzBreakWord>Dung lượng</th>
            <th nzAlign="center" nzBreakWord>Gói backup</th>
            <th nzAlign="center" nzBreakWord>Thời gian tạo</th>
            <th nzAlign="center" nzBreakWord>Hết hạn</th>
            <th nzAlign="center" nzBreakWord>Trạng thái</th>
            <th nzAlign="center" nzBreakWord [nzWidth]="'100px'">Trạng thái tác vụ</th>
            <th nzAlign="center" nzBreakWord>Thao tác</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let data of fixedTable.data">
            <td nzAlign="center" nzLeft><a (click)="navigateToDetail(data.id)" nzTooltipTitle="Xem chi tết" nzTooltipPlacement="bottom" nz-tooltip>{{ data.name }}</a></td>
            <td nzAlign="center" nzBreakWord> {{ data.instanceName }}</td>
            <td nzAlign="center" nzBreakWord>{{ data.size }} GB</td>
            <td nzAlign="center" nzBreakWord>{{ data.backupPackageName }}</td>
            <td nzAlign="center" nzBreakWord>{{ data.creationDate | date: "HH:mm:ss - dd/MM/yyyy" }}</td>
            <td nzAlign="center" nzBreakWord>{{ data.expirationDate | date: "HH:mm:ss - dd/MM/yyyy" }}</td>
            <td nzAlign="center" nzBreakWord>
              <div class="status" [ngSwitch]="data.status">
                                          <span class="available" *ngSwitchCase="'AVAILABLE'">
                                            Hoạt động
                                          </span>
                <span class="suspended" *ngSwitchCase="'SUSPENDED'">
                                            Tạm dừng
                                          </span>
                <span class="available" *ngSwitchCase="'CREATING'">
                                            Đang khởi tạo
                                          </span>
                <span class="suspended" *ngSwitchCase="'DELETING'">
                                            Đang xóa
                                          </span>
              </div>
            </td>
            <td nzAlign="center" nzBreakWord>
                                        <span *ngIf="data.serviceStatus === 'KHOITAO'">
                                          -
                                        </span>
              <span *ngIf="data.serviceStatus !== 'KHOITAO'">{{ data.serviceStatus }}</span>
            </td>
            <td nzAlign="center" nzBreakWord>
              <div [ngSwitch]="data.status">
                <div *ngSwitchCase="'AVAILABLE'">
                  <button nz-button
                          [nzType]="'primary'"
                          nz-dropdown
                          [nzDropdownMenu]="opMenu">
                    <span>Chọn thao tác</span> <i nz-icon nzType="down"></i>
                  </button>
                  <nz-dropdown-menu #opMenu="nzDropdownMenu">
                    <ul nz-menu>
                      <li nz-menu-item (click)="navigateToRestore(data.id)">Restore</li>
                      <li nz-menu-item (click)="showModalDelete(data.id)">Xóa</li>
                      <one-portal-delete-backup-vm [isVisible]="isVisibleDelete"
                                                   [isLoading]="isLoading"
                                                   (onCancel)="handleCancelDelete()"
                                                   (onOk)="handleOkDelete()"/>
                    </ul>
                  </nz-dropdown-menu>
                </div>
                <div *ngSwitchCase="'SUSPENDED'">
                  <button nz-button
                          nzType="primary"
                          nzDanger
                          (click)="showModalDelete(data.id)">Xóa
                  </button>
                  <one-portal-delete-backup-vm [isVisible]="isVisibleDelete"
                                               [isLoading]="isLoading"
                                               (onCancel)="handleCancelDelete()"
                                               (onOk)="handleOkDelete()"/>
                </div>
              </div>
            </td>
          </tr>
          </tbody>
        </nz-table>
      </nz-card>
    </ng-container>
    <ng-container *ngSwitchDefault>
      <nz-card>
        <nz-row nzJustify="center">
          <img src="/assets/imgs/backup-vm-blank.png" width="450" height="450" alt="blank-security-group">
        </nz-row>
        <nz-row nzJustify="center" style="margin-top:15px;">
          <div class="text-title">
            <h1>Backup VM - Sao lưu, bảo mật</h1>
          </div>
        </nz-row>
        <nz-row nzJustify="center">
          <div class="text-subtitle" style="text-align: center;">Giải pháp sao lưu VM nâng cao, phần mềm giúp giảm chi phí chụp nhanh và tiết kiệm thời gian của bạn bằng
            cách tạo các bản sao VM giống hệt nhau trực tiếp từ các bản sao lưu VM hiện có.</div>
        </nz-row>
        <nz-row nzJustify="center">
          <button style="text-align: center; margin-top: 10px" nz-button nzType="primary" [routerLink]="'/app-smart-cloud/schedule/backup/create'">Khởi tạo ngay</button>
        </nz-row>
      </nz-card>
    </ng-container>
  </ng-container>
</nz-content>
