<page-header
  [breadcrumb]="breadcrumb"
  [action]="action"
  [title]="'Quản lý lịch File System Snapshot'"
>
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item>Trang chủ</nz-breadcrumb-item>
      <nz-breadcrumb-item>Dịch vụ hạ tầng</nz-breadcrumb-item>
      <nz-breadcrumb-item>File Storage</nz-breadcrumb-item>
      <nz-breadcrumb-item>Quản lý lịch File System Snapshot</nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <region-select-dropdown
        (valueChanged)="onRegionChange($event)"
      ></region-select-dropdown>
      <project-select-dropdown
        [regionId]="region"
        (valueChanged)="projectChange($event)"
        (userChanged)="projectChange($event)"
      ></project-select-dropdown>
    </div>
  </ng-template>
</page-header>
<nz-content>
  <nz-card>
    <div
      style="display: flex; justify-content: space-between; align-items: center"
    >
      <span class="text-card-header">Danh sách lịch File System Snapshot</span>
      <nz-row style="gap: 16px">
        <nz-col>
          <nz-input-group
            [nzPrefix]="prefixIconSearch"
            nzSize="large"
            style="width: 400px"
          >
            <input
              name="name"
              nz-input
              placeholder="Tìm kiếm theo tên lịch Snapshot..."
              [(ngModel)]="value"
              (input)="onInputChange($event.target['value'])"
            />
          </nz-input-group>
          <ng-template #prefixIconSearch>
            <img
              src="assets/imgs/search.svg"
              alt=""
              style="cursor: pointer"
              nz-tooltip="Tìm kiếm"
            />
          </ng-template>
        </nz-col>
        <nz-col>
          <button
            [routerLink]="['../create']"
            nz-button
            nzType="primary"
            nzSize="large"
          >
            <img
              style="padding-right: 10px; margin-top: -4px"
              src="assets/imgs/add-circle.svg"
              alt=""
            />
            <span class="button-text-primary"
              >Tạo mới lịch File System Snapshot</span
            >
          </button>
        </nz-col>
      </nz-row>
    </div>
    <nz-table
      #fixedTable
      style="margin-top: 20px"
      [nzData]="response?.records"
      [nzPageSize]="response?.pageSize"
      (nzPageSizeChange)="onPageSizeChange($event)"
      [nzPageIndex]="response?.currentPage"
      (nzPageIndexChange)="onPageIndexChange($event)"
      [nzTotal]="response?.totalCount"
      [nzFrontPagination]="false"
      [nzLoading]="isLoading"
    >
      <thead>
        <tr>
          <th>STT</th>
          <th>Tên lịch Snapshot</th>
          <th>Áp dụng cho File System</th>
          <th>Số bản ghi tối đa</th>
          <th>Chu kỳ</th>
          <th>Trạng thái</th>
          <th>Lần snapshot tiếp theo</th>
          <th nzAlign="center">Thao tác</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of fixedTable.data, index as i">
          <td>{{ i + 1 }}</td>
          <td>{{data.name}}</td>
          <td>file-system-01</td>
          <td>{{data.maxSnapshot}}</td>
          <td>{{data.mode === 1 ? 'Hằng ngày': data.mode === 2 ? 'Theo thứ' : data.mode === 3 ? 'Theo tuần' : data.mode === 4 && 'Theo tháng'}}</td>
          <td [ngStyle]="{
            color:
              data.status === 'ACTIVE'
                ? '#0066B3'
                : data.status === 'DISABLED'
                ? '#EA3829'
                : ''
          }">{{data.status === 'ACTIVE' ? 'Đang hoạt động' : data.status === 'DISABLED' && 'Tạm ngưng'}}</td>
          <td>{{data.nextRuntime | date: 'dd/MM/yyyy HH:mm:ss'}}</td>
          <td>
            <div class="d-flex gap-2 justify-content-center align-items-center">

              <span
                style="color: #0066b3; margin-right: 10px; cursor: pointer"
                nz-icon
                nzType="edit"
                nzTheme="outline"
                [routerLink]="['../extend/' + data.id]"
                [nzPopoverContent]="'Sửa'"
                nz-popover
                nzPopoverPlacement="bottom"
              ></span>
              <one-portal-pause-file-system-snapshot
                [region]="region"
                [project]="project"
              />

              <one-portal-delete-file-system-snapshot-schedule
                [region]="region"
                [project]="project"
                [scheduleId]="data.id"
                [scheduleName]="data.name"
                (onOk)="handleDeleteSchedule()"
              />
            </div>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </nz-card>
</nz-content>
