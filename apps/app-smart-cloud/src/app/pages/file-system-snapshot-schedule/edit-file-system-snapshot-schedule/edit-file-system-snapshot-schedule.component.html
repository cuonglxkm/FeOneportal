<page-header
  [breadcrumb]="breadcrumb"
  [action]="action"
  [title]="'Chỉnh sửa đặt lịch File System Snapshot'"
>
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">{{ 'app.breadcrumb.home' | i18n }}</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/app-smart-cloud/schedule/snapshot/list']"
          >{{ 'app.breadcrumb.infrastructure.service' | i18n }}</a
        >
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>File Storage</nz-breadcrumb-item>
      <nz-breadcrumb-item
        ><a
          [routerLink]="['/app-smart-cloud/file-system-snapshot-schedule/list']"
          >File System Snapshot Schedule</a
        ></nz-breadcrumb-item
      >
      <nz-breadcrumb-item
        >Chỉnh sửa đặt lịch File System Snapshot</nz-breadcrumb-item
      >
    </nz-breadcrumb>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <share-users-combobox></share-users-combobox>
      <region-select-dropdown
        (valueChanged)="regionChange($event)"
      ></region-select-dropdown>
      <project-select-dropdown
        [regionId]="region"
        (valueChanged)="projectChange($event)"
      ></project-select-dropdown>
    </div>
  </ng-template>
</page-header>

<form nz-form [formGroup]="FileSystemSnapshotForm" [nzLayout]="'vertical'">
  <div nz-row [nzGutter]="16">
    <div nz-col [nzSpan]="18" class="gutter-row">
      <nz-card style="border-radius: 8px">
        <h2 class="custom-title">Thông tin đặt lịch File System Snapshot</h2>
        <nz-form-item>
          <nz-form-label nzFor="name">
            <div>
              <span>Tên lịch Snapshot</span>
              (<span style="color: rgba(252, 16, 16, 1)">*</span>)
              <span
                nz-icon
                nzType="question-circle"
                nzTheme="outline"
                nz-popover
                [nzPopoverContent]="
                  'Tên của lịch Snapshot muốn tạo, các ký tự chữ thường a-z, chữ hoa A-Z, số 0-9, dấu gạch ngang (-) và dấu gạch dưới (_), có thể có khoảng trắng, tối thiểu 1 ký tự và tối đa 255 ký tự.'
                "
                nzPopoverPlacement="bottom"
              ></span>
            </div>
          </nz-form-label>
          <nz-form-control [nzErrorTip]="nameErrorTpl">
            <input
              nz-input
              type="text"
              required
              id="nameSnapshot"
              [placeholder]="'app.input.name' | i18n"
              formControlName="name"
              class="input-custom"
            />
            <ng-template #nameErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')"
                >{{ 'validation.info.required' | i18n }}</ng-container
              >
              <ng-container *ngIf="control.hasError('pattern')"
                >Tên lịch snapshot chứa chỉ chứa kí tự viết thường, viết hoa,
                số, dấu ngạch ngang (-), dấu gạch dưới (_)</ng-container
              >
            </ng-template>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzFor="name">
            <div>
              <span>Áp dụng cho File System</span>
              (<span style="color: rgba(252, 16, 16, 1)">*</span>)
              <span
                nz-icon
                nzType="question-circle"
                nzTheme="outline"
                nz-popover 
                [nzPopoverContent]="'Chọn File System để thực hiện Snapshot.'"
                nzPopoverPlacement="bottom"
              ></span>
            </div>
          </nz-form-label>
          <nz-form-control nzErrorTip="File System không đuợc để trống!">
            <nz-select
              nzMode="multiple"
              [nzPlaceHolder]="'app.choose.file.system' | i18n"
              formControlName="listOfFileSystem"
              class="input-select-custom"
            >
              <nz-option
                *ngFor="let data of response?.records"
                [nzLabel]="data.name"
                [nzValue]="data.id"
              ></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzFor="name">
            <div>
              <span>Chọn thời điểm thực hiện Snapshot</span>
              (<span style="color: rgba(252, 16, 16, 1)">*</span>)
              <span
                nz-icon
                nzType="question-circle"
                nzTheme="outline"
                nz-popover
                [nzPopoverContent]="
                  'Thời gian chạy chính sách, tính theo giờ UTC + 00: 00.'
                "
                nzPopoverPlacement="bottom"
              ></span>
            </div>
          </nz-form-label>
          <nz-form-control nzErrorTip="Thời gian không đuợc để trống!">
            <nz-time-picker
              style="width: 100%"
              [ngModelOptions]="{ standalone: true }"
              formControlName="runtime"
              class="input-select-custom"
            ></nz-time-picker>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzFor="name">
            <div>
              <span>Chế độ Snapshot</span>
              (<span style="color: rgba(252, 16, 16, 1)">*</span>)
              <span
                nz-icon
                nzType="question-circle"
                nzTheme="outline"
                nz-popover
                [nzPopoverContent]="
                  'Chọn tần suất để thực hiện snapshot policy. Nếu theo tuần thì chọn số tuần và chọn ngày trong tuần. Nếu theo tháng thì chọn số tháng và ngày trong tháng.'
                "
                nzPopoverPlacement="bottom"
              ></span>
            </div>
          </nz-form-label>
          <nz-form-control nzErrorTip="Chế độ Snapshot không đuợc để trống!">
            <nz-select
              nzShowSearch
              nzAllowClear
              [(ngModel)]="snapshotMode"
              name="snapshotMode"
              formControlName="mode"
              (ngModelChange)="modeChange($event)"
              class="input-select-custom"
            >
              <nz-option
                *ngFor="let item of dateOptions"
                [nzLabel]="item.label"
                [nzValue]="item.value"
              ></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        <ng-container *ngIf="snapshotMode === '1'">
          <nz-form-item>
            <nz-form-control nzErrorTip="Số bản Snapshot không đuợc để trống!">
              <nz-form-label nzFor="name">
                <div>
                  <span>Số bản Snapshot lưu trữ</span>
                  (<span style="color: rgba(252, 16, 16, 1)">*</span>)
                  <span
                    nz-icon
                    nzType="question-circle"
                    nzTheme="outline"
                    nz-popover
                    [nzPopoverContent]="
                      'Khi 1 bản snapshot được tạo ra, hệ thống sẽ tự động xóa bản snapshot cũ nhất để đảm bảo số bản snapshot tối đa được lưu trữ không vượt quá số lượng được cài đặt. Số lượng này chỉ tác động đến các snapshot được cài đặt theo từng lịch, không tác động đến các bản snapshot được tạo đơn lẻ hoặc nằm trong lịch khác.'
                    "
                    nzPopoverPlacement="bottom"
                  ></span>
                </div>
              </nz-form-label>
              <input
                formControlName="maxSnapshot"
                nz-input
                type="number"
                class="input-custom"
              />
            </nz-form-control>
          </nz-form-item>
        </ng-container>
        <ng-container *ngIf="snapshotMode === '3'">
          <div style="display: flex; flex-wrap: wrap">
            <nz-form-item
              style="flex-basis: calc(50% - 8px); margin-right: 16px"
            >
              <nz-form-label nzFor="name">
                <div>
                  <span>Chọn số tuần</span>
                  (<span style="color: rgba(252, 16, 16, 1)">*</span>)
                  <span
                    nz-icon
                    nzType="question-circle"
                    nzTheme="outline"
                    nz-popover
                    [nzPopoverContent]="
                      'Chọn số tuần / lần thực hiện Snapshot.'
                    "
                    nzPopoverPlacement="bottom"
                  ></span>
                </div>
              </nz-form-label>
              <nz-form-control nzErrorTip="Số tuần không đuợc để trống!">
                <nz-select
                  formControlName="intervalWeek"
                  id="numberOfWeek"
                  [nzPlaceHolder]="'Số tuần thực hiện'"
                  [nzShowSearch]="false"
                  class="input-select-custom"
                >
                  <nz-option
                    *ngFor="let i of numberOfWeek"
                    [nzLabel]="i.label"
                    [nzValue]="i.value"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item style="flex-basis: calc(50% - 8px)">
              <nz-form-label nzFor="name">
                <div>
                  <span>Chọn ngày</span>
                  (<span style="color: rgba(252, 16, 16, 1)">*</span>)
                  <span
                    nz-icon
                    nzType="question-circle"
                    nzTheme="outline"
                    nz-popover
                    [nzPopoverContent]="'Ngày thực hiện snapshot trong tuần.'"
                    nzPopoverPlacement="bottom"
                  ></span>
                </div>
              </nz-form-label>
              <nz-form-control nzErrorTip="Số ngày không đuợc để trống!">
                <nz-select
                  formControlName="dayOfWeek"
                  id="daysOfWeek"
                  [nzPlaceHolder]="'Chọn ngày'"
                  [nzShowSearch]="false"
                  class="input-select-custom"
                >
                  <nz-option
                    *ngFor="let i of daysOfWeek"
                    [nzLabel]="i.label"
                    [nzValue]="i.value"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <nz-form-item>
            <nz-form-label nzFor="name">
              <div>
                <span>Số bản Snapshot lưu trữ</span>
                (<span style="color: rgba(252, 16, 16, 1)">*</span>)
                <span
                  nz-icon
                  nzType="question-circle"
                  nzTheme="outline"
                  nz-popover
                  [nzPopoverContent]="
                    'Khi 1 bản snapshot được tạo ra, hệ thống sẽ tự động xóa bản snapshot cũ nhất để đảm bảo số bản snapshot tối đa được lưu trữ không vượt quá số lượng được cài đặt. Số lượng này chỉ tác động đến các snapshot được cài đặt theo từng lịch, không tác động đến các bản snapshot được tạo đơn lẻ hoặc nằm trong lịch khác.'
                  "
                  nzPopoverPlacement="bottom"
                ></span>
              </div>
            </nz-form-label>
            <nz-form-control nzErrorTip="Số bản Snapshot không đuợc để trống!">
              <input
                formControlName="maxSnapshot"
                nz-input
                type="number"
                class="input-custom"
              />
            </nz-form-control>
          </nz-form-item>
        </ng-container>
        <ng-container *ngIf="snapshotMode === '2'">
          <div style="display: flex; flex-wrap: wrap">
            <nz-form-item
              style="flex-basis: calc(50% - 8px); margin-right: 16px"
            >
              <nz-form-label nzFor="name">
                <div>
                  <span>Chọn ngày trong tuần</span>
                  (<span style="color: rgba(252, 16, 16, 1)">*</span>)
                  <span
                    nz-icon
                    nzType="question-circle"
                    nzTheme="outline"
                    nz-popover
                    [nzPopoverContent]="
                      'Bấm Ctrl để chọn nhiều, giữ Ctrl để bỏ chọn.'
                    "
                    nzPopoverPlacement="bottom"
                  ></span>
                </div>
              </nz-form-label>
              <nz-form-control nzErrorTip="Số ngày không đuợc để trống!">
                <nz-select
                  formControlName="daysOfWeek"
                  id="daysOfWeekMultiple"
                  nzMode="multiple"
                  [nzPlaceHolder]="'Chọn thứ'"
                  [nzShowSearch]="false"
                  class="input-select-custom"
                >
                  <nz-option
                    *ngFor="let i of daysOfWeek"
                    [nzLabel]="i.label"
                    [nzValue]="i.value"
                  />
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item style="flex-basis: calc(50% - 8px)">
              <nz-form-label nzFor="name">
                <div>
                  <span>Số bản Snapshot lưu trữ</span>
                  (<span style="color: rgba(252, 16, 16, 1)">*</span>)
                  <span
                    nz-icon
                    nzType="question-circle"
                    nzTheme="outline"
                    nz-popover
                    [nzPopoverContent]="
                      'Khi 1 bản snapshot được tạo ra, hệ thống sẽ tự động xóa bản snapshot cũ nhất để đảm bảo số bản snapshot tối đa được lưu trữ không vượt quá số lượng được cài đặt. Số lượng này chỉ tác động đến các snapshot được cài đặt theo từng lịch, không tác động đến các bản snapshot được tạo đơn lẻ hoặc nằm trong lịch khác.'
                    "
                    nzPopoverPlacement="bottom"
                  ></span>
                </div>
              </nz-form-label>
              <nz-form-control
                nzErrorTip="Số bản Snapshot không đuợc để trống!"
              >
                <input
                  formControlName="maxSnapshot"
                  nz-input
                  type="number"
                  class="input-custom"
                />
              </nz-form-control>
            </nz-form-item>
          </div>
        </ng-container>
        <ng-container *ngIf="snapshotMode === '4'">
          <div style="display: flex; flex-wrap: wrap">
            <nz-form-item
              style="flex-basis: calc(50% - 8px); margin-right: 16px"
            >
              <nz-form-label nzFor="name">
                <div>
                  <span>Chọn số tháng</span>
                  (<span style="color: rgba(252, 16, 16, 1)">*</span>)
                  <span
                    nz-icon
                    nzType="question-circle"
                    nzTheme="outline"
                    nz-popover
                    [nzPopoverContent]="'Số tháng / lần thực hiện Snapshot.'"
                    nzPopoverPlacement="bottom"
                  ></span>
                </div>
              </nz-form-label>
              <nz-form-control nzErrorTip="Số tháng không đuợc để trống!">
                <nz-input-number
                  style="width: 100%; border-radius: 8px; margin-left: 0"
                  formControlName="intervalMonth"
                  id="months"
                  nzMin="0"
                  nzMax="24"
                  nzStep="1"
                  class="input-custom"
                />
              </nz-form-control>
            </nz-form-item>
            <nz-form-item style="flex-basis: calc(50% - 8px)">
              <nz-form-label nzFor="name">
                <div>
                  <span>Chọn ngày thực hiện Snapshot</span>
                  (<span style="color: rgba(252, 16, 16, 1)">*</span>)
                  <span
                    nz-icon
                    nzType="question-circle"
                    nzTheme="outline"
                    nz-popover
                    [nzPopoverContent]="'Ngày thực hiện Snapshot trong tháng.'"
                    nzPopoverPlacement="bottom"
                  ></span>
                </div>
              </nz-form-label>
              <nz-form-control nzErrorTip="Số ngày không đuợc để trống!">
                <nz-input-number
                  style="width: 100%; border-radius: 8px; margin-left: 0"
                  formControlName="dates"
                  id="date"
                  nzMin="0"
                  nzMax="31"
                  nzStep="1"
                  class="input-custom"
                />
              </nz-form-control>
            </nz-form-item>
          </div>
          <nz-form-item>
            <nz-form-label nzFor="name">
              <div>
                <span>Số bản Snapshot lưu trữ</span>
                (<span style="color: rgba(252, 16, 16, 1)">*</span>)
                <span
                  nz-icon
                  nzType="question-circle"
                  nzTheme="outline"
                  nz-popover
                  [nzPopoverContent]="
                    'Khi 1 bản snapshot được tạo ra, hệ thống sẽ tự động xóa bản snapshot cũ nhất để đảm bảo số bản snapshot tối đa được lưu trữ không vượt quá số lượng được cài đặt. Số lượng này chỉ tác động đến các snapshot được cài đặt theo từng lịch, không tác động đến các bản snapshot được tạo đơn lẻ hoặc nằm trong lịch khác.'
                  "
                  nzPopoverPlacement="bottom"
                ></span>
              </div>
            </nz-form-label>
            <nz-form-control nzErrorTip="Số bản Snapshot không đuợc để trống!">
              <input
                formControlName="maxSnapshot"
                nz-input
                type="number"
                class="input-custom"
              />
            </nz-form-control>
          </nz-form-item>
        </ng-container>
        <nz-form-label [nzSm]="6" [nzXs]="24">{{ 'app.service.description' | i18n }}</nz-form-label>
        <textarea
          formControlName="description"
          [placeholder]="'app.input.des' | i18n"
          rows="4"
          nz-input
        ></textarea>
      </nz-card>
    </div>
    <div nz-col [nzSpan]="6" class="gutter-row">
      <nz-card style="border-radius: 8px">
        <h2 class="custom-title">{{ 'app.config.parameters' | i18n }}</h2>
        <div style="margin-bottom: 12px">
          <h3 class="custom-subtitle">Tên lịch Snapshot</h3>
          <span>{{ FileSystemSnapshotForm.value.name }}</span>
        </div>
        <div style="margin-bottom: 20px">
          <h3 class="custom-subtitle">{{ 'app.file.system.name' | i18n }}</h3>
            <span *ngFor="let fs of selectedFileSystemName">
              {{ fs.name }}
            </span>
        </div>
        <div style="margin-bottom: 20px">
          <h3 class="custom-subtitle">Thời điểm thực hiện Snapshot</h3>
          <span>{{ FileSystemSnapshotForm.value.runtime | date : 'mediumTime' }}</span>
        </div>
        <div style="margin-bottom: 20px">
          <h3 class="custom-subtitle">Chế độ Snapshot</h3>
          <span>{{
            snapshotMode === '1'
              ? 'Hằng ngày'
              : snapshotMode === '2'
              ? 'Theo thứ'
              : snapshotMode === '3'
              ? 'Theo tuần'
              : snapshotMode === '4' && 'Theo tháng'
          }}</span>
        </div>
        <ng-container *ngIf="snapshotMode === '3'">
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Số tuần thực hiện</h3>
            <span>{{
              FileSystemSnapshotForm.value.intervalWeek === 1
                ? '1 Tuần'
                : FileSystemSnapshotForm.value.intervalWeek === 2
                ? '2 Tuần'
                : FileSystemSnapshotForm.value.intervalWeek === 3
                ? '3 Tuần'
                : ''
            }}</span>
          </div>
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Ngày thực hiện</h3>
            <span>{{ getDayLabel(FileSystemSnapshotForm.value.dayOfWeek) }}</span>
          </div>
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Số bản Snapshot lưu trữ</h3>
            <span>{{ FileSystemSnapshotForm.value.maxSnapshot }}</span>
          </div>
        </ng-container>
        <ng-container *ngIf="snapshotMode === '4'">
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Số tháng thực hiện</h3>
            <span>{{ FileSystemSnapshotForm.value.intervalMonth }}</span>
          </div>
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Ngày thực hiện</h3>
            <span>{{ FileSystemSnapshotForm.value.dates }}</span>
          </div>
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Số bản Snapshot lưu trữ</h3>
            <span>{{ FileSystemSnapshotForm.value.maxSnapshot }}</span>
          </div>
        </ng-container>
        <ng-container *ngIf="snapshotMode === '1'">
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Số bản Snapshot lưu trữ</h3>
            <span>{{ FileSystemSnapshotForm.value.maxSnapshot }}</span>
          </div>
        </ng-container>
        <ng-container *ngIf="snapshotMode === '2'">
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Ngày trong tuần</h3>
            <span *ngFor="let selectedValue of listOfSelectedDate">
              {{ getDayLabelMulti(selectedValue) }}
            </span>
          </div>
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Số bản Snapshot lưu trữ</h3>
            <span>{{ FileSystemSnapshotForm.value.maxSnapshot }}</span>
          </div>
        </ng-container>
        <button
          nz-button
          nzType="primary"
          style="
            border: none;
            width: 100%;
            display: flex;
            align-items: center;
            gap: 5px;
            justify-content: center;
          "
          nzSize="large"
          (click)="handleEdit()"
          [disabled]="FileSystemSnapshotForm.invalid"
        >
          <span nz-icon nzType="edit"></span>
          <span class="button-text-primary">Chỉnh sửa</span>
        </button>
      </nz-card>
    </div>
  </div>
</form>
<div
  class="text-right"
  style="
    display: flex;
    align-items: center;
    justify-content: flex-end;
    height: 100%;
  "
></div>
