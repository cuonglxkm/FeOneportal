<page-header
  [breadcrumb]="breadcrumb"
  [action]="action"
  [title]="'Đặt lịch File System Snapshot'"
>
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">Trang chủ</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/app-smart-cloud/schedule/snapshot/list']"
          >Dịch vụ hạ tầng</a
        >
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>File Storage</nz-breadcrumb-item>
      <nz-breadcrumb-item
        ><a [routerLink]="['/app-smart-cloud/file-system-snapshot-schedule/list']"
          >File System Snapshot Schedule</a
        ></nz-breadcrumb-item
      >
      <nz-breadcrumb-item>Tạo mới lịch File System Snapshot</nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <region-select-dropdown
        (valueChanged)="regionChange($event)"
      ></region-select-dropdown>
      <project-select-dropdown
        [regionId]="region"
        (valueChanged)="projectChange($event)"
      ></project-select-dropdown>
    </div>
  </ng-template>
</page-header>

<form
  nz-form
  [formGroup]="FileSystemSnapshotForm"
  [nzLayout]="'vertical'"
>
  <div nz-row [nzGutter]="16">
    <div nz-col [nzSpan]="18" class="gutter-row">
      <nz-card style="border-radius: 8px;">
        <h2 class="custom-title">Thông tin đặt lịch File System Snapshot</h2>
        <nz-form-item>
          <nz-form-label nzFor="name" nzRequired
            >Tên lịch Snapshot</nz-form-label
          >
          <nz-form-control [nzErrorTip]="nameErrorTpl">
          <input
            nz-input
            type="text"
            required
            id="nameSnapshot"
            placeholder="Nhập tên lịch Snapshot"
            [(ngModel)]="nameSnapshot"
            (ngModelChange)="nameSnapshot = $event"
            formControlName="name"
          />
          <ng-template #nameErrorTpl let-control>
            <ng-container *ngIf="control.hasError('required')">Tên lịch snapshot không được để trống</ng-container>
            <ng-container *ngIf="control.hasError('pattern')">Tên lịch snapshot chứa chỉ chứa kí tự viết thường, viết hoa, số, dấu ngạch ngang (-), dấu gạch dưới (_)</ng-container>
          </ng-template>
        </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzFor="name" nzRequired
            >Áp dụng cho File System</nz-form-label
          >
          <nz-form-control nzErrorTip="File System không đuợc để trống!">
          <nz-select
            nzMode="multiple"
            nzPlaceHolder="Chọn File System"
            formControlName="listOfFileSystem"
            (ngModelChange)="updateSelectedFileSystems($event)"
          >
            <nz-option
              *ngFor="let data of response?.records"
              [nzLabel]="data.name"
              [nzValue]="data.id"
            ></nz-option>
          </nz-select>
        </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzRequired
            >Chọn thời điểm thực hiện Snapshot</nz-form-label
          >
          <nz-form-control nzErrorTip="Thời gian không đuợc để trống!">
          <nz-time-picker
            style="width: 100%"
            [(ngModel)]="time"
            [ngModelOptions]="{ standalone: true }"
            [nzDefaultOpenValue]="defaultOpenValue"
            formControlName="runtime"
          ></nz-time-picker>
        </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzFor="name" nzRequired>Chế độ Snapshot</nz-form-label>
          <nz-form-control nzErrorTip="Chế độ Snapshot không đuợc để trống!">
          <nz-select
            nzShowSearch
            nzAllowClear
            [(ngModel)]="snapshotMode"
            name="snapshotMode"
            formControlName="mode"
            (ngModelChange)="modeChange($event)"
          >
            <nz-option
              *ngFor="let item of dateOptions"
              [nzLabel]="item.label"
              [nzValue]="item.value"
            ></nz-option>
          </nz-select>
        </nz-form-control>
        </nz-form-item>
        <ng-container *ngIf="snapshotMode === '1'">
          <nz-form-item>
            <nz-form-control nzErrorTip="Số bản Snapshot không đuợc để trống!">
            <nz-form-label nzFor="name" nzRequired
              >Số bản Snapshot lưu trữ</nz-form-label
            >
            <input
              formControlName="maxSnapshot"
              nz-input
              type="number"
              [(ngModel)]="snapshotRecord"
            />
          </nz-form-control>
          </nz-form-item>
        </ng-container>
        <ng-container *ngIf="snapshotMode === '3'">
          <div style="display: flex; flex-wrap: wrap">
            <nz-form-item
              style="flex-basis: calc(50% - 8px); margin-right: 16px"
            >
              <nz-form-label nzFor="name" nzRequired
                >Chọn số tuần</nz-form-label
              >
              <nz-form-control nzErrorTip="Số tuần không đuợc để trống!">
              <nz-select
                formControlName="intervalWeek"
                id="numberOfWeek"
                [nzPlaceHolder]="'Số tuần thực hiện'"
                [nzShowSearch]="false"
                [(ngModel)]="numberOfWeekSelected"
              >
                <nz-option
                  *ngFor="let i of numberOfWeek"
                  [nzLabel]="i.label"
                  [nzValue]="i.value"
                />
              </nz-select>
            </nz-form-control>
            </nz-form-item>
            <nz-form-item style="flex-basis: calc(50% - 8px)">
              <nz-form-label nzFor="name" nzRequired>Chọn ngày</nz-form-label>
              <nz-form-control nzErrorTip="Số ngày không đuợc để trống!">
              <nz-select
                formControlName="dayOfWeek"
                id="daysOfWeek"
                [nzPlaceHolder]="'Chọn ngày'"
                [(ngModel)]="daysOfWeekSelected"
                [nzShowSearch]="false"
              >
                <nz-option
                  *ngFor="let i of daysOfWeek"
                  [nzLabel]="i.label"
                  [nzValue]="i.value"
                />
              </nz-select>
            </nz-form-control>
            </nz-form-item>
          </div>
          <nz-form-item>
            <nz-form-label nzFor="name" nzRequired
              >Số bản Snapshot lưu trữ</nz-form-label
            >
            <nz-form-control nzErrorTip="Số bản Snapshot không đuợc để trống!">
            <input
              formControlName="maxSnapshot"
              nz-input
              type="number"
              [(ngModel)]="snapshotRecord"
            />
          </nz-form-control>
          </nz-form-item>
        </ng-container>
        <ng-container *ngIf="snapshotMode === '2'">
          <div style="display: flex; flex-wrap: wrap">
            <nz-form-item
              style="flex-basis: calc(50% - 8px); margin-right: 16px"
            >
              <nz-form-label nzFor="name" nzRequired
                >Chọn ngày trong tuần</nz-form-label
              >
              <nz-form-control nzErrorTip="Số ngày không đuợc để trống!">
              <nz-select
                formControlName="daysOfWeek"
                id="daysOfWeekMultiple"
                nzMode="multiple"
                [nzPlaceHolder]="'Chọn thứ'"
                [nzShowSearch]="false"
              >
                <nz-option
                  *ngFor="let i of daysOfWeek"
                  [nzLabel]="i.label"
                  [nzValue]="i.value"
                />
              </nz-select>
            </nz-form-control>
            </nz-form-item>
            <nz-form-item style="flex-basis: calc(50% - 8px)">
              <nz-form-label nzFor="name" nzRequired
                >Số bản Snapshot lưu trữ</nz-form-label
              >
              <nz-form-control nzErrorTip="Số bản Snapshot không đuợc để trống!">
              <input
                formControlName="maxSnapshot"
                nz-input
                type="number"
                [(ngModel)]="snapshotRecord"
              />
            </nz-form-control>
            </nz-form-item>
          </div>
        </ng-container>
        <ng-container *ngIf="snapshotMode === '4'">
          <div style="display: flex; flex-wrap: wrap">
            <nz-form-item
              style="flex-basis: calc(50% - 8px); margin-right: 16px"
            >
              <nz-form-label nzFor="name" nzRequired
                >Chọn số tháng</nz-form-label
              >
              <nz-form-control nzErrorTip="Số tháng không đuợc để trống!">
              <nz-input-number
                style="width: 100%; border-radius: 8px; margin-left: 0"
                formControlName="intervalMonth"
                id="months"
                nzMin="1"
                nzMax="24"
                nzStep="1"
                [(ngModel)]="months"
              />
            </nz-form-control>
            </nz-form-item>
            <nz-form-item style="flex-basis: calc(50% - 8px)">
              <nz-form-label nzFor="name" nzRequired
                >Chọn ngày thực hiện Snapshot</nz-form-label
              >
              <nz-form-control nzErrorTip="Số ngày không đuợc để trống!">
              <nz-input-number
                style="width: 100%; border-radius: 8px; margin-left: 0"
                formControlName="dates"
                id="date"
                nzMin="1"
                nzMax="31"
                nzStep="1"
                [(ngModel)]="dateDone"
              />
            </nz-form-control>
            </nz-form-item>
          </div>
          <nz-form-item>
            <nz-form-label nzFor="name" nzRequired
              >Số bản Snapshot lưu trữ</nz-form-label
            >
            <nz-form-control nzErrorTip="Số bản Snapshot không đuợc để trống!">
            <input
              formControlName="maxSnapshot"
              nz-input
              type="number"
              [(ngModel)]="snapshotRecord"
            />
          </nz-form-control>
          </nz-form-item>
        </ng-container>
        <nz-form-label [nzSm]="6" [nzXs]="24">Mô tả</nz-form-label>
        <textarea
          formControlName="description"
          placeholder="Nhập mô tả"
          rows="4"
          nz-input
        ></textarea>
      </nz-card>
    </div>
    <div nz-col [nzSpan]="6" class="gutter-row">
      <nz-card style="border-radius: 8px;">
        <h2 class="custom-title">Thông số cấu hình</h2>
        <div style="margin-bottom: 12px">
          <h3 class="custom-subtitle">Tên lịch Snapshot</h3>
          <span [innerText]="nameSnapshot"></span>
        </div>
        <div style="margin-bottom: 20px">
          <h3 class="custom-subtitle">Tên File System</h3>     
            <div style="overflow-wrap: break-word;">{{ selectedFileSystemName }}</div>
        </div>
        <div style="margin-bottom: 20px">
          <h3 class="custom-subtitle">Thời điểm thực hiện Snapshot</h3>
          <span>{{ time | date : 'mediumTime' }}</span>
        </div>
        <div style="margin-bottom: 20px">
          <h3 class="custom-subtitle">Chế độ Snapshot</h3>
          <span>{{
            snapshotMode === '1'
              ? 'Hằng ngày'
              : snapshotMode === '2'
              ? 'Theo thứ'
              : snapshotMode === '3'
              ? 'Theo tuần'
              : snapshotMode === '4' && 'Theo tháng'
          }}</span>
        </div>
        <ng-container *ngIf="snapshotMode === '3'">
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Số tuần thực hiện</h3>
            <span>{{
              numberOfWeekSelected === '1'
                ? '1 Tuần'
                : numberOfWeekSelected === '2'
                ? '2 Tuần'
                : numberOfWeekSelected === '3'
                ? '3 Tuần'
                : ''
            }}</span>
          </div>
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Ngày thực hiện</h3>
            <span>{{ getDayLabel(daysOfWeekSelected) }}</span>
          </div>
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Số bản Snapshot lưu trữ</h3>
            <span>{{ snapshotRecord }}</span>
          </div>
        </ng-container>
        <ng-container *ngIf="snapshotMode === '4'">
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Số tháng thực hiện</h3>
            <span>{{ months }}</span>
          </div>
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Ngày thực hiện</h3>
            <span>{{ dateDone }}</span>
          </div>
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Số bản Snapshot lưu trữ</h3>
            <span>{{ snapshotRecord }}</span>
          </div>
        </ng-container>
        <ng-container *ngIf="snapshotMode === '1'">
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Số bản Snapshot lưu trữ</h3>
            <span>{{ snapshotRecord }}</span>
          </div>
        </ng-container>
        <ng-container *ngIf="snapshotMode === '2'">
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Ngày trong tuần</h3>
            <span *ngFor="let selectedValue of listOfSelectedDate">
              {{ getDayLabelMulti(selectedValue) }}
            </span>
          </div>
          <div style="margin-bottom: 20px">
            <h3 class="custom-subtitle">Số bản Snapshot lưu trữ</h3>
            <span>{{ snapshotRecord }}</span>
          </div>
        </ng-container>
        <button
          nz-button
          nzType="primary"
          style="
            border: none;
            width: 100%;
            display: flex;
            align-items: center;
            gap: 5px;
            justify-content: center;
          "
          nzSize="large"
          (click)="handleSubmit()"
          [disabled]="FileSystemSnapshotForm.invalid"
        >
          <img src="assets/imgs/wallet.svg" alt="" />
          <span class="button-text-primary">Khởi tạo</span>
        </button>
      </nz-card>
    </div>
  </div>
</form>
<div
  class="text-right"
  style="
    display: flex;
    align-items: center;
    justify-content: flex-end;
    height: 100%;
  "
></div>
<nz-modal [(nzVisible)]="isVisibleCreate" nzTitle="Xác nhận tạo mới Lịch Snapshot File System"
          (nzOnCancel)="handleCancel()"
          (nzOnOk)="handleCreate()"
          nzOkText="Xác nhận" nzCancelText="Hủy bỏ"
          [nzOkLoading]="isLoading"
          >
  <ng-container *nzModalContent>
    <h3 style="font-weight: normal;">Quý khách có chắc chắn muốn tạo mới Lịch Snapshot File System?</h3>
  </ng-container>
</nz-modal>
