<page-header [breadcrumb]="breadcrumb" [action]="action" [title]="'Danh sách Policies'">
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item>Home</nz-breadcrumb-item>
      <nz-breadcrumb-item> IAM </nz-breadcrumb-item>
      <nz-breadcrumb-item> Polices </nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <region-select-dropdown (valueChanged)="onRegionChange($event)"></region-select-dropdown>
      <project-select-dropdown [regionId]="regionId" (valueChanged)="projectChange($event)"></project-select-dropdown>
    </div>
  </ng-template>
</page-header>
<nz-card>
  <span class="table-title">Thông tin Policies</span>
  <div style="margin-bottom: 20px" nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 24 }">
    <div class="text-right p-0 m-b-0" nz-col [nzLg]="12" [nzMd]="12" [nzSm]="24" [nzXl]="12" [nzXs]="24" [nzXXl]="12">
      <div style="display:flex;">
        <h4 style="display: flex; align-items: center; margin-right:10px">Loại policy:</h4>
        <nz-select [(ngModel)]="selectedStatus" nzSize="default" style="width: 150px">
          <nz-option *ngFor="let p of listPolicyType" [nzValue]="p.value" [nzLabel]="p.label"></nz-option>
        </nz-select>
      </div>
    </div>
    <div nz-col [nzLg]="12" [nzMd]="12" [nzSm]="24" [nzXl]="12" [nzXs]="24" [nzXXl]="12">
      <div>
        <nz-input-group style="margin-right: 8px; width: 40%" [nzSuffix]="suffixIconSearch">
          <input name="name" nz-input placeholder="Tìm kiếm" [ngModel]="searchValue" (ngModelChange)="changeSearch($event)"/>
        </nz-input-group>
        <ng-template #suffixIconSearch>
          <span nz-icon nzType="search" style="color: var(--Primary-1, #0066b3); cursor: pointer" nz-tooltip="Tìm kiếm" (click)="search()"></span>
        </ng-template>
        <button nz-button nzSize="default" style="cursor: pointer;margin-right: 10px;" (click)="reload()">
          <span nz-icon nzType="reload" nzTheme="outline"></span>
        </button>
        <nz-select [(ngModel)]="selectedAction" (nzOpenChange)="selectAction($event)" nzSize="default" style="width: 90px; margin-right: 10px;margin-left: 10px;">
          <nz-option *ngFor="let p of listAction" [nzValue]="p.value" [nzLabel]="p.label"></nz-option>
        </nz-select>
        <button class="button-custom" nz-button (click)="deletePolicy()">
          <i nz-icon nzType="delete" style="margin-right: 10px"></i>
          <span class="button-text-default">Xóa</span>
        </button>
        <button nz-button nzType="primary" (click)="createPolicy()">
        <span
          nz-icon
          nzType="plus"
          nzTheme="outline"
          style="margin-right: 10px"
        >
        </span>
          <span class="button-text-primary">Tạo mới</span>
        </button>
      </div>
    </div>
  </div>
  <!-- Bảng-->
  <nz-table #rowSelectionTable [nzLoading]="loading" [nzFrontPagination]="false" nzShowPagination nzShowSizeChanger [nzData]="listOfData"
            [nzTotal]="total" [nzPageSize]="size" (nzPageSizeChange)="onPageSizeChange($event)"
            (nzPageIndexChange)="onPageIndexChange($event)">
    <thead>
    <tr>
      <th nzWidth="40px"></th>
      <th nzWidth="40px"></th>
      <th>Tên</th>
      <th>Type</th>
      <th>Mô tả</th>
    </tr>
    </thead>
    <tbody>
    <ng-container *ngFor="let item of listOfData">
      <tr>
        <td>
          <nz-radio-group [(ngModel)]="radioValue">
            <label nz-radio [nzValue]="item.name"></label>
          </nz-radio-group>
        </td>
        <td [nzExpand]="expandSet.has(item.name)" (nzExpandChange)="onExpandChange(item.name, $event)"></td>
        <td (click)="detail(item.name)">{{ item.name }}</td>
        <td (click)="detail(item.name)">{{ item.type }}</td>
        <td (click)="detail(item.name)">{{ item.description }}</td>
      </tr>
      <tr [nzExpand]="expandSet.has(item.name)">
<!--        <json-editor-->
<!--          style="position: relative;"-->
<!--          [options]="optionJsonEditor"-->
<!--          formControlName="myinput"-->
<!--          [data]="item.jsonData"-->
<!--          [disabled]="true"-->
<!--        ></json-editor>-->



        <div class="json-viewer-bg">
          <button (click)="copyText(item)" style="z-index: 1;position: absolute; right: 20px; top: 21px;">
            <span nz-icon nzType="copy" nzTheme="outline"></span> Copy JSON
          </button>
          <ngx-json-viewer [json]="item" style="position: relative;"></ngx-json-viewer>
        </div>



      </tr>
    </ng-container>
    </tbody>
  </nz-table>
  <nz-modal [(nzVisible)]="isVisibleDelete" nzTitle="Xóa [name] Policy"
            nzOkText="Đồng ý" nzCancelText="Hủy"
            (nzOnCancel)="handleCancel()"
            (nzOnOk)="deleteHandlePolicy()">
    <ng-container *nzModalContent>
      <nz-alert nzType="warning" nzShowIcon nzMessage="Bạn đang thực hiện xóa [name] policy. Hành động này không thể được hoàn tác"></nz-alert>
      <br>
      <p><b>Để thực hiện Xóa Policy, vui lòng nhập tên Policy để xác nhận</b></p>

      <input nz-input placeholder="Nhập tên policy" [(ngModel)]="nameDelete" type="text" />
      <br />
    </ng-container>
  </nz-modal>
</nz-card>

