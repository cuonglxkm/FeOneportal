<form nz-form [formGroup]="validateForm" nzLayout="vertical">
  <nz-card>
    <nz-row nzGutter="24" nzJustify="space-between">
      <nz-col nzSpan="12">
        <nz-form-item>
          <nz-form-label>
            <span>Tên lịch Backup</span>
            <span style="color: rgba(252, 16, 16, 1);">*</span>
          </nz-form-label>
          <nz-form-control nzDisableAutoTips [nzErrorTip]="nameErrorTpl">
              <input nz-input
                     class="input-custom"
                     formControlName="name"
                     style="width: 100%;"/>
            <ng-template #nameErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')">Vui lòng nhập thông tin</ng-container>
              <ng-container *ngIf="control.hasError('pattern')">Tên gồm 255 ký tự viết liền không dấu
                cách
              </ng-container>
              <ng-container *ngIf="control.hasError('invalidCharacters')"> Tên không chứa ký tự đặc biệt
                ngoại trừ dấu “_”
              </ng-container>
              <ng-container *ngIf="control.hasError('duplicateName')"> Tên không được trùng với tên lịch đã có</ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label>
            <span>Số bản lưu trữ Backup</span>
            <span style="color: rgba(252, 16, 16, 1);">*</span>
          </nz-form-label>
          <nz-form-control nzDisableAutoTips [nzErrorTip]="maxBackupTpl">
            <nz-input-number nzSize="large"
                             formControlName="maxBackup"
                             style="width: 100%; border-radius: 8px; margin-left: 0;"
                             nzMin="1"
                             nzStep="1"/>
            <ng-template #maxBackupTpl let-control>
              <ng-container *ngIf="control.hasError('required')">Tên lịch Backup không được để trống</ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label>
            <span>Gói Backup</span>
            <span style="color: rgba(252, 16, 16, 1);">*</span>
          </nz-form-label>
          <nz-form-control nzDisableAutoTips [nzErrorTip]="backupPackageErrorTpl">
            <nz-select [nzLoading]="isLoadingPackage"
                       formControlName="backupPackage"
                       [nzPlaceHolder]="'Gói backup'"
                       nzSize="large"
                       style="border-radius: 8px;">
              <nz-option *ngFor="let index of backupPackages"
                         [nzLabel]="index.packageName"
                         [nzValue]="index.id"></nz-option>
            </nz-select>
            <ng-template #backupPackageErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')">Tên lịch Backup không được để trống</ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzFor="description">
            <div class="label">
              <span>Mô tả</span>
            </div>
          </nz-form-label>
          <nz-form-control nzDisableAutoTips [nzErrorTip]="descriptionErrorTpl">
            <textarea nz-input
                      formControlName="description"
                      id="description"
                      [nzAutosize]="{ minRows: 6, maxRows: 6 }"></textarea>
            <ng-template #descriptionErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')">Vui lòng nhập thông tin</ng-container>
              <ng-container *ngIf="control.hasError('maxlength')">Cho phép nhập tối đa 500 kí tự</ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </nz-col>
      <nz-col nzSpan="12">
        <nz-form-item>
          <nz-form-label nzFor="instanceId">
            <div class="label">
              <span>Chọn máy ảo</span>
              <span style="color: rgba(252, 16, 16, 1);">*</span>
            </div>
          </nz-form-label>
          <nz-form-control nzDisableAutoTips [nzErrorTip]="instanceErrorTpl">
            <nz-select *ngIf="instanceId != null" formControlName="instanceId"
                       [nzSize]="'large'"
                       [nzPlaceHolder]="'Chọn máy ảo'"
                       [nzShowSearch]="false"
                       [nzLoading]="isLoadingInstance"
                       (ngModelChange)="selectInstanceChange($event)">
              <nz-option [nzValue]="instanceId" [nzLabel]="instanceName"></nz-option>
            </nz-select>
            <nz-select *ngIf="instanceId == null" formControlName="instanceId"
                       [nzSize]="'large'"
                       [nzPlaceHolder]="'Chọn máy ảo'"
                       [nzShowSearch]="false"
                       [nzLoading]="isLoadingInstance"
                       (ngModelChange)="selectInstanceChange($event)">
              <nz-option *ngFor="let i of listInstanceNotUse"
                         [nzLabel]="i.name"
                         [nzValue]="i.id"></nz-option>
            </nz-select>
            <ng-template #instanceErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')">Vui lòng nhập thông tin</ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzFor="backupMode">
            <div class="label">
              <span>Chế độ Backup</span>
              <span style="color: rgba(252, 16, 16, 1);">*</span>
            </div>
          </nz-form-label>
          <nz-form-control nzDisableAutoTips [nzErrorTip]="backupModeErrorTpl">
            <nz-select
              formControlName="backupMode" id="backupMode"
              nzSize="large"
              [nzPlaceHolder]="'Chế độ Backup'"
              [nzShowSearch]="false"
              (ngModelChange)="modeChange($event)">
              <nz-option *ngFor="let i of mode"
                         [nzLabel]="i.label"
                         [nzValue]="i.value"/>
            </nz-select>
            <ng-template #backupModeErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')">Vui lòng nhập thông tin</ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label>
            <span>Thời gian thực hiện</span>
            <span style="color: rgba(252, 16, 16, 1);">*</span>
          </nz-form-label>
          <nz-form-control nzDisableAutoTips [nzErrorTip]="timeErrorTpl">
            <nz-time-picker formControlName=times
                            id="times"
                            nzSize="large"
                            [nzPlaceHolder]="'Chọn thời gian'"
                            style="width: 100%; border-radius: 8px;"></nz-time-picker>
            <ng-template #timeErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')">Vui lòng nhập thông tin</ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
        <div *ngIf="modeType === '4'">
          <nz-form-item>
            <nz-form-label nzFor="months">
              <div class="label">
                <span>Số tháng thực hiện</span>
                <span style="color: rgba(252, 16, 16, 1);">*</span>
              </div>
            </nz-form-label>
            <nz-form-control nzDisableAutoTips [nzErrorTip]="monthsErrorTpl">
              <nz-input-number style="width:100%; border-radius: 8px; margin-left: 0;"
                class="input-custom"
                formControlName="months"
                id="months"
                nzMin="1"
                nzMax="24"
                nzStep="1"/>
              <ng-template #monthsErrorTpl let-control>
                <ng-container *ngIf="control.hasError('required')">Vui lòng nhập số lớn hơn 0 và nhỏ hơn 24</ng-container>
                <ng-container *ngIf="control.hasError('max')">Vui lòng nhập số lớn hơn 0 và nhỏ hơn 24</ng-container>
                <ng-container *ngIf="control.hasError('min')">Vui lòng nhập số lớn hơn 0 và nhỏ hơn 24</ng-container>
              </ng-template>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label nzFor="date">
              <div class="label">
                <span>Ngày thực hiện</span>
                <span style="color: rgba(252, 16, 16, 1); "> *</span>
              </div>
            </nz-form-label>
            <nz-form-control nzDisableAutoTips [nzErrorTip]="dateErrorTpl">
              <nz-input-number
                style="width:100%; border-radius: 8px; margin-left: 0;"
                formControlName="date"
                class="input-custom"
                id="date"
                nzMin="1"
                nzMax="31"
                nzStep="1"/>
              <ng-template #dateErrorTpl let-control>
                <ng-container *ngIf="control.hasError('required')">Vui lòng nhập số lớn hơn 0 và nhỏ hơn 31</ng-container>
                <ng-container *ngIf="control.hasError('max')">Vui lòng nhập số lớn hơn 0 và nhỏ hơn 31</ng-container>
                <ng-container *ngIf="control.hasError('min')">Vui lòng nhập số lớn hơn 0 và nhỏ hơn 31</ng-container>
              </ng-template>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div *ngIf="modeType === '3'">
          <nz-form-item>
            <nz-form-label nzFor="numberOfWeek">
              <div class="label">
                <span>Số tuần thực hiện</span>
                <span style="color: rgba(252, 16, 16, 1); "> *</span>
              </div>
            </nz-form-label>
            <nz-form-control nzDisableAutoTips>
              <nz-select
                formControlName="numberOfWeek" id="numberOfWeek"
                [nzPlaceHolder]="'Số tuần thực hiện'"
                [nzShowSearch]="false"
                nzSize="large"
                [(ngModel)]="numberOfWeekChangeSelected"
                (ngModelChange)="numberOfWeekChange($event)">
                <nz-option
                  *ngFor="let i of numberOfWeek"
                  [nzLabel]="i.label"
                  [nzValue]="i.value"/>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label nzFor="daysOfWeek">
              <div class="label">
                <span>Chọn thứ</span>
                <span style="color: rgba(252, 16, 16, 1); "> *</span>
              </div>
            </nz-form-label>
            <nz-form-control nzDisableAutoTips [nzErrorTip]="daysOfWeekErrorTpl">
              <nz-select
                formControlName="daysOfWeek" id="daysOfWeek"
                [nzPlaceHolder]="'Chọn thứ'"
                nzSize="large"
                [nzShowSearch]="false">
                <nz-option
                  *ngFor="let i of daysOfWeek"
                  [nzLabel]="i.label"
                  [nzValue]="i.value"/>
              </nz-select>
              <ng-template #daysOfWeekErrorTpl let-control>
                <ng-container *ngIf="control.hasError('required')">Vui lòng nhập ngày</ng-container>
              </ng-template>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div *ngIf="modeType === '2'">
          <nz-form-item>
            <nz-form-label nzFor="daysOfWeekMultiple">
              <div class="label">
                <span>Chọn thứ</span>
                <span style="color: rgba(252, 16, 16, 1); "> *</span>
              </div>
            </nz-form-label>
            <nz-form-control nzDisableAutoTips [nzErrorTip]="daysOfWeekErrorTpl">
              <nz-select
                formControlName="daysOfWeekMultiple" id="daysOfWeekMultiple"
                nzMode="multiple"
                nzSize="large"
                [nzPlaceHolder]="'Chọn thứ'"
                [nzShowSearch]="false">
                <nz-option
                  *ngFor="let i of daysOfWeek"
                  [nzLabel]="i.label"
                  [nzValue]="i.value"/>
              </nz-select>
              <ng-template #daysOfWeekErrorTpl let-control>
                <ng-container *ngIf="control.hasError('required')">Vui lòng nhập ngày</ng-container>
              </ng-template>
            </nz-form-control>
          </nz-form-item>
        </div>
        <nz-form-item>
          <nz-form-label nzFor="listAttachedVolume">
            <div class="label">
              <span>Chọn Volume gắn ngoài cần backup</span>
            </div>
          </nz-form-label>
          <nz-form-control>
            <nz-select id="volumeToBackupIds"
                       formControlName="volumeToBackupIds"
                       [nzPlaceHolder]="'Volume gắn ngoài'"
                       nzMode="multiple"
                       nzSize="large"
                       [nzShowSearch]="false">
              <nz-option *ngFor="let i of volumeAttachments" [nzLabel]="i.name" [nzValue]="i.id"/>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </nz-col>
    </nz-row>
    <nz-form-item nzAlign="bottom" nzJustify="end" style="margin-top: 30px">
      <nz-space nzSize="middle">
        <button *nzSpaceItem nz-button nzType="default" (click)="goBack()" class="button-back">
          <span nz-icon nzType="close" nzTheme="outline"></span>Hủy
        </button>
        <nz-form-control *nzSpaceItem>
          <button nz-button [nzLoading]="isLoading" nzType="primary"
                  class="button-create" [disabled]="!validateForm.valid">
            <span nz-icon nzType="check" nzTheme="outline"></span>Xác nhận
          </button>
        </nz-form-control>
      </nz-space>
    </nz-form-item>
  </nz-card>
</form>
