<page-header [breadcrumb]="breadcrumb"
             [action]="action"
             title="{{'schedule.backup.title.list' | i18n}}" xmlns="http://www.w3.org/1999/html">
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item>{{'app.breadcrumb.home' | i18n}}</nz-breadcrumb-item>
      <nz-breadcrumb-item>
        {{'app.breadcrumb.infrastructure.service' | i18n}}
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        Backup
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a routerLink="/app-smart-cloud/schedule/backup/list">{{'schedule.backup.title.job' | i18n}}</a>
      </nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <share-users-combobox></share-users-combobox>
      <region-select-dropdown (valueChanged)="regionChanged($event)"></region-select-dropdown>
      <project-select-dropdown (valueChanged)="projectChanged($event)"
                               (userChanged)="projectChanged($event)"
                               [regionId]="region"></project-select-dropdown>
    </div>
  </ng-template>
</page-header>
<nz-content>
    <nz-card>
        <span class="text-card-header">{{'schedule.backup.label.edit' | i18n}}</span>
        <nz-row>
            <div style="display: block;">
                <label nz-radio nzValue="VM" class="label" [ngModel]="true" [nzDisabled]="true">Backup VM</label>
                <label nz-radio nzValue="VOLUME" class="label" [nzDisabled]="true">Backup Volume</label>
            </div>
        </nz-row>
        <form nz-form [formGroup]="validateForm" (ngSubmit)="submitForm()" nzLayout="vertical">
            <nz-row nzGutter="24" style="margin-top: 20px;">
                <nz-col nzSpan="12">
                    <nz-form-item>
                        <nz-form-label nzFor="name">
                            <div class="label">
                                <span>{{'schedule.backup.label.name' | i18n}}</span>
                                <span style="color: rgba(252, 16, 16, 1); "> *</span>
                            </div>
                        </nz-form-label>
                        <nz-form-control nzDisableAutoTips [nzErrorTip]="nameErrorTpl">
                            <input nz-input formControlName="name" id="name"/>
                            <ng-template #nameErrorTpl let-control>
                                <ng-container *ngIf="control.hasError('required')">{{'validation.info.required' | i18n}}
                                </ng-container>
                                <ng-container *ngIf="control.hasError('pattern')">{{'schedule.backup.validate1' | i18n}}
                                </ng-container>
                                <ng-container *ngIf="control.hasError('invalidCharacters')">{{'schedule.backup.validate2' | i18n}}
                                </ng-container>
                                <ng-container *ngIf="control.hasError('duplicateName')">{{'schedule.backup.validate3' | i18n}}</ng-container>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label nzFor="maxBackup">
                            <div class="label">
                                <span>{{'schedule.backup.number.save' | i18n}}</span>
                                <span style="color: rgba(252, 16, 16, 1); "> *</span>
                            </div>
                        </nz-form-label>
                        <nz-form-control>
                            <input nz-input
                                   style="width: 100%;"
                                   value="{{backupSchedule?.maxBackup}}"
                                   disabled="true"/>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label>
                            <div class="label">
                                <span>{{'app.backup.volume.backup.package' | i18n}}</span>
                                <span style="color: rgba(252, 16, 16, 1); "> *</span>
                            </div>
                        </nz-form-label>
                        <nz-form-control nzDisableAutoTips>
                            <input nz-input
                                   style="width: 100%;"
                                   value="{{backupSchedule?.backupPackageName}}"
                                   [disabled]="true"/>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label nzFor="description">
                            <div class="label">
                                <span>{{'app.cluster.description' | i18n}}</span>
                            </div>
                        </nz-form-label>
                        <nz-form-control nzDisableAutoTips [nzErrorTip]="descriptionErrorTpl">
                            <textarea nz-input
                                      style="width: 100%;"
                                      formControlName="description"
                                      id="description"
                                      [nzAutosize]="{ minRows: 3, maxRows: 5 }"></textarea>
                            <ng-template #descriptionErrorTpl let-control>
                                <ng-container *ngIf="control.hasError('required')">{{'validation.info.required' | i18n}}
                                </ng-container>
                                <ng-container *ngIf="control.hasError('maxlength')">{{'schedule.backup.validate4' | i18n}}
                                </ng-container>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                </nz-col>
                <nz-col nzSpan="12">
                    <nz-form-item>
                        <nz-form-label nzFor="instanceId">
                            <div class="label">
                                <span>{{'wan.label.instance.select' | i18n}}</span>
                                <span style="color: rgba(252, 16, 16, 1); "> *</span>
                            </div>
                        </nz-form-label>
                        <nz-form-control>
                            <input nz-input
                                   style="width: 100%;"
                                   value="{{backupSchedule?.serviceName}}"
                                   [disabled]="true"/>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label nzFor="backupMode">
                            <div class="label">
                                <span>{{'schedule.backup.mode' | i18n}}</span>
                                <span style="color: rgba(252, 16, 16, 1); "> *</span>
                            </div>
                        </nz-form-label>
                        <nz-form-control nzDisableAutoTips [nzErrorTip]="backupModeErrorTpl">
                            <nz-select
                                    formControlName="backupMode" id="backupMode"
                                    nzPlaceHolder="{{'schedule.backup.mode' | i18n}}"
                                    [nzShowSearch]="false"
                                    (ngModelChange)="modeChange($event)">
                                <nz-option
                                        *ngFor="let i of mode"
                                        [nzLabel]="i.label"
                                        [nzValue]="i.value"/>
                            </nz-select>
                            <ng-template #backupModeErrorTpl let-control>
                                <ng-container *ngIf="control.hasError('required')">{{'validation.info.required' | i18n}}
                                </ng-container>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label nzFor="times">
                            <div class="label">
                                <span>{{'app.cluster.action-time' | i18n}}</span>
                                <span style="color: rgba(252, 16, 16, 1); "> *</span>
                            </div>
                        </nz-form-label>
                        <nz-form-control nzDisableAutoTips [nzErrorTip]="timeErrorTpl">
                            <nz-time-picker formControlName=times
                                            id="times"
                                            nzPlaceHolder="{{'schedule.backup.time.select' | i18n}}"
                                            style="width: 100%"></nz-time-picker>
                            <ng-template #timeErrorTpl let-control>
                                <ng-container *ngIf="control.hasError('required')">{{'validation.info.required' | i18n}}
                                </ng-container>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                    <div *ngIf="modeType === '4'">
                        <nz-form-item>
                            <nz-form-label nzFor="months">
                                <div class="label">
                                    <span>{{'app.number.of.month.executed' | i18n}}</span>
                                    <span style="color: rgba(252, 16, 16, 1); "> *</span>
                                </div>
                            </nz-form-label>
                            <nz-form-control nzDisableAutoTips [nzErrorTip]="monthsErrorTpl">
                                <input nz-input type="number" style="width:100%;"
                                       formControlName="months"
                                       id="months"
                                       min="1"
                                       max="24"
                                       step="1"/>
                                <ng-template #monthsErrorTpl let-control>
                                    <ng-container *ngIf="control.hasError('required')">{{'schedule.backup.0.to.24' | i18n}}
                                    </ng-container>
                                </ng-template>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item>
                            <nz-form-label nzFor="date">
                                <div class="label">
                                    <span>{{'app.execution.date' | i18n}}</span>
                                    <span style="color: rgba(252, 16, 16, 1); "> *</span>
                                </div>
                            </nz-form-label>
                            <nz-form-control nzDisableAutoTips [nzErrorTip]="dateErrorTpl">
                                <input nz-input type="number"
                                       style="width:100%;"
                                       formControlName="date"
                                       id="date"
                                       min="1"
                                       max="31"
                                       step="1"/>
                                <ng-template #dateErrorTpl let-control>
                                    <ng-container *ngIf="control.hasError('required')">{{'schedule.backup.0.to.31' | i18n}}</ng-container>
                                    <ng-container *ngIf="control.hasError('max')">{{'schedule.backup.0.to.31' | i18n}}</ng-container>
                                    <ng-container *ngIf="control.hasError('min')">{{'schedule.backup.0.to.31' | i18n}}</ng-container>
                                </ng-template>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div *ngIf="modeType === '3'">
                        <nz-form-item>
                            <nz-form-label nzFor="numberOfWeek">
                                <div class="label">
                                    <span>{{'app.number.of.week.executed' | i18n}}</span>
                                    <span style="color: rgba(252, 16, 16, 1); "> *</span>
                                </div>
                            </nz-form-label>
                            <nz-form-control nzDisableAutoTips>
                                <nz-select
                                        formControlName="numberOfWeek" id="numberOfWeek"
                                        nzPlaceHolder="{{'app.number.of.week.executed' | i18n}}"
                                        [nzShowSearch]="false"
                                        [(ngModel)]="numberOfWeekChangeSelected"
                                        (ngModelChange)="numberOfWeekChange($event)">
                                    <nz-option
                                            *ngFor="let i of numberOfWeek"
                                            [nzLabel]="i.label"
                                            [nzValue]="i.value"/>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item>
                            <nz-form-label nzFor="daysOfWeek">
                                <div class="label">
                                    <span>{{'schedule.backup.day.select' | i18n}}</span>
                                    <span *ngIf="modeType == '2'" style="color: rgba(252, 16, 16, 1); ">*</span>
                                </div>
                            </nz-form-label>
                            <nz-form-control nzDisableAutoTips [nzErrorTip]="daysOfWeekErrorTpl">
                                <nz-select
                                        formControlName="daysOfWeek" id="daysOfWeek"
                                        nzPlaceHolder="{{'schedule.backup.day.select' | i18n}}"
                                        [nzShowSearch]="false">
                                    <nz-option
                                            *ngFor="let i of daysOfWeek"
                                            [nzLabel]="i.label"
                                            [nzValue]="i.value"/>
                                </nz-select>
                                <ng-template #daysOfWeekErrorTpl let-control>
                                    <ng-container *ngIf="control.hasError('required')">{{'schedule.backup.press.date' | i18n}}</ng-container>
                                </ng-template>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div *ngIf="modeType==='2'">
                        <nz-form-item>
                            <nz-form-label nzFor="daysOfWeekMultiple">
                                <div class="label">
                                    <span>{{'schedule.backup.day.select' | i18n}}</span>
                                    <span *ngIf="modeType == '2'" style="color: rgba(252, 16, 16, 1); "> *</span>
                                </div>
                            </nz-form-label>
                            <nz-form-control nzDisableAutoTips [nzErrorTip]="daysOfWeekErrorTpl">
                                <nz-select
                                        formControlName="daysOfWeekMultiple" id="daysOfWeekMultiple"
                                        nzMode="multiple"
                                        nzPlaceHolder="{{'schedule.backup.day.select' | i18n}}"
                                        [nzShowSearch]="false">
                                    <nz-option
                                            *ngFor="let i of daysOfWeek"
                                            [nzLabel]="i.label"
                                            [nzValue]="i.value"/>
                                </nz-select>
                                <ng-template #daysOfWeekErrorTpl let-control>
                                    <ng-container *ngIf="control.hasError('required')">{{'schedule.backup.press.date' | i18n}}</ng-container>
                                </ng-template>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <nz-form-item>
                        <nz-form-label nzFor="listAttachedVolume">
                            <div class="label">
                                <span>{{'schedule.backup.select.volume.backup' | i18n}}</span>
                            </div>
                        </nz-form-label>
                        <nz-form-control>
                            <input nz-input
                                   [disabled]="true"
                                   value="{{listVolume?.join(', ')}}"
                                   style="width: 100%;"/>
                        </nz-form-control>
                    </nz-form-item>
                </nz-col>
            </nz-row>
            <nz-form-item nzAlign="bottom" nzJustify="end" style="margin-top: 30px">
                <nz-space nzSize="large">
                    <button *nzSpaceItem nz-button nzType="default" (click)="goBack()" class="button-back">{{'app.order-detail.back' | i18n}}</button>
                    <nz-form-control *nzSpaceItem>
                        <button nz-button [nzLoading]="isLoading" nzType="primary"
                                class="button-create" [disabled]="!validateForm.valid">{{'app.button.confirm' | i18n}}
                        </button>
                    </nz-form-control>
                </nz-space>
            </nz-form-item>
        </form>
    </nz-card>
</nz-content>
