<page-header
  [breadcrumb]="breadcrumb"
  [action]="action"
  [title]="'Danh sách lịch Snapshot'"
>
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item
        ><a [routerLink]="['/']">Trang chủ</a></nz-breadcrumb-item
      >
      <nz-breadcrumb-item> Lịch Snapshot </nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <region-select-dropdown
        (valueChanged)="onRegionChange($event)"
      ></region-select-dropdown>
      <project-select-dropdown
        [regionId]="region"
        (valueChanged)="onProjectChange($event)"
        (userChanged)="onProjectChange($event)"
      ></project-select-dropdown>
    </div>
  </ng-template>
</page-header>

<nz-card style="border-radius: 4px">
  <div style="margin-bottom: 20px" nz-row [nzGutter]="24">
    <div
      nz-col
      [nzLg]="12"
      [nzMd]="12"
      [nzSm]="24"
      [nzXl]="12"
      [nzXs]="24"
      [nzXXl]="12"
    >
    <nz-select
        style="width: 20%"
        [(ngModel)]="searchStatus"
        [ngModelOptions]="{ standalone: true }"
        [nzPlaceHolder]="'Trạng thái dịch vụ'"
        [nzShowSearch]="false"
        (ngModelChange)="searchSnapshotScheduleList()"
        nzSize="large"
      >
        <nz-option
          *ngFor="let i of status"
          [nzLabel]="i.label"
          [nzValue]="i.value"
        />
      </nz-select>
      <nz-input-group
        style="margin-left: 10px; width: 50%; border-radius: 8px"
        [nzPrefix]="prefixIconSearch"
        nzSize="large"
      >
        <input
          name="name"
          nz-input
          placeholder="Tìm kiếm tên"
          [(ngModel)]="searchName"
          (keyup.enter)="searchSnapshotScheduleList()"
        />
      </nz-input-group>
      <ng-template #prefixIconSearch>
        <img
          src="assets/imgs/search.svg"
          alt=""
          style="cursor: pointer"
          nz-tooltip="Tìm kiếm"
          (click)="searchSnapshotScheduleList()"
        />
      </ng-template>
    </div>
    <div
      class="text-right p-0 m-b-0"
      nz-col
      [nzLg]="12"
      [nzMd]="12"
      [nzSm]="24"
      [nzXl]="12"
      [nzXs]="24"
      [nzXXl]="12"
    >
      <button
        nz-button
        nzType="primary"
        (click)="navigateToCreate()"
        nzSize="large"
      >
        <img
          style="padding-right: 10px; margin-top: -4px"
          src="assets/imgs/add-circle.svg"
          alt=""
        />
        Tạo mới
      </button>
    </div>
  </div>
  <nz-table
    class="table-data"
    #rowSelectionTable
    [nzData]="listOfData"
    nzShowSizeChanger
    [nzFrontPagination]="false"
    [nzTotal]="totalData"
    [(nzPageSize)]="pageSize"
    [(nzPageIndex)]="pageNumber"
    (nzPageSizeChange)="searchSnapshotScheduleList()"
    (nzPageIndexChange)="searchSnapshotScheduleList()"
    [nzLoading]="isLoadingEntities"
    [nzScroll]="{ x: '100%', y: '55vh' }"
  >
    <thead>
      <tr>
        <th>Tên</th>
        <th>Volume</th>
        <th>Số bản ghi tối đa</th>
        <th>Chu kỳ</th>
        <th>Trạng thái dịch vụ</th>
        <th>Lần Snapshot tiếp theo</th>
        <th>Thao tác</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of rowSelectionTable.data">
        <td>
          <a (click)="navigateToDetail(data.id)">{{ data.name }}</a>
        </td>
        <td>{{ data.volumeName }}</td>
        <td>{{ data.maxSnapshot }}</td>
        <td>Theo tuần</td>
        <td *ngIf="data.status == 'ACTIVE'" style="color: #52c41a">
          Đang hoạt động
        </td>
        <td>{{ data.nextRuntime | date : 'HH:mm:ss dd/MM/yyyy' }}</td>
        <td nzRight>
          <button
            nz-button
            [nzType]="'primary'"
            nz-dropdown
            [nzDropdownMenu]="opMenu"
          >
            <span>Chọn thao tác</span> <i nz-icon nzType="down"></i>
          </button>
          <nz-dropdown-menu #opMenu="nzDropdownMenu">
            <ul nz-menu>
              <li nz-menu-item (click)="navigateToEdit(data.id)">Chỉnh sửa</li>
              <li
                *ngIf="data.status == 'ACTIVE'"
                nz-menu-item
                (click)="doPauseSnapshotSchedule(data.id)"
              >
                Tạm dừng
              </li>
              <li
                *ngIf="data.status == 'TAMNGUNG'"
                nz-menu-item
                (click)="doResumeSnapshotSchedule(data.id)"
              >
                Tiếp tục
              </li>
              <li nz-menu-item (click)="DeleteSnapshot(data.id)">Xóa</li>
            </ul>
          </nz-dropdown-menu>
        </td>
      </tr>
    </tbody>
  </nz-table>
</nz-card>
