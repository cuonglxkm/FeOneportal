<page-header [breadcrumb]="breadcrumb" [title]="'app.payment.service' | i18n">
  <ng-template #breadcrumb>
    <nz-breadcrumb [nzSeparator]="separatorTemplate">
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">{{ 'app.breadcrumb.home' | i18n }}</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        {{ 'app.payment.payment' | i18n }}
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        {{ 'app.payment.service' | i18n }}
      </nz-breadcrumb-item>
    </nz-breadcrumb>
    <ng-template #separatorTemplate
      ><img src="assets/imgs/arrow-square-right.svg" alt="" />
    </ng-template>
  </ng-template>
</page-header>
<div nz-row nzGutter="16">
  <div nz-col nzSpan="16">
    <nz-card style="border-radius: 8px">
      <div style="margin-bottom: 20px">
        <span class="text-card-header">{{ 'app.customer.info' | i18n }}</span>
      </div>
      <nz-row>
        <div nz-col nzSpan="24">
          <nz-row style="height: 50px">
            <span class="fw-600 text-16" nz-col nzSpan="4"
              >{{ 'app.payment-detail.customerName' | i18n }}:</span
            >
            <span nz-col nzSpan="20" class="text-16">{{
              userModel.name || ''
            }}</span>
          </nz-row>
          <nz-row style="height: 50px">
            <span class="fw-600 text-16" nz-col nzSpan="4"
              >{{ 'form.account.phone' | i18n }}:</span
            >
            <span nz-col nzSpan="20" class="text-16">{{
              userModel.phoneNumber === '' ? '-' : userModel.phoneNumber
            }}</span>
          </nz-row>
          <nz-row style="height: 50px">
            <span class="fw-600 text-16" nz-col nzSpan="4">Email:</span>
            <span nz-col nzSpan="20" class="text-16">
              {{ userModel.email === '' ? '-' : userModel.email }}</span
            >
          </nz-row>
          <nz-row style="height: 50px">
            <span class="fw-600 text-16" nz-col nzSpan="4"
              >{{ 'app.payment-detail.address' | i18n }}:</span
            >
            <span nz-col nzSpan="20" class="text-16">{{
              userModel.address === '' ? '-' : userModel.address
            }}</span>
          </nz-row>
        </div>
      </nz-row>
    </nz-card>
    <nz-card style="border-radius: 8px">
      <div style="margin-bottom: 20px">
        <span class="text-card-header">{{
          'app.payment-detail.serviceInformation' | i18n
        }}</span>
      </div>
      <nz-table
        #rowSelectionTable
        nzShowSizeChanger
        [nzFrontPagination]="false"
        [nzData]="listServiceInfo"
      >
        <thead>
          <tr>
            <th>{{ 'app.action-history.serviceName' | i18n }}</th>
            <th>{{ 'app.payment.service.type' | i18n }}</th>
            <th nzAlign="right">{{ 'app.payment-detail.price' | i18n }}</th>
            <th nzAlign="right">{{ 'app.payment-detail.remain' | i18n }}</th>
            <th nzAlign="right">{{ 'app.amount' | i18n }}</th>
            <th nzAlign="right">
              {{ 'app.payment-detail.totalPrice' | i18n }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of listServiceInfo; let i = index">
            <td>{{ item.name }}</td>
            <td>{{ item.type }}</td>
            <td nzAlign="right">{{ item.price | number : '1.0-0' }}</td>
            <td nzAlign="right">{{ item.duration }}</td>
            <td nzAlign="right">{{ item.amount }}</td>
            <td nzAlign="right">{{ item.currency | number : '1.0-0' }}</td>
          </tr>
        </tbody>
      </nz-table>
    </nz-card>
  </div>
  <div nz-col nzSpan="8">
    <nz-card style="border-radius: 8px; border-color: #b2deff">
      <div style="margin-bottom: 20px">
        <span class="text-card-header">{{
          'app.payment-detail.paymentInformation' | i18n
        }}</span>
      </div>
      <div>
        <nz-table>
          <tr style="margin-bottom: 5px">
            <td class="text-16">
              {{ 'app.payment-detail.totalAmount' | i18n }}
            </td>
            <td style="text-align: right">
              <span class="price"
                >{{ totalAmount | number : '1.0-0' }} VND</span
              >
            </td>
          </tr>
          <tr>
            <td style="border-bottom: 1px solid rgba(0, 0, 0, 0.06)"></td>
            <td style="border-bottom: 1px solid rgba(0, 0, 0, 0.06)"></td>
          </tr>
          <tr style="height: 10px">
            <td></td>
            <td></td>
          </tr>
          <tr style="margin-bottom: 5px">
            <td class="text-16">VAT(10%)</td>
            <td style="text-align: right">
              <span class="price"
                >{{
                  (totalAmount - promotion) * 0.1 | number : '1.0-0'
                }}
                VND</span
              >
            </td>
          </tr>
          <tr>
            <td style="border-bottom: 1px solid rgba(0, 0, 0, 0.06)"></td>
            <td style="border-bottom: 1px solid rgba(0, 0, 0, 0.06)"></td>
          </tr>
          <tr style="height: 10px">
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td style="display: flex; align-items: center">
              <img alt="" src="assets/imgs/ticket-discount.png" />
              <span class="text-16">{{ 'app.payment.discounts' | i18n }}:</span>
            </td>
            <td style="text-align: right">
              <span style="margin-right: 10px">{{ order.couponCode }}</span>
              <a class="text-16" (click)="showModal()">{{
                'app.payment.choose.or.enter.code' | i18n
              }}</a>
            </td>
          </tr>
          <tr style="height: 10px">
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td style="border-bottom: 1px solid rgba(0, 0, 0, 0.06)"></td>
            <td style="border-bottom: 1px solid rgba(0, 0, 0, 0.06)"></td>
          </tr>
          <tr style="height: 20px">
            <td></td>
            <td></td>
          </tr>
          <tr style="background-color: #cce9ff">
            <td style="padding: 10px; border-radius: 8px 0 0 8px">
              <span style="display: block; font-size: 16px; font-weight: 600">{{
                'app.total.payment' | i18n
              }}</span>
              <span class="text-16"
                >({{ 'app.payment-detail.vat' | i18n }})</span
              >
            </td>
            <td
              style="
                text-align: right;
                color: #ea3829;
                font-weight: 600;
                padding: 10px;
                border-radius: 0 8px 8px 0;
                font-size: 16px;
              "
            >
              {{
                totalAmount - promotion + (totalAmount - promotion) * 0.1
                  | number : '1.0-0'
              }}
              VND
            </td>
          </tr>
        </nz-table>

        <div style="border-radius: 8px" class="custom-div">
          <label
            nz-checkbox
            [(ngModel)]="acceptTerm"
            [ngModelOptions]="{ standalone: true }"
            class="text-16"
            >{{ 'app.payment.agree.to' | i18n }} <a>{{ 'app.payment.service.term' | i18n }}</a></label
          >
        </div>
        <div style="margin-top: 10px">
          <button
            [disabled]="!acceptTerm"
            nz-button
            nzType="primary"
            (click)="payNow()"
            style="
              width: 100%;
              display: flex;
              align-items: center;
              gap: 5px;
              justify-content: center;
            "
          >
            <img src="assets/imgs/wallet.svg" />
            {{ 'app.payment.payment' | i18n }}
          </button>
          <button
            style="width: 100%; margin: 15px 0px 0px 0px; border: none"
            nz-button
            (click)="navigateToCreate()"
          >
            <img
              style="padding-right: 10px"
              src="assets/imgs/arrow-left-2.svg"
              alt=""
            />
            <span>{{ 'app.button.back' | i18n }}</span>
          </button>
        </div>
      </div>
    </nz-card>
  </div>
</div>

<nz-modal
  [(nzVisible)]="isVisibleDiscount"
  nzTitle="Chọn Voucher"
  nzWidth="700px"
  (nzOnCancel)="handleCancelDiscount()"
>
  <ng-container *nzModalContent>
    <nz-input-group
      style="margin-right: 8px; margin-bottom: 8px; width: 100%"
      [nzSuffix]="suffixApply"
      [nzPrefix]="prefixLable"
      nzSize="large"
    >
      <input
        name="name"
        nz-input
        style="border: 1px solid #d9d9d9; padding-left: 8px"
        placeholder="Nhập mã VNPT Cloud Voucher"
        [(ngModel)]="inputCode"
      />
      <ng-template #prefixLable>
        <label>{{ 'app.payment.voucher.code' | i18n }}</label>
      </ng-template>
      <ng-template #suffixApply>
        <button
          nz-button
          nzType="primary"
          (click)="applyInputDiscount()"
          [disabled]="inputCode == ''"
        >
        {{ 'app.apply' | i18n }}
        </button>
      </ng-template>
    </nz-input-group>
    <span *ngIf="!checkedExistDiscount" style="color: #ff4d4f"
      >{{ 'app.payment.voucher.not.found' | i18n }}</span
    >
    <nz-table
      style="margin-top: 8px"
      [nzLoading]="loading"
      [nzData]="listDiscount"
      [nzFrontPagination]="false"
      [nzShowPagination]="false"
      [nzScroll]="{ y: '320px' }"
    >
      <tbody>
        <tr
          class="test-1"
          *ngFor="let item of listDiscount"
          style="display: flex; padding-right: 10px"
        >
          <nz-card
            class="ant-card-body-custom"
            style="width: 100%; border-radius: 4px; cursor: pointer"
            (click)="chooseDiscount(item.promotionCode)"
          >
            <nz-card-meta
              [nzAvatar]="nzAvatarselected2"
              [nzDescription]="nzDescriptionselected2"
            >
              <ng-template #nzAvatarselected2>
                <img
                  style="width: 150px; height: 100%"
                  src="assets/imgs/image_discount.png"
                  alt=""
                />
              </ng-template>
              <ng-template #nzDescriptionselected2>
                <nz-row nzGutter="24">
                  <nz-col nzSpan="20"
                    ><span>{{ item.description }}</span
                    ><br /><span
                      >{{ 'app.application.period' | i18n }}: {{ item.endDate }}</span
                    ></nz-col
                  >
                  <nz-col style="display: flex; align-items: center" nzSpan="4">
                    <input
                      style="cursor: pointer"
                      type="radio"
                      [checked]="item.promotionCode == discountPicked"
                    />
                  </nz-col>
                </nz-row>
              </ng-template>
            </nz-card-meta>
          </nz-card>
        </tr>
      </tbody>
    </nz-table>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button (click)="handleCancelDiscount()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/cancel.svg"
        alt=""
      />{{ 'app.button.cancel' | i18n }}
    </button>
    <button nz-button nzType="primary" (click)="handleOkDiscount()">
      <img
        style="padding-right: 10px; margin-top: -4px"
        src="assets/imgs/confirm.svg"
        alt=""
      />{{ 'app.button.confirm' | i18n }}
    </button>
  </div>
</nz-modal>
