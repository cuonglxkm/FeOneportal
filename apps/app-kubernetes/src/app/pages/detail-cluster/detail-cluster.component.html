<ng-container *ngIf="detailCluster; else loadingTpl">
  <ng-container *ngIf="!isEditMode; else submitModeTpl">
    <button nz-button nzType="primary" (click)="onEditCluster()" class="mb-3">
      <span nz-icon nzType="edit" nzTheme="outline"></span>
      Chỉnh sửa
    </button>
  </ng-container>
  <ng-template #submitModeTpl>
    <button nz-button nzType="default" nzDanger (click)="onCancelEdit()" class="mb-3" [disabled]="isUpgrading">
      <span nz-icon nzType="close" nzTheme="outline"></span>
      Hủy bỏ
    </button>
    <button nz-button nzType="primary" (click)="handleShowModalUpgradeWorker()" class="mb-3"
      [disabled]="isUpgrading || upgradeForm.invalid">
      <span nz-icon nzType="check" nzTheme="outline"></span>
      Xác nhận
    </button>
  </ng-template>

  <form nz-form [formGroup]="upgradeForm">
    <!-- Thông tin chung -->
    <nz-card class="border-card">
      <h3>Thông tin chung</h3>
      <div nz-row>
        <div nz-col [nzSpan]="24" class="detailtable">
          <nz-table [nzTemplateMode]="true" nzBordered>
            <tbody>
              <tr>
                <td class="w-50" [ngClass]="{'padbot-zero': isEditMode == true}">
                  <div nz-row>
                    <div nz-col [nzSpan]="8" [ngClass]="{'padtop-5': isEditMode == true}">Tên cluster</div>
                    <div nz-col [nzSpan]="16" class="description-info">
                      <ng-container *ngIf="!isEditMode; else editClusterNameTpl">
                        {{detailCluster.clusterName}}
                      </ng-container>
                      <ng-template #editClusterNameTpl>
                        <nz-form-item>
                          <nz-form-control [nzErrorTip]="errorClusterNameTpl">
                            <input type="text" nz-input formControlName="clusterName" placeholder="Nhập tên cluster" />
                          </nz-form-control>
                          <ng-template #errorClusterNameTpl>
                            <ng-container *ngIf="control.hasError('required')">
                              <div>Tên cluster không để trống</div>
                            </ng-container>
                            <ng-container *ngIf="control.hasError('minlength') || control.hasError('maxlength')">
                              <div>Tên cluster trong khoảng từ 5-50 ký tự</div>
                            </ng-container>
                            <ng-container *ngIf="control.hasError('pattern')">
                              <div>Tên cluster chỉ bao gồm các chữ thường, chữ hoa, số và các ký tự _-</div>
                            </ng-container>
                          </ng-template>
                        </nz-form-item>
                      </ng-template>
                    </div>
                  </div>
                </td>
                <td class="w-50">
                  <div nz-row>
                    <div nz-col [nzSpan]="8">
                      Phiên bản Kubernetes
                    </div>
                    <div nz-col [nzSpan]="16" class="description-info">
                      {{detailCluster.currentVersion}}
                      <button nz-button nzType="text" (click)="handleShowModalUpgradeVersion()"
                        class="action-icon borderless" nzTooltipTitle="Nâng cấp" nzTooltipPlacement="top" nz-tooltip>
                        <span nz-icon>
                          <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M18.343 9.46736L17.9653 8.81195C17.6458 8.25737 16.9377 8.06606 16.3823 8.38426C16.118 8.53999 15.8026 8.58417 15.5056 8.50706C15.2086 8.42996 14.9545 8.2379 14.7993 7.97324C14.6995 7.80502 14.6459 7.61342 14.6438 7.41781C14.6528 7.1042 14.5345 6.8003 14.3158 6.57534C14.0971 6.35037 13.7967 6.2235 13.483 6.22363H12.722C12.4147 6.22363 12.12 6.34611 11.9031 6.56397C11.6863 6.78184 11.5653 7.07712 11.5667 7.38449C11.5576 8.01909 11.0405 8.52874 10.4059 8.52868C10.2103 8.52665 10.0187 8.473 9.85045 8.37316C9.29511 8.05495 8.58699 8.24626 8.26746 8.80084L7.862 9.46736C7.54285 10.0212 7.73157 10.7289 8.28413 11.0503C8.6433 11.2577 8.86456 11.6409 8.86456 12.0557C8.86456 12.4704 8.6433 12.8536 8.28413 13.061C7.73227 13.3803 7.54335 14.0862 7.862 14.6384L8.24525 15.2994C8.39496 15.5695 8.64615 15.7689 8.94324 15.8533C9.24033 15.9378 9.55882 15.9003 9.82823 15.7493C10.0931 15.5948 10.4087 15.5524 10.7049 15.6317C11.0011 15.711 11.2534 15.9053 11.4057 16.1714C11.5055 16.3396 11.5591 16.5313 11.5612 16.7269C11.5612 17.368 12.0809 17.8877 12.722 17.8877H13.483C14.1219 17.8877 14.6408 17.3714 14.6438 16.7324C14.6423 16.4241 14.7642 16.128 14.9822 15.9099C15.2002 15.6919 15.4964 15.5701 15.8047 15.5716C15.9998 15.5768 16.1906 15.6302 16.3601 15.7271C16.914 16.0462 17.6217 15.8575 17.9431 15.305L18.343 14.6384C18.4978 14.3727 18.5403 14.0563 18.4611 13.7592C18.3818 13.4621 18.1874 13.2088 17.9209 13.0555C17.6543 12.9021 17.4599 12.6488 17.3807 12.3517C17.3015 12.0546 17.344 11.7382 17.4988 11.4725C17.5994 11.2967 17.7451 11.151 17.9209 11.0503C18.4701 10.7291 18.6584 10.0255 18.343 9.47291V9.46736Z" stroke="#0066B0" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M13.1064 13.6556C13.9898 13.6556 14.7059 12.9395 14.7059 12.0561C14.7059 11.1727 13.9898 10.4565 13.1064 10.4565C12.223 10.4565 11.5068 11.1727 11.5068 12.0561C11.5068 12.9395 12.223 13.6556 13.1064 13.6556Z" stroke="#0066B0" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M4.55005 17.4682C4.92357 18.0907 5.38008 18.6718 5.89886 19.1905C9.71706 23.0087 15.9216 23.0087 19.7606 19.1905C21.3169 17.6342 22.2092 15.6628 22.4997 13.6499" stroke="#0066B0" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M3.16016 10.8696C3.45067 8.83601 4.34298 6.88531 5.89932 5.32898C9.71752 1.51078 15.9221 1.51078 19.761 5.32898C20.3006 5.86851 20.7363 6.44958 21.1098 7.05136" stroke="#0066B0" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M4.5 20.0005V17.0005H7.5" stroke="#0066B0" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M21.5 4.00049V7.00049H18.5" stroke="#0066B0" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </span>
                      </button>
                    </div>
                  </div>
                </td>
              </tr>

              <tr>
                <!-- <td class="w-50"><row-data [value]="detailCluster.apiEndpoint" [label]="'API Endpoint'"></row-data></td> -->
                <td class="w-50">
                  <div nz-row>
                    <div nz-col [nzSpan]="8">
                      API Endpoint
                    </div>
                    <div nz-col [nzSpan]="16" class="description-info">
                      <ng-container *ngIf="detailCluster.apiEndpoint?.length <= 30; else truncateEndpointTpl">
                        {{detailCluster.apiEndpoint}}
                      </ng-container>
                      <ng-template #truncateEndpointTpl>
                        <span [nzTooltipTitle]="apiEnpointTpl" nzTooltipPlacement="bottom" nz-tooltip>
                          {{detailCluster.apiEndpoint | truncateLabel}}
                        </span>

                        <ng-template #apiEnpointTpl>
                          <div style="width: fit-content">{{detailCluster.apiEndpoint}}</div>
                        </ng-template>
                      </ng-template>

                      <button nz-button nzType="text" (click)="handleCopyAPIEndpoint()" class="action-icon borderless"
                        nzTooltipTitle="Sao chép" nzTooltipPlacement="top" nz-tooltip>
                        <span nz-icon>
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 12.9V17.1C16 20.6 14.6 22 11.1 22H6.9C3.4 22 2 20.6 2 17.1V12.9C2 9.4 3.4 8 6.9 8H11.1C14.6 8 16 9.4 16 12.9Z" stroke="#0066B0" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M22 6.9V11.1C22 14.6 20.6 16 17.1 16H16V12.9C16 9.4 14.6 8 11.1 8H8V6.9C8 3.4 9.4 2 12.9 2H17.1C20.6 2 22 3.4 22 6.9Z" stroke="#0066B0" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </span>
                      </button>
                    </div>
                  </div>
                </td>
                <td class="w-50"><row-data [value]="detailCluster.orderCode" [label]="'Mã đơn hàng'"></row-data></td>
              </tr>

              <tr>
                <td class="w-50"><row-data [value]="detailCluster.createdDate | date: 'dd/MM/yyyy'"
                    [label]="'Ngày khởi tạo'"></row-data></td>
                <td class="w-50"><row-data
                    [value]="(detailCluster.createdDate | calculateDate : detailCluster.usageTime) | date: 'dd/MM/yyyy'"
                    [label]="'Ngày hết hạn'" [type]="'danger'"></row-data></td>
              </tr>

              <tr>
                <td class="w-50">
                  <div nz-row>
                    <div nz-col [nzSpan]="8">Trạng thái</div>
                    <div nz-col [nzSpan]="16">
                      <ng-container *ngIf="detailCluster.serviceStatus | status2ColorPipe as status">
                        <span [ngStyle]="{color: status.color, 'font-weight': 600}">{{status.status}}</span>
                      </ng-container>
                    </div>
                  </div>
                </td>
                <td class="w-50"><row-data [value]="detailCluster.description" [label]="'Mô tả'"></row-data></td>
              </tr>

              <tr>
                <td class="w-50">
                  <div nz-row>
                    <div nz-col [nzSpan]="8">Cấu hình</div>
                    <div nz-col [nzSpan]="16">
                      <span class="description-info">
                        <a (click)="handleViewKubeConfig()">{{detailCluster.clusterName}}.Kubeconfig</a>
                      </span>
                      <button nz-button nzType="text" (click)="handleDownloadKubeConfig()"
                        class="action-icon borderless" nzTooltipTitle="Tải file cấu hình" nzTooltipPlacement="top"
                        nz-tooltip>
                        <span nz-icon>
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20.5 10.19H17.61C15.24 10.19 13.31 8.26 13.31 5.89V3C13.31 2.45 12.86 2 12.31 2H8.07C4.99 2 2.5 4 2.5 7.57V16.43C2.5 20 4.99 22 8.07 22H15.93C19.01 22 21.5 20 21.5 16.43V11.19C21.5 10.64 21.05 10.19 20.5 10.19ZM12.28 15.78L10.28 17.78C10.21 17.85 10.12 17.91 10.03 17.94C9.94 17.98 9.85 18 9.75 18C9.65 18 9.56 17.98 9.47 17.94C9.39 17.91 9.31 17.85 9.25 17.79C9.24 17.78 9.23 17.78 9.23 17.77L7.23 15.77C6.94 15.48 6.94 15 7.23 14.71C7.52 14.42 8 14.42 8.29 14.71L9 15.44V11.25C9 10.84 9.34 10.5 9.75 10.5C10.16 10.5 10.5 10.84 10.5 11.25V15.44L11.22 14.72C11.51 14.43 11.99 14.43 12.28 14.72C12.57 15.01 12.57 15.49 12.28 15.78Z" fill="#005999"/>
                            <path d="M17.4299 8.81048C18.3799 8.82048 19.6999 8.82048 20.8299 8.82048C21.3999 8.82048 21.6999 8.15048 21.2999 7.75048C19.8599 6.30048 17.2799 3.69048 15.7999 2.21048C15.3899 1.80048 14.6799 2.08048 14.6799 2.65048V6.14048C14.6799 7.60048 15.9199 8.81048 17.4299 8.81048Z" fill="#005999"/>
                          </svg>
                        </span>
                      </button>
                      <button nz-button nzType="text" class="action-icon borderless"
                        nzTooltipTitle="Sao chép" nzTooltipPlacement="top" nz-tooltip (click)="handleCopyKubeConfig()">
                        <span nz-icon>
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 12.9V17.1C16 20.6 14.6 22 11.1 22H6.9C3.4 22 2 20.6 2 17.1V12.9C2 9.4 3.4 8 6.9 8H11.1C14.6 8 16 9.4 16 12.9Z" stroke="#0066B0" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M22 6.9V11.1C22 14.6 20.6 16 17.1 16H16V12.9C16 9.4 14.6 8 11.1 8H8V6.9C8 3.4 9.4 2 12.9 2H17.1C20.6 2 22 3.4 22 6.9Z" stroke="#0066B0" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </span>
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </div>
    </nz-card>

    <!-- Thông tin worker group -->
    <nz-card class="border-card">
      <h3>Thông tin worker group</h3>
      <div formArrayName="workerGroup" *ngFor="let control of listFormWorkerGroupUpgrade.controls; let i = index;">
        <ng-container [formGroupName]="i">
          <div nz-row>
            <div nz-col [nzSpan]="24" class="detailtable">
              <nz-table [nzTemplateMode]="true" nzBordered>
                <tbody>
                  <tr>
                    <td class="w-50" [ngClass]="{'padbot-zero': isEditMode == true}">
                      <div nz-row>
                        <div nz-col [nzSpan]="8" [ngClass]="{'padtop-5': isEditMode == true}">Tên nhóm worker</div>
                        <div nz-col [nzSpan]="16" class="description-info">
                          <ng-container *ngIf="!isEditMode; else editWorkerGroupNameTpl">
                            {{'workerGroupName' | getValueInForm: listFormWorkerGroupUpgrade : i}}
                          </ng-container>
                          <ng-template #editWorkerGroupNameTpl>
                            <nz-form-item>
                              <nz-form-control [nzErrorTip]="errorWorkerNameTpl">
                                <input nz-input type="text" formControlName="workerGroupName"
                                  placeholder="Nhập tên nhóm worker" />
                              </nz-form-control>
                              <ng-template #errorWorkerNameTpl let-control>
                                <ng-container *ngIf="control.hasError('required')">
                                  Tên nhóm worker không để trống
                                </ng-container>
                                <ng-container *ngIf="control.hasError('duplicateName')">
                                  Tên nhóm worker đã tồn tại
                                </ng-container>
                                <ng-container *ngIf="control.hasError('maxlength')">
                                  Tên nhóm worker tối đa 16 ký tự
                                </ng-container>
                                <ng-container *ngIf="control.hasError('pattern')">
                                  Tên nhóm worker chỉ chứa các ký tự và số viết thường hoặc dấu gạch nối
                                </ng-container>
                              </ng-template>
                            </nz-form-item>
                          </ng-template>
                        </div>
                      </div>
                    </td>

                    <td class="w-50" [ngClass]="{'padbot-zero': isEditMode == true}">
                      <div nz-row>
                        <div nz-col [nzSpan]="8" [ngClass]="{'padtop-5': isEditMode == true}">Số node</div>
                        <div nz-col [nzSpan]="16" class="description-info">
                          <ng-container *ngIf="!isEditMode; else editNodeNumberTpl">
                            {{'nodeNumber' | getValueInForm: listFormWorkerGroupUpgrade : i}}
                          </ng-container>
                          <ng-template #editNodeNumberTpl>
                            <nz-form-item>
                              <nz-form-control [nzErrorTip]="errorNodeNumberTpl">
                                <input nz-input type="text" formControlName="nodeNumber" (keypress)="isNumber($event)"
                                  (ngModeChange)="onChangeNodeNumber($event, i)" />
                              </nz-form-control>
                              <ng-template #errorNodeNumberTpl>
                                <ng-container *ngIf="control.hasError('required')">
                                  Số node không để trống
                                </ng-container>
                                <ng-container *ngIf="control.hasError('min') || control.hasError('max')">
                                  Số node trong khoảng từ 1-10
                                </ng-container>
                              </ng-template>
                            </nz-form-item>
                          </ng-template>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="w-50" [ngClass]="{'padbot-zero': isEditMode == true}">
                      <div nz-row>
                        <div nz-col [nzSpan]="8" [ngClass]="{'padtop-5': isEditMode == true}">Cấu hình</div>
                        <div nz-col [nzSpan]="16" class="description-info">
                          <ng-container *ngIf="!isEditMode; else editConfigTypeTpl">
                            {{'cpu' | getValueInForm: listFormWorkerGroupUpgrade : i}}vCPU / {{'ram' | getValueInForm:
                            listFormWorkerGroupUpgrade : i}}GB
                          </ng-container>
                          <ng-template #editConfigTypeTpl>
                            <nz-form-item>
                              <nz-form-control [nzErrorTip]="errorConfigError">
                                <nz-select formControlName="configType" nzShowSearch nzPlaceHolder="Chọn cấu hình"
                                  (ngModelChange)="onChangeConfigType($event, i)" class="w-100">
                                  <nz-option *ngFor="let item of listOfWorkerType"
                                    nzLabel="{{item.machineName}} ({{item.cpu}} CPU - {{item.ram}} GB RAM)"
                                    [nzValue]="item.machineName">
                                  </nz-option>
                                </nz-select>
                              </nz-form-control>
                            </nz-form-item>
                          </ng-template>
                        </div>
                      </div>
                    </td>

                    <td class="w-50" [ngClass]="{'padbot-zero': isEditMode == true}">
                      <div nz-row>
                        <div nz-col [nzSpan]="8" [ngClass]="{'padtop-5': isEditMode == true}">Ổ cứng (GB)</div>
                        <div nz-col [nzSpan]="16" class="description-info">
                          <ng-container *ngIf="!isEditMode; else editWorkerVolumeSizeTpl">
                            {{'volumeStorage' | getValueInForm: listFormWorkerGroupUpgrade : i}}
                          </ng-container>
                          <ng-template #editWorkerVolumeSizeTpl>
                            <nz-form-item>
                              <nz-form-control [nzErrorTip]="volumeErrorTpl">
                                <input nz-input type="text" formControlName="volumeStorage"
                                  (keypress)="isNumber($event)" (ngModelChange)="onChangeVolumeWorker($event, i)" />
                              </nz-form-control>
                              <ng-template #volumeErrorTpl let-control>
                                <ng-container *ngIf="control.hasError('required')">
                                  Ổ cứng không để trống
                                </ng-container>
                                <ng-container *ngIf="control.hasError('min') || control.hasError('max')">
                                  Ổ cứng trong khoảng từ 20-1000 GB
                                </ng-container>
                                <ng-container *ngIf="control.hasError('invalid')">
                                  Ổ cứng không nhỏ hơn số đang sử dụng
                                </ng-container>
                              </ng-template>
                            </nz-form-item>
                          </ng-template>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="w-50">
                      <div nz-row>
                        <div nz-col [nzSpan]="8">Auto scale</div>
                        <div nz-col [nzSpan]="16" class="description-info">
                          <ng-container *ngIf="!isEditMode; else editScalingTpl">
                            <ng-container
                              *ngIf="('autoScalingWorker' | getValueInForm: listFormWorkerGroupUpgrade : i) == true; else offAutoScaleTpl">
                              Bật
                            </ng-container>
                            <ng-template #offAutoScaleTpl>
                              Tắt
                            </ng-template>
                          </ng-container>
                          <ng-template #editScalingTpl>
                            <nz-switch formControlName="autoScalingWorker" (ngModelChange)="onChangeAutoScale($event)"
                              nzCheckedChildren="Bật" nzUnCheckedChildren="Tắt"></nz-switch>
                          </ng-template>
                        </div>
                      </div>
                    </td>

                    <td class="w-50">
                      <!-- <div nz-row>
                        <div nz-col [nzSpan]="8">Auto healing</div>
                        <div nz-col [nzSpan]="16" class="description-info">
                          <ng-container *ngIf="!isEditMode; else editHealingTpl">
                            <ng-container
                              *ngIf="('autoHealing' | getValueInForm: listFormWorkerGroupUpgrade : i) == true; else offAutoHealingTpl">
                              Bật
                            </ng-container>
                            <ng-template #offAutoHealingTpl>
                              Tắt
                            </ng-template>
                          </ng-container>
                          <ng-template #editHealingTpl>
                            <nz-switch formControlName="autoHealing" nzCheckedChildren="Bật"
                              nzUnCheckedChildren="Tắt"></nz-switch>
                          </ng-template>
                        </div>
                      </div> -->

                      <div nz-row>
                        <div nz-col [nzSpan]="8">Loại ổ cứng</div>
                        <div nz-col [nzSpan]="16" class="description-info">
                          <ng-container *ngIf="!isEditMode; else editVolumeTypeTpl">
                            {{'volumeTypeName' | getValueInForm: listFormWorkerGroupUpgrade : i}}
                          </ng-container>
                          <ng-template #editVolumeTypeTpl>
                            <nz-radio-group formControlName="volumeType" (ngModelChange)="onSelectVolumeType($event, i)"
                              [nzDisabled]="isUsingPackConfig">
                              <ng-container *ngFor="let item of listOfVolumeType">
                                <label nz-radio [nzValue]="item.volumeType" id="volumeType">
                                  {{item.volumeTypeName}}
                                </label>
                              </ng-container>
                            </nz-radio-group>
                          </ng-template>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <ng-container *ngIf="isAutoScale">
                    <tr>
                      <td class="w-50" [ngClass]="{'padbot-zero': isEditMode == true}">
                        <div nz-row>
                          <div nz-col [nzSpan]="8" [ngClass]="{'padtop-5': isEditMode == true}">Minimum node</div>
                          <div nz-col [nzSpan]="16" class="description-info">
                            <ng-container *ngIf="!isEditMode; else editMinimumNodeTpl">
                              {{'minimumNode' | getValueInForm: listFormWorkerGroupUpgrade : i}}
                            </ng-container>
                            <ng-template #editMinimumNodeTpl>
                              <nz-form-item>
                                <nz-form-control [nzErrorTip]="errorMinimumNodeTpl">
                                  <input nz-input type="text" formControlName="minimumNode"
                                    placeholder="Nhập số node tối thiểu" />
                                </nz-form-control>
                                <ng-template #errorMinimumNodeTpl>
                                  <ng-container *ngIf="control.hasError('required')">
                                    Số node tối thiểu không để trống
                                  </ng-container>
                                  <ng-container *ngIf="control.hasError('invalid')">
                                    Số node tối thiểu không lớn hơn số node tối đa
                                  </ng-container>
                                  <ng-container *ngIf="control.hasError('min') || control.hasError('max')">
                                    Số node tối thiểu trong khoảng 1-10
                                  </ng-container>
                                </ng-template>
                              </nz-form-item>
                            </ng-template>
                          </div>
                        </div>
                      </td>

                      <td class="w-50" [ngClass]="{'padbot-zero': isEditMode == true}">
                        <div nz-row>
                          <div nz-col [nzSpan]="8" [ngClass]="{'padtop-5': isEditMode == true}">Maximum node</div>
                          <div nz-col [nzSpan]="16" class="description-info">
                            <ng-container *ngIf="!isEditMode; else editMaximumNodeTpl">
                              {{'maximumNode' | getValueInForm: listFormWorkerGroupUpgrade : i}}
                            </ng-container>
                            <ng-template #editMaximumNodeTpl>
                              <nz-form-item>
                                <nz-form-control [nzErrorTip]="errorMaximumNodeTpl">
                                  <input nz-input type="text" formControlName="maximumNode"
                                    placeholder="Nhập số node tối đa" />
                                </nz-form-control>
                                <ng-template #errorMaximumNodeTpl>
                                  <ng-container *ngIf="control.hasError('required')">
                                    Số node tối đa không để trống
                                  </ng-container>
                                  <ng-container *ngIf="control.hasError('min') || control.hasError('max')">
                                    Số node tối đa trong khoảng từ 1-10
                                  </ng-container>
                                </ng-template>
                              </nz-form-item>
                            </ng-template>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </ng-container>
                </tbody>
              </nz-table>
            </div>

            <ng-container *ngIf="isEditMode">
              <nz-divider nzDashed></nz-divider>
            </ng-container>
          </div>
        </ng-container>
      </div>

      <ng-container *ngIf="isEditMode">
        <button nz-button nzType="default" class="border-button" (click)="addWorkerGroup()">
          <span nz-icon>
            <svg viewBox="64 64 896 896" focusable="false">
              <path d="M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z" />
              <path d="M176 474h672q8 0 8 8v60q0 8-8 8H176q-8 0-8-8v-60q0-8 8-8z" />
            </svg>
          </span>
          Thêm worker group
        </button>
      </ng-container>
    </nz-card>

    <!-- Thông tin network -->
    <nz-card class="border-card">
      <h3>Thông tin network</h3>
      <div nz-row>
        <div nz-col [nzSpan]="24" class="detailtable">
          <nz-table [nzTemplateMode]="true" nzBordered>
            <tbody>
              <tr>
                <td class="w-50"><row-data [value]="detailCluster.networkType | network2label"
                    [label]="'Loại network'"></row-data></td>
                <td class="w-50"><row-data [value]="detailCluster.cidr" [label]="'Pod CIDR'"></row-data></td>
              </tr>

              <tr>
                <td class="w-50"><row-data [value]="vpcNetwork" [label]="'Mạng VPC'"></row-data></td>
                <td class="w-50"><row-data [value]="detailCluster.subnet" [label]="'Subnet'"></row-data></td>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </div>
    </nz-card>

    <!-- Thông tin volume -->
    <!-- <nz-card class="border-card">
      <h3>Thông tin volume persistent</h3>
      <div nz-row>
        <div nz-col [nzSpan]="24" class="detailtable">
          <nz-table [nzTemplateMode]="true" nzBordered>
            <tbody>
              <tr>
                <td class="w-50" [ngClass]="{'padbot-zero': isEditMode == true}">
                  <div nz-row>
                    <div nz-col [nzSpan]="8" [ngClass]="{'padtop-5': isEditMode == true}">Loại</div>
                    <div nz-col [nzSpan]="16" class="description-info">
                      <ng-container *ngIf="!isEditMode; else editVolumeTypeTpl">
                        {{detailCluster.volumeCloudType == 'hdd' ? 'HDD' : 'SSD'}}
                      </ng-container>
                      <ng-template #editVolumeTypeTpl>
                        <nz-form-item>
                          <nz-form-control>
                            <nz-radio-group formControlName="volumeCloudType">
                              <label nz-radio nzValue="hdd">HDD</label>
                              <label nz-radio nzValue="sdd">SDD</label>
                            </nz-radio-group>
                          </nz-form-control>
                        </nz-form-item>
                      </ng-template>
                    </div>
                  </div>
                </td>

                <td class="w-50" [ngClass]="{'padbot-zero': isEditMode == true}">
                  <div nz-row>
                    <div nz-col [nzSpan]="8" [ngClass]="{'padtop-5': isEditMode == true}">Quota (GB)</div>
                    <div nz-col [nzSpan]="16" class="description-info">
                      <ng-container *ngIf="!isEditMode; else editVolumeSizeTpl">
                        {{detailCluster.volumeCloudSize}}
                      </ng-container>
                      <ng-template #editVolumeSizeTpl>
                        <nz-form-item>
                          <nz-form-control [nzErrorTip]="errorVolumeSizeTpl">
                            <input type="text" nz-input formControlName="volumeCloudSize" (keypress)="isNumber($event)"
                              (ngModelChange)="onChangeVolumeSize($event)" />
                          </nz-form-control>
                          <ng-template #errorVolumeSizeTpl let-control>
                            <ng-container *ngIf="control.hasError('required')">
                              Quota volume không để trống
                            </ng-container>
                            <ng-container *ngIf="control.hasError('max') || control.hasError('min')">
                              Quota trong khoảng từ 20-1000 (GB)
                            </ng-container>
                          </ng-template>
                        </nz-form-item>
                      </ng-template>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </div>
    </nz-card> -->

    <!-- Thông tin SSH -->
    <nz-card class="border-card">
      <h3>SSH Key</h3>
      <div nz-row>
        <div nz-col [nzSpan]="12" class="detailtable">
          <nz-table [nzTemplateMode]="true" nzBordered>
            <tbody>
              <tr>
                <td class="w-50">
                  <div nz-row>
                    <div nz-col [nzSpan]="8">SSH Key</div>
                    <div nz-col [nzSpan]="16">
                      <span class="description-info">
                        k8s-{{detailCluster.clusterName}}-ssh_keypair
                      </span>
                      <button nz-button nzType="text" (click)="handleDownloadSSHkey()"
                        class="action-icon borderless" nzTooltipTitle="Tải SSH Key" nzTooltipPlacement="top"
                        nz-tooltip>
                        <span nz-icon>
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20.5 10.19H17.61C15.24 10.19 13.31 8.26 13.31 5.89V3C13.31 2.45 12.86 2 12.31 2H8.07C4.99 2 2.5 4 2.5 7.57V16.43C2.5 20 4.99 22 8.07 22H15.93C19.01 22 21.5 20 21.5 16.43V11.19C21.5 10.64 21.05 10.19 20.5 10.19ZM12.28 15.78L10.28 17.78C10.21 17.85 10.12 17.91 10.03 17.94C9.94 17.98 9.85 18 9.75 18C9.65 18 9.56 17.98 9.47 17.94C9.39 17.91 9.31 17.85 9.25 17.79C9.24 17.78 9.23 17.78 9.23 17.77L7.23 15.77C6.94 15.48 6.94 15 7.23 14.71C7.52 14.42 8 14.42 8.29 14.71L9 15.44V11.25C9 10.84 9.34 10.5 9.75 10.5C10.16 10.5 10.5 10.84 10.5 11.25V15.44L11.22 14.72C11.51 14.43 11.99 14.43 12.28 14.72C12.57 15.01 12.57 15.49 12.28 15.78Z" fill="#005999"/>
                            <path d="M17.4299 8.81048C18.3799 8.82048 19.6999 8.82048 20.8299 8.82048C21.3999 8.82048 21.6999 8.15048 21.2999 7.75048C19.8599 6.30048 17.2799 3.69048 15.7999 2.21048C15.3899 1.80048 14.6799 2.08048 14.6799 2.65048V6.14048C14.6799 7.60048 15.9199 8.81048 17.4299 8.81048Z" fill="#005999"/>
                          </svg>
                        </span>
                      </button>
                      <button nz-button nzType="text" class="action-icon borderless"
                        nzTooltipTitle="Sao chép" nzTooltipPlacement="top" nz-tooltip (click)="handleCopySSHKey()">
                        <span nz-icon>
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 12.9V17.1C16 20.6 14.6 22 11.1 22H6.9C3.4 22 2 20.6 2 17.1V12.9C2 9.4 3.4 8 6.9 8H11.1C14.6 8 16 9.4 16 12.9Z" stroke="#0066B0" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M22 6.9V11.1C22 14.6 20.6 16 17.1 16H16V12.9C16 9.4 14.6 8 11.1 8H8V6.9C8 3.4 9.4 2 12.9 2H17.1C20.6 2 22 3.4 22 6.9Z" stroke="#0066B0" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </span>
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </div>

    </nz-card>

  </form>

</ng-container>

<ng-template #loadingTpl>
  loading ...
</ng-template>

<!-- modal upgrade -->
<nz-modal [(nzVisible)]="showModalUpgradeVersion" nzTitle="Nâng cấp phiên bản"
  (nzOnCancel)="handleCancelShowModalUpgrade()">
  <div *nzModalContent>
    <ng-container *ngIf="detailCluster.upgradeVersion?.length > 0; else noAvailableVersionTpl">
      <p class="description-info">Lưu ý: Chỉ có thể nâng cấp phiên bản, không thực hiện việc hạ phiên bản.</p>
      <p>Để tránh phát sinh vấn đề trong quá trình xử lý, chỉ nâng cấp phiên bản lần lượt theo thứ tự.</p>
      <div>
        <nz-select nzPlaceHolder="Chọn phiên bản nâng cấp" [(ngModel)]="upgradeVersionCluster" class="w-100">
          <nz-option *ngFor="let item of listOfK8sVersion" [nzLabel]="item.k8sVersion" [nzValue]="item.k8sVersion"
            [nzDisabled]="item.k8sVersion | checkUpgradeVersion : detailCluster.upgradeVersion"></nz-option>
        </nz-select>
      </div>
    </ng-container>
    <ng-template #noAvailableVersionTpl>
      Bạn đang sử dụng phiên bản <b>{{detailCluster.currentVersion}}</b> mới nhất
    </ng-template>
  </div>
  <div *nzModalFooter>
    <ng-container *ngIf="detailCluster.upgradeVersion?.length > 0; else noAvailableVersionFooterTpl">
      <button nz-button nzType="default" (click)="handleCancelShowModalUpgrade()">Hủy bỏ</button>
      <button nz-button nzType="primary" (click)="handleUpgadeVersionCluster()" [nzLoading]="isUpgradingVersion"
        [disabled]="upgradeVersionCluster == null || upgradeVersionCluster == undefined">Xác nhận</button>
    </ng-container>
    <ng-template #noAvailableVersionFooterTpl>
      <button nz-button nzType="default" (click)="handleCancelShowModalUpgrade()">Đóng</button>
    </ng-template>
  </div>
</nz-modal>

<!-- modal upgrade cluster -->
<nz-modal [(nzVisible)]="showModalUpgradeWorker" nzTitle="Nâng cấp nhóm worker"
  (nzOnCancel)="handleCancelModalUpgradeWorker()">
  <div *nzModalContent>
    <nz-alert
      nzType="warning"
      [nzDescription]="warningDes"
      nzShowIcon
    ></nz-alert>
    <ng-template #warningDes>
      <div class="warning-description">Hệ thống sẽ bị gián đoạn trong quá trình nâng cấp.</div>
      <div class="warning-description mt-1">Bạn có muốn nâng cấp không?</div>
    </ng-template>
  </div>
  <div *nzModalFooter>
    <button nz-button nzType="default" (click)="handleCancelModalUpgradeWorker()">
      <span nz-icon nzType="close" nzTheme="outline"></span>
      Hủy bỏ
    </button>
    <button nz-button nzType="primary" (click)="onSubmitUpgradeWorker()" [nzLoading]="isUpgradingWorker"
      [disabled]="upgradeForm.invalid">
      <span nz-icon nzType="check" nzTheme="outline"></span>
      Xác nhận
    </button>
  </div>
</nz-modal>

<!-- modal view kubeconfig -->
<nz-modal [(nzVisible)]="showModalKubeConfig" [nzTitle]="viewKubeConfigTitle" [nzContent]="viewKubeConfigBodyTpl"
  [nzFooter]="viewKubeConfigFooterTpl" (nzOnCancel)="handleCancelModalViewKubeConfig()">
  <ng-template #viewKubeConfigTitle>
    <div>
      <label>Cluster {{detailCluster.clusterName}} Kubenetes Config</label>
      <div class="modal-btn">
        <button nz-button nzType="text" class="borderless" (click)="handleCopyKubeConfig()" style="height: fit-content;"
          nzTooltipTitle="Sao chép" nzTooltipPlacement="top" nz-tooltip>
          <span nz-icon nzType="copy" nzTheme="outline" class="primary-color"></span>
        </button>
        <button nz-button nzType="text" class="borderless" (click)="handleDownloadKubeConfig()"
          style="height: fit-content;" nzTooltipTitle="Tải file cấu hình" nzTooltipPlacement="top" nz-tooltip>
          <span nz-icon class="primary-color">
            <svg viewBox="64 64 896 896" focusable="false">
              <path
                d="M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z" />
            </svg>
          </span>
        </button>
      </div>
    </div>
  </ng-template>

  <ng-template #viewKubeConfigBodyTpl>
    <div class="modal-view">
      <pre>{{yamlString}}</pre>
    </div>
  </ng-template>

  <ng-template #viewKubeConfigFooterTpl>
    <button nz-button nzType="primary" (click)="handleCancelModalViewKubeConfig()">
      <span nz-icon nzType="check" nzTheme="outline"></span>
      Đóng
    </button>
  </ng-template>
</nz-modal>
