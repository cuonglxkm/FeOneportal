<page-header [breadcrumb]="breadcrumb" [action]="action" [title]="('app.cluster.extend-service' | i18n) + ': ' + detailCluster?.clusterName">
  <ng-template #breadcrumb>
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        <a [routerLink]="['/']">{{ 'app.breadcrumb.home' | i18n }}</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/app-kubernetes']">Container</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['/app-kubernetes']">{{ 'app.cluster.list' | i18n }}</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        {{ 'app.cluster.extend-service' | i18n }}: <ng-container *ngIf="detailCluster"><b>{{detailCluster?.clusterName}}</b></ng-container>
      </nz-breadcrumb-item>
    </nz-breadcrumb>
  </ng-template>

  <!-- action -->
  <ng-template #action>
    <div class="alain-custom-action text-right">
      <region-select-dropdown (valueChanged)="onRegionChange($event)" [isDetail]="true"></region-select-dropdown>
      <project-select-dropdown [regionId]="regionId" (valueChanged)="onProjectChange($event)"
        [isDetail]="true"></project-select-dropdown>
    </div>
  </ng-template>
</page-header>

<div nz-row [nzGutter]="16">
  <div nz-col [nzSpan]="16" class="gutter-row">
    <ng-container *ngIf="detailCluster; else loadingClusterTpl">
      <nz-card class="border-card">
        <h3>{{ 'app.cluster.overall' | i18n }}</h3>
        <div class="detailtable">
          <nz-table [nzTemplateMode]="true" nzBordered>
            <tbody>
              <tr>
                <td class="w-50"><row-data [value]="detailCluster.clusterName" [label]="'app.cluster.name' | i18n"></row-data></td>
                <td class="w-50"><row-data [value]="detailCluster.currentVersion"
                    [label]="'app.cluster.version' | i18n"></row-data></td>
              </tr>

              <tr>
                <td class="w-50"><row-data [value]="detailCluster.apiEndpoint" [label]="'API Endpoint'"></row-data></td>
                <td class="w-50">
                  <div nz-row>
                    <div nz-col [nzSpan]="8">{{ 'app.text.status' | i18n }}</div>
                    <div nz-col [nzSpan]="16">
                      <ng-container *ngIf="detailCluster.serviceStatus | status2ColorPipe as status">
                        <span [ngStyle]="{color: status.color, 'font-weight': 600}">{{status.status}}</span>
                      </ng-container>
                    </div>
                  </div>
                </td>
                <!-- <td class="w-50">
                  <div nz-row>
                    <div nz-col [nzSpan]="8">Mã đơn hàng</div>
                    <div nz-col [nzSpan]="16">
                      <span style="font-size: 16px; font-weight: 600;">
                        <a [routerLink]="'/app-smart-cloud/order/detail/' + detailCluster.orderId"
                          target="_blank">{{detailCluster.orderCode}}</a>
                      </span>
                    </div>
                  </div>
                </td> -->
              </tr>

              <tr>
                <td class="w-50"><row-data [value]="detailCluster.createdDate | date: 'dd/MM/yyyy'"
                    [label]="'app.text.creation-time' | i18n"></row-data></td>
                <td class="w-50 border-cell"><row-data
                    [value]="(detailCluster.createdDate | calculateDate : detailCluster.usageTime) | date: 'dd/MM/yyyy'"
                    [label]="'app.service.expiration-date' | i18n" [type]="'danger'"></row-data></td>
              </tr>

              <tr>
                <td><row-data [value]="detailCluster.description" [label]="'app.cluster.description' | i18n"></row-data></td>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </nz-card>

      <!-- Thông tin worker group -->
      <nz-card class="border-card">
        <h3>{{ 'app.cluster.wg-info' | i18n }}</h3>
        <ng-container *ngFor="let item of detailCluster.workerGroup ; let i = index;">
          <div nz-row>
            <div nz-col [nzSpan]="24" class="detailtable">
              <nz-table [nzTemplateMode]="true" nzBordered>
                <tbody>
                  <tr>
                    <td class="w-50"><row-data [value]="item.workerGroupName" [label]="'app.cluster.worker-group-name' | i18n"></row-data>
                    </td>
                    <td class="w-50"><row-data [value]="item.minimumNode" [label]="'app.cluster.node-number' | i18n"></row-data></td>
                  </tr>

                  <tr>
                    <td class="w-50"><row-data [value]="item.cpu + 'vCPU / ' + item.ram + 'GB'"
                        [label]="'app.config' | i18n"></row-data></td>
                    <td class="w-50"><row-data [value]="item.volumeSize" [label]="'app.cluster.storage' | i18n"></row-data></td>
                  </tr>

                  <tr>
                    <td class="w-50">
                      <div nz-row>
                        <div nz-col [nzSpan]="8">Auto scale</div>
                        <div nz-col [nzSpan]="16" class="description-info">
                          <span class="weight-600">{{item.autoScalingWorker == true ? ('app.start' | i18n): ('app.off' | i18n)}}</span>
                        </div>
                      </div>
                    </td>

                    <td class="w-50"><row-data [value]="item.volumeTypeName" [label]="'app.hard.drive.type' | i18n"></row-data></td>
                  </tr>

                  <ng-container *ngIf="isAutoScale">
                    <tr>
                      <td class="w-50"><row-data [value]="item.minimumNode" [label]="'app.cluster.minimum-node' | i18n"></row-data></td>
                      <td class="w-50"><row-data [value]="item.maximumNode" [label]="'app.cluster.maximum-node' | i18n"></row-data></td>
                    </tr>
                  </ng-container>
                </tbody>
              </nz-table>
            </div>

            <ng-container *ngIf="detailCluster?.workerGroup.length > 0 && i != detailCluster?.workerGroup.length - 1">
              <nz-divider nzDashed></nz-divider>
            </ng-container>
          </div>
        </ng-container>
      </nz-card>

      <!-- Thông tin network -->
      <nz-card class="border-card">
        <h3>{{ 'app.cluster.network' | i18n }}</h3>
        <div nz-row>
          <div nz-col [nzSpan]="24" class="detailtable">
            <nz-table [nzTemplateMode]="true" nzBordered>
              <tbody>
                <tr>
                  <td class="w-50"><row-data [value]="detailCluster.networkType | network2label"
                      [label]="'app.cluster.network-type' | i18n"></row-data></td>
                  <td class="w-50"><row-data [value]="detailCluster.cidr" [label]="'Pod CIDR'"></row-data></td>
                </tr>

                <tr>
                  <td class="w-50"><row-data [value]="vpcNetwork" [label]="'app.cluster.vpc-network' | i18n"></row-data></td>
                  <td class="w-50"><row-data [value]="detailCluster.serviceCidr" [label]="'Service CIDR'"></row-data>
                  </td>
                </tr>

                <tr>
                  <td class="w-50"><row-data [value]="detailCluster.subnet" [label]="'Subnet'"></row-data></td>
                </tr>
              </tbody>
            </nz-table>
          </div>
        </div>
      </nz-card>
    </ng-container>
    <ng-template #loadingClusterTpl>
      <nz-card class="border-card">
        <nz-table [nzTemplateMode]="true" [nzLoading]="true">
        </nz-table>
      </nz-card>
    </ng-template>

    <nz-card class="border-card">
      <h3>{{ 'app.extension.info' | i18n }}</h3>

      <div nz-row [nzGutter]="16">
        <div nz-col [nzSpan]="12">
          <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="8"><label>{{ 'app.cluster.created-date' | i18n }}</label></div>
            <div nz-col [nzSpan]="16"><label class="weight-600">{{detailCluster?.createdDate | date: 'dd/MM/yyyy'}}</label></div>
          </div>
        </div>

        <div nz-col [nzSpan]="12">
          <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="8"><label>{{ 'app.service.expiration-date' | i18n }}</label></div>
            <div nz-col [nzSpan]="16"><label class="weight-600">{{expiryDate | date: 'dd/MM/yyyy'}}</label></div>
          </div>
        </div>
      </div>

      <div class="mt-3">
        <label>{{ 'app.months.for.extend' | i18n }} (<span class="required-color">*</span>)</label>
        <input type="number" nz-input [placeholder]="'cluster.placeholder.extend-month' | i18n"
          [(ngModel)]="extendMonth" (ngModelChange)="onSelectUsageTime($event)" nzSize="large" />
      </div>

      <div class="mt-3 delete-icon">
        <label>{{ 'app.expected.expiry.date' | i18n }}: <span class="weight-600">{{expectedExpirationDate | date: 'dd/MM/yyyy'}}</span></label>
      </div>
    </nz-card>

  </div>

  <!-- payment tab -->
  <div nz-col [nzSpan]="8" class="gutter-row">
    <nz-affix [nzOffsetTop]="72">
      <nz-card class="border-card price-card">
        <h3 class="mb-3">{{ 'app.estimated.cost' | i18n }}</h3>

        <div nz-row [nzGutter]="8">
          <div nz-col [nzSpan]="12">
            <div class="ml-3 mb-3"><label class="weight-600">
              {{ 'app.dashboard.service.near.expire.service.name' | i18n }}</label>
            </div>
          </div>

          <div nz-col [nzSpan]="12">
            <div class="price-style mr-3 mb-3">{{detailCluster?.clusterName}}</div>
          </div>
        </div>

        <div nz-row [nzGutter]="8">
          <div nz-col [nzSpan]="12">
            <div class="ml-3 mb-3"><label class="weight-600">{{ 'app.text.version' | i18n }}</label></div>
          </div>

          <div nz-col [nzSpan]="12">
            <div class="price-style mr-3 mb-3">{{detailCluster?.currentVersion}}</div>
          </div>
        </div>

        <div nz-row [nzGutter]="8">
          <ng-container *ngIf="currentPack; else customPackSummaryTpl">
            <div nz-col [nzSpan]="12">
              <div class="ml-3 mb-3"><label class="weight-600">
                {{ 'app.text.package' | i18n }}: <b>{{currentPack.packName}}</b></label>
              </div>
            </div>

            <div nz-col [nzSpan]="12">
              <div class="mr-3 summary-info">
                {{currentPack.cpu}}vCPU / {{currentPack.ram}}GB / {{currentPack.rootStorage}}GB
                {{currentPack.rootStorageName}}
              </div>
            </div>
          </ng-container>
          <ng-template #customPackSummaryTpl>
            <div nz-col [nzSpan]="12">
              <div class="ml-3 mb-3"><label class="weight-600">{{ 'app.cluster.wg-info' | i18n }}</label></div>
            </div>

            <div nz-col [nzSpan]="12">
              <ng-container *ngFor="let item of detailCluster?.workerGroup">
                <div class="mb-3">
                  {{item.workerGroupName}} / {{item.cpu}}vCPU / {{item.ram}}GB / {{item.volumeSize}}GB {{item.volumeTypeName}}
                </div>
              </ng-container>
            </div>
          </ng-template>
        </div>

        <nz-divider class="divider-style"></nz-divider>

        <div nz-row [nzGutter]="8">
          <div nz-col [nzSpan]="12">
            <div class="ml-3"><label class="weight-600">{{ 'app.cost.a.month' | i18n }}</label></div>
          </div>

          <div nz-col [nzSpan]="12">
            <div class="price-style price-color mr-3">{{(costPerMonth ? costPerMonth : 0) | number: '1.0-0'}} VNĐ
            </div>
            <div class="price-style unit-color mr-3 mb-3">{{ 'app.cluster.unit-price-2' | i18n }}</div>
          </div>
        </div>

        <div nz-row [nzGutter]="8">
          <div nz-col [nzSpan]="12">
            <div class="ml-3"><label class="weight-600">{{ 'app.cluster.vat-cost-2' | i18n : {vat: '10'} }}</label></div>
          </div>

          <div nz-col [nzSpan]="12">
            <div class="price-style price-color mr-3">{{(vatCost ? vatCost : 0) | number: '1.0-0'}} VND</div>
            <div class="price-style unit-color mr-3">{{ 'app.cluster.unit-price-2' | i18n }}</div>
          </div>
        </div>

        <div nz-row [nzGutter]="8" class="mt-5 price-panel">
          <div nz-col [nzSpan]="12">
            <div class="mt-3 ml-3"><label class="weight-600">{{ 'app.cluster.total-cost' | i18n }}</label></div>
            <div class="mt-1 ml-3 mb-3 unit-color"><i>({{ 'app.cluster.vat-cost-1' | i18n : {vat: '10'} }})</i></div>
          </div>
          <div nz-col [nzSpan]="12">
            <div class="price-style total-color mt-3 mr-3">{{(totalCost && totalCost > 0 ? totalCost : 0) | number: '1.0-0'}} VND</div>
            <div class="price-style unit-color mr-3">{{ 'app.cluster.unit-price-2' | i18n }}</div>
          </div>
        </div>

        <div nz-row class="mt-5" [nzGutter]="16" nzJustify="center">
          <div nz-col [nzSpan]="12">
            <button nz-button nzType="default" nzBlock class="border-button" (click)="showModalCancelExtend()"
              [disabled]="isSubmitting">
              <span nz-icon nzType="close" nzTheme="outline"></span>
              {{ 'app.button.cancel' | i18n }}
            </button>
          </div>

          <div nz-col [nzSpan]="12">
            <button nz-button nzType="primary" nzBlock class="border-button" (click)="onExtendService()"
              [disabled]="isSubmitting || this.extendMonth == null || this.extendMonth == undefined || detailCluster?.serviceStatus != 2">
              <ng-container *ngIf="isSubmitting; else paymentIconTpl">
                <span nz-icon [nzType]="'loading'"></span>
              </ng-container>
              <ng-template #paymentIconTpl>
                <span nz-icon>
                  <svg width="22" height="21" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8.5 2V5" stroke="#989BB3" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16.5 2V5" stroke="#989BB3" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M4 9.09009H21" stroke="#989BB3" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M21.5 8.5V17C21.5 20 20 22 16.5 22H8.5C5 22 3.5 20 3.5 17V8.5C3.5 5.5 5 3.5 8.5 3.5H16.5C20 3.5 21.5 5.5 21.5 8.5Z" stroke="#989BB3" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16.1947 13.7H16.2037" stroke="#989BB3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16.1947 16.7H16.2037" stroke="#989BB3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12.4955 13.7H12.5045" stroke="#989BB3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12.4955 16.7H12.5045" stroke="#989BB3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.79431 13.7H8.80329" stroke="#989BB3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.79431 16.7H8.80329" stroke="#989BB3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              </ng-template>
              <span>{{ 'app.button.extend' | i18n }}</span>
            </button>
          </div>
        </div>

      </nz-card>
    </nz-affix>
  </div>
</div>

<!-- modal cancel upgrade -->
<nz-modal [(nzVisible)]="isShowModalCancelExtend" [nzTitle]="modalTitle" [nzContent]="modalContent"
  [nzFooter]="modalFooter" (nzOnCancel)="handleCancelModal()">
  <ng-template #modalTitle>{{ 'app.cluster.title-cancel' | i18n }}</ng-template>

  <ng-template #modalContent>
    <nz-alert nzType="warning" [nzDescription]="cancelWarning" nzShowIcon></nz-alert>
    <ng-template #cancelWarning>
      <div class="warning-description">{{ 'app.cluster.cancel-desciption-1' | i18n }}</div>
      <div class="delete-color warning-description mt-1">{{ 'app.cluster.cancel-desciption-2' | i18n }}</div>
    </ng-template>
  </ng-template>

  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="handleCancelModal()" [disabled]="isSubmitDelete">
      <span nz-icon nzType="close" nzTheme="outline"></span>
      {{ 'app.button.cancel' | i18n }}
    </button>
    <button nz-button nzType="primary" (click)="back2list()">
      <span nz-icon nzType="check" nzTheme="outline"></span>
      {{ 'app.button.confirm' | i18n }}
    </button>
  </ng-template>
</nz-modal>
